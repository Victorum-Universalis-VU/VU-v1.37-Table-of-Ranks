# Triggers and effects will be given the Actor's scope, with the Recipient's as FROM

static_actions = { # static_actions is a reserved token.

	# alert_index maps to the frame of the alert icon
	royal_marriage = { alert_index = 1 alert_tooltip = ICON_RM }
	requestpeace = { alert_index = 2 alert_tooltip = ICON_PEACE  } # alert_index will be overwritten in code for this one.
	allianceaction = { alert_index = 3 alert_tooltip = ICON_ALLIANCE }
	# 4 is currently unused.
	integrationaction = { alert_index = 5 alert_tooltip = ICON_ANNEX }
	annexationaction = { alert_index = 5 alert_tooltip = ICON_ANNEX }
	vassalaction = { alert_index = 6 alert_tooltip = ICON_VASSAL }
	milaccess = { alert_index = 7 alert_tooltip = ICON_ASKMIL }
	fleet_access = { alert_index = 8 alert_tooltip = ICON_ASKFLEET }
	offermilaccess = { alert_index = 9 alert_tooltip = ICON_OFFACC }
	callaction = { alert_index = 10 alert_tooltip = ICON_CALLALLY } # This one is referred to in the code (settings.cpp)
	offerloan = { alert_index = 11 alert_tooltip = ICON_OFFERLOAN }
	sellprov = { alert_index = 12 alert_tooltip = ICON_PROVSALE }
	#13 is cursed
	request_to_join_federation = { alert_index = 14 alert_tooltip = ICON_FEDERATIONREQUEST }
	invite_to_federation = { alert_index = 15 alert_tooltip = ICON_FEDERATIONINVITE }
	transfer_trade_power = { alert_index = 16 alert_tooltip = TRANSFER_TRADE_POWER }
	religious_unity_action = { alert_index = 17 alert_tooltip = ICON_RELIGIOUS_UNITY }
	#18 is used by requestpeace
	form_coalition = { alert_index = 19 alert_tooltip = ICON_FORM_COALITION }
	enforce_peace = { alert_index = 20 alert_tooltip = ICON_ENFORCE_PEACE } # This one may be overwritten in code.
	grant_electorate = { alert_index = 21 alert_tooltip = ICON_GRANT_ELECTORATE }
	demand_unlawful_territory_action = { alert_index = 22 alert_tooltip = ICON_DEMAND_UNLAWFUL_TERRITORY }
	# 23 is used by requestpeace
	# 24 is used by requestpeace
	# 25 is used by requestpeace
	# 26 is used by requestpeace
	# 27 is used by enforce_peace (when actor is coalition leader) with tooltip "ICON_ENFORCE_PEACE_COALITION_LEADER"
	support_independence_action = { alert_index = 28 alert_tooltip = support_independence }
	steer_trade = { alert_index = 29 alert_tooltip = ICON_STEER_TRADE }
	ask_for_march = { alert_index = 30 alert_tooltip = ICON_MARCH }
	sell_ships_action = { alert_index = 31 alert_tooltip = ICON_FLEETSALE }
	grant_freecity = { alert_index = 32 alert_tooltip = ICON_GRANT_FREECITY }
	# 33 is currently unused
	invite_to_trade_league = { alert_index = 34 alert_tooltip = ICON_TRADELEAGUEINVITE }
	request_to_join_trade_league = { alert_index = 35 alert_tooltip = ICON_TRADELEAGUEREQUEST }
	sharemap = { alert_index = 36 alert_tooltip = ICON_REQUESTSHAREMAP } # alert_tooltip gets special treatment in the code
	condottieri_action = { alert_index = 37 alert_tooltip = ICON_CONDOTTIERI }
	offer_fleet_access = { alert_index = 38 alert_tooltip = ICON_OFFERFLEET }
	break_alliance = { alert_index = 39 alert_tooltip = ICON_BREAK_ALLIANCE }
	tributary_state_action = { alert_index = 40 alert_tooltip = ICON_TRIBUTARY }
	ask_for_tributary_state_action = { alert_index = 41 alert_tooltip = ICON_ASK_TRIBUTARY }
	knowledge_sharing = { alert_index = 42 alert_tooltip = ICON_KNOWLEDGESHARE } #The answer to life
	# 43 is currently unused
	charter_company = { alert_index = 44 alert_tooltip = ICON_CHARTERCOMPANY }
	#reduce_relations_favor = { alert_index = 45 alert_tooltip = ICON_TRADEFAVORSFORREDUCERELATIONS }
	#return_core_favor = { alert_index = 46 alert_tooltip = ICON_TRADEFAVORSFORRETURNCORE }
	#break_alliance_favor = { alert_index = 47 alert_tooltip = ICON_TRADEFAVORSFORBREAKALLIANCE }
	#trade_favors_for_trust = { alert_index = 48 alert_tooltip = ICON_TRADEFAVORSFORTRUST }
	#trade_favors_for_men = { alert_index = 49 alert_tooltip = ICON_TRADEFAVORSFORMEN }
	#trade_favors_for_sailors = { alert_index = 50 alert_tooltip = ICON_TRADEFAVORSFORSAILORS }
	#trade_favors_for_heir = { alert_index = 51 alert_tooltip = ICON_TRADEFAVORSFORHEIR }
	#trade_favors_for_war_prep = { alert_index = 52 alert_tooltip = ICON_TRADEFAVORSFORWARPREP }
	#trade_favors_for_gold = { alert_index = 53 alert_tooltip = ICON_TRADEFAVORSFORGOLD }
	#ask_knowledge_sharing = { alert_index = 55 alert_tooltip = ICON_ASKKNOWLEDGESHARE }
}

grant_imperial_court = {
	category = emperor


	require_acceptance = no 

	is_visible = {
		is_emperor = yes
		NOT = {
			FROM = {
				OR = {
					has_country_flag = GE_HRE_Imperial_Court
					has_country_flag = GE_HRE_Imperial_Marshall
				}
			}
		}
		FROM = {
			is_part_of_hre = yes
		}
		NOT = {
			any_country = {
				has_country_flag = GE_HRE_Imperial_Court
			}
		}
	}
	is_allowed = {
		is_emperor = yes
		NOT = {
			FROM = {
				OR = {
					has_country_flag = GE_HRE_Imperial_Court
					has_country_flag = GE_HRE_Imperial_Marshall
				}
			}
		}
		FROM = {
			is_part_of_hre = yes
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_HRE_Imperial_Court
			country_event = {
				id = GE_privileges.13
			}
		}
		ROOT = {
			add_ruler_modifier = {
				name = GE_HRE_Emperor_has_Judge
				duration = -1
			}
			if = {
				limit = {
					NOT = {
						ai = yes
					}
				}
				add_imperial_influence = -5
			}
		}
	}
	#on_decline = {}
	#ai_acceptance = {} # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.

	ai_will_do = { # this is a trigger
		FROM = {
			calc_true_if = {
				is_elector = yes
				any_ally = {
					tag = ROOT
				}
				marriage_with = ROOT
				ROOT = {				
					has_opinion = {
						who = FROM
						value = 200
					}
				}
				amount = 3
			}
		}
	}
}

cancel_imperial_court = {
	category = emperor
	require_acceptance = no
	is_visible = {
		is_emperor = yes
		FROM = {
			has_country_flag = GE_HRE_Imperial_Court
		}
	}
	is_allowed = {
		is_emperor = yes
		FROM = {
			has_country_flag = GE_HRE_Imperial_Court
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = GE_HRE_Imperial_Court
			country_event = {
				id = GE_privileges.14
			}
		}
	}
	ai_will_do = {
		OR = {
			FROM = {
				NOT = {
					calc_true_if = {
						is_elector = yes
						any_ally = {
							tag = ROOT
						}
						marriage_with = ROOT
						ROOT = {				
							has_opinion = {
								who = FROM
								value = 200
							}
						}
						amount = 3
					}
				}
			}
			ROOT = {
				NOT = {
					has_ruler_modifier = GE_HRE_Emperor_has_Judge
				}
			}
		}
	}
}

grant_imperial_marshall = {
	category = emperor


	require_acceptance = no 

	is_visible = {
		is_emperor = yes
		NOT = {
			FROM = {
				OR = {
					has_country_flag = GE_HRE_Imperial_Court
					has_country_flag = GE_HRE_Imperial_Marshall
				}
			}
		}
		FROM = {
			is_part_of_hre = yes
		}
		NOT = {
			any_country = {
				has_country_flag = GE_HRE_Imperial_Marshall
			}
		}
	}
	is_allowed = {
		is_emperor = yes
		NOT = {
			FROM = {
				OR = {
					has_country_flag = GE_HRE_Imperial_Court
					has_country_flag = GE_HRE_Imperial_Marshall
				}
			}
		}
		FROM = {
			is_part_of_hre = yes
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_HRE_Imperial_Marshall
			country_event = {
				id = GE_privileges.15
			}
		}
		ROOT = {
			add_ruler_modifier = {
				name = GE_HRE_Emperor_has_Marshall
				duration = -1
			}
			if = {
				limit = {
					NOT = {
						ai = yes
					}
				}
				add_imperial_influence = -5
			}
		}
	}
	#on_decline = {}
	#ai_acceptance = {} # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.

	ai_will_do = { # this is a trigger
		FROM = {
			calc_true_if = {
				is_elector = yes
				any_ally = {
					tag = ROOT
				}
				marriage_with = ROOT
				ROOT = {				
					has_opinion = {
						who = FROM
						value = 200
					}
				}
				amount = 3
			}
		}
	}
}

cancel_imperial_marshall = {
	category = emperor
	require_acceptance = no
	is_visible = {
		is_emperor = yes
		FROM = {
			has_country_flag = GE_HRE_Imperial_Marshall
		}
	}
	is_allowed = {
		is_emperor = yes
		FROM = {
			has_country_flag = GE_HRE_Imperial_Marshall
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = GE_HRE_Imperial_Marshall
			country_event = {
				id = GE_privileges.16
			}
		}
	}
	ai_will_do = {
		OR = {
			FROM = {
				NOT = {
					calc_true_if = {
						is_elector = yes
						any_ally = {
							tag = ROOT
						}
						marriage_with = ROOT
						ROOT = {				
							has_opinion = {
								who = FROM
								value = 200
							}
						}
						amount = 3
					}
				}
			}
			ROOT = {
				NOT = {
					has_ruler_modifier = GE_HRE_Emperor_has_Marshall
				}
			}
		}
	}
}

cancel_trade_deal_generic = {
	category = trade
	require_acceptance = no
	is_visible = {
		OR = {
			AND = {
				FROM = {
					has_country_flag = GE_Trade_Deal_With_@Root
				}
				ROOT = {
					has_country_flag = GE_Trade_Deal_From_@From
				}
			}
			AND = {
				FROM = {
					has_country_flag = GE_Trade_Deal_From_@Root
				}
				ROOT = {
					has_country_flag = GE_Trade_Deal_With_@From
				}
			}
		}
	}
	is_allowed = {
		hidden_trigger = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			if = {
				limit = {
					has_country_flag = GE_Trade_Deal_With_@Root
				}
				change_variable = {
					which = GE_num_of_incoming_trade
					value = -1
				}
				add_import_effect = yes
				clr_country_flag = GE_Trade_Deal_With_@Root
			}
			if = {
				limit = {
					has_country_flag = GE_Trade_Deal_From_@Root
				}
				change_variable = {
					which = GE_num_of_outgoing_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Trade_Deal_From_@Root
			}	
			if = {
				limit = {
					has_country_flag = GE_Initiated_Trade_Deal_With_@Root
				}
				change_variable = {
					which = GE_num_of_total_trade
					value = -1
				}
				clr_country_flag = GE_Initiated_Trade_Deal_With_@Root
			}
			if = {
				limit = {
					has_country_flag = GE_Rural_Trade_Deal_From_@Root
				}
				change_variable = {
					which = GE_num_of_outgoing_rural_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Rural_Trade_Deal_From_@Root
			}
			if = {
				limit = {
					has_country_flag = GE_Urban_Trade_Deal_From_@Root
				}
				change_variable = {
					which = GE_num_of_outgoing_urban_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Urban_Trade_Deal_From_@Root
			}
			if = {
				limit = {
					has_country_flag = GE_Mining_Trade_Deal_From_@Root
				}
				change_variable = {
					which = GE_num_of_outgoing_mining_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Mining_Trade_Deal_From_@Root
			}
			if = {
				limit = {
					has_country_flag = GE_Plantation_Trade_Deal_From_@Root
				}
				change_variable = {
					which = GE_num_of_outgoing_plantation_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Plantation_Trade_Deal_From_@Root
			}
			if = {
				limit = {
					has_country_flag = GE_Rural_Trade_Deal_With_@ROOT
				}
				change_variable = {
					which = GE_num_of_incoming_rural_trade
					value = -1
				}
				clr_country_flag = GE_Rural_Trade_Deal_With_@ROOT
				add_import_effect = yes
			}
			if = {
				limit = {
					has_country_flag = GE_Urban_Trade_Deal_With_@ROOT
				}
				change_variable = {
					which = GE_num_of_incoming_urban_trade
					value = -1
				}
				clr_country_flag = GE_Urban_Trade_Deal_With_@ROOT
				add_import_effect = yes
			}
			if = {
				limit = {
					has_country_flag = GE_Mining_Trade_Deal_With_@ROOT
				}
				change_variable = {
					which = GE_num_of_incoming_mining_trade
					value = -1
				}
				clr_country_flag = GE_Mining_Trade_Deal_With_@ROOT
				add_import_effect = yes
			}
			if = {
				limit = {
					has_country_flag = GE_Plantation_Trade_Deal_With_@ROOT
				}
				change_variable = {
					which = GE_num_of_incoming_plantation_trade
					value = -1
				}
				clr_country_flag = GE_Plantation_Trade_Deal_With_@ROOT
				add_import_effect = yes
			}
			add_opinion = {
				who = ROOT
				modifier = GE_Cancel_Trade_Deal_Angry
			}
		}
		ROOT = {
			if = {
				limit = {
					has_country_flag = GE_Trade_Deal_With_@From
				}
				change_variable = {
					which = GE_num_of_incoming_trade
					value = -1
				}
				# change_variable = {
				# 	which = GE_num_of_total_trade
				# 	value = -1
				# }
				add_import_effect = yes
				clr_country_flag = GE_Trade_Deal_With_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Trade_Deal_From_@From
				}
				change_variable = {
					which = GE_num_of_outgoing_trade
					value = -1
				}
				# change_variable = {
				# 	which = GE_num_of_total_trade
				# 	value = -1
				# }
				add_export_effect = yes
				clr_country_flag = GE_Trade_Deal_From_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Initiated_Trade_Deal_With_@From
				}
				change_variable = {
					which = GE_num_of_total_trade
					value = -1
				}
				clr_country_flag = GE_Initiated_Trade_Deal_With_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Rural_Trade_Deal_From_@From
				}
				change_variable = {
					which = GE_num_of_outgoing_rural_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Rural_Trade_Deal_From_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Urban_Trade_Deal_From_@From
				}
				change_variable = {
					which = GE_num_of_outgoing_urban_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Urban_Trade_Deal_From_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Mining_Trade_Deal_From_@From
				}
				change_variable = {
					which = GE_num_of_outgoing_mining_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Mining_Trade_Deal_From_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Plantation_Trade_Deal_From_@From
				}
				change_variable = {
					which = GE_num_of_outgoing_plantation_trade
					value = -1
				}
				add_export_effect = yes
				clr_country_flag = GE_Plantation_Trade_Deal_From_@From
			}
			if = {
				limit = {
					has_country_flag = GE_Rural_Trade_Deal_With_@From
				}
				change_variable = {
					which = GE_num_of_incoming_rural_trade
					value = -1
				}
				clr_country_flag = GE_Rural_Trade_Deal_With_@From
				add_import_effect = yes
			}
			if = {
				limit = {
					has_country_flag = GE_Urban_Trade_Deal_With_@From
				}
				change_variable = {
					which = GE_num_of_incoming_urban_trade
					value = -1
				}
				clr_country_flag = GE_Urban_Trade_Deal_With_@From
				add_import_effect = yes
			}
			if = {
				limit = {
					has_country_flag = GE_Mining_Trade_Deal_With_@From
				}
				change_variable = {
					which = GE_num_of_incoming_mining_trade
					value = -1
				}
				clr_country_flag = GE_Mining_Trade_Deal_With_@From
				add_import_effect = yes
			}
			if = {
				limit = {
					has_country_flag = GE_Plantation_Trade_Deal_With_@From
				}
				change_variable = {
					which = GE_num_of_incoming_plantation_trade
					value = -1
				}
				clr_country_flag = GE_Plantation_Trade_Deal_With_@From
				add_import_effect = yes
			}
		}
	}
	ai_will_do = { # this is a trigger
		AND = {
			NOT = {
				FROM = {
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
			}
			NOT = {
				FROM = {
					OR = {
						alliance_with = ROOT
						AND = {
							is_trade_league_leader = yes
							is_in_trade_league_with = ROOT
						}
						AND = {
							ROOT = {
								is_trade_league_leader = yes
							}
							is_in_trade_league_with = ROOT
						}
					}
				}
			}
		}
	}
}

offer_trade_deal_rural_exports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		ROOT = {
			custom_trigger_tooltip = {
				tooltip = GE_ROOT_produces_enough_rural_goods
				check_variable = {
					which = GE_percentage_of_rural_goods
					value = 50
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_With_@Root
			set_country_flag = GE_Rural_Trade_Deal_With_@Root
			change_variable = {
				which = GE_num_of_incoming_rural_trade
				value = 1
			}
			add_import_effect = yes
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_From_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			set_country_flag = GE_Rural_Trade_Deal_From_@From
			change_variable = {
				which = GE_num_of_outgoing_rural_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_export_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+20% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #+5 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_rural_imports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		FROM = {
			custom_trigger_tooltip = {
				tooltip = GE_FROM_produces_enough_rural_goods
				check_variable = {
					which = GE_percentage_of_rural_goods
					value = 50
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_From_@Root
			set_country_flag = GE_Rural_Trade_Deal_From_@Root
			change_variable = {
				which = GE_num_of_outgoing_rural_trade
				value = 1
			}
			add_export_effect = yes	
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_With_@From
			set_country_flag = GE_Rural_Trade_Deal_With_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			change_variable = {
				which = GE_num_of_incoming_rural_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_import_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+20% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-15 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_urban_exports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		ROOT = {
			custom_trigger_tooltip = {
				tooltip = GE_ROOT_produces_enough_urban_goods
				check_variable = {
					which = GE_percentage_of_urban_goods
					value = 40
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_With_@Root
			set_country_flag = GE_Urban_Trade_Deal_With@Root
			change_variable = {
				which = GE_num_of_incoming_urban_trade
				value = 1
			}
			add_import_effect = yes
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_From_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			set_country_flag = GE_Urban_Trade_Deal_From_@From
			change_variable = {
				which = GE_num_of_outgoing_urban_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_export_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+20% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #+5 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_urban_imports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		FROM = {
			custom_trigger_tooltip = {
				tooltip = GE_FROM_produces_enough_urban_goods
				check_variable = {
					which = GE_percentage_of_urban_goods
					value = 40
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_From_@Root
			set_country_flag = GE_Urban_Trade_Deal_From_@Root
			change_variable = {
				which = GE_num_of_outgoing_urban_trade
				value = 1
			}
			add_export_effect = yes	
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_With_@From
			set_country_flag = GE_Urban_Trade_Deal_With_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			change_variable = {
				which = GE_num_of_incoming_urban_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_import_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+20% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-15 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_mining_exports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		ROOT = {
			custom_trigger_tooltip = {
				tooltip = GE_ROOT_produces_enough_mining_goods
				check_variable = {
					which = GE_percentage_of_mining_goods
					value = 20
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_With_@Root
			set_country_flag = GE_Mining_Trade_Deal_From@Root
			change_variable = {
				which = GE_num_of_incoming_mining_trade
				value = 1
			}
			add_import_effect = yes
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_From_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			set_country_flag = GE_Mining_Trade_Deal_With_@From
			change_variable = {
				which = GE_num_of_outgoing_mining_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_export_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+10% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #+5 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_mining_imports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		FROM = {
			custom_trigger_tooltip = {
				tooltip = GE_FROM_produces_enough_mining_goods
				check_variable = {
					which = GE_percentage_of_mining_goods
					value = 20
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_From_@Root
			set_country_flag = GE_Mining_Trade_Deal_From_@Root
			change_variable = {
				which = GE_num_of_outgoing_mining_trade
				value = 1
			}
			add_export_effect = yes	
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_With_@From
			set_country_flag = GE_Mining_Trade_Deal_With_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			change_variable = {
				which = GE_num_of_incoming_mining_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_import_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+20% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-15 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_plantation_exports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		ROOT = {
			custom_trigger_tooltip = {
				tooltip = GE_ROOT_produces_enough_plantation_goods
				check_variable = {
					which = GE_percentage_of_plantation_goods
					value = 10
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_With_@Root
			set_country_flag = GE_Plantation_Trade_Deal_With@Root
			change_variable = {
				which = GE_num_of_incoming_plantation_trade
				value = 1
			}
			add_import_effect = yes
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_From_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			set_country_flag = GE_Plantation_Trade_Deal_From_@From
			change_variable = {
				which = GE_num_of_outgoing_plantation_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_export_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+10% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #+5 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

offer_trade_deal_plantation_imports = {
	category = trade

    alert_index = 34 #27             # The alert to use for the action. Refer to static_actions for the indexes. Optional.
	alert_tooltip = ICON_GE_TD         # The localisation key to display in the alert tooltip. Optional.
	
	require_acceptance = yes

	is_visible = {
		has_global_modifier_value = {
			which = trade_deals_slots
			value = 1
		}
		NOT = {
			OR = {
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_With_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_From_@From
					}
				}
				AND = {
					FROM = {
						has_country_flag = GE_Trade_Deal_From_@Root
					}
					ROOT = {
						has_country_flag = GE_Trade_Deal_With_@From
					}
				}
			}
		}
	}
	is_allowed = {
		Trade_Deals_Allowed = yes
		FROM = {
			custom_trigger_tooltip = {
				tooltip = GE_FROM_produces_enough_plantation_goods
				check_variable = {
					which = GE_percentage_of_plantation_goods
					value = 10
				}
			}
		}
		hidden_trigger = {
			NOT = {
				OR = {
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
					}
					AND = {
						FROM = {
							has_country_flag = GE_Trade_Deal_From_@Root
						}
						ROOT = {
							has_country_flag = GE_Trade_Deal_With_@Root
						}
					}
				}
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = GE_Trade_Deal_From_@Root
			set_country_flag = GE_Plantation_Trade_Deal_From_@Root
			change_variable = {
				which = GE_num_of_outgoing_plantation_trade
				value = 1
			}
			add_export_effect = yes	
		}
		ROOT = {
			set_country_flag = GE_Trade_Deal_With_@From
			set_country_flag = GE_Plantation_Trade_Deal_With_@From
			set_country_flag = GE_Initiated_Trade_Deal_With_@From
			change_variable = {
				which = GE_num_of_incoming_plantation_trade
				value = 1
			}
			change_variable = {
				which = GE_num_of_total_trade
				value = 1
			}
			add_import_effect = yes
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {#+3*DipRep
			name = GE_diplomatic_reputation    # The localisation key to display for this factor
			
			# ai_value MUST always be created within an entry first.
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 3
			}
			# You can then change ai_value with effects such as multiply_variable, etc
		}
		add_entry = { #+10% Opinion
			name = GE_opinion_modifier
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM 
				with = ROOT  
			}
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
		add_entry = { #-10 base acceptance
			name = GE_base_acceptance
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10 #10
			}
		}
		add_entry = { #-10 if not Allied Player
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = no
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = { #-100 if not Allied AI
			name = GE_not_willing
			limit = {
				ROOT = {
					ai = yes
				}
				NOT = {
					FROM = {
						OR = {
							alliance_with = ROOT
							AND = {
								is_trade_league_leader = yes
								is_in_trade_league_with = ROOT
							}
							AND = {
								ROOT = {
									is_trade_league_leader = yes
								}
								is_in_trade_league_with = ROOT
							}
							is_subject_of = ROOT
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-100 if broken trade treaty
			name = GE_angry_merchants
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = GE_Cancel_Trade_Deal_Angry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = { #-15 Merchant Republic
			name = GE_merchant_republic
			limit = {
				FROM = {
					has_government_attribute = is_merchant_republic
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1      # Which exportable value to export
				who = ROOT                      # Who to export the value from
				with = FROM                     # Who the ai_value is for
			}
			multiply_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					is_trade_league_leader = yes
					is_in_trade_league_with = ROOT
				}
				AND = {
					ROOT = {
						is_trade_league_leader = yes
					}
					is_in_trade_league_with = ROOT
				}
			}
		}
	}
}

#Austrian
austria_increase_relations = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_government_mechanic = habsburg_glory
		dynasty = "von Habsburg"
	}

	is_allowed = {
		hidden_trigger = {
			has_government_mechanic = habsburg_glory
			dynasty = "von Habsburg"
		}
		has_government_power = {
			mechanic_type = habsburg_glory
			power_type = habsburg_glory_power
			value = 20
		}
	}

	on_accept = {
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = me_hab_spent_glory
			}
		}
		HAB_change_habsburg_glory = { remove = 20 }
		clr_country_flag = me_hab_improved_relations
		set_country_flag = me_hab_improved_relations
	}

	ai_will_do = {
		has_government_power = {
			mechanic_type = habsburg_glory
			power_type = habsburg_glory_power
			value = 60
		}
		FROM = {
			is_elector = yes
			NOT = { preferred_emperor = ROOT }
		}
		OR = {
			NOT = { has_country_flag = me_hab_add_favors }
			had_country_flag = { flag = me_hab_add_favors days = 1825 }
		}
	}
}

austria_add_favors = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_government_mechanic = habsburg_glory
		has_country_flag = me_hab_more_actions
		dynasty = "von Habsburg"
	}

	is_allowed = {
		hidden_trigger = {
			has_government_mechanic = habsburg_glory
			dynasty = "von Habsburg"
		}
		has_government_power = {
			mechanic_type = habsburg_glory
			power_type = habsburg_glory_power
			value = 25
		}
	}

	on_accept = {
		add_favors = {
		   who = FROM
		   amount = 10
		}
		add_favors = {
		   who = FROM
		   amount = 5
		}
		HAB_change_habsburg_glory = { remove = 25 }
		clr_country_flag = me_hab_add_favors
		set_country_flag = me_hab_add_favors
	}

	ai_will_do = {
		has_government_power = {
			mechanic_type = habsburg_glory
			power_type = habsburg_glory_power
			value = 60
		}
		FROM = {
			is_elector = yes
			NOT = { preferred_emperor = ROOT }
		}
		OR = {
			NOT = { has_country_flag = me_hab_add_favors }
			had_country_flag = { flag = me_hab_add_favors days = 1825 }
		}
	}
}

austria_put_relative_as_heir = {
	category = influence

	require_acceptance = yes

	is_visible = {
		has_government_mechanic = habsburg_glory
		dynasty = "von Habsburg"
		FROM = {
			government = monarchy
			has_government_attribute = heir
			religion_group = ROOT
			NOT = { dynasty = ROOT }
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_government_mechanic = habsburg_glory
			dynasty = "von Habsburg"
			FROM = {
				government = monarchy
				has_government_attribute = heir
				religion_group = ROOT
				NOT = { dynasty = ROOT }
			}
		}
		has_government_power = {
			mechanic_type = habsburg_glory
			power_type = habsburg_glory_power
			value = 80
		}
		FROM = {
			has_heir = no
		}
	}

	on_accept = {
		FROM = {
			define_heir = {
				dynasty = ROOT
				culture = ROOT
				religion = ROOT
				claim = 50
				male = yes
				adm = 2
				dip = 2
				mil = 2
				hidden = yes
				block_disinherit = yes
			}
		}
		if = {
			limit = {
				has_country_flag = me_hab_spread_dynasty_cheaper
			}
			HAB_change_habsburg_glory = { remove = 25 }
		}
		else = {
			HAB_change_habsburg_glory = { remove = 50 }
		}
		
		change_variable = {
			which = MEHABUsedSpreadDynasty
			value = 1
		}
	}

	on_decline = {
		FROM = {
			clr_country_flag = declined_heir_from_@ROOT
			set_country_flag = declined_heir_from_@ROOT
		}
	}

	ai_acceptance = {
		add_entry = {
			name = HAB_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = HAB_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
		}
		add_entry = {
			name = HAB_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = HAB_FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = HAB_FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = HAB_ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
		}
		add_entry = {
			name = HAB_ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = HAB_ROOT_FROM_ARE_HISTORICAL_RIVALS
			limit = {
				FROM = {
					historical_rival_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		has_government_power = {
			mechanic_type = habsburg_glory
			power_type = habsburg_glory_power
			value = 100
		}
		FROM = {
			total_development = 200
			religion = ROOT
			NOT = {	historical_rival_with = ROOT }
			NOT = { is_rival = ROOT }
			NOT = {	is_enemy = ROOT	}
			OR = {
				ai_attitude = { who = ROOT attitude = attitude_allied }
				ai_attitude = { who = ROOT attitude = attitude_friendly }
				ai_attitude = { who = ROOT attitude = attitude_threatened }
			}
			OR = {
				NOT = { has_country_flag = declined_heir_from_@ROOT }
				had_country_flag = { flag = declined_heir_from_@ROOT days = 1825 }
			}
		}
	}
}

austria_establish_imperial_treasurer = {
	category = emperor

	require_acceptance = no

	is_visible = {
		has_country_flag = me_hab_new_diplo_actions
		FROM = {
			capital_scope = {
				is_part_of_hre = yes
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_country_flag = me_hab_new_diplo_actions
		}
		NOT = { has_global_flag = imperial_treasurer_established }
		NOT = { has_country_modifier = me_hab_imperial_court_chaplain }
		NOT = { has_country_modifier = me_hab_imperial_marshall }
	}

	on_accept = {
		hidden_effect = {
			FROM = {
				country_event = { id = ME_Austria_Events.58 }
			}
			set_global_flag = imperial_treasurer_established
		}
		tooltip = {
			FROM = {
				add_country_modifier = {
					name = me_hab_imperial_treasurer
					duration = -1
				}
			}
		}
	}

	ai_will_do = {
		NOT = { has_global_flag = imperial_treasurer_established }
	}
}

austria_establish_imperial_marshall = {
	category = emperor

	require_acceptance = no

	is_visible = {
		has_country_flag = me_hab_new_diplo_actions
		FROM = {
			capital_scope = {
				is_part_of_hre = yes
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_country_flag = me_hab_new_diplo_actions
		}
		NOT = { has_global_flag = imperial_marshall_established }
		NOT = { has_country_modifier = me_hab_imperial_court_chaplain  }
		NOT = { has_country_modifier = me_hab_imperial_treasurer }
	}

	on_accept = {
		hidden_effect = {
			FROM = {
				country_event = { id = ME_Austria_Events.59 }
			}
			set_global_flag = imperial_marshall_established
		}
		tooltip = {
			FROM = {
				add_country_modifier = {
					name = me_hab_imperial_marshall
					duration = -1
				}
			}
		}
	}

	ai_will_do = {
		NOT = { has_global_flag = imperial_marshall_established }
	}
}

austria_establish_imperial_court_chaplain = {
	category = emperor

	require_acceptance = no

	is_visible = {
		has_country_flag = me_hab_new_diplo_actions
		FROM = {
			capital_scope = {
				is_part_of_hre = yes
			}
			government = theocracy
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_country_flag = me_hab_new_diplo_actions
		}
		NOT = { has_global_flag = imperial_court_chaplain_established }
		NOT = { has_country_modifier = me_hab_imperial_marshall }
		NOT = { has_country_modifier = me_hab_imperial_treasurer }
	}

	on_accept = {
		hidden_effect = {
			FROM = {
				country_event = { id = ME_Austria_Events.60 }
			}
			set_global_flag = imperial_court_chaplain_established
		}
		tooltip = {
			FROM = {
				add_country_modifier = {
					name = me_hab_imperial_court_chaplain
					duration = -1
				}
			}
		}
	}

	ai_will_do = {
		NOT = { has_global_flag = imperial_court_chaplain_established }
	}
}

##Subject stuff
call_pu_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = ME_Austrian_personal_union
		}
		is_at_war = yes
		OR = {
			is_in_war = {
				attacker_leader = ROOT
			}
			is_in_war = {
				defender_leader = ROOT
			}
		}
		any_country = {
			OR = {
				is_in_war = {
					attacker_leader = ROOT
					defender_leader = THIS
				}
				is_in_war = {
					attacker_leader = THIS
					defender_leader = ROOT
				}
			}
			NOT = { war_with = FROM }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = ME_Austrian_personal_union
			}
			is_at_war = yes
			OR = {
				is_in_war = {
					attacker_leader = ROOT
				}
				is_in_war = {
					defender_leader = ROOT
				}
			}
			any_country = {
				OR = {
					is_in_war = {
						attacker_leader = ROOT
						defender_leader = THIS
					}
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
					}
				}
				NOT = { war_with = FROM }
			}
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = ME_Austrian_personal_union
				}
				is_at_war = yes
				OR = {
					is_in_war = {
						attacker_leader = ROOT
					}
					is_in_war = {
						defender_leader = ROOT
					}
				}
				any_country = {
					OR = {
						is_in_war = {
							attacker_leader = ROOT
							defender_leader = THIS
						}
						is_in_war = {
							attacker_leader = THIS
							defender_leader = ROOT
						}
					}
					NOT = { war_with = FROM }
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				add_liberty_desire = 25
				join_all_defensive_wars_of = ROOT
				join_all_offensive_wars_of = ROOT
			}
		}
	}

	ai_will_do = {
		is_at_war = yes
		NOT = { war_score = -20 }
		FROM = {
			army_size = 5
			NOT = { liberty_desire = 30 }
		}
	}
}

#Crimean
cancel_timar = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = timar
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = -100
			mutual = yes
		}
		FROM = {
			grant_independence = yes
		}
	}
	ai_will_do = {
		always = no
	}
}

#daimyo_diplomatic_actions
onin_war_bribe_action = {
	category = influence
	
	require_acceptance = no
	
	is_visible = {
		OR = {
			tag = HSK
			tag = YMN
		}
		has_global_flag = JAP_crisis
		FROM = {
			OR = {
			    has_reform = daimyo
			    has_reform = daimyo_barony_reform
			    has_reform = daimyo_viscounty_reform
			    has_reform = daimyo_county_reform
			    has_reform = daimyo_marquisate_reform
			    has_reform = daimyo_duchy_reform
			    has_reform = daimyo_principality_reform
			}
			NOT = { tag = ASK }
			NOT = { tag = HSK }
			NOT = { tag = YMN }
			ai = yes
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			OR = {
				tag = HSK
				tag = YMN
			}
			has_global_flag = JAP_crisis
			FROM = {
				OR = {
			        has_reform = daimyo
			        has_reform = daimyo_barony_reform
			        has_reform = daimyo_viscounty_reform
			        has_reform = daimyo_county_reform
			        has_reform = daimyo_marquisate_reform
			        has_reform = daimyo_duchy_reform
			        has_reform = daimyo_principality_reform
			    }
				NOT = { tag = ASK }
				NOT = { tag = HSK }
				NOT = { tag = YMN }
				ai = yes
			}
		}
		treasury = 25
		custom_trigger_tooltip = {
			tooltip = ONIN_WAR_DIP_ACTION_ONLY_EVERY_2_YEARS
			FROM = {
				OR = {
					NOT = { has_country_flag = onin_war_bribe_action_used_by_@ROOT }
					had_country_flag = { flag = onin_war_bribe_action_used_by_@ROOT days = 730 }
				}
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				OR = {
					tag = HSK
					tag = YMN
				}
				has_global_flag = JAP_crisis
				FROM = {
					OR = {
			            has_reform = daimyo
			            has_reform = daimyo_barony_reform
			            has_reform = daimyo_viscounty_reform
			            has_reform = daimyo_county_reform
			            has_reform = daimyo_marquisate_reform
			            has_reform = daimyo_duchy_reform
			            has_reform = daimyo_principality_reform
			        }
					NOT = { tag = ASK }
					NOT = { tag = HSK }
					NOT = { tag = YMN }
					ai = yes
				}
				treasury = 25
				FROM = {
					OR = {
						NOT = { has_country_flag = onin_war_bribe_action_used_by_@ROOT }
						had_country_flag = { flag = onin_war_bribe_action_used_by_@ROOT days = 730 }
					}
				}
			}
			add_treasury = -25
			FROM = {
				add_treasury = 25
				if = {
					limit = {
						ROOT = { tag = HSK }
					}
					change_variable = { which = Daimyo_Support_for_HSK value = 10 }
				}
				else = {
					change_variable = { which = Daimyo_Support_for_YMN value = 10 }
				}
				clr_country_flag = onin_war_bribe_action_used_by_@ROOT
				set_country_flag = onin_war_bribe_action_used_by_@ROOT
			}
		}
	}
	
	ai_will_do = {
		treasury = 100
		NOT = { is_rival = FROM }
		OR = {
			FROM = {
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							variable_name = Daimyo_Support_for_YMN_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_YMN
						}
						export_to_variable = {
							variable_name = Daimyo_Support_for_HSK_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_HSK
						}
						
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							value = 25
						}

						check_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_HSK_temp
						}
					}
				}
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							variable_name = Daimyo_Support_for_YMN_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_YMN
						}
						export_to_variable = {
							variable_name = Daimyo_Support_for_HSK_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_HSK
						}
						
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							value = 25
						}

						check_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_YMN_temp
						}
					}
				}
			}
			AND = {
				tag = HSK
				NOT = {
					any_country = {
						OR = {
			                has_reform = daimyo
			                has_reform = daimyo_barony_reform
			                has_reform = daimyo_viscounty_reform
			                has_reform = daimyo_county_reform
			                has_reform = daimyo_marquisate_reform
			                has_reform = daimyo_duchy_reform
			                has_reform = daimyo_principality_reform
			            }
						NOT = { tag = ASK }
						NOT = { tag = HSK }
						NOT = { tag = YMN }
						ai = yes
						NOT = {
							variable_arithmetic_trigger = {
								export_to_variable = {
									variable_name = Daimyo_Support_for_YMN_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_YMN
								}
								export_to_variable = {
									variable_name = Daimyo_Support_for_HSK_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									which = Daimyo_Support_for_HSK
								}
								
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									value = 25
								}

								check_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_HSK_temp
								}
							}
						}
					}
				}
			}
			AND = {
				tag = YMN
				NOT = {
					any_country = {
						OR = {
			                has_reform = daimyo
			                has_reform = daimyo_barony_reform
			                has_reform = daimyo_viscounty_reform
			                has_reform = daimyo_county_reform
			                has_reform = daimyo_marquisate_reform
			                has_reform = daimyo_duchy_reform
			                has_reform = daimyo_principality_reform
			            }
						NOT = { tag = ASK }
						NOT = { tag = HSK }
						NOT = { tag = YMN }
						ai = yes
						NOT = {
							variable_arithmetic_trigger = {
								export_to_variable = {
									variable_name = Daimyo_Support_for_YMN_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_YMN
								}
								export_to_variable = {
									variable_name = Daimyo_Support_for_HSK_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									which = Daimyo_Support_for_HSK
								}
								
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									value = 25
								}

								check_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_HSK_temp
								}
							}
						}
					}
				}
			}
		}
	}
}

onin_war_send_men_action = {
	category = influence
	
	require_acceptance = no
	
	is_visible = {
		OR = {
			tag = HSK
			tag = YMN
		}
		has_global_flag = JAP_crisis
		FROM = {
			OR = {
			    has_reform = daimyo
			    has_reform = daimyo_barony_reform
			    has_reform = daimyo_viscounty_reform
			    has_reform = daimyo_county_reform
			    has_reform = daimyo_marquisate_reform
			    has_reform = daimyo_duchy_reform
			    has_reform = daimyo_principality_reform
			}
			NOT = { tag = ASK }
			NOT = { tag = HSK }
			NOT = { tag = YMN }
			ai = yes
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			OR = {
				tag = HSK
				tag = YMN
			}
			has_global_flag = JAP_crisis
			FROM = {
				OR = {
			        has_reform = daimyo
			        has_reform = daimyo_barony_reform
			        has_reform = daimyo_viscounty_reform
			        has_reform = daimyo_county_reform
			        has_reform = daimyo_marquisate_reform
			        has_reform = daimyo_duchy_reform
			        has_reform = daimyo_principality_reform
			    }
				NOT = { tag = ASK }
				NOT = { tag = HSK }
				NOT = { tag = YMN }
				ai = yes
			}
		}
		manpower = 1
		custom_trigger_tooltip = {
			tooltip = ONIN_WAR_DIP_ACTION_ONLY_EVERY_2_YEARS
			FROM = {
				OR = {
					NOT = { has_country_flag = onin_war_send_men_action_used_by_@ROOT }
					had_country_flag = { flag = onin_war_send_men_action_used_by_@ROOT days = 730 }
				}
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				OR = {
					tag = HSK
					tag = YMN
				}
				has_global_flag = JAP_crisis
				FROM = {
					OR = {
			            has_reform = daimyo
			            has_reform = daimyo_barony_reform
			            has_reform = daimyo_viscounty_reform
			            has_reform = daimyo_county_reform
			            has_reform = daimyo_marquisate_reform
			            has_reform = daimyo_duchy_reform
			            has_reform = daimyo_principality_reform
			        }
					NOT = { tag = ASK }
					NOT = { tag = HSK }
					NOT = { tag = YMN }
					ai = yes
				}
				manpower = 1
				FROM = {
					OR = {
						NOT = { has_country_flag = onin_war_send_men_action_used_by_@ROOT }
						had_country_flag = { flag = onin_war_send_men_action_used_by_@ROOT days = 730 }
					}
				}
			}
			add_manpower = -1
			FROM = {
				add_manpower = 1
				if = {
					limit = {
						ROOT = { tag = HSK }
					}
					change_variable = { which = Daimyo_Support_for_HSK value = 10 }
				}
				else = {
					change_variable = { which = Daimyo_Support_for_YMN value = 10 }
				}
				clr_country_flag = onin_war_send_men_action_used_by_@ROOT
				set_country_flag = onin_war_send_men_action_used_by_@ROOT
			}
		}
	}
	
	ai_will_do = {
		is_at_war = no
		manpower = 3
		NOT = { is_rival = FROM }
		OR = {
			FROM = {
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							variable_name = Daimyo_Support_for_YMN_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_YMN
						}
						export_to_variable = {
							variable_name = Daimyo_Support_for_HSK_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_HSK
						}
						
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							value = 25
						}

						check_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_HSK_temp
						}
					}
				}
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							variable_name = Daimyo_Support_for_YMN_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_YMN
						}
						export_to_variable = {
							variable_name = Daimyo_Support_for_HSK_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_HSK
						}
						
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							value = 25
						}

						check_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_YMN_temp
						}
					}
				}
			}
			AND = {
				tag = HSK
				NOT = {
					any_country = {
						OR = {
			                has_reform = daimyo
			                has_reform = daimyo_barony_reform
			                has_reform = daimyo_viscounty_reform
			                has_reform = daimyo_county_reform
			                has_reform = daimyo_marquisate_reform
			                has_reform = daimyo_duchy_reform
			                has_reform = daimyo_principality_reform
			            }
						NOT = { tag = ASK }
						NOT = { tag = HSK }
						NOT = { tag = YMN }
						ai = yes
						NOT = {
							variable_arithmetic_trigger = {
								export_to_variable = {
									variable_name = Daimyo_Support_for_YMN_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_YMN
								}
								export_to_variable = {
									variable_name = Daimyo_Support_for_HSK_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									which = Daimyo_Support_for_HSK
								}
								
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									value = 25
								}

								check_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_HSK_temp
								}
							}
						}
					}
				}
			}
			AND = {
				tag = YMN
				NOT = {
					any_country = {
						OR = {
			                has_reform = daimyo
			                has_reform = daimyo_barony_reform
			                has_reform = daimyo_viscounty_reform
			                has_reform = daimyo_county_reform
			                has_reform = daimyo_marquisate_reform
			                has_reform = daimyo_duchy_reform
			                has_reform = daimyo_principality_reform
			            }
						NOT = { tag = ASK }
						NOT = { tag = HSK }
						NOT = { tag = YMN }
						ai = yes
						NOT = {
							variable_arithmetic_trigger = {
								export_to_variable = {
									variable_name = Daimyo_Support_for_YMN_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_YMN
								}
								export_to_variable = {
									variable_name = Daimyo_Support_for_HSK_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									which = Daimyo_Support_for_HSK
								}
								
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									value = 25
								}

								check_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_HSK_temp
								}
							}
						}
					}
				}
			}
		}
	}
}

onin_war_send_generals_action = {
	category = influence
	
	require_acceptance = no
	
	is_visible = {
		OR = {
			tag = HSK
			tag = YMN
		}
		has_global_flag = JAP_crisis
		FROM = {
			OR = {
			    has_reform = daimyo
			    has_reform = daimyo_barony_reform
			    has_reform = daimyo_viscounty_reform
			    has_reform = daimyo_county_reform
			    has_reform = daimyo_marquisate_reform
			    has_reform = daimyo_duchy_reform
			    has_reform = daimyo_principality_reform
			}
			NOT = { tag = ASK }
			NOT = { tag = HSK }
			NOT = { tag = YMN }
			ai = yes
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			OR = {
				tag = HSK
				tag = YMN
			}
			has_global_flag = JAP_crisis
			FROM = {
				OR = {
			        has_reform = daimyo
			        has_reform = daimyo_barony_reform
			        has_reform = daimyo_viscounty_reform
			        has_reform = daimyo_county_reform
			        has_reform = daimyo_marquisate_reform
			        has_reform = daimyo_duchy_reform
			        has_reform = daimyo_principality_reform
			    }
				NOT = { tag = ASK }
				NOT = { tag = HSK }
				NOT = { tag = YMN }
				ai = yes
			}
		}
		army_tradition = 10
		custom_trigger_tooltip = {
			tooltip = ONIN_WAR_DIP_ACTION_ONLY_EVERY_5_YEARS
			FROM = {
				OR = {
					NOT = { has_country_flag = onin_war_send_generals_action_used_by_@ROOT }
					had_country_flag = { flag = onin_war_send_generals_action_used_by_@ROOT days = 1825 }
				}
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				OR = {
					tag = HSK
					tag = YMN
				}
				has_global_flag = JAP_crisis
				FROM = {
					OR = {
			            has_reform = daimyo
			            has_reform = daimyo_barony_reform
			            has_reform = daimyo_viscounty_reform
			            has_reform = daimyo_county_reform
			            has_reform = daimyo_marquisate_reform
			            has_reform = daimyo_duchy_reform
			            has_reform = daimyo_principality_reform
			        }
					NOT = { tag = ASK }
					NOT = { tag = HSK }
					NOT = { tag = YMN }
					ai = yes
				}
				army_tradition = 10
				FROM = {
					OR = {
						NOT = { has_country_flag = onin_war_send_generals_action_used_by_@ROOT }
						had_country_flag = { flag = onin_war_send_generals_action_used_by_@ROOT days = 1825 }
					}
				}
			}
			add_army_tradition = -10
			FROM = {
				add_army_tradition = 10
				if = {
					limit = {
						ROOT = { tag = HSK }
					}
					change_variable = { which = Daimyo_Support_for_HSK value = 15 }
				}
				else = {
					change_variable = { which = Daimyo_Support_for_YMN value = 15 }
				}
				clr_country_flag = onin_war_send_generals_action_used_by_@ROOT
				set_country_flag = onin_war_send_generals_action_used_by_@ROOT
			}
		}
	}
	
	ai_will_do = {
		army_tradition = 20
		NOT = { is_rival = FROM }
		OR = {
			FROM = {
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							variable_name = Daimyo_Support_for_YMN_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_YMN
						}
						export_to_variable = {
							variable_name = Daimyo_Support_for_HSK_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_HSK
						}
						
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							value = 25
						}

						check_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_HSK_temp
						}
					}
				}
				NOT = {
					variable_arithmetic_trigger = {
						export_to_variable = {
							variable_name = Daimyo_Support_for_YMN_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							which = Daimyo_Support_for_YMN
						}
						export_to_variable = {
							variable_name = Daimyo_Support_for_HSK_temp
							value = 0
						}
						change_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_HSK
						}
						
						change_variable = {
							which = Daimyo_Support_for_YMN_temp
							value = 25
						}

						check_variable = {
							which = Daimyo_Support_for_HSK_temp
							which = Daimyo_Support_for_YMN_temp
						}
					}
				}
			}
			AND = {
				tag = HSK
				NOT = {
					any_country = {
						OR = {
			                has_reform = daimyo
			                has_reform = daimyo_barony_reform
			                has_reform = daimyo_viscounty_reform
			                has_reform = daimyo_county_reform
			                has_reform = daimyo_marquisate_reform
			                has_reform = daimyo_duchy_reform
			                has_reform = daimyo_principality_reform
			            }
						NOT = { tag = ASK }
						NOT = { tag = HSK }
						NOT = { tag = YMN }
						ai = yes
						NOT = {
							variable_arithmetic_trigger = {
								export_to_variable = {
									variable_name = Daimyo_Support_for_YMN_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_YMN
								}
								export_to_variable = {
									variable_name = Daimyo_Support_for_HSK_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									which = Daimyo_Support_for_HSK
								}
								
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									value = 25
								}

								check_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_HSK_temp
								}
							}
						}
					}
				}
			}
			AND = {
				tag = YMN
				NOT = {
					any_country = {
						OR = {
			                has_reform = daimyo
			                has_reform = daimyo_barony_reform
			                has_reform = daimyo_viscounty_reform
			                has_reform = daimyo_county_reform
			                has_reform = daimyo_marquisate_reform
			                has_reform = daimyo_duchy_reform
			                has_reform = daimyo_principality_reform
			            }
						NOT = { tag = ASK }
						NOT = { tag = HSK }
						NOT = { tag = YMN }
						ai = yes
						NOT = {
							variable_arithmetic_trigger = {
								export_to_variable = {
									variable_name = Daimyo_Support_for_YMN_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_YMN
								}
								export_to_variable = {
									variable_name = Daimyo_Support_for_HSK_temp
									value = 0
								}
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									which = Daimyo_Support_for_HSK
								}
								
								change_variable = {
									which = Daimyo_Support_for_HSK_temp
									value = 25
								}

								check_variable = {
									which = Daimyo_Support_for_YMN_temp
									which = Daimyo_Support_for_HSK_temp
								}
							}
						}
					}
				}
			}
		}
	}
}

#france_diplomatic_actions
make_french_hre_subject_action = {
	category = influence

	alert_index = 6
	alert_tooltip = make_french_hre_subject_action_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_country_flag = french_hre_subject_enabled
		can_be_overlord = french_hre_subject
		FROM = {
			is_subject = no
			capital_scope = {
				OR = {
					region = north_german_region
					region = south_german_region
					region = low_countries_region
				}
			}
		}
	}

	is_allowed = {
		has_country_flag = french_hre_subject_enabled
		hidden_trigger = {
			can_be_overlord = french_hre_subject
			FROM = {
				is_subject = no
				capital_scope = {
					OR = {
						region = north_german_region
						region = south_german_region
						region = low_countries_region
					}
				}
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				can_be_overlord = french_hre_subject
				FROM = {
					is_subject = no
					capital_scope = {
						OR = {
							region = north_german_region
							region = south_german_region
							region = low_countries_region
						}
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
			}
			create_subject = {
				subject = FROM
				subject_type = french_hre_subject
			}
			add_truce_with = FROM
			change_variable = {
				which = french_authority
				value = 1
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_be_overlord = french_hre_subject
				FROM = {
					is_subject = no
					capital_scope = {
						OR = {
							region = north_german_region
							region = south_german_region
							region = low_countries_region
						}
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
			}
			FROM = {
				clr_country_flag = declined_make_french_hre_subject_@ROOT
				set_country_flag = declined_make_french_hre_subject_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_make_french_hre_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = ME_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ME_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = ME_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				diplomatic_reputation = 0
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				NOT = { diplomatic_reputation = 0 }
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ME_ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ME_ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ME_FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ME_ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				OR = {
					any_owned_province = {
						is_core = FROM
					}
					any_subject_country = {
						is_subject_other_than_tributary_trigger = yes
						any_owned_province = {
							is_core = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ME_ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ME_FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_FROM_HAS_STRONG_NEIGHBOR_OUTSIDE_FRANCE
			limit = {
				FROM = {
					any_neighbor_country = {
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
						variable_arithmetic_trigger = {
							export_to_variable = {
								which = this_army_size
								value = trigger_value:army_size
							}
							export_to_variable = {
								which = our_army_size
								value = trigger_value:army_size
								who = ROOT
							}
							export_to_variable = {
								which = their_army_size
								value = trigger_value:army_size
								who = FROM
							}
							divide_variable = { which = this_army_size value = 2 }
							divide_variable = { which = our_army_size value = 3 }
							check_variable = { which = this_army_size which = their_army_size }
							check_variable = { which = our_army_size which = this_army_size }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ME_FROM_HAS_STRONG_NEIGHBOR_OUTSIDE_FRANCE
			limit = {
				FROM = {
					any_neighbor_country = {
						NOT = { tag = ROOT }
						NOT = { is_subject_of = ROOT }
						variable_arithmetic_trigger = {
							export_to_variable = {
								which = this_army_size
								value = trigger_value:army_size
							}
							export_to_variable = {
								which = our_army_size
								value = trigger_value:army_size
								who = ROOT
							}
							export_to_variable = {
								which = their_army_size
								value = trigger_value:army_size
								who = FROM
							}
							divide_variable = { which = this_army_size value = 2 }
							divide_variable = { which = our_army_size value = 3 }
							check_variable = { which = this_army_size which = their_army_size }
							NOT = { check_variable = { which = our_army_size which = this_army_size } }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = ME_FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ME_ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
					is_papal_controller = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_FROM_IS_CURIA_CONTROLLER
			limit = {
				FROM = {
					is_papal_controller = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_FROM_IS_DEFENDER_OF_FAITH
			limit = {
				FROM = {
					is_defender_of_faith = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = ME_ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ME_FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ME_ROOT_IS_DEFENDER_OF_FROM_FAITH
			limit = {
				is_defender_of_faith = yes
				religion = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = {
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_make_french_hre_subject_@ROOT }
				had_country_flag = { flag = declined_make_french_hre_subject_@ROOT days = 1825 }
			}
		}
	}
}

french_hre_subject_independence_action = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = french_hre_subject
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = french_hre_subject
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = french_hre_subject
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
			}
			FROM = {
				ROOT = { grant_independence = yes }
				add_casus_belli = {
					target = ROOT
					type = cb_disloyal_french_hre_subject
				}
			}
			add_truce_with = FROM
			FROM = {
				country_event = { id = ME_France_Events.59 }
			}
		}
	}

	ai_will_do = {
		liberty_desire = 55
	}
}

#malaya_diplomatic_actions
#ME_tributary_state_interaction = {
#	category = influenc
#	alert_index = 6
#	alert_tooltip = ME_tributary_state_interaction_toolti
#	require_acceptance = ye
#	is_visible = {
#		has_country_flag = MSA_tributary_interaction_enabled
#		FROM = {
#			is_subject_of = ROOT
#			is_subject_of_type = vassal
#		}
#	}
#
#	is_allowed = {
#		FROM = {
#			years_in_vassalage_under = {
#				who = ROOT
#				years = 30
#			}
#		}
#		is_at_war = no
#		dip_power = 100
#		FROM = { is_at_war = no }
#	}
#
#	on_accept = {
#		if = {
#			limit = {
#				has_country_flag = MSA_tributary_interaction_enabled
#				FROM = {
#					is_subject_of = ROOT
#					is_subject_of_type = vassal
#					years_in_vassalage_under = {
#						who = ROOT
#						years = 30
#					}
#					NOT = { liberty_desire = 5 }
#				}
#			}
#			FROM = {
#				create_subject = {
#					subject = ROOT
#					subject_type = tributary_state
#				}
#			}
#			add_dip_power = -100
#		}
#	}
#
#	on_decline = {
#		if = {
#			limit = {
#				FROM = {
#					is_subject = no
#					can_create_subject_type = {
#						subject = ROOT
#						subject_type = agricultural_march
#					}
#				}
#				is_at_war = no
#				FROM = { is_at_war = no }
#			}
#			FROM = {
#				clr_country_flag = declined_become_agricultural_march_@ROOT
#				set_country_flag = declined_become_agricultural_march_@ROOT
#			}
#			add_opinion = {
#				who = FROM
#				modifier = declined_ask_to_become_agricultural_march
#			}
#		}
#	}
#
#	ai_acceptance = {
#		add_entry = {
#			name = OPINION
#			export_to_variable = {
#				which = ai_value
#				value = opinion
#				who = FROM
#				with = ROOT
#			}
#			divide_variable = { which = ai_value value = 4 }
#		}
#		add_entry = {
#			name = MODIFIER_DIPLO_SKILL
#			export_to_variable = {
#				which = ai_value
#				value = modifier:diplomatic_reputation
#			}
#			multiply_variable = { which = ai_value value = 5 }
#		}
#		add_entry = {
#			name = ROOT_IS_VASSAL_FOR_AT_LEAST_10_YEARS
#			limit = {
#				years_in_vassalage_under = {
#					who = FROM
#					years = 10
#					all_subject_country = yes
#				}
#			}
#			export_to_variable = {
#				which = ai_value
#				value = 1000
#			}
#			multiply_variable = { which = ai_value value = -1 }
#		}
#		add_entry = {
#			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_RIVALS
#			limit = {
#				NOT = {
#					any_neighbor_country = {
#						OR = {
#							is_rival = FROM
#							is_enemy = FROM
#						}
#					}
#				}
#			}
#			export_to_variable = {
#				which = ai_value
#				value = 1000
#			}
#			multiply_variable = { which = ai_value value = -1 }
#		}
#		add_entry = {
#			name = ROOT_HAS_MORE_THAN_25_PERCENT_OF_OVERLORD_DEVELOPMENT
#			limit = {
#				development_of_overlord_fraction = 0.25
#			}
#			export_to_variable = {
#				which = ai_value
#				value = 1000
#			}
#			multiply_variable = { which = ai_value value = -1 }
#		}
#		add_entry = {
#			name = ROOT_HAS_TOO_FEW_PRODUCTION_INCOME
#			limit = {
#				OR = {
#					NOT = { monthly_income = 20 }
#					NOT = { production_income_percentage = 0.35 }
#				}
#			}
#			export_to_variable = {
#				which = ai_value
#				value = 1000
#			}
#			multiply_variable = { which = ai_value value = -1 }
#		}
#		add_entry = {
#			name = ROOT_HAS_TOO_FEW_MAX_MANPOWER
#			limit = {
#				NOT = { max_manpower = 20 }
#			}
#			export_to_variable = {
#				which = ai_value
#				value = 1000
#			}
#			multiply_variable = { which = ai_value value = -1 }
#		}
#	}
#
#	ai_will_do = {
#		NOT = { liberty_desire = 50 }
#		NOT = { is_different_march_subject = yes }
#		army_size = 20
#		OR = {
#			is_subject_of_type = march
#			FROM = { ai = no }
#		}
#		production_income_percentage = 0.2
#		any_neighbor_country = {
#			OR = {
#				is_rival = FROM
#				is_enemy = FROM
#			}
#		}
#		FROM = {
#			OR = {
#				NOT = { has_country_flag = declined_become_agricultural_march_@ROOT }
#				had_country_flag = { flag = declined_become_agricultural_march_@ROOT days = 1825 }
#			}
#		}
#	}
#}

#mamluks_diplomatic_actions
mamluks_purchase_new_mamluks = {
	category = alliance

	require_acceptance = no

	is_visible = {
		has_country_flag = MAM_purchase_new_mamluks_flag 
		FROM = {
			NOT = {
				religion_group = muslim
			}
		}
		has_reform = mamluk_government
	}
	
	is_allowed = {
		hidden_trigger = {
			has_country_flag = MAM_purchase_new_mamluks_flag 
			FROM = {
				NOT = {
					religion_group = muslim
				}
			}
			has_reform = mamluk_government
		}
		NOT = { has_country_modifier = MAM_new_mamluks }
	}
	
	on_accept = {
		add_yearly_manpower = 0.5
		add_country_modifier = {
			name = MAM_new_mamluks
			duration = 9125
		} #this will have other influence, I promise!
		hidden_effect = {
			FROM = { save_global_event_target_as = MAM_new_mamluk_target }
		}
	}
	
	ai_will_do = {
		always = yes
	}
}

#ME_abbasid_diplomatic_actions
abbasid_denounce_actions = {
	category = subsidies

	require_acceptance = no

	is_visible = {
		#ME_has_abbasid_caliph = yes #Was this but changed to 'caliphate_reform' as it is already in the base game - by SF
		has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
		ME_can_benefit_from_abbasid_caliph = yes
	}
	
	is_allowed = {
		hidden_trigger = {
			#ME_has_abbasid_caliph = yes #Was this but changed to 'caliphate_reform' as it is already in the base game - by SF
			has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
			# FROM = {
				# is_enemy = ROOT
				# religion = ROOT
			# }
		}
		if = {
			limit = {
				NOT = {
					ME_is_caliphate_trigger = yes
				}
			}
			FROM = {
				OR = {
					is_enemy = ROOT
					is_rival = ROOT
				}
			}
			dip_power = 50
		}
		FROM = {
			religion = ROOT
		}
		custom_trigger_tooltip = {
			tooltip = Abbasid_has_not_denounced_in_10_years
			OR = {
				NOT = { has_country_flag = abbasid_recently_denounced }
				had_country_flag = {
					flag = abbasid_recently_denounced
					days = 3650
				}
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				NOT = {
					ME_is_caliphate_trigger = yes
				}
			}
			add_dip_power = -50
		}
		FROM = {
			add_country_modifier = {
				name = Abbasid_got_denounced
				duration = 3650
			}
			hidden_effect = { 
				country_event = { id = ME_Abbasid_Events.5 } 
			}
			add_opinion = {
				who = ROOT
				modifier = abbasid_denounced_us
			}
			every_neighbor_country = {
				add_opinion = {
					who = PREV
					modifier = abbasid_got_denounced_by_caliph_opinion
				}
			}
		}
		add_power_projection = {
			type = forced_to_denounce_rival
			amount = 10
		}
		set_country_flag = abbasid_recently_denounced
		if = {
			limit = {
				has_country_flag = me_tim_abbasid_completion
			}
			change_variable = {
				which = METimCaliphActions
				value = 1
			}
		}
	}
	
	ai_will_do = {
		always = yes
	}
}

abbasid_call_jihad = {
	category = subsidies

	require_acceptance = no

	is_visible = {
		has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
		ME_can_benefit_from_abbasid_caliph = yes
		# FROM = {
			# NOT = { religion_group = ROOT }
		# }
	}
	
	is_allowed = {
		hidden_trigger = {
			has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
		}
		FROM = {
			NOT = { religion_group = ROOT }
		}
		if = {
			limit = {
				NOT = {
					ME_is_caliphate_trigger = yes
				}
			}
			dip_power = 100
		}
		custom_trigger_tooltip = {
			tooltip = Abbasid_has_not_called_jihad_in_25_years
			OR = {
				NOT = { has_country_flag = abbasid_recently_called_jihad }
				had_country_flag = {
					flag = abbasid_recently_called_jihad
					days = 9125
				}
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				NOT = {
					ME_is_caliphate_trigger = yes
				}
			}
			add_dip_power = -100
		}
		add_casus_belli = {
			target = FROM
			type = cb_abbasid_jihad
			months = 60
		}
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = abbasid_called_jihad_on_us
			}
			country_event = { id = ME_Abbasid_Events.7 }
		}
		set_country_flag = abbasid_recently_called_jihad
		if = {
			limit = {
				has_country_flag = me_tim_abbasid_completion
			}
			change_variable = {
				which = METimCaliphActions
				value = 1
			}
		}
	}
	
	ai_will_do = {
		FROM = { is_neighbor_of = ROOT }
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_rivalry
			}
		}
	}
}

abbasid_praise = {
	category = subsidies

	require_acceptance = no

	is_visible = {
		has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
		ME_can_benefit_from_abbasid_caliph = yes
	}
	
	is_allowed = {
		hidden_trigger = {
			has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
			# FROM = {
				# religion = ROOT
			# }
		}
		FROM = {
			religion = ROOT
		}
		custom_trigger_tooltip = {
			tooltip = Abbasid_has_not_called_praised_in_5_years
			OR = {
				NOT = { has_country_flag = abbasid_recently_praised }
				had_country_flag = {
					flag = abbasid_recently_praised
					days = 1825
				}
			}
		}
	}
	
	on_accept = {
		FROM = {
			hidden_effect = { 
				country_event = { id = ME_Abbasid_Events.6 } 
			}
			add_opinion = {
				who = ROOT
				modifier = abbasid_praised_us
			}
			
		}
		add_trust = {
			who = FROM
			value = 5
			mutual = yes
		}
		set_country_flag = abbasid_recently_praised
		if = {
			limit = {
				has_country_flag = me_tim_abbasid_completion
			}
			change_variable = {
				which = METimCaliphActions
				value = 1
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			alliance_with = ROOT
		}
	}
}

abbasid_invite_scholar = {
	category = subsidies

	require_acceptance = no

	is_visible = {
		ME_is_caliphate_trigger = yes
	}
	
	is_allowed = {
		hidden_trigger = {
			ME_is_caliphate_trigger = yes
		}
		FROM = {
			religion = ROOT
		}
		custom_trigger_tooltip = {
			tooltip = Abbasid_has_not_invited_scholar_in_20_years
			OR = {
				NOT = { has_country_flag = abbasid_recently_invited_scholars }
				had_country_flag = {
					flag = abbasid_recently_invited_scholars
					days = 7300
				}
			}
		}
	}
	
	on_accept = {
		set_variable = {
			which = invited_scholar_reduction
			value = 0
		}
		if = {
			limit = {
				has_country_flag = ARB_caliphal_invite_scholars_diplomatic_action
			}
			change_variable = {
				which = invited_scholar_reduction
				value = 25
			}
		}
		
		if = {
			limit = {
				FROM = {
					has_opinion = {
						who = ROOT
						value = 25
					}
				}
			}
			change_variable = {
				which = invited_scholar_reduction
				value = 5
			}
			if = {
				limit = {
					FROM = {
						has_opinion = {
							who = ROOT
							value = 50
						}
					}
				}
				change_variable = {
					which = invited_scholar_reduction
					value = 5
				}
				if = {
					limit = {
						FROM = {
							has_opinion = {
								who = ROOT
								value = 75
							}
						}
					}
					change_variable = {
						which = invited_scholar_reduction
						value = 5
					}
					if = {
						limit = {
							FROM = {
								has_opinion = {
									who = ROOT
									value = 100
								}
							}
						}
						change_variable = {
							which = invited_scholar_reduction
							value = 5
						}
						if = {
							limit = {
								FROM = {
									has_opinion = {
										who = ROOT
										value = 125
									}
								}
							}
							change_variable = {
								which = invited_scholar_reduction
								value = 5
							}
							if = {
								limit = {
									FROM = {
										has_opinion = {
											who = ROOT
											value = 150
										}
									}
								}
								change_variable = {
									which = invited_scholar_reduction
									value = 5
								}
							}
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				FROM = {
					innovativeness = 10
				}
			}
			change_variable = {
				which = invited_scholar_reduction
				value = 5
			}
			if = {
				limit = {
					FROM = {
						innovativeness = 20
					}
				}
				change_variable = {
					which = invited_scholar_reduction
					value = 5
				}
				if = {
					limit = {
						FROM = {
							innovativeness = 30
						}
					}
					change_variable = {
						which = invited_scholar_reduction
						value = 5
					}
					if = {
						limit = {
							FROM = {
								innovativeness = 40
							}
						}
						change_variable = {
							which = invited_scholar_reduction
							value = 5
						}
						if = {
							limit = {
								FROM = {
									innovativeness = 50
								}
							}
							change_variable = {
								which = invited_scholar_reduction
								value = 5
							}
						}
					}
				}
			}
		}
		
		set_country_flag = abbasid_recently_invited_scholars
		
		if = {
			limit = {
				has_country_flag = me_tim_abbasid_completion
			}
			change_variable = {
				which = METimCaliphActions
				value = 1
			}
		}
		
		FROM = {
			save_event_target_as = temp_aba_target
		}
		country_event = { id = ME_Abbasid_Events.30 }
	}
	
	ai_will_do = {
		OR = {
			FROM = {
				has_opinion = {
					who = ROOT
					value = 100
				}
				innovativeness = 25
			}
		}
		# FROM = {
			# alliance_with = ROOT
		# }
	}
}

abbasid_send_help = {
	category = subsidies

	require_acceptance = no

	is_visible = {
		ME_is_caliphate_trigger = yes
	}
	
	is_allowed = {
		hidden_trigger = {
			ME_is_caliphate_trigger = yes
		}
		FROM = {
			religion = ROOT
			at_war_with_religious_enemy = yes
		}
		mil_power = 50
		custom_trigger_tooltip = {
			tooltip = Abbasid_has_not_sent_help_in_30_years
			OR = {
				NOT = { has_country_flag = abbasid_recently_sent_help }
				had_country_flag = {
					flag = abbasid_recently_sent_help
					days = 10950
				}
			}
		}
	}
	
	on_accept = {
		set_country_flag = abbasid_recently_sent_help
		add_mil_power = -50
		
		if = {
			limit = {
				has_country_flag = me_tim_abbasid_completion
			}
			change_variable = {
				which = METimCaliphActions
				value = 1
			}
		}
		
		save_event_target_as = temp_caliph
		FROM = { 
			country_event = { id = ME_Abbasid_Events.31 }
		}
	}
	
	ai_will_do = {
		FROM = {
			NOT = { is_rival = ROOT }
		}
		
		mil_power = 500
		# FROM = {
			# alliance_with = ROOT
		# }
	}
}

abbasid_zakat = {
	category = subsidies

	require_acceptance = yes

	is_visible = {
		ME_is_caliphate_trigger = yes
		has_country_flag = ARB_can_ask_for_zakat
	}
	
	is_allowed = {
		hidden_trigger = {
			ME_is_caliphate_trigger = yes
			has_country_flag = ARB_can_ask_for_zakat
		}
		FROM = {
			religion = ROOT
			years_of_income = 0.5
		}
		custom_trigger_tooltip = {
			tooltip = Abbasid_has_not_asked_for_zakat_in_10_years
			OR = {
				NOT = { has_country_flag = abbasid_recently_asked_for_zakat }
				had_country_flag = {
					flag = abbasid_recently_asked_for_zakat
					days = 3650
				}
			}
		}
	}
	
	on_accept = {
		set_country_flag = abbasid_recently_asked_for_zakat
		FROM = {
			add_stability = 1
		}
		export_to_variable = {
			which = ABA_Temp
			value = years_of_income
			who = FROM
		}
		multiply_variable = {
			which = ABA_Temp
			value = 0.5
		}
		while = {
			limit = {
				check_variable = {
					which = ABA_Temp
					value = 10
				}
			}
			ROOT = {
				add_treasury = 10
			}
			FROM = {
				add_treasury = -10
			}
			change_variable = {
				which = ABA_Temp
				value = -10
			}
		}
		while = {
			limit = {
				check_variable = {
					which = ABA_Temp
					value = 1
				}
			}
			ROOT = {
				add_treasury = 1
			}
			FROM = {
				add_treasury = -1
			}
			change_variable = {
				which = ABA_Temp
				value = -1
			}
		}
		while = {
			limit = {
				check_variable = {
					which = ABA_Temp
					value = 0.1
				}
			}
			ROOT = {
				add_treasury = 0.1
			}
			FROM = {
				add_treasury = -0.1
			}
			change_variable = {
				which = ABA_Temp
				value = -0.1
			}
		}
		set_variable = {
			which = ABA_Temp
			value = 0
		}
		if = {
			limit = {
				has_country_flag = me_tim_abbasid_completion
			}
			change_variable = {
				which = METimCaliphActions
				value = 1
			}
		}
	}
	
	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {
			name = TRUST
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
		}
		add_entry = {
			name = DIPLO_IS_RIVAL
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_rivalry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = diplomatic_reputation
			limit = { }
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 2
			multiply_variable = {
				which = ai_value
				value = 2
			}
		}
		add_entry = {
			name = STABILITY_AI_MODIFIER
			export_to_variable = {
				variable_name = ai_value
				value = stability
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = -25
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			NOT = { is_rival = ROOT }
		}
		
		mil_power = 500
		# FROM = {
			# alliance_with = ROOT
		# }
	}
}

abbasid_ransom = {
	category = subsidies

	require_acceptance = yes

	is_visible = {
		has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
		has_country_flag = ABA_ransom_abbasid
	}
	
	is_allowed = {
		hidden_trigger = {
			has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
			has_country_flag = ABA_ransom_abbasid
		}
		FROM = {
			religion = sunni
			is_at_war = no
			is_subject = no
		}
	}
	
	on_accept = {
		FROM = {
			capital_scope = {
				ME_set_abbasid_caliph_province = yes
			}
		}
		export_to_variable = {
			which = ABA_Temp
			value = years_of_income
			who = FROM
		}
		while = {
			limit = {
				check_variable = {
					which = ABA_Temp
					value = 10
				}
			}
			ROOT = {
				add_treasury = 10
			}
			FROM = {
				add_treasury = -10
			}
			change_variable = {
				which = ABA_Temp
				value = -10
			}
		}
		while = {
			limit = {
				check_variable = {
					which = ABA_Temp
					value = 1
				}
			}
			ROOT = {
				add_treasury = 1
			}
			FROM = {
				add_treasury = -1
			}
			change_variable = {
				which = ABA_Temp
				value = -1
			}
		}
		while = {
			limit = {
				check_variable = {
					which = ABA_Temp
					value = 0.1
				}
			}
			ROOT = {
				add_treasury = 0.1
			}
			FROM = {
				add_treasury = -0.1
			}
			change_variable = {
				which = ABA_Temp
				value = -0.1
			}
		}
		set_variable = {
			which = ABA_Temp
			value = 0
		}
	}
	
	ai_acceptance = {
		add_entry = {
			name = TRUST
			export_to_variable = {
				variable_name = ai_value # Each "add_entry" must create one variable called "ai_value", the value of which will be extracted after executing all effects
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		
		add_entry = {
			name = OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = ME_DOESNT_HAVE_ENOUGH_IN_BANK
			export_to_variable = {
				variable_name = ai_value
				value = 0
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = treasury
				who = FROM
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = years_of_income
				who = FROM
			}
			
			divide_variable = {
				which = their_treasury
				which = their_years_of_income
			}
			
			change_variable = {
				which = their_treasury
				value = -1
			}
			
			multiply_variable = {
				which = their_treasury
				value = 5
			}
			
			change_variable = {
				which = ai_value
				which = their_treasury
			}
		}
		
		add_entry = {
			name = ME_OUR_BALANCE
			export_to_variable = {
				variable_name = ai_value
				value = 0
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:current_income_balance
				who = FROM
			}
			
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:monthly_income
				who = FROM
			}
			
			divide_variable = {
				which = their_balance
				which = their_monthly_income
			}
			
			multiply_variable = {
				which = their_balance
				value = 10
			}
			
			change_variable = {
				which = their_balance
				value = -10
			}
			
			change_variable = {
				which = ai_value
				which = their_balance
			}
		}
		
		add_entry = {
			name = ME_will_pay_any_price_for_caliph
			limit = { 
				FROM = {
					OR = {
						AND = {
							OR = {
								tag = ADU
								tag = GRA
							}
							NOT = { mission_completed = gra_restore_the_andalusian_caliphate } #Was GRA_the_fake_caliph
						}
						AND = {
							OR = {
								tag = MAM
								tag = EGY 
							}
							#NOT = { mission_completed = MAM_protectors_of_the_caliph }
						}
						AND = {
							tag = NAJ
							NOT = { mission_completed = NAJ_challenge_the_ummah }
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 100
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			OR = {
				alliance_with = ROOT
				AND = {
					total_development = 300 
					OR = {
						ai_attitude = {
							who = ROOT
							attitude = attitude_friendly
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_neutral
						}
					}
				}
			}
		}
	}
}

#Prussia
prussia_make_prussian_vassal = {
	category = influence
	
	require_acceptance = no
	
	is_visible = {
		has_country_modifier = PRU_vassal_play
		FROM = {
			is_subject_of_type = vassal
			is_subject_of = ROOT
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			has_country_modifier = PRU_vassal_play
			FROM = {
				is_subject_of_type = vassal
				is_subject_of = ROOT
			}
		}
		FROM = { is_at_war = no }
		if = {
			limit = {
				has_country_flag = PRU_vassal_more
			}
			NOT = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = prussian_vassal
					}
					amount = 5
				}
			}
		}
		else = {
			NOT = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = prussian_vassal
					}
					amount = 3
				}
			}
		}
	}
	
	on_accept = {
		create_subject = {
			subject_type = prussian_vassal 
			subject = FROM
		}
	}
	
	ai_will_do = {
	}
}

#Sus
#SOS_turn_claim_into_perma_claim = {
#	category = covert
#
#	require_acceptance = no
#
#	is_visible = {
#		has_country_flag = ME_diplo_action_to_convert_claim_to_perma_claim_flag 
#	}
#	
#	is_allowed = {
#		hidden_trigger = {
#			has_country_flag = ME_diplo_action_to_convert_claim_to_perma_claim_flag 
#		}
#		FROM = {
#			custom_trigger_tooltip = {
#				tooltip = SOS_any_owned_province_is_regular_claim_of_root
#				any_owned_province = {
#					is_claim = ROOT
#					NOT = { is_permanent_claim = ROOT }
#				}
#			}
#			has_spy_network_from = {
#				who = ROOT
#				value = 30
#			}
#		}
#		
#		custom_trigger_tooltip = {	
#			tooltip = SOS_window_isnt_open_tt
#			NOT = { has_country_flag = SOS_window_is_open }
#		}
#		
#	}
#	
#	on_accept = {
#		hidden_effect = {
#			FROM = {
#				save_event_target_as = Sus_target_for_claims
#			}
#		}
#		country_event = { id = ME_Sus_Events.7 }
#		
#		FROM = {
#			add_spy_network_from = {
#				who = ROOT 
#				value = -30
#			}
#		}
#	}
#	
#	ai_will_do = {
#		always = yes
#	}
#}

#Swiss
request_canton = {
	category = influence

	alert_index = 6
	alert_tooltip = request_canton_alert_tooltip

	require_acceptance = yes # Whether the recipient gets an option to decline

	is_visible = {
		can_be_overlord = canton
		FROM = { 
			NOT = { is_subject = yes } 
		}
		FROM = { NOT = { is_subject_of = ROOT } }
	}
	is_allowed = {
		FROM = {
			has_opinion = {
				who = ROOT
				value = 190
			}
			alliance_with = ROOT
			NOT = { is_at_war = yes }
			is_subject = no 
			NOT = { total_development = 25 }
			OR = {
				technology_group = western
				technology_group = dutch_tech_group
				technology_group = english_tech_group
				technology_group = french_tech_group
				technology_group = german_tech_group
				technology_group = italian_tech_group
				technology_group = portuguese_tech_group
				technology_group = roman_tech_group
				technology_group = scandinavian_tech_group
				technology_group = spanish_tech_group
				technology_group = swiss_tech_group
			}
		}
		
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = 20
			mutual = yes
		}
		create_subject = {
			subject_type = canton
			subject = FROM
		}
	}
	on_decline = {
		add_trust = {
			who = FROM
			value = -100
			mutual = yes
		}
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		#Size of Trade League
		add_entry = {
			name = SIZE_CANTON
			limit = {
				canton = 4
			}
			export_to_variable = { #needs testing
				which = ai_value
				value = -1000
			}
		}
		
		#Attitude towards proposer
		add_entry = {
			name = ATTITUDE_CANTON
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_allied }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ATTITUDE_CANTON
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = ATTITUDE_CANTON
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = ATTITUDE_CANTON
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -1000
			}
		}
		
		#We have a royal marriage
		add_entry = {
			name = MARRIAGE_CANTON
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		
		#Proposer's diplomatic reputation 
		add_entry = {
			name = REPUTATION_CANTON
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
		
		#Target's opinion of Proposer
		add_entry = {
			name = OPINION_CANTON
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = {
				which = ai_value
				value = 4
			}
		}
		
		#Nation has a religion not in the same religious group
		add_entry = {
			name = RELIGION_CANTON
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = -20
			}
		}
		
		#Nation has a different religion within the same religious group
		add_entry = {
			name = SAME_GROUP_DIFFERENT_RELIGION_CANTON
			limit = {
				NOT = { religion = FROM }
				religion_group = FROM
			}
			export_to_variable = {
				which = ai_value
				value = -10
			}
		}
		
		
		#Proposer army strength power compared to target nation
		add_entry = {
			name = ARMY_CANTON
			limit = {
				NOT = {
					army_strength = {
						who = FROM
						value = 0.25
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = ARMY_CANTON
			limit = {
				army_strength = {
					who = FROM
					value = 0.25
				}
				NOT = {
					army_strength = {
						who = FROM
						value = 1
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = army_from
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = {
				which = ai_value
				which = army_from
			}
			subtract_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 80
			}
			divide_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = ARMY_CANTON
			limit = {
				army_strength = {
					who = FROM
					value = 1
				}
				NOT = {
					army_strength = {
						who = FROM
						value = 4
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = army_from
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = {
				which = ai_value
				which = army_from
			}
			subtract_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 20
			}
			divide_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = ARMY_CANTON
			limit = {
				army_strength = {
					who = FROM
					value = 4
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
	}

	ai_will_do = { # this is a trigger
		always = yes
	}
}

cancel_canton = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = canton
		}
	}
	is_allowed = {
		FROM = { prestige = 0 }
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = -25
			mutual = yes
		}
		FROM = {
			grant_independence = yes
			add_prestige = -25
		}
	}
	ai_will_do = {
		always = no
	}
}

#Autonomous Canton

request_autonomous_canton = {
	category = influence

	alert_index = 6
	alert_tooltip = request_autonomous_canton_alert_tooltip

	require_acceptance = yes # Whether the recipient gets an option to decline

	is_visible = {
		can_be_overlord = autonomous_canton
		FROM = { 
			NOT = { is_subject = yes } 
		}
		FROM = { NOT = { is_subject_of = ROOT } }
	}
	is_allowed = {
		FROM = {
			has_opinion = {
				who = ROOT
				value = 190
			}
			alliance_with = ROOT
			NOT = { is_at_war = yes }
			is_subject = no 
			NOT = { total_development = 25 }
			OR = {
				technology_group = western
				technology_group = dutch_tech_group
				technology_group = english_tech_group
				technology_group = french_tech_group
				technology_group = german_tech_group
				technology_group = italian_tech_group
				technology_group = portuguese_tech_group
				technology_group = roman_tech_group
				technology_group = scandinavian_tech_group
				technology_group = spanish_tech_group
				technology_group = swiss_tech_group
			}
		}
		
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = 20
			mutual = yes
		}
		create_subject = {
			subject_type = autonomous_canton
			subject = FROM
		}
	}
	on_decline = {
		add_trust = {
			who = FROM
			value = -100
			mutual = yes
		}
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		#Size of Trade League
		add_entry = {
			name = SIZE_AUTONOMOUS_CANTON
			limit = {
				autonomous_canton = 4
			}
			export_to_variable = { #needs testing
				which = ai_value
				value = -1000
			}
		}
		
		#Attitude towards proposer
		add_entry = {
			name = ATTITUDE_AUTONOMOUS_CANTON
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_allied }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ATTITUDE_AUTONOMOUS_CANTON
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = ATTITUDE_AUTONOMOUS_CANTON
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = ATTITUDE_AUTONOMOUS_CANTON
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -1000
			}
		}
		
		#We have a royal marriage
		add_entry = {
			name = MARRIAGE_AUTONOMOUS_CANTON
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		
		#Proposer's diplomatic reputation 
		add_entry = {
			name = REPUTATION_AUTONOMOUS_CANTON
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
		
		#Target's opinion of Proposer
		add_entry = {
			name = OPINION_AUTONOMOUS_CANTON
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = {
				which = ai_value
				value = 4
			}
		}
		
		#Nation has a religion not in the same religious group
		add_entry = {
			name = RELIGION_AUTONOMOUS_CANTON
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = -20
			}
		}
		
		#Nation has a different religion within the same religious group
		add_entry = {
			name = SAME_GROUP_DIFFERENT_RELIGION_AUTONOMOUS_CANTON
			limit = {
				NOT = { religion = FROM }
				religion_group = FROM
			}
			export_to_variable = {
				which = ai_value
				value = -10
			}
		}
		
		
		#Proposer army strength power compared to target nation
		add_entry = {
			name = ARMY_AUTONOMOUS_CANTON
			limit = {
				NOT = {
					army_strength = {
						who = FROM
						value = 0.25
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = ARMY_AUTONOMOUS_CANTON
			limit = {
				army_strength = {
					who = FROM
					value = 0.25
				}
				NOT = {
					army_strength = {
						who = FROM
						value = 1
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = army_from
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = {
				which = ai_value
				which = army_from
			}
			subtract_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 80
			}
			divide_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = ARMY_AUTONOMOUS_CANTON
			limit = {
				army_strength = {
					who = FROM
					value = 1
				}
				NOT = {
					army_strength = {
						who = FROM
						value = 4
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = army_from
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = {
				which = ai_value
				which = army_from
			}
			subtract_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 20
			}
			divide_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = ARMY_AUTONOMOUS_CANTON
			limit = {
				army_strength = {
					who = FROM
					value = 4
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
	}

	ai_will_do = { # this is a trigger
		always = yes
	}
}

cancel_autonomous_canton = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = autonomous_canton
		}
	}
	is_allowed = {
		FROM = { prestige = 0 }
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = -25
			mutual = yes
		}
		FROM = {
			grant_independence = yes
			add_prestige = -25
		}
	}
	ai_will_do = {
		always = no
	}
}

# Create new diplomatic actions like this. AI will currently never send them.
#demand_dummy = {
#	category = influence
#
#	alert_index = 40
#	alert_tooltip = demand_dummy_alert_tooltip
#
#	require_acceptance = yes # Whether the recipient gets an option to decline
#
#	is_visible = {
#		always = no ############################ Remove this line to unleash the magic ########################################
#		religion_group = christian
#		is_subject = no
#		FROM = {
#			is_subject = no
#		}
#	}
#	is_allowed = {
#		variable_arithmetic_trigger = {
#			custom_tooltip = HAS_OLDER_RULER_THAN_THEIR_HEIR
#			export_to_variable = { # All export to variable will happen first. Then the other effects and triggers will be executed/evaluated in order
#				variable_name = my_age
#				value = trigger_value:ruler_age
#			}
#			export_to_variable = {
#				variable_name = their_age
#				value = trigger_value:heir_age
#				who = FROM
#			}
#			ruler_age = 0 # This is a normal trigger.
#			FROM = {
#				heir_age = 0 # This is a normal trigger too.
#			}
#			check_variable = { # This trigger is only allowed inside a variable_arithmetic_trigger.
#				which = my_age
#				which = their_age
#			}
#		}
#		religion = catholic
#	}
#	on_accept = {
#		add_trust = {
#			who = FROM
#			value = 20
#			mutual = yes
#		}
#		create_subject = {
#			subject_type = dummy
#			subject = FROM
#		}
#	}
#	on_decline =
#	{
#		add_trust = {
#			who = FROM
#			value = -100
#			mutual = no
#		}
#	}
#
#	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
#		add_entry = {
#			name = TRUST
#			limit = { religion = catholic }
#			export_to_variable = {
#				variable_name = ai_value # Each "add_entry" must create one variable called "ai_value", the value of which will be extracted after executing all effects
#				value = trust
#				who = FROM
#				with = THIS
#			}
#			subtract_variable = { which = ai_value value = 50 }
#			multiply_variable = { which = ai_value value = 2 }
#		}
#		add_entry = {
#			name = TRUST
#			limit = { NOT = { religion = catholic } }
#			export_to_variable = {
#				variable_name = ai_value
#				value = trust
#				who = FROM
#				with = THIS
#			}
#			export_to_variable = {
#				variable_name = is_defender
#				value = trigger_value:is_defender_of_faith # This sets is_defender to either 0.0 or 1.0
#			}
#			multiply_variable = {
#				which = is_defender
#				value = 10
#			}
#			change_variable = {
#				which = ai_value
#				which = is_defender # This adds 10 to ai_value if you are defender of faith
#			}
#			subtract_variable = { which = ai_value value = 50 }
#		}
#		add_entry = {
#			name = OPINION
#			export_to_variable = {
#				variable_name = ai_value
#				value = opinion
#				who = FROM
#				with = THIS
#			}
#			divide_variable = { which = ai_value value = 4 }
#		}
#	}
#
#	ai_will_do = { # this is a trigger
#		has_opinion_modifier = {
#			modifier = insulted
#			who = FROM
#		}
#	}
#}
#
#cancel_dummy = {
#	category = influence
#	require_acceptance = no
#	is_visible = {
#		overlord_of = FROM
#		FROM = {
#			is_subject_of_type = dummy
#		}
#	}
#	is_allowed = {
#		reverse_has_opinion_modifier = {
#			modifier = insulted
#			who = FROM
#		}
#	}
#	on_accept = {
#		add_trust = {
#			who = FROM
#			value = -100
#			mutual = yes
#		}
#		FROM = {
#			grant_independence = yes
#		}
#	}
#	ai_will_do = {
#		always = no
#	}
#}

# Sell indulgence
sell_indulgence = {
	category = economy

	alert_index = 56
	alert_tooltip = sell_indulgence_alert_tooltip

	require_acceptance = yes # Whether the recipient gets an option to decline

	is_visible = {
		has_government_attribute = can_sell_indulgences
		religion = catholic
	}
	is_allowed = {
		if = {
			limit = { FROM = { NOT = { religion = catholic } } }
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_catholic
				FROM = { religion = catholic }
			}
		}
		if = {
			limit = { FROM = { tag = PAP } }
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_pope
				FROM = { NOT = { tag = PAP } }
			}
		}
		if = {
			limit = { FROM = { is_subject_other_than_tributary_trigger = yes } }
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_subject
				FROM = { is_free_or_tributary_trigger = yes }
			}
		}
		if = {
			limit = { NOT = { papal_influence = 50 } NOT = { tag = PAP } }
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_pi
				papal_influence = 50
			}
		}
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_war
				NOT = { war_with = FROM }
			}
		}
	}
	on_accept = {
		if = {
			limit = { NOT = { tag = PAP } }
			add_papal_influence = -50
		}
		else = {
			add_corruption = 0.5
		}
		add_reform_desire = 0.0025
		FROM = {
			add_stability = 1
			add_prestige = 10
			country_event = {
				id = flavor_rig.5
			}
		}
		change_variable = {
			which = sold_indulgences
			value = 1
		}
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {
			name = TRUST
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
		}
		add_entry = {
			name = DIPLO_IS_RIVAL
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_rivalry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = diplomatic_reputation
			limit = { }
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 2
			multiply_variable = {
				which = ai_value
				value = 2
			}
		}
		add_entry = {
			name = STABILITY_AI_MODIFIER
			export_to_variable = {
				variable_name = ai_value
				value = stability
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = -25
			}
		}
	}

	ai_will_do = { # this is a trigger
		has_opinion = {
			who = FROM
			value = 50
		}
		FROM = {
			NOT = { stability = 2 }
		}
		NOT = { is_rival = FROM }
		NOT = { is_enemy = FROM }
		trust = {
			who = FROM
			value = 65
		}
	}
}

# Fabricate Ottoman Campaign of Conquest cb
fabricate_ottoman_invasion_cb = {
	category = covert

	require_acceptance = no

	is_visible = {
		has_government_attribute = has_eyalets
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { total_development = 150 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_NOT_150_TOTAL_DEV
				FROM = { NOT = { total_development = 150 } }
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 30
					}
				}
				NOT = { full_idea_group = spy_ideas }
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_30_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 30
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 24
					}
				}
				full_idea_group = spy_ideas
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_24_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 24
				}
			}
		}
		if = {
			limit = {
				has_casus_belli = {
					type = cb_ottoman_subjugation_war
					target = FROM
				}
			}
			custom_trigger_tooltip = {
				tooltip = HAS_OTTOMAN_INVASION_CB_ALREADY_TT
				NOT = {
					has_casus_belli = {
						type = cb_ottoman_subjugation_war
						target = FROM
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_subject = yes }
			}
			custom_trigger_tooltip = {
				tooltip = CANNOT_DO_ACTION_TO_SUBJECTS_TT
				FROM = { is_subject = no }
			}
		}
		if = {
			limit = {
				NOT = { is_neighbor_of = FROM }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_MUST_BE_NEIGHBOR_TT
				is_neighbor_of = FROM
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				full_idea_group = spy_ideas
			}
			add_spy_network_in = {
				who = FROM
				value = -24
			}
		}
		else = {
			add_spy_network_in = {
				who = FROM
				value = -30
			}
		}
		add_casus_belli = {
			target = FROM
			type = cb_ottoman_subjugation_war
			months = 60
		}
		FROM = {
			set_country_flag = got_invasion_cb_fabricated_by_@ROOT
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		has_spy_network_in = {
			who = FROM
			value = 50
		}
	}
}

# Elevate Eyalet to Vassal status
reign_in_eyalet = {
	category = influence

	alert_index = 5
	alert_tooltip = reign_in_eyalet_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_government_attribute = has_eyalets
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = eyalet
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = core_eyalet
			subject = FROM
			keep_liberty_desire = yes
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = yes	#There is never a reason for the Ottomans to not want to integrate their eyalets
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 4
			multiply_variable = {
				which = ai_value
				value = 4
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = HAS_BONUS_REIGN_IN_REASON
			limit = {
				has_country_flag = tur_reduced_requirements_for_core_eyalet
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = AI_LIBERTY_DESIRE
			export_to_variable = {
				variable_name = ai_value
				value = liberty_desire
				who = FROM
			}
			multiply_variable = {
				which = ai_value
				value = -1
			}
		}
	}
}

# Call Eyalet into wars
call_eyalet_into_wars = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_government_attribute = has_eyalets
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = eyalet
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				is_at_war = no
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_NOT_AT_WAR_TT
				is_at_war = yes
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						owes_favors = {
							who = ROOT
							value = 10
						}
					}
				}
				is_in_war = {
					defender_leader = ROOT
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_MUST_OWE_10_FAVORS_DEFENSIVE_WAR_TT
				FROM = {
					owes_favors = {
						who = ROOT
						value = 10
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						owes_favors = {
							who = ROOT
							value = 20
						}
					}
				}
				NOT = {
					is_in_war = {
						defender_leader = ROOT
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_MUST_OWE_20_FAVORS_TT
				FROM = {
					owes_favors = {
						who = ROOT
						value = 20
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
	}
	on_accept = {
		FROM = {
			ROOT = {
				add_favors = {
					who = PREV
					amount = -10
				}
			}
			join_all_defensive_wars_of = ROOT
		}
		if = {
			limit = {
				FROM = {
					owes_favors = {
						who = ROOT
						value = 10
					}
				}
			}
			FROM = {
				ROOT = {
					add_favors = {
						who = PREV
						amount = -10
					}
				}
				join_all_offensive_wars_of = ROOT
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = yes
	}
}

fabricate_tributary_cb = {
	category = covert

	require_acceptance = no

	is_visible = {
		has_country_flag = jap_enable_fabricating_trib_CB_flag
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 100
					}
				}
				NOT = { full_idea_group = spy_ideas }
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_100_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 100
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 80
					}
				}
				full_idea_group = spy_ideas
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_100_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 80
				}
			}
		}
		if = {
			limit = {
				has_casus_belli = {
					type = cb_force_tributary_mission
					target = FROM
				}
			}
			custom_trigger_tooltip = {
				tooltip = has_force_trib_cb_already_tt
				NOT = {
					has_casus_belli = {
						type = cb_force_tributary_mission
						target = FROM
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_subject = yes }
			}
			custom_trigger_tooltip = {
				tooltip = CANNOT_DO_ACTION_TO_SUBJECTS_TT
				FROM = { is_subject = no }
			}
		}
		if = {
			limit = {
				NOT = { total_development = FROM } 
			}
			custom_trigger_tooltip = {
				tooltip = we_need_more_dev_tt
				total_development = FROM 
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				full_idea_group = spy_ideas
			}
			add_spy_network_in = {
				who = FROM
				value = -80
			}
		}
		else = {
			add_spy_network_in = {
				who = FROM
				value = -100
			}
		}
		add_casus_belli = {
			target = FROM
			type = cb_force_tributary_mission
			months = 60
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		has_spy_network_in = {
			who = FROM
			value = 100
		}
	}
}

offer_protectorate = {
	category = influence
	require_acceptance = yes

	alert_index = 4
	alert_tooltip = offer_protectorate_alert_tooltip

	is_visible = {
		has_government_attribute = can_establish_trade_protectorates
		is_subject = no
		FROM = { is_subject = no }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					FROM = {
						capital_scope = {
							trade_range = ROOT
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_CAPITAL_IN_TRADE_RANGE_TT
				FROM = {
					capital_scope = {
						trade_range = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_reform = steppe_horde
						has_reform = scythian_horde_reform
						has_reform = great_mongol_state_reform
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_A_HORDE_TT
				FROM = {
					NOT = { 
						has_reform = steppe_horde
						has_reform = scythian_horde_reform
					}
					NOT = { has_reform = great_mongol_state_reform }
				}
			}
		}
		if = {
			limit = {
				FROM = {
					same_continent = ROOT
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_ON_ROOT_CONTINENT_TT
				FROM = {
					NOT = { same_continent = ROOT }
				}
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = trade_protectorate
			subject = FROM
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
		NOT = {
			FROM = {
				has_country_modifier = dissolve_protectorate_timer
			}
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			limit = {
				FROM = { num_of_subjects = 1 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.5
			}
		}
	}
}

dissolve_protectorate = {
	category = influence
	require_acceptance = no

	is_visible = {
		OR = {
			AND = {
				is_subject_of = FROM
				is_subject_of_type = trade_protectorate
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = trade_protectorate
			}
		}
	}
	is_allowed = {
	}
	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = trade_protectorate
			}
			grant_independence = yes		
		}
		else = {
			FROM = {
				grant_independence = yes
			}
		}
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = trade_protectorate
				NOT = { liberty_desire = 100 }
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			add_country_modifier = {
				name = dissolve_protectorate_timer
				duration = 3650
				hidden = yes
			}
		}
		else_if = {
			limit = {
				FROM = {
					NOT = { liberty_desire = 100 }
				}
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			FROM = {
				add_country_modifier = {
					name = dissolve_protectorate_timer
					duration = 3650
					hidden = yes
				}
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # Overlords will never want to break the relationship
		is_subject_of = FROM
		OR = {
			liberty_desire = 100
			AND = {
				stability = 1
				liberty_desire = 90
				NOT = {
					has_opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 80
				NOT = {
					has_opinion = {
						who = ROOT
						value = -100
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 70
				NOT = {
					has_opinion = {
						who = ROOT
						value = -150
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 60
				NOT = {
					has_opinion = {
						who = ROOT
						value = -199
					}
				}
			}
		}
		NOT = {
			any_neighbor_country = {
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
		}
	}
}

request_protectorate = {
	category = influence
	require_acceptance = yes

	alert_index = 4
	alert_tooltip = request_protectorate_alert_tooltip

	is_visible = {
		FROM = { has_government_attribute = can_establish_trade_protectorates }
		is_subject = no
		FROM = { is_subject = no }
		NOT = { 
			has_reform = steppe_horde
			has_reform = scythian_horde_reform
		}
		NOT = { has_reform = great_mongol_state_reform }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					capital_scope = {
						trade_range = FROM
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_FROM_TO_BE_IN_TRADE_RANGE_TT
				capital_scope = {
					trade_range = FROM
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				FROM = {
					same_continent = ROOT
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_ON_ROOT_CONTINENT_TT
				FROM = {
					NOT = { same_continent = ROOT }
				}
			}
		}
	}
	on_accept = {
		every_subject_country = {
			limit = {
				NOT = { is_subject_of_type = colony }
				NOT = { is_subject_of_type = crown_colony }
				NOT = { is_subject_of_type = private_enterprise }
				NOT = { is_subject_of_type = self_governing_colony }
			}
			ROOT = {
				release = PREV
			}
		}
		FROM = {
			create_subject = {
				subject_type = trade_protectorate
				subject = ROOT
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_threatened
			}
			any_neighbor_country = {
				NOT = { tag = FROM }
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
			FROM = {
				OR = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_domineering
					}
					ai_attitude = {
						who = ROOT
						attitude = attitude_protective
					}
				}
			}
		}
		NOT = { mil_tech = FROM }
		OR = {
			NOT = { army_size = FROM }
			AND = {
				capital_scope = { is_island = yes }
				NOT = { navy_size = FROM }
			}
			FROM = {
				military_strength = {
					who = ROOT
					value = 2
				}
			}
		}
		NOT = { has_country_modifier = dissolve_protectorate_timer }
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_rivalry
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = DIPLO_OUR_TOTAL_DEVELOPMENT_TT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = ROOT
			}
			#10 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.1
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = attitude_protective_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_protective } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.5
			}
		}
	}
}

# Call Protectorate into wars
call_trade_protectorate_into_wars = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = trade_protectorate
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				is_at_war = no
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_NOT_AT_WAR_TT
				is_at_war = yes
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						has_opinion = {
							who = ROOT
							value = 0
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_MUST_HAVE_POSITIVE_OPINION_TT
				FROM = {
					has_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
	}
	on_accept = {
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = trade_protectorate_called_into_war
			}
			join_all_defensive_wars_of = ROOT
		}
		if = {
			limit = {
				is_in_war = { attackers = ROOT }
			}
			FROM = {
				add_opinion = {
					who = ROOT
					modifier = trade_protectorate_called_into_war
				}
				join_all_offensive_wars_of = ROOT
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = yes
	}
}

# Grant Autonomy to Core Eyalet
grant_autonomy_to_core_eyalet = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_government_attribute = has_eyalets
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = core_eyalet
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = eyalet
			subject = FROM
			keep_liberty_desire = yes
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = no	#AI should never want to have its eyalet to be less centralized
	}
}

# Turn Eyalet to Vassal status
promote_vassal_to_eyalet = {
	category = influence

	require_acceptance = yes

	alert_index = 6
	alert_tooltip = promote_vassal_to_eyalet_alert_tooltip

	is_visible = {
		has_government_attribute = has_eyalets
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = vassal
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = eyalet
			subject = FROM
			keep_liberty_desire = yes
		}
		FROM = {
			if = {
				limit = {
					NOT = { has_reform = papacy_reform }
					NOT = { has_reform = celestial_empire }
					NOT = { has_reform = shogunate }
				}
				if = {
					limit = {
						OR = {
							culture_group = turko_semitic
							has_reform = pirate_republic_reform
						}
					}
					set_country_flag = pirate_eyalet
				}
				if = {
					limit = { NOT = { government = monarchy } }
					change_government = monarchy
				}
				if = {
					limit = { has_country_flag = pirate_eyalet }
					clr_country_flag = pirate_eyalet
					add_government_reform = barbary_eyalet_government
				}
				else = {
					add_government_reform = eyalet_government
				}
				set_country_flag = has_eyalet_color
				set_country_flag = has_overriden_color_flag
				change_country_color = { country = ROOT }
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = no	#Too risky to test this out with the AI
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 4
			multiply_variable = {
				which = ai_value
				value = 4
			}
		}
		add_entry = {
			name = AI_LIBERTY_DESIRE
			export_to_variable = {
				variable_name = ai_value
				value = liberty_desire
				who = FROM
			}
			multiply_variable = {
				which = ai_value
				value = -1
			}
		}
	}
}

# Promote Appanage Heir
promote_appanage_heir = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_government_attribute = heir
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = appanage
			has_government_attribute = heir
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				has_heir = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_HAS_HEIR_TT
				has_heir = no
			}
		}
		if = {
			limit = {
				FROM = { has_heir = no }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_NO_HEIR_TT
				FROM = { has_heir = YES }
			}
		}
	}
	on_accept = {
		FROM = { exile_heir_as = appanage_heir }
		set_heir = appanage_heir
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		FROM = {
			OR = {
				AND = {
					heir_adm = 3
					heir_dip = 3
					heir_mil = 3
				}
				AND = {
					heir_adm = 5
					OR = {
						heir_dip = 2
						heir_mil = 2
					}
				}
				AND = {
					heir_dip = 5
					OR = {
						heir_adm = 2
						heir_mil = 2
					}
				}
				AND = {
					heir_mil = 5
					OR = {
						heir_dip = 2
						heir_adm = 2
					}
				}
			}
		}
	}

	#ai_acceptance = {
    #    add_entry = {
    #        name = DIPLO_OPPINION
	#		export_to_variable = {
	#			variable_name = ai_value
	#			value = opinion
	#			who = FROM
	#			with = ROOT
	#		}
	#		multiply_variable = {
	#			which = ai_value 
	#			value = 0.2
	#		}
    #    }
	#	add_entry = {
	#		name = AI_TRUST_TOWARDS_ROOT
	#		export_to_variable = {
	#			variable_name = ai_value
	#			value = trust
	#			who = FROM
	#			with = ROOT
	#		}			
	#		subtract_variable = { 
	#			which = ai_value
	#			value = 50
	#		}
	#		#1 trust = +4 ai points
	#		multiply_variable = {
	#			which = ai_value
	#			value = 0.4
	#		}
	#	}
	#	add_entry = {
	#		name = AI_DIPLOMATIC_REPUTATION
	#		export_to_variable = {
	#			variable_name = ai_value
	#			value = trigger_value:diplomatic_reputation
	#		}
	#		#1 rep = 4
	#		multiply_variable = {
	#			which = ai_value
	#			value = 4
	#		}
	#	}
	#	add_entry = {
	#		name = AI_LIBERTY_DESIRE
	#		export_to_variable = {
	#			variable_name = ai_value
	#			value = liberty_desire
	#			who = FROM
	#		}
	#		multiply_variable = {
	#			which = ai_value
	#			value = -1
	#		}
	#	}
	#}
}

# Allow Commercial Enterprise to dow
grant_war_rights = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = commercial_enterprise
			has_country_modifier = revoked_war_rights
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		FROM = {
			remove_country_modifier = revoked_war_rights
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = no
	}
}

# Disallow Commercial Enterprise to dow
revoke_war_rights = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = commercial_enterprise
			NOT = { has_country_modifier = revoked_war_rights }
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		FROM = {
			add_country_modifier = {
				name = revoked_war_rights
				duration = -1
			}
			add_opinion = {
				who = ROOT
				modifier = revoked_our_right_to_war
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = no
	}
}

# Steal Modern Ideas
steal_modern_ideas = {
	category = covert
	require_acceptance = no

	is_visible = {
		has_government_mechanic = russian_modernization_mechanic
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { NOT = { tech_difference = 0 } }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_LESS_THAN_ROOT_TECHNOLOGY
				FROM = { tech_difference = 0 }
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 30
					}
				}
				NOT = { full_idea_group = spy_ideas }
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_30_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 30
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 24
					}
				}
				full_idea_group = spy_ideas
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_24_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 24
				}
			}
		}
		if = {
			limit = { has_estate_privilege = estate_nobles_mestnichestvo }
			custom_trigger_tooltip = {
				tooltip = CANNOT_GAIN_ANY_MODERNIZATION_TT
				NOT = { has_estate_privilege = estate_nobles_mestnichestvo }
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				full_idea_group = spy_ideas
			}
			add_spy_network_in = {
				who = FROM
				value = -24
			}
		}
		else = {
			add_spy_network_in = {
				who = FROM
				value = -30
			}
		}
		if = {
			limit = { FROM = { tech_difference = 0 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 2.0 }
		}
		if = {
			limit = { FROM = { tech_difference = 1 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 2 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 3 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 4 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 5 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 6 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
	}

	ai_will_do = { # this is a trigger
		has_spy_network_in = {
			who = FROM
			value = 30
		}
	}
}

# Study Modern Ideas
request_access_to_modern_ideas = {
	category = economy
	require_acceptance = yes

	alert_index = 11
	alert_tooltip = request_access_to_modern_ideas_alert_tooltip

	is_visible = {
		has_government_mechanic = russian_modernization_mechanic
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { NOT = { tech_difference = 1 } }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_LESS_THAN_ROOT_TECHNOLOGY
				FROM = { tech_difference = 1 }
			}
		}
		if = {
			limit = { NOT = { years_of_income = 0.25 } }
			years_of_income = 0.25
		}
		if = {
			limit = { has_estate_privilege = estate_nobles_mestnichestvo }
			custom_trigger_tooltip = {
				tooltip = CANNOT_GAIN_ANY_MODERNIZATION_TT
				NOT = { has_estate_privilege = estate_nobles_mestnichestvo }
			}
		}
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = FROM }
			}
		}
	}
	on_accept = {
		if = {
			limit = { FROM = { tech_difference = 1 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 2.0 }
		}
		if = {
			limit = { FROM = { tech_difference = 2 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 3 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 4 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 5 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 6 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		if = {
			limit = { FROM = { tech_difference = 7 } }
			add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 }
		}
		FROM = {
			country_event = {
				id = flavor_rus.294
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		years_of_income = 0.5
		is_in_deficit = no
		is_bankrupt = no
		is_at_war = no
		not = { num_of_loans = 1 }
		not = {
			has_government_power = {
				mechanic_type = russian_modernization_mechanic
				power_type = russian_modernization
				value = 90
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -50
			}
		}
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = HAS_DEFICIT
			limit = {
				FROM = {
					is_in_deficit = yes
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = SIZE_OF_LOANS
			limit = {
				FROM = {
					num_of_loans = 1
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = num_of_loans
			}			
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = AI_PERSONALITY
			limit = {
				FROM = {
					OR = {
						personality = ai_capitalist
						personality = ai_balanced
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = AI_PERSONALITY
			limit = {
				FROM = {
					OR = {
						personality = ai_diplomat
						personality = ai_colonialist
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = attitude_protective_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_protective } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#10 units = 1
			multiply_variable = {
				which = ai_value
				value = 0.1
			}
		}
	}
}

# Share Modern Ideas
share_modern_ideas = {
	category = economy
	require_acceptance = yes

	alert_index = 11
	alert_tooltip = share_modern_ideas_alert_tooltip

	is_visible = {
		FROM = { has_government_mechanic = russian_modernization_mechanic }
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { tech_difference = 1 }
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_HAS_LESS_THAN_ROOT_TECHNOLOGY
				FROM = { NOT = { tech_difference = 1 } }
			}
		}
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = FROM }
			}
		}
	}
	on_accept = {
		if = {
			limit = { FROM = { ROOT = { tech_difference = 1 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 2.0 } }
		}
		if = {
			limit = { FROM = { ROOT = { tech_difference = 2 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 } }
		}
		if = {
			limit = { FROM = { ROOT = { tech_difference = 3 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 } }
		}
		if = {
			limit = { FROM = { ROOT = { tech_difference = 4 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 } }
		}
		if = {
			limit = { FROM = { ROOT = { tech_difference = 5 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 } }
		}
		if = {
			limit = { FROM = { ROOT = { tech_difference = 6 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 } }
		}
		if = {
			limit = { FROM = { ROOT = { tech_difference = 7 } } }
			FROM = { add_government_power = { mechanic_type = russian_modernization_mechanic power_type = russian_modernization value = 0.5 } }
		}
		FROM = {
			country_event = {
				id = flavor_rus.297
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_defensive
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_allied
			}
			is_subject_of = FROM
		}
		FROM = {
			years_of_income = 0.5
			is_in_deficit = no
			is_bankrupt = no
			is_at_war = no
			not = { num_of_loans = 1 }
			not = {
				has_government_power = {
					mechanic_type = russian_modernization_mechanic
					power_type = russian_modernization
					value = 90
				}
			}
		}
		OR = {
			alliance_with = FROM
			is_subject_of = FROM
			AND = {
				is_in_deficit = yes
				num_of_loans = 2
			}
			is_bankrupt = yes
			personality = ai_capitalist
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_rivalry
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_threatened
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = all_nations	#"Base", using this loc key 
			limit = { always = yes }
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = HAS_DEFICIT
			limit = {
				FROM = {
					is_in_deficit = yes
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
		add_entry = {
			name = HAS_BANKRUPTCY
			limit = {
				FROM = {
					is_bankrupt = yes
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = SIZE_OF_LOANS
			limit = {
				FROM = {
					num_of_loans = 1
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = num_of_loans
			}			
			multiply_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = CANNOT_AFFORD
			limit = {
				FROM = {
					NOT = { years_of_income = 0.25 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = DOES_NOT_BENEFIT
			limit = {
				FROM = {
					or = {
						has_government_power = {
							mechanic_type = russian_modernization_mechanic
							power_type = russian_modernization
							value = 90
						}
						has_estate_privilege = estate_nobles_mestnichestvo
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
	}
}

create_pronoia = {
	category = influence

	alert_index = 17 #doesn't matter. it is forced onto the subject
	alert_tooltip = sell_indulgence_alert_tooltip #doesn't matter. it is forced onto the subject

	require_acceptance = no

	is_visible = {
		has_government_attribute = enables_pronoias
		FROM = {
			is_subject_of = ROOT
			NOT = {
				OR = {
					is_subject_of_type = hereditary_pronoia_subject_type
					is_subject_of_type = pronoia_subject_type
				}
			}
			is_subject_other_than_tributary_trigger = yes
		}
	}
	is_allowed = {
		if = {
			limit = { BYZ_reached_pronia_slot_limit = yes }
			custom_trigger_tooltip = {
				tooltip = BYZ_not_enough_free_pronoia_slots
				BYZ_enough_pronoia_slots = yes
			}
		}
		if = {
			limit = { from = { liberty_desire = 15 } }
			custom_trigger_tooltip = {
				tooltip = BYZ_too_much_liberty_desire
				from = { not = { liberty_desire = 15 } }
			}
		}
		if = {
			limit = { from = { total_development = 100 } }
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_NOT_100_TOTAL_DEV
				from = { not = { total_development = 100 } }
			}
		}
		if = {
			limit = { from = { not = { government = monarchy } } }
			custom_trigger_tooltip = {
				tooltip = FROM_IS_NOT_MONARCHY
				from = { government = monarchy }
			}
		}
		if = {
			limit = {
				from = {
					not = { is_subject_of_type = vassal }
					not = { is_subject_of_type = client_vassal }
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_NOT_VASSAL_OF_ROOT
				FROM = {
					OR = {
						is_subject_of_type = vassal
						is_subject_of_type = client_vassal
					}
				}
			}
		}
	}
	on_accept = {
		from = { grant_independence = { keep_liberty_desire = yes } }
		hidden_effect = {
			# country_event = { id = MEE_Byzantine_Events.56 }
			FROM = {
				set_saved_name = {
					key = byzantine_general
					type = advisor
					scope = ROOT
				}
				define_ruler = {
					name = byzantine_general
					change_mil = 4
					change_adm = 1
					change_dip = 0
					min_age = 30
					male = yes
					religion = ROOT
					culture = ROOT
				}
				if = {
					limit = {
						has_heir = yes
					}
					kill_heir = { allow_new_heir = no }
				}
			}
		}
		if = {
			limit = {
				has_country_flag = BYZ_hereditary_pronoiars
			}
			create_subject = {
				subject_type = pronoia_subject_type
				subject = FROM
				keep_liberty_desire = yes
			}
		}
		else = {
			create_subject = {
				subject_type = hereditary_pronoia_subject_type
				subject = FROM
				keep_liberty_desire = yes
			}
		}
	}

	ai_will_do = {
		if = {
			limit = {
				NOT = {
					OR = {
						mission_completed = BYZ_decentralized_pronoia
						mission_completed = BYZ_centralized_pronoia
					}
				}
			}
			always = yes
		}
		else_if = {
			limit = {
				is_subject_of_type = march
			}
			always = yes
		}
		else = {
			always = no
		}
	}
}
release_pronia = {
	category = influence
	require_acceptance = no
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			OR = {
				is_subject_of_type = hereditary_pronoia_subject_type
				is_subject_of_type = pronoia_subject_type
			}
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		from = {
			if = {
				limit = { not = { liberty_desire = 50 } }
				add_opinion = {
					who = root
					modifier = vassal_abandoned
				}
			}
			grant_independence = yes
			every_owned_province = {
				limit = {
					or = {
						is_claim = root
						is_permanent_claim = root
						is_core = root
					}
				}
				if = {
					limit = { is_permanent_claim = root }
					remove_claim = root
				}
				if = {
					limit = { is_claim = root }
					remove_claim = root
				}
				if = {
					limit = { is_core = root }
					remove_core = root
				}
			}
		}
		add_prestige = -25
	}
	ai_will_do = {
		always = no
	}
}

make_pronoia_inheritable = {
	category = influence

	alert_index = 17 #doesn't matter. it is forced onto the subject
	alert_tooltip = sell_indulgence_alert_tooltip #doesn't matter. it is forced onto the subject

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = hereditary_pronoia_subject_type
		}
	}
	is_allowed = {
		if = {
			limit = { from = { liberty_desire = 15 } }
			custom_trigger_tooltip = {
				tooltip = BYZ_too_much_liberty_desire
				from = { not = { liberty_desire = 15 } }
			}
		}
	}
	on_accept = {
		ROOT = {
			create_subject = {
				subject_type = pronoia_subject_type
				subject = FROM
			}
		}
	}

	ai_will_do = {
		if = {
			limit = {
				NOT = {
					OR = {
						mission_completed = BYZ_decentralized_pronoia
						mission_completed = BYZ_centralized_pronoia
					}
				}
			}
			always = no
		}
		else_if = {
			limit = {
				FROM = { development_of_overlord_fraction = 0.25 }
			}
			always = yes
		}
		else = {
			always = no 
		}
	}
}

# Sphere of Cultural Influence
invite_into_cultural_sphere_of_influence = {
	category = influence
	require_acceptance = yes

	alert_index = 60
	alert_tooltip = invite_into_cultural_sphere_of_influence_alert_tooltip

	is_visible = {
		has_government_mechanic = persian_influence_mechanic
		is_subject = no
		FROM = { is_subject = no }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					FROM = {
						capital_scope = {
							trade_range = ROOT
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_CAPITAL_IN_TRADE_RANGE_TT
				FROM = {
					capital_scope = {
						trade_range = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = { FROM = { NOT = { religion = root } } }
			custom_trigger_tooltip = {
				tooltip = FROM_IS_NOT_ROOT_RELIGION_TT
				FROM = { religion = root }
			}
		}
		if = {
			limit = { FROM = { is_great_power = yes } }
			custom_trigger_tooltip = {
				tooltip = FROM_IS_GREAT_POWER_TT
				FROM = { is_great_power = no }
			}
		}
		if = {
			limit = { FROM = { total_development = root } }
			custom_trigger_tooltip = {
				tooltip = FROM_MORE_DEV_THAN_ROOT_TT
				FROM = { NOT = { total_development = root } }
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = cultural_sphere_of_influence_subject
			subject = FROM
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
		NOT = {
			FROM = {
				has_country_modifier = just_left_sphere_of_cultural_influence_timer
			}
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			limit = {
				FROM = { num_of_subjects = 1 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = ADDITIONAL_REASONS_FROM_EVENTS_AND_MISSIONS_TO_ACCEPT_TT
			limit = { FROM = { has_country_flag = easier_to_get_into_persian_sphere } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 25 }
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -10 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#4 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
	}
}

remove_them_from_cultural_sphere_of_influece = {
	category = influence
	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = cultural_sphere_of_influence_subject
		}
	}
	is_allowed = {
	}
	on_accept = {
		FROM = {
			grant_independence = yes
			add_country_modifier = {
				name = just_left_sphere_of_cultural_influence_timer
				duration = 3650
				hidden = yes
			}
		}
		reverse_add_opinion = {
			who = from
			modifier = was_removed_from_our_sphere_of_influence
		}
		add_opinion = {
			who = from
			modifier = removed_from_our_sphere_of_influence
		}
		add_truce_with = from
	}
	on_decline = {
	}

	ai_will_do = { # Overlords will never want to break the relationship
		always = no
	}
}

leave_the_cultural_sphere_of_influece = {
	category = influence
	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = cultural_sphere_of_influence_subject
	}
	is_allowed = {
	}
	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = cultural_sphere_of_influence_subject
				NOT = { liberty_desire = 100 }
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
		}
		grant_independence = yes
		reverse_add_opinion = {
			who = from
			modifier = left_our_sphere_of_influence
		}
		add_opinion = {
			who = from
			modifier = left_their_sphere_of_influence
		}
		add_country_modifier = {
			name = just_left_sphere_of_cultural_influence_timer
			duration = 3650
			hidden = yes
		}
	}
	on_decline = {
	}

	ai_will_do = { # Overlords will never want to break the relationship
		is_subject_of = FROM
		OR = {
			liberty_desire = 100
			AND = {
				stability = 1
				liberty_desire = 90
				NOT = {
					has_opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 80
				NOT = {
					has_opinion = {
						who = ROOT
						value = -100
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 70
				NOT = {
					has_opinion = {
						who = ROOT
						value = -150
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 60
				NOT = {
					has_opinion = {
						who = ROOT
						value = -199
					}
				}
			}
		}
		NOT = {
			any_neighbor_country = {
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
		}
	}
}

join_cultural_sphere_of_influence = {
	category = influence
	require_acceptance = yes

	alert_index = 59
	alert_tooltip = join_cultural_sphere_of_influence_alert_tooltip

	is_visible = {
		FROM = { has_government_mechanic = persian_influence_mechanic }
		is_subject = no
		FROM = { is_subject = no }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					capital_scope = {
						trade_range = FROM
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_FROM_TO_BE_IN_TRADE_RANGE_TT
				capital_scope = {
					trade_range = FROM
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = { NOT = { religion = from } }
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_NOT_FROM_RELIGION_TT
				religion = from
			}
		}
		if = {
			limit = { is_great_power = yes }
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_GREAT_POWER_TT
				is_great_power = no
			}
		}
		if = {
			limit = { total_development = from }
			custom_trigger_tooltip = {
				tooltip = ROOT_MORE_DEV_THAN_FROM_TT
				NOT = { total_development = from }
			}
		}
	}
	on_accept = {
		FROM = {
			create_subject = {
				subject_type = cultural_sphere_of_influence_subject
				subject = ROOT
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_threatened
			}
			any_neighbor_country = {
				NOT = { tag = FROM }
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
			FROM = {
				OR = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_domineering
					}
					ai_attitude = {
						who = ROOT
						attitude = attitude_protective
					}
				}
			}
		}
		NOT = { mil_tech = FROM }
		OR = {
			NOT = { army_size = FROM }
			AND = {
				capital_scope = { is_island = yes }
				NOT = { navy_size = FROM }
			}
			FROM = {
				military_strength = {
					who = ROOT
					value = 2
				}
			}
		}
		NOT = { has_country_modifier = dissolve_protectorate_timer }
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_rivalry
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		is_emperor = no
		is_emperor_of_china = no
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = DIPLO_OUR_TOTAL_DEVELOPMENT_TT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = ROOT
			}
			#10 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.1
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = attitude_protective_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_protective } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#4 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = ADDITIONAL_REASONS_FROM_EVENTS_AND_MISSIONS_TO_ACCEPT_TT
			limit = { has_country_flag = easier_to_get_into_persian_sphere }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 25 }
		}
	}
}

# Create Vassal out of Influenced Country
elevate_influenced_country_to_vassal = {
	category = influence

	alert_index = 61
	alert_tooltip = elevate_influenced_country_to_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_government_mechanic = persian_influence_mechanic
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = cultural_sphere_of_influence_subject
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				has_global_modifier_value = {
					which = influence_to_vassal_elevation_cost
					value = 100
				}
			}
			custom_trigger_tooltip = {
				tooltip = COST_HIGHER_THAN_OUR_MAX_INFLUENCE_TT
				NOT = {
					has_global_modifier_value = {
						which = influence_to_vassal_elevation_cost
						value = 100
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { NOT = { primary_culture = root } }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_NOT_OUR_PRIMARY_CULTURE_TT
				FROM = { primary_culture = root }
			}
		}
		if = {
			limit = { NOT = { has_enough_persian_influence_to_elevate = yes } }
			custom_trigger_tooltip = {
				tooltip = HAS_ENOUGH_PERSIAN_INFLUENCE_TT
				has_enough_persian_influence_to_elevate = yes
			}
		}
	}
	on_accept = {
		export_to_variable = {
			which = PERSIAN_INFLUENCE_COST
			value = modifier:influence_to_vassal_elevation_cost
		}
		while = {
			limit = {
				check_variable = {
					which = PERSIAN_INFLUENCE_COST
					value = 1
				}
			}
			subtract_variable = {
				which = PERSIAN_INFLUENCE_COST
				value = 1
			}
			add_government_power = {
				mechanic_type = persian_influence_mechanic
				power_type = persian_influence
				value = -1
				scaled_with_gain_modifier = no
			}
		}
		consume_persian_influence_reduction = yes
		change_variable = {
			which = persian_influence_elevation_counter
			value = 1
		}
		from = {
			country_event = {
				id = persian_influence_events.100
			}
		}
		if = {
			limit = { has_country_flag = improved_elevation_effect }
			add_historical_friend = from
			from = { add_historical_friend = root }
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = yes	#There is never a reason for the Ottomans to not want to integrate their eyalets
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 4
			multiply_variable = {
				which = ai_value
				value = 4
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = HAS_BONUS_REIGN_IN_REASON
			limit = {
				has_country_flag = tur_reduced_requirements_for_core_eyalet
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = AI_LIBERTY_DESIRE
			export_to_variable = {
				variable_name = ai_value
				value = liberty_desire
				who = FROM
			}
			multiply_variable = {
				which = ai_value
				value = -1
			}
		}
	}
}

# Fabricate Spread the True Faith cb
fabricate_spread_the_true_faith_cb = {
	category = covert

	require_acceptance = no

	is_visible = {
		has_unlocked_diplomatic_action = { type = fabricate_spread_the_true_faith_cb }
		NOT = { religion = from }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 30
					}
				}
				NOT = { full_idea_group = spy_ideas }
				NOT = { has_country_flag = reduced_spread_faith_cb_spy_cost }
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_30_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 30
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 24
					}
				}
				full_idea_group = spy_ideas
				NOT = { has_country_flag = reduced_spread_faith_cb_spy_cost }
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_24_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 24
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 10
					}
				}
				NOT = { full_idea_group = spy_ideas }
				has_country_flag = reduced_spread_faith_cb_spy_cost
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_10_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 10
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_spy_network_in = {
						who = FROM
						value = 8
					}
				}
				full_idea_group = spy_ideas
				has_country_flag = reduced_spread_faith_cb_spy_cost
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_8_SPY_NETWORK_TT
				has_spy_network_in = {
					who = FROM
					value = 8
				}
			}
		}
		if = {
			limit = {
				has_casus_belli = {
					type = cb_spread_the_true_faith
					target = FROM
				}
			}
			custom_trigger_tooltip = {
				tooltip = HAS_SPREAD_THE_TRUE_FAITH_CB_ALREADY_TT
				NOT = {
					has_casus_belli = {
						type = cb_spread_the_true_faith
						target = FROM
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_subject = yes }
			}
			custom_trigger_tooltip = {
				tooltip = CANNOT_DO_ACTION_TO_SUBJECTS_TT
				FROM = { is_subject = no }
			}
		}
		if = {
			limit = {
				NOT = {
					FROM = {
						capital_scope = {
							trade_range = ROOT
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_CAPITAL_IN_TRADE_RANGE_TT
				FROM = {
					capital_scope = {
						trade_range = ROOT
					}
				}
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				full_idea_group = spy_ideas
				has_country_flag = reduced_spread_faith_cb_spy_cost
			}
			add_spy_network_in = {
				who = FROM
				value = -8
			}
		}
		else_if = {
			limit = {
				NOT = { full_idea_group = spy_ideas }
				has_country_flag = reduced_spread_faith_cb_spy_cost
			}
			add_spy_network_in = {
				who = FROM
				value = -10
			}
		}
		else_if = {
			limit = {
				full_idea_group = spy_ideas
				NOT = { has_country_flag = reduced_spread_faith_cb_spy_cost }
			}
			add_spy_network_in = {
				who = FROM
				value = -24
			}
		}
		else = {
			add_spy_network_in = {
				who = FROM
				value = -30
			}
		}
		add_casus_belli = {
			target = FROM
			type = cb_spread_the_true_faith
			months = 60
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		has_spy_network_in = {
			who = FROM
			value = 50
		}
	}
}

# Change primary culture of target
promote_primary_culture = {
	category = influence

	alert_index = 65
	alert_tooltip = promote_primary_culture_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_government_mechanic = persian_influence_mechanic
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { primary_culture = root }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_OUR_PRIMARY_CULTURE_TT
				FROM = { NOT = { primary_culture = root } }
			}
		}
		if = {
			limit = { NOT = { has_government_power = { mechanic_type = persian_influence_mechanic power_type = persian_influence value = 10 } } }
			custom_trigger_tooltip = {
				tooltip = HAS_NOT_10_PERSIAN_INFLUENCE_TT
				has_government_power = { mechanic_type = persian_influence_mechanic power_type = persian_influence value = 10 }
			}
		}
		if = {
			limit = { FROM = { NOT = { is_subject_of = root } NOT = { guaranteed_by = root } } }
			custom_trigger_tooltip = {
				tooltip = FROM_IS_NEITHER_GUARANTEED_NOR_SUBJECT_TT
				FROM = {
					OR = {
						is_subject_of = root
						guaranteed_by = root
					}
				}
			}
		}
		if = {
			limit = { war_with = from }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = from }
			}
		}
	}
	on_accept = {
		change_variable = {
			which = num_of_forced_culture_conversions
			value = 1
		}
		from = {
			change_primary_culture = root
		}
		add_government_power = {
			mechanic_type = persian_influence_mechanic
			power_type = persian_influence
			value = -10
			scaled_with_gain_modifier = no
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		has_government_power = {
			mechanic_type = persian_influence_mechanic
			power_type = persian_influence
			value = 100
		}
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_rebellious
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_disloyal
			}
		}
		has_opinion = {
			who = FROM
			value = 100
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 4
			multiply_variable = {
				which = ai_value
				value = 4
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_rebellious_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rebellious } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_disloyal_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_disloyal } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -100 }
		}
		add_entry = {
			name = AI_LIBERTY_DESIRE
			limit = {
				FROM = { is_subject_of = root liberty_desire = 50 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
	}
}

send_royal_ambassador = {
	category = covert

	require_acceptance = no

	is_visible = {
		OR = {
			has_government_mechanic = persian_influence_mechanic
			has_government_mechanic = the_three_royal_fires_mechanic
		}
		has_unlocked_diplomatic_action = { type = send_royal_ambassador }
	}
	is_allowed = {
		if = {
			limit = { 
				has_government_mechanic = persian_influence_mechanic
				NOT = { has_government_power = { mechanic_type = persian_influence_mechanic power_type = persian_influence value = 25 } }
			}
			custom_trigger_tooltip = {
				tooltip = HAS_NOT_25_PERSIAN_INFLUENCE_TT
				has_government_power = { mechanic_type = persian_influence_mechanic power_type = persian_influence value = 25 }
			}
		}
		if = {
			limit = { 
				has_government_mechanic = the_three_royal_fires_mechanic
				NOT = { has_government_power = { mechanic_type = the_three_royal_fires_mechanic power_type = asha_vahishta value = 25 } }
			}
			custom_trigger_tooltip = {
				tooltip = HAS_NOT_25_ASHA_VAHISHTA_TT
				has_government_power = { mechanic_type = the_three_royal_fires_mechanic power_type = asha_vahishta value = 25 }
			}
		}
		if = {
			limit = { war_with = from }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = from }
			}
		}
		if = {
			limit = {
				FROM = { has_opinion_modifier = { who = root modifier = royal_ambassador_visit } }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_WAS_VISITED_BY_ROYAL_AMBASSADORS_TT
				FROM = { NOT = { has_opinion_modifier = { who = root modifier = royal_ambassador_visit } } }
			}
		}
	}
	on_accept = {
		reverse_add_opinion = {
			who = from
			modifier = royal_ambassador_visit
		}
		add_government_power = {
			mechanic_type = persian_influence_mechanic
			power_type = persian_influence
			value = -25
			scaled_with_gain_modifier = no
		}
		add_government_power = {
			mechanic_type = the_three_royal_fires_mechanic
			power_type = asha_vahishta
			value = -25
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = no
	}
}

invite_to_zoroastrian_community = {
	category = influence
	require_acceptance = yes

	alert_index = 62
	alert_tooltip = invite_to_zoroastrian_community_alert_tooltip

	is_visible = {
		has_government_mechanic = the_three_royal_fires_mechanic
		is_subject = no
		FROM = { is_subject = no }
		NOT = { religion = from }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					FROM = {
						capital_scope = {
							trade_range = ROOT
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_CAPITAL_IN_TRADE_RANGE_TT
				FROM = {
					capital_scope = {
						trade_range = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = { FROM = { total_development = root } }
			custom_trigger_tooltip = {
				tooltip = FROM_MORE_DEV_THAN_ROOT_TT
				FROM = { NOT = { total_development = root } }
			}
		}
		if = {
			limit = { FROM = { tag = PAP } }
			custom_trigger_tooltip = {
				tooltip = FROM_IS_THE_POPE_TT
				FROM = { NOT = { tag = PAP } }
			}
		}
		if = {
			limit = { OR = { NOT = { has_country_flag = gained_first_invitation_charge } NOT = { check_variable = { which = zoroastrian_invitation_charges value = 1 } } } }
			custom_trigger_tooltip = {
				tooltip = ROOT_HAS_NO_INVITATION_CHARGES_TT
				check_variable = {
					which = zoroastrian_invitation_charges
					value = 1
				}
				has_country_flag = gained_first_invitation_charge
			}
		}
	}
	on_accept = {
		change_variable = {
			which = zoroastrian_invitation_charges
			value = -1
		}
		change_variable = {
			which = num_of_forced_conversions
			value = 1
		}
		FROM = { 
			change_religion = root 
			country_event = {
				id = flavor_per.72
			}
		}
	}
	on_decline = {
		FROM = {
			add_country_modifier = {
				name = just_asked_to_convert_timer
				duration = 18250
			}
		}
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
		NOT = {
			FROM = {
				has_country_modifier = just_asked_to_convert_timer
			}
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -10 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#4 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = ADDITIONAL_REASONS_FROM_EVENTS_AND_MISSIONS_TO_ACCEPT_TT
			limit = { FROM = { has_country_flag = easier_to_get_into_persian_sphere } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 25 }
		}
	}
}

mam_export_grain = {
	category = economy

	require_acceptance = yes

	alert_index = 63
	alert_tooltip = export_grain_alert_tooltip

	is_visible = {
		has_country_flag = enable_export_grain_dip_action_flag
		owns = 362 
		owns = 363
		owns = 2316
		owns = 4316
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					OR = {
						alliance_with = FROM 
						FROM = { is_subject_of = ROOT }
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_ALLIANCE_OR_SUBJECT_TT
				OR = {
					alliance_with = FROM 
					FROM = { is_subject_of = ROOT }
				}
			}
		}
		if = {
			limit = {
				FROM = { has_ruler_flag = trading_grain_exports_flag }
			}
			custom_trigger_tooltip = {
				tooltip = is_already_trading_grain_tt
				FROM = { 
					NOT = { has_ruler_flag = trading_grain_exports_flag }
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						province_distance = {
							who = FROM
							distance = 150
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = must_be_within_distance_tt
				any_owned_province = {
					province_distance = {
						who = FROM
						distance = 150
					}
				}
			}
		}
		if = {
			limit = {
				calc_true_if = {
					all_country = {
						has_ruler_flag = trading_grain_exports_flag
					}
					amount = 4
				}
				NOT = { has_country_flag = increase_exports_to_6_flag }
			}
			custom_trigger_tooltip = {
				tooltip = mam_no_more_than_4_trades_tt
				NOT = {
					calc_true_if = {
						all_country = {
							has_ruler_flag = trading_grain_exports_flag
						}
						amount = 4
					}
				}
			}
		}
		else = {
			custom_trigger_tooltip = {
				tooltip = mam_no_more_than_6_trades_tt
				NOT = {
					calc_true_if = {
						all_country = {
							has_ruler_flag = trading_grain_exports_flag
						}
						amount = 6
					}
				}
			}
		}
		if = {
			limit = { 
				NOT = { adm_power = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = NOT_ENOUGH_RESOURCES
				adm_power = 50
			}
		}
	}
	on_accept = {
		FROM = {
			set_ruler_flag = trading_grain_exports_flag
			add_ruler_modifier = {
				name = grain_trade_imports_modifier
				duration = -1
			}
			add_opinion = {
				who = ROOT
				modifier = engaged_in_grain_trade_modifier
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = exported_grain_in_europe }
				FROM = {
					capital_scope = {
						continent = europe 
					}
				}
			}
			set_country_flag = exported_grain_in_europe
		}
		if = {
			limit = {
				NOT = { has_country_flag = exported_grain_in_oceania }
				FROM = {
					capital_scope = {
						continent = oceania 
					}
				}
			}
			set_country_flag = exported_grain_in_oceania
		}
		if = {
			limit = {
				NOT = { has_country_flag = exported_grain_in_north_america }
				FROM = {
					capital_scope = {
						continent = north_america 
					}
				}
				
			}
			set_country_flag = exported_grain_in_north_america
		}
		if = {
			limit = {
				NOT = { has_country_flag = exported_grain_in_south_america }
				FROM = {
					capital_scope = {
						continent = south_america 
					}
				}
				
			}
			set_country_flag = exported_grain_in_south_america
		}
		if = {
			limit = {
				NOT = { has_country_flag = exported_grain_in_africa }
				FROM = {
					capital_scope = {
						continent = africa 
					}
				}
			}
			set_country_flag = exported_grain_in_africa
		}
		if = {
			limit = {
				NOT = { has_country_flag = exported_grain_in_asia }
				FROM = {
					capital_scope = {
						continent = asia 
					}
				}
			}
			set_country_flag = exported_grain_in_asia
		}
		add_adm_power = -50
		add_mercantilism = 2
	}
	on_decline = {
		add_prestige_or_monarch_power = { amount = -10 }
		FROM = {
			add_country_modifier = {
				name = just_asked_to_convert_timer
				duration = 18250
			}
		}
	}

	ai_will_do = { # this is a trigger
		NOT = {
			FROM = {
				has_country_modifier = just_asked_to_convert_timer
			}
		}
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_loyal
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_allied
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -10 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#5 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
	}
}

mam_sponsor_hajj = {
	category = influence
	require_acceptance = yes

	alert_index = 64
	alert_tooltip = sponsor_hajj_alert_tooltip

	is_visible = {
		has_country_flag = sponsor_hajj_dip_action_flag
		384 = {
			country_or_non_sovereign_subject_holds = ROOT
		}
		385 = {
			country_or_non_sovereign_subject_holds = ROOT
		}
		is_subject = no
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					religion_group = muslim 
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_ROOT_BEING_MUSLIM_TT
				religion_group = muslim 
			}
		}
		if = {
			limit = {
				NOT = {
					FROM = { religion_group = muslim }
				}
			}
			custom_trigger_tooltip = {
				tooltip = REQUIRES_FROM_BEING_MUSLIM_TT
				FROM = { religion_group = muslim }
			}
		}
		if = {
			limit = {
				FROM = { has_ruler_flag = performed_hajj_already_flag }
			}
			custom_trigger_tooltip = {
				tooltip = from_has_performed_hajj_already_tt
				FROM = { 
					NOT = { has_ruler_flag = performed_hajj_already_flag }
				}
			}
		}
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = FROM }
			}
		}
		if = {
			limit = { 
				OR = { 
					is_rival = FROM 
					is_enemy = FROM 
				}
			}
			custom_trigger_tooltip = {
				tooltip = NOT_RIVAL_OR_ENEMY_TT
				NOT = { 
					is_rival = FROM 
					is_enemy = FROM
				}
			}
		}
		if = {
			limit = {
				calc_true_if = {
					all_country = {
						has_ruler_flag = performed_hajj_already_flag
					}
					amount = 4
				}
			}
			custom_trigger_tooltip = {
				tooltip = mam_no_more_than_4_hajj_tt
				NOT = {
					calc_true_if = {
						all_country = {
							has_ruler_flag = performed_hajj_already_flag
						}
						amount = 4
					}
				}
			}
		}
		if = {
			limit = { 
				NOT = { treasury = 200 }
			}
			custom_trigger_tooltip = {
				tooltip = NOT_ENOUGH_RESOURCES_TREASURY_200
				treasury = 200
			}
		}
		if = {
			limit = { 
				NOT = { dip_power = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = NOT_ENOUGH_RESOURCES_DIP_50
				dip_power = 50
			}
		}
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_war
				NOT = { war_with = FROM }
			}
		}
	}
	on_accept = {
		FROM = { set_ruler_flag = performed_hajj_already_flag }
		if = {
			limit = {
				has_dlc = "Cradle of Civilization"
			}
			FROM = {
				if = {
					limit = {
						NOT = { has_religious_school_of = ROOT }
						NOT = {
							school_opinion = { 
								who = ROOT
								opinion = 1
							}
						}
					}
					if = {
						limit = {
							NOT = {
								school_opinion = { 
									who = ROOT
									opinion = 0
								}
							}
						}
						set_school_opinion = {
							who = ROOT
							opinion = 0
						}
					}
					else = {
						set_school_opinion = {
							who = ROOT
							opinion = 1
						}
					}
				}
				if = {
					limit = {
						piety = 0 
					}
					add_piety = 0.25
				}
				else = { add_piety = -0.25 }
			}
		}
		FROM = {  
			add_legitimacy = 10
			add_devotion = 10
			add_opinion = {
				who = ROOT
				modifier = performed_hajj_modifier
			}
		}
		add_trust = {
			who = FROM
			value = 10
			mutual = yes
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = 20
		}
		add_dip_power = -50
		add_treasury = -200
	}
	on_decline = {
		FROM = {
			add_country_modifier = {
				name = just_asked_to_convert_timer
				duration = 18250
			}
		}
	}

	ai_will_do = { # this is a trigger
		NOT = {
			FROM = {
				has_country_modifier = just_asked_to_convert_timer
			}
		}
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_loyal
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_allied
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -10 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#5 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
	}
}

incorporate_vassal = {
	category = influence

	alert_index = 17 #doesn't matter. it is forced onto the subject
	alert_tooltip = sell_indulgence_alert_tooltip #doesn't matter. it is forced onto the subject

	require_acceptance = no

	is_visible = {
		can_have_incorporated_vassals = yes
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = vassal
		}
	}
	is_allowed = {
		
	}
	on_accept = {
		create_subject = {
			subject_type = incorporated_vassal
			subject = FROM
			keep_liberty_desire = yes
		}
	}

	ai_will_do = {
		always = yes
	}
}

recruit_foreign_general = {
	category = relation

	alert_index = 56
	alert_tooltip = recruit_foreign_general_alert_tooltip

	require_acceptance = yes # Whether the recipient gets an option to decline

	is_visible = {
		has_government_attribute = enables_recruit_foreign_generals
	}
	is_allowed = {
		years_of_income = 1
		if = {
			limit = {
				FROM = { 
					OR = {
						NOT = { is_subject_of = ROOT }
						NOT = { alliance_with = ROOT }
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_SUBJECT_OR_ALLY_TT
				FROM = { 
					OR = {
						is_subject_of = ROOT
						alliance_with = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = { army_tradition = 10 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_10_AT_TT
				FROM = {
					army_tradition = 10
				}
			}
		}
		if = {
			limit = {
				ROOT = {
					has_country_flag = feo_recruit_general_cooldown
					NOT = {
						had_country_flag = {
							flag = feo_recruit_general_cooldown
							days = 3650
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_10_YEAR_CD_TT
				ROOT = {
					had_country_flag = {
						flag = feo_recruit_general_cooldown
						days = 3650
					}
				}
			}
		}
	}
	on_accept = {
		clr_country_flag = feo_recruit_general_cooldown
		set_country_flag = feo_recruit_general_cooldown
		#add all variables, then determine the general
		FROM = {
			add_army_tradition = -10
		}
		add_army_tradition = 10
		hidden_effect = { #Pays the Money
			set_variable = {
				which = MoneyToPay
				value = years_of_income
			}
			while = {
				limit = {
					check_variable = {
						which = MoneyToPay
						value = 1
					}
				}
				FROM = {
					add_treasury = 1
				}
				add_treasury = -1
				subtract_variable = {
					which = MoneyToPay
					value = -1
				}
			}
		}
		if = {
			limit = {
				mission_completed = feo_gavras_triumphant
			}
			define_advisor = {
				type = commandant
				religion = FROM
				culture = FROM
				cost_multiplier = 0.75
			}
		}
		#Final Army Tradition = ArmyTradtionOfFROM * (OpinionOfFROM / 200)
		#Example: 
		#Final Army Tradition = 75 * (150 / 200)
		#Final Army Tradition = 75 * 0.75
		#Final Army Tradition = 56
		#In the feo_create_general_diplomatic_action_effect scripted effect, this would mean it generates a general of 50 Army Tradition
		export_to_variable = {
			which = ArmyTradtionOfFROM
			value = army_tradition
			who = FROM
		}
		export_to_variable = {
			which = OpinionOfFROM
			value = opinion
			who = FROM
		}
		divide_variable = {
			which = OpinionOfFROM
			value = 200
		}
		multiply_variable = {
			which = ArmyTradtionOfFROM
			value = OpinionOfFROM
		}
		feo_create_general_diplomatic_action_effect = yes
	}
	on_decline = {
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {
			name = TRUST
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +3 ai points
			multiply_variable = {
				which = ai_value
				value = 0.3
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
		}
		add_entry = {
			name = DIPLO_IS_RIVAL
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_rivalry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = diplomatic_reputation
			limit = { }
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 1
			multiply_variable = {
				which = ai_value
				value = 1
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -5 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.1
			}
		}
	}

	ai_will_do = { # this is a trigger
		has_opinion = {
			who = FROM
			value = 50
		}
		FROM = {
			NOT = { stability = 2 }
		}
		NOT = { is_rival = FROM }
		NOT = { is_enemy = FROM }
		trust = {
			who = FROM
			value = 65
		}
	}
}

create_european_colony = {
	category = influence
	require_acceptance = no
	is_visible = {
		can_be_overlord = european_colony
		FROM = {
			is_overseas_subject = yes
			NOT = { is_subject_of_type = tributary_state }
			NOT = { is_subject_of_type = european_colony }
			is_subject_of = ROOT
		}
		NOT = {
            any_subject_country = {
                is_subject_of_type = european_colony
                capital_scope = {
                    region_for_scope_province = {
                        FROM = {
                            capital_scope = {
                                province_id = PREV_PREV
                            }
                        }
                    }
                }
            }
        }
	}
	is_allowed = {
		FROM = {
			NOT = { liberty_desire = 50 }
		}
	}
	on_accept = {
		create_subject = {
			subject_type = european_colony
			subject = FROM
		}
	}
	ai_will_do = {
		always = no
	}
}

demand_sacrifices = {
	category = influence
	require_acceptance = no
	is_visible = {
		FROM = {
			is_subject_of = ROOT
		}
		religion = nahuatl
		is_primitive = yes
	}
	is_allowed = {
		FROM = {
			NOT = { liberty_desire = 50 }
		}
	}
	on_accept = {
		add_doom = -10
		every_subject_country = {
			add_liberty_desire = 10
		}
	}
	ai_will_do = {
		always = no
	}
}

heathen_royal_marriage = {
	category = dynasty

	alert_index = 1
	alert_tooltip = ICON_RM

	require_acceptance = yes

	is_visible = {
		FROM = {
			NOT = { religion_group = ROOT }
			NOT = { marriage_with = ROOT }
		}
		OR = {
			AND = {
				has_government_attribute = can_royal_marry_heathens
				religion_group = christian
			}
			FROM = {
				has_government_attribute = can_royal_marry_heathens
				religion_group = christian
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				NOT = { religion_group = ROOT }
				NOT = { marriage_with = ROOT }
			}
			OR = {
				AND = {
					has_government_attribute = can_royal_marry_heathens
					religion_group = christian
				}
				FROM = {
					has_government_attribute = can_royal_marry_heathens
					religion_group = christian
				}
			}
		}
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = HEATHEN_MARWAR
				NOT = { war_with = FROM }
			}
		}
		
		if = {
			limit = { FROM = { is_subject_other_than_tributary_trigger = yes is_lesser_in_union = no } }
			custom_trigger_tooltip = {
				tooltip = HEATHEN_MARVAS
				NOT = { FROM = { is_subject_other_than_tributary_trigger = yes } }
			}
		}
		
		if = {
			limit = { FROM = { is_lesser_in_union = yes } }
			custom_trigger_tooltip = {
				tooltip = HEATHEN_MARJUN
				NOT = { FROM = { is_lesser_in_union = yes } }
			}
		}
		
	}

	on_accept = {
		force_create_marriage = FROM
	}

	on_decline = {
		add_opinion = {
			who = FROM
			modifier = opinion_refused_marriage
		}
	}

	ai_acceptance = {
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 40 }
		}
		add_entry = {
			name = attitude_protective_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_protective } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 40 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 5
			}
		}
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.25
			}
        }
		add_entry = {
			name = DIPLO_SAME_CULTURE_GROUP
			limit = { FROM = { culture_group = ROOT } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = DIPLO_SAME_RELIGION
			limit = { FROM = { religion = ROOT } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = DIPLO_MSG_FILTER_NEIGHBOURS
			limit = { FROM = { is_neighbor_of = ROOT } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.1
			}
		}
	}

	ai_will_do = {
		OR = {
			num_of_free_diplomatic_relations = 1
			alliance_with = FROM
			has_guaranteed = FROM
			FROM = { is_subject_of = ROOT }
		}
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_loyal
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_allied
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
	}
}

# Create Incorporated Personal Union
convert_to_core_personal_union = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_country_flag = hab_integrated_vassals_flag
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = personal_union
		}
	}
	is_allowed = {
		FROM = { NOT = { liberty_desire = 25 } }
		NOT = {
			integrated_personal_union = 5
		}
		OR = {
			NOT = {
				has_country_flag = convert_subject_to_incorporated_subject_cooldown_flag
			}
			had_country_flag = {
				flag = convert_subject_to_incorporated_subject_cooldown_flag
				days = 3650
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = integrated_personal_union
			subject = FROM
			keep_liberty_desire = yes
		}
		clr_country_flag = convert_subject_to_incorporated_subject_cooldown_flag
		set_country_flag = convert_subject_to_incorporated_subject_cooldown_flag
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = no
	}
}

create_soyurghal = {
	category = influence

	alert_index = 17 #doesn't matter. it is forced onto the subject
	alert_tooltip = sell_indulgence_alert_tooltip #doesn't matter. it is forced onto the subject

	require_acceptance = no

	is_visible = {
		has_country_flag = TIM_soyurghals_flag
		FROM = {
			is_subject_of = ROOT
			NOT = {
				is_subject_of_type = soyurghal_subject_type
			}
			is_subject_other_than_tributary_trigger = yes
		}
	}
	is_allowed = {
		if = {
			limit = { TIM_reached_soyurghal_slot_limit = yes }
			custom_trigger_tooltip = {
				tooltip = TIM_not_enough_free_soyurghal_slots
				TIM_enough_soyurghal_slots = yes
			}
		}
		if = {
			limit = { from = { total_development = 100 } }
			custom_trigger_tooltip = {
				tooltip = FROM_HAS_NOT_100_TOTAL_DEV
				from = { not = { total_development = 100 } }
			}
		}
		if = {
			limit = { from = { not = { government = monarchy } } }
			custom_trigger_tooltip = {
				tooltip = FROM_IS_NOT_MONARCHY
				from = { government = monarchy }
			}
		}
		if = {
			limit = {
				from = {
					not = { is_subject_of_type = vassal }
					not = { is_subject_of_type = client_vassal }
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_NOT_VASSAL_OF_ROOT
				FROM = {
					OR = {
						is_subject_of_type = vassal
						is_subject_of_type = client_vassal
					}
				}
			}
		}
	}
	on_accept = {
		from = { grant_independence = { keep_liberty_desire = yes } }
		hidden_effect = {
			FROM = {
				set_saved_name = {
					key = timurid_noble
					type = advisor
					scope = ROOT
				}
				define_ruler = {
					name = timurid_noble
					change_mil = 3
					change_adm = 1
					change_dip = 2
					min_age = 35
					male = yes
					religion = ROOT
					culture = ROOT
				}
				if = {
					limit = {
						has_heir = yes
					}
					kill_heir = { allow_new_heir = no }
				}
			}
		}
		create_subject = {
			subject_type = soyurghal_subject_type
			subject = FROM
			keep_liberty_desire = yes
		}
	}

	ai_will_do = {
		always = no
	}
}
release_soyurghal = {
	category = influence
	require_acceptance = no
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = soyurghal_subject_type
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		from = {
			if = {
				limit = { not = { liberty_desire = 50 } }
				add_opinion = {
					who = root
					modifier = vassal_abandoned
				}
			}
			grant_independence = yes
			every_owned_province = {
				limit = {
					or = {
						is_claim = root
						is_permanent_claim = root
						is_core = root
					}
				}
				if = {
					limit = { is_permanent_claim = root }
					remove_claim = root
				}
				if = {
					limit = { is_claim = root }
					remove_claim = root
				}
				if = {
					limit = { is_core = root }
					remove_core = root
				}
			}
		}
		add_prestige = -25
	}
	ai_will_do = {
		always = no
	}
}

release_nahuatl_tributary = {
	category = influence
	require_acceptance = no
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = nahuatl_tributary
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		from = {
			if = {
				limit = { not = { liberty_desire = 50 } }
				add_opinion = {
					who = root
					modifier = vassal_abandoned
				}
			}
			grant_independence = yes
			every_owned_province = {
				limit = {
					or = {
						is_claim = root
						is_permanent_claim = root
						is_core = root
					}
				}
				if = {
					limit = { is_permanent_claim = root }
					remove_claim = root
				}
				if = {
					limit = { is_claim = root }
					remove_claim = root
				}
				if = {
					limit = { is_core = root }
					remove_core = root
				}
			}
		}
		add_prestige = -25
	}
	ai_will_do = {
		always = no
	}
}
#VU additions
vu_enforce_temporal_authority_action = {

	category = papacy

	alert_index = 5
	alert_tooltip = vu_enforce_temporal_authority_action_tooltip
	
	require_acceptance = no

	is_visible = {
		tag = PAP
		is_subject = no
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = papal_subject_vu
		}
	}
	
	is_allowed = {
		FROM = {
			has_opinion = {
				who = ROOT
				value = 175
			}
			is_at_war = no
			is_neighbor_of = ROOT
		}
	}
	
	on_accept = {
		vassalize = FROM
		FROM = {
			add_trust = {
				who = ROOT
				value = -5
			}
			add_opinion = {
				who = ROOT
				modifier = vu_temporal_authority_enforced
			}
		}
		every_subject_country = {
			limit = { is_subject_of_type = papal_subject_vu }
			add_trust = {
				who = ROOT
				value = -3
			}
			add_opinion = {
				who = ROOT
				modifier = vu_temporal_authority_enforced_on_other
			}
		}
	}
	
	#on_decline = {}
	#ai_acceptance = {}

	ai_will_do = {
		always = no
		#stability = 1
		#NOT = { any_subject_country = { liberty_desire = 50 } }
	}
}

vu_release_silesian_duchy = {
	
	category = influence
	
	require_acceptance = no

	is_visible = {
		is_subject = no
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = silesian_duke
		}
	}
	
	is_allowed = {
		FROM = {
			is_at_war = no
			is_subject_of = ROOT
			is_subject_of_type = silesian_duke
		}
		NOT = { truce_with = FROM }
		prestige = -25
	}
	
	on_accept = {
		FROM = {
			if = {
				limit = {
					NOT = { liberty_desire = 50 }
				}
				add_opinion = {
					who = ROOT
					modifier = vassal_abandoned
				}
			}
			grant_independence = yes
			add_truce_with = ROOT
		}
		add_truce_with = FROM
		add_prestige = -25
	}
	
	#on_decline = {}
	#ai_acceptance = {}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

vu_create_silesian_duchy = {
	category = influence
	
	require_acceptance = no
	
	is_visible = {
		is_subject = no
		OR = {
			tag = BOH
			tag = HAB
			tag = AUT #VU - SF addition
			tag = POL
			tag = DWA
			tag = PLC
			tag = HUN
			tag = BRA
			tag = SAX
			tag = PRU
			tag = GER
			tag = MAZ
			capital_scope = {
				region = bohemia_region
			}
			capital_scope = {
				region = austria_region
			}
			capital_scope = {
				region = poland_region
			}
		}
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = vassal
			NOT = { is_subject_of_type = silesian_duke }
			OR = {
				tag = LEG
				tag = GLG
				tag = TES
				tag = OLE
				tag = OPL
				tag = ASC
				tag = TRO
				tag = SAG
				tag = BAU
				tag = BEG
				tag = BET
				tag = JAW
				tag = MST
				tag = NIE
				tag = RAC
				tag = SWD
				tag = KUZ
				tag = KRO
				tag = EGR
				tag = SCI
				capital_scope = {
					area = silesia_area
				}
			}
		}
	}
	
	is_allowed = {
		FROM = {
			is_at_war = no
			is_subject_of = ROOT
			is_subject_of_type = vassal
			NOT = { is_subject_of_type = silesian_duke }
		}
		NOT = { truce_with = FROM }
		is_at_war = no
	}
	
	on_accept = {
		create_subject = {
			subject = FROM
			subject_type = silesian_duke
		}
		add_truce_with = FROM
	}
	
	#on_decline = {}
	#ai_acceptance = {}

	ai_will_do = {
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_administrative_region
establish_administrative_region = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = administrative_region
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = administrative_region
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = administrative_region
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				NOT = { truce_with = FROM }
			}
			create_subject = {
				subject = FROM
				subject_type = administrative_region
			}
		}
	}

	ai_will_do = {
		calc_true_if = {
			all_subject_country = {
				is_vassal_or_similar_subject = yes
			}
			amount = 3
		}
		FROM = {
			NOT = { total_development = 100 }
		}
	}
}

administrative_region_remove_heir = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = administrative_region
			government = monarchy
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = administrative_region
				government = monarchy
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			has_regency = no
		}
		FROM = {
			has_heir = yes
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = administrative_region
					government = monarchy
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					has_regency = no
				}
				FROM = {
					has_heir = yes
				}
			}
			FROM = {
				set_ruler_flag = administrative_region_remove_heir
				country_event = { id = subjects_expanded_administrative_region_events.3 }
			}
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { has_ruler_flag = administrative_region_remove_heir }
			NOT = { liberty_desire = 25 }
			OR = {
				AND = {
					NOT = { heir_adm = 3 }
					NOT = { heir_dip = 3 }
					NOT = { heir_mil = 3 }
				}
				AND = {
					NOT = { heir_adm = 1 }
					NOT = { heir_dip = 4 }
					NOT = { heir_mil = 4 }
				}
				AND = {
					NOT = { heir_adm = 4 }
					NOT = { heir_dip = 1 }
					NOT = { heir_mil = 4 }
				}
				AND = {
					NOT = { heir_adm = 4 }
					NOT = { heir_dip = 4 }
					NOT = { heir_mil = 1 }
				}
			}
		}
	}
}

administrative_region_enable_administrative_help = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = administrative_region
			NOT = { has_country_flag = administrative_region_enable_administrative_help }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = administrative_region
				NOT = { has_country_flag = administrative_region_enable_administrative_help }
			}
		}
		is_at_war = no
		NOT = { truce_with = FROM }
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			has_regency = no
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = administrative_region
					NOT = { has_country_flag = administrative_region_enable_administrative_help }
				}
				is_at_war = no
				NOT = { truce_with = FROM }
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					has_regency = no
				}
			}
			FROM = {
				set_country_flag = administrative_region_enable_administrative_help
				add_opinion = {
					who = ROOT
					modifier = administrative_region_enable_administrative_help_opinion
				}
			}
		}
	}

	ai_will_do = {
		has_regency = no
		OR = {
			NOT = { ADM = 1 }
			NOT = { DIP = 1 }
			NOT = { MIL = 1 }
		}
		FROM = {
			NOT = { liberty_desire = 5 }
		}
	}
}

administrative_region_disable_administrative_help = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = administrative_region
			has_country_flag = administrative_region_enable_administrative_help
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = administrative_region
				has_country_flag = administrative_region_enable_administrative_help
			}
		}
		has_regency = no
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = administrative_region
					has_country_flag = administrative_region_enable_administrative_help
				}
				has_regency = no
			}
			FROM = {
				clr_country_flag = administrative_region_enable_administrative_help
				add_liberty_desire = 40
			}
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 55
		}
	}
}

#subjects_expanded_diplomatic_actions_agricultural_march
establish_agricultural_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = agricultural_march
		}
	}

	is_allowed = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = agricultural_march
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				is_subject = no
				can_create_subject_type = {
					subject = FROM
					subject_type = agricultural_march
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			create_subject = {
				subject = FROM
				subject_type = agricultural_march
			}
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { liberty_desire = 50 }
			NOT = { is_different_march_subject = yes }
			NOT = { development_of_overlord_fraction = 0.25 }
			is_subject_of_type = march
			any_neighbor_country = {
				OR = {
					is_rival = ROOT
					is_enemy = ROOT
				}
			}
			monthly_income = 20
			production_income_percentage = 0.35
			max_manpower = 20
			NOT = {
				num_of_owned_provinces_with = {
					value = 10
					is_permanent_claim = ROOT
				}
			}
		}
	}
}

ask_to_become_agricultural_march = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_agricultural_march_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = agricultural_march
			}
		}
	}

	is_allowed = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = agricultural_march
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = agricultural_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = agricultural_march
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = agricultural_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				clr_country_flag = declined_become_agricultural_march_@ROOT
				set_country_flag = declined_become_agricultural_march_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_agricultural_march
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_IS_VASSAL_FOR_AT_LEAST_10_YEARS
			limit = {
				years_in_vassalage_under = {
					who = FROM
					years = 10
					all_subject_country = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_RIVALS
			limit = {
				NOT = {
					any_neighbor_country = {
						OR = {
							is_rival = FROM
							is_enemy = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_MORE_THAN_25_PERCENT_OF_OVERLORD_DEVELOPMENT
			limit = {
				development_of_overlord_fraction = 0.25
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_TOO_FEW_PRODUCTION_INCOME
			limit = {
				OR = {
					NOT = { monthly_income = 20 }
					NOT = { production_income_percentage = 0.35 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_TOO_FEW_MAX_MANPOWER
			limit = {
				NOT = { max_manpower = 20 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { liberty_desire = 50 }
		NOT = { is_different_march_subject = yes }
		army_size = 20
		OR = {
			is_subject_of_type = march
			FROM = { ai = no }
		}
		production_income_percentage = 0.2
		any_neighbor_country = {
			OR = {
				is_rival = FROM
				is_enemy = FROM
			}
		}
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_become_agricultural_march_@ROOT }
				had_country_flag = { flag = declined_become_agricultural_march_@ROOT days = 1825 }
			}
		}
		NOT = {
			num_of_owned_provinces_with = {
				value = 10
				is_permanent_claim = FROM
			}
		}
	}
}

agricultural_march_enable_seize_production = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = agricultural_march
			NOT = { has_country_flag = agricultural_march_seize_production }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = agricultural_march
				NOT = { has_country_flag = agricultural_march_seize_production }
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = agricultural_march
					NOT = { has_country_flag = agricultural_march_seize_production }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				set_country_flag = agricultural_march_seize_production
			}
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { liberty_desire = 35 }
		}
	}
}

agricultural_march_disable_seize_production = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = agricultural_march
			has_country_flag = agricultural_march_seize_production
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = agricultural_march
				has_country_flag = agricultural_march_seize_production
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = agricultural_march
					has_country_flag = agricultural_march_seize_production
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			add_prestige = -10
			FROM = {
				clr_country_flag = agricultural_march_seize_production
			}
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 55
		}
	}
}

#subjects_expanded_diplomatic_actions_annexable_colony
establish_annexable_colony = {
	category = influence

	require_acceptance = no

	is_visible = {
		ai = no
		can_create_subject_type = {
			subject = FROM
			subject_type = annexable_colony
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = annexable_colony
		}
		num_of_colonists = 2
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = annexable_colony
				}
				num_of_colonists = 2
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = annexable_colony
			}
			FROM = {
				set_disabled_colonial_nation_spawning_for_region_for_overlord = yes
			}
			set_country_flag = has_had_annexable_colony
		}
	}

	ai_will_do = {
		always = no
	}
}

make_annexable_colony_to_colony_again = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = annexable_colony
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = annexable_colony
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = annexable_colony
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				grant_independence = yes
			}
			if = {
				limit = {
					has_dlc = "Leviathan"
				}
				create_subject = {
					subject = FROM
					subject_type = crown_colony
				}
			}
			else = {
				create_subject = {
					subject = FROM
					subject_type = colony
				}
			}
			FROM = {
				unset_disabled_colonial_nation_spawning_for_region_for_overlord = yes
			}
		}
	}

	ai_will_do = {
		always = yes
	}
}

#subjects_expanded_diplomatic_actions_banking_family_subject
establish_banking_family_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_banking_family_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = banking_family_subject
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = banking_family_subject
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
				}
			}
			FROM = {
				NOT = { liberty_desire = 50 }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = banking_family_subject
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				if = {
					limit = {
						FROM = {
							is_subject_of = ROOT
						}
					}
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = banking_family_subject
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = banking_family_subject
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				if = {
					limit = {
						FROM = {
							is_subject_of = ROOT
						}
					}
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_establish_banking_family_subject_@ROOT
				set_country_flag = declined_establish_banking_family_subject_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_banking_family_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_JUST_CANCELED_BANKING_FAMILY_SUBJECT
			limit = {
				FROM = {
					has_ruler_modifier = ruler_just_canceled_to_be_banking_family_subject
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_NUM_OF_PROVINCES
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_cities
				who = FROM
			}
			multiply_variable = { which = ai_value value = -5 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -49 }
					NOT = { check_variable = { which = eco_power value = 50 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -49 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_ACCEPT_VASSALIZATION_REASONS
			export_to_variable = {
				which = ai_value
				value = modifier:accept_vassalization_reasons
			}
		}
		add_entry = {
			name = ROOT_IS_NOT_A_REPUBLIC
			limit = {
				NOT = { government = republic }
				NOT = { has_government_attribute = can_create_banking_family_subject_rule }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
	}

	ai_will_do = {
		OR = {
			capital_scope = {
				region = italy_region
			}
			tag = ARA
			government_rank = 9
			AND = {
				NOT = { has_dlc = "Common Sense" }
				total_development = 1000
			}
			num_of_loans = 3
		}
		FROM = {
			is_emperor = no
			OR = {
				NOT = { has_country_flag = declined_establish_banking_family_subject_@ROOT }
				had_country_flag = { flag = declined_establish_banking_family_subject_@ROOT days = 1825 }
			}
			NOT = { is_subject_of = ROOT }
			capital_scope = {
				region = italy_region
			}
			NOT = {
				any_owned_province = {
					OR = {
						is_core = ROOT
						is_permanent_claim = ROOT
					}
				}
			}
		}
	}
}

ask_to_become_banking_family_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_banking_family_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = banking_family_subject
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = banking_family_subject
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		if = {
			limit = {
				is_subject_of = FROM
			}
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = banking_family_subject
					}
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				if = {
					limit = {
						is_subject_of = FROM
					}
					NOT = { liberty_desire = 50 }
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = banking_family_subject
				}
				add_truce_with = ROOT
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = banking_family_subject
					}
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				if = {
					limit = {
						is_subject_of = FROM
					}
					NOT = { liberty_desire = 50 }
				}
			}
			clr_country_flag = declined_establish_banking_family_subject_@FROM
			set_country_flag = declined_establish_banking_family_subject_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_banking_family_subject
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = ROOT_IS_VASSAL_OF_FROM
			limit = {
				is_subject_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				is_subject_of = FROM
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
						who = FROM
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -49 }
					NOT = { check_variable = { which = eco_power value = 50 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
				who = FROM
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
						who = FROM
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -49 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
						who = FROM
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = STRATEGIC_VALUE
			limit = {
				NOT = {
					AND = {
						FROM = {
							OR = {
								capital_scope = {
									region = italy_region
								}
								tag = ARA
								government_rank = 9
								AND = {
									NOT = { has_dlc = "Common Sense" }
									total_development = 1000
								}
								num_of_loans = 3
							}
						}
						is_emperor = no
						OR = {
							NOT = { has_country_flag = declined_establish_banking_family_subject_@FROM }
							had_country_flag = { flag = declined_establish_banking_family_subject_@FROM days = 1825 }
						}
						NOT = { is_subject_of = FROM }
						capital_scope = {
							region = italy_region
						}
						NOT = {
							any_owned_province = {
								OR = {
									is_core = FROM
									is_permanent_claim = FROM
								}
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_NUM_OF_LOANS
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_loans
				who = FROM
			}
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = FROM_IS_NOT_A_REPUBLIC
			limit = {
				FROM = {
					NOT = { government = republic }
					NOT = { has_government_attribute = can_create_banking_family_subject_rule }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
	}

	ai_will_do = {
		is_subject = no
		NOT = { num_of_cities = 4 }
		alliance_with = FROM
		religion = FROM
		OR = {
			is_part_of_hre = no
			FROM = {
				is_part_of_hre = yes
			}
		}
		is_elector = no
		is_emperor = no
		NOT = { num_of_subjects = 1 }
		NOT = { has_ruler_modifier = ruler_just_canceled_to_be_banking_family_subject }
		NOT = { has_reform = free_city }
		FROM = {
			NOT = {
				any_owned_province = {
					is_core = ROOT
				}
			}
		}
	}
}

enable_banking_family_subject_demand_war_chest_contribution = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = banking_family_subject
			NOT = { has_country_flag = banking_family_subject_demand_war_chest_contribution }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = banking_family_subject
				NOT = { has_country_flag = banking_family_subject_demand_war_chest_contribution }
			}
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = banking_family_subject
					NOT = { has_country_flag = banking_family_subject_demand_war_chest_contribution }
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			FROM = {
				set_country_flag = banking_family_subject_demand_war_chest_contribution
			}
		}
	}

	ai_will_do = {
		is_at_war = yes
		FROM = {
			NOT = { liberty_desire = 35 }
		}
	}
}

disable_banking_family_subject_demand_war_chest_contribution = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = banking_family_subject
			has_country_flag = banking_family_subject_demand_war_chest_contribution
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = banking_family_subject
				has_country_flag = banking_family_subject_demand_war_chest_contribution
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = banking_family_subject
					has_country_flag = banking_family_subject_demand_war_chest_contribution
				}
			}
			FROM = {
				clr_country_flag = banking_family_subject_demand_war_chest_contribution
			}
		}
	}

	ai_will_do = {
		OR = {
			is_at_war = no
			FROM = {
				liberty_desire = 55
			}
		}
	}
}

banking_family_subject_extort_emergency_funds = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = banking_family_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = banking_family_subject
			}
		}
		custom_trigger_tooltip = {
			tooltip = NOT_USED_BANKING_FAMILY_SUBJECT_EXTORT_EMERGENCY_FUNDS_WITHIN_LAST_25_YEARS_TT
			OR = {
				NOT = { has_country_flag = banking_family_subject_extort_emergency_funds_used }
				had_country_flag = { flag = banking_family_subject_extort_emergency_funds_used days = 9125 }
			}
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 190
			}
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = banking_family_subject
				}
				OR = {
					NOT = { has_country_flag = banking_family_subject_extort_emergency_funds_used }
					had_country_flag = { flag = banking_family_subject_extort_emergency_funds_used days = 9125 }
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 190
					}
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			clr_country_flag = banking_family_subject_extort_emergency_funds_used
			set_country_flag = banking_family_subject_extort_emergency_funds_used
			FROM = {
				country_event = { id = subjects_expanded_banking_family_subject_events.3 }
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

banking_family_subject_become_independent = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = banking_family_subject
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = banking_family_subject
		}
		NOT = { truce_with = FROM }
		liberty_desire = 50
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = banking_family_subject
				NOT = { truce_with = FROM }
				liberty_desire = 50
			}
			add_stability = -1
			add_ruler_modifier = {
				name = ruler_just_canceled_to_be_banking_family_subject
				duration = -1
				hidden = yes
			}
			FROM = {
				ROOT = {
					grant_independence = yes
				}
				add_casus_belli = {
					target = ROOT
					type = cb_disloyal_banking_family_subject
				}
			}
		}
	}

	ai_will_do = {
		stability = 1
		liberty_desire = 60
		is_at_war = no
	}
}

cancel_banking_family_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = banking_family_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = banking_family_subject
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = banking_family_subject
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
				add_ruler_modifier = {
					name = ruler_just_canceled_to_be_banking_family_subject
					duration = -1
					hidden = yes
				}
			}
			add_truce_with = FROM
			add_prestige = -25
			remove_casus_belli = {
				target = FROM
				type = cb_disloyal_banking_family_subject
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

#subjects_expanded_diplomatic_actions_brother_kingdom
establish_brother_kingdom = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_brother_kingdom_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = brother_kingdom
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = brother_kingdom
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		is_female = no
		FROM = {
			is_female = no
		}
		months_of_ruling = 24
		FROM = {
			months_of_ruling = 24
		}
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
				}
			}
			FROM = {
				NOT = { liberty_desire = 50 }
			}
			if = {
				limit = {
					FROM = {
						is_subject_of_type = medieval_vassal
					}
				}
				FROM = {
					custom_trigger_tooltip = {
						tooltip = MEDIEVAL_VASSAL_AT_LEAST_SUBJECT_FOR_25_YEARS_TT
						years_in_vassalage_under = {
							who = ROOT
							years = 25
							all_subject_country = yes
						}
					}
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = brother_kingdom
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				is_female = no
				FROM = {
					is_female = no
				}
				if = {
					limit = {
						FROM = {
							is_subject_of = ROOT
						}
					}
					FROM = {
						NOT = { liberty_desire = 50 }
					}
					if = {
						limit = {
							FROM = {
								is_subject_of_type = medieval_vassal
							}
						}
						FROM = {
							years_in_vassalage_under = {
								who = ROOT
								years = 25
								all_subject_country = yes
							}
						}
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = brother_kingdom
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = brother_kingdom
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				is_female = no
				FROM = {
					is_female = no
				}
				if = {
					limit = {
						FROM = {
							is_subject_of = ROOT
						}
					}
					FROM = {
						NOT = { liberty_desire = 50 }
					}
					if = {
						limit = {
							FROM = {
								is_subject_of_type = medieval_vassal
							}
						}
						FROM = {
							years_in_vassalage_under = {
								who = ROOT
								years = 25
								all_subject_country = yes
							}
						}
					}
				}
			}
			FROM = {
				clr_country_flag = declined_establish_brother_kingdom_@ROOT
				set_country_flag = declined_establish_brother_kingdom_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_brother_kingdom_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				NOT = { government_rank = 9 }
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				government_rank = 9
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { overlord_of = FROM }
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_CURIA_CONTROLLER
			limit = {
				FROM = {
					is_papal_controller = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			limit = {
				FROM = {
					NOT = {
						is_subject_of_type_with_overlord = {
							who = ROOT
							type = medieval_vassal
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			limit = {
				FROM = {
					is_subject_of_type_with_overlord = {
						who = ROOT
						type = medieval_vassal
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_WAR_EXHAUSTION
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:war_exhaustion
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_RULER_STATS_COMPARED
			limit = {
				full_idea_group = diplomatic_ideas
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = their_ruler_adm
				value = ADM
				who = FROM
			}
			export_to_variable = {
				which = their_ruler_dip
				value = DIP
				who = FROM
			}
			export_to_variable = {
				which = their_ruler_mil
				value = MIL
				who = FROM
			}
			export_to_variable = {
				which = our_ruler_adm
				value = ADM
			}
			export_to_variable = {
				which = our_ruler_dip
				value = DIP
			}
			export_to_variable = {
				which = our_ruler_mil
				value = MIL
			}
			change_variable = { which = ai_value which = our_ruler_adm }
			change_variable = { which = ai_value which = our_ruler_dip }
			change_variable = { which = ai_value which = our_ruler_mil }
			subtract_variable = { which = ai_value which = their_ruler_adm }
			subtract_variable = { which = ai_value which = their_ruler_dip }
			subtract_variable = { which = ai_value which = their_ruler_mil }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = ROOT_FROM_RULER_STATS_COMPARED
			limit = {
				NOT = { full_idea_group = diplomatic_ideas }
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = their_ruler_adm
				value = ADM
				who = FROM
			}
			export_to_variable = {
				which = their_ruler_dip
				value = DIP
				who = FROM
			}
			export_to_variable = {
				which = their_ruler_mil
				value = MIL
				who = FROM
			}
			export_to_variable = {
				which = our_ruler_adm
				value = ADM
			}
			export_to_variable = {
				which = our_ruler_dip
				value = DIP
			}
			export_to_variable = {
				which = our_ruler_mil
				value = MIL
			}
			change_variable = { which = ai_value which = our_ruler_adm }
			change_variable = { which = ai_value which = our_ruler_dip }
			change_variable = { which = ai_value which = our_ruler_mil }
			subtract_variable = { which = ai_value which = their_ruler_adm }
			subtract_variable = { which = ai_value which = their_ruler_dip }
			subtract_variable = { which = ai_value which = their_ruler_mil }
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_RULER_IS_OLDER
			limit = {
				NOT = { ruler_age = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_LEGITIMACY_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				NOT = { legitimacy = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:legitimacy
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:legitimacy
				who = FROM
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = ROOT_FROM_LEGITIMACY_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				legitimacy = FROM
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:legitimacy
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:legitimacy
				who = FROM
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_A_HEIR
			limit = {
				FROM = {
					has_heir = yes
					heir_has_ruler_dynasty = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_HEIR_FROM_HAS_NO_HEIR
			limit = {
				has_heir = yes
				heir_has_ruler_dynasty = yes
				FROM = {
					has_heir = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = FROM_JUST_CANCELED_BROTHER_KINGDOM
			limit = {
				FROM = {
					has_ruler_modifier = ruler_just_canceled_to_be_brother_kingdom
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_TOO_SMALL
			limit = {
				NOT = { total_development = 50 }
				NOT = { total_development = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { personal_union = 2 }
		FROM = {
			is_emperor = no
			OR = {
				NOT = { has_country_flag = declined_establish_brother_kingdom_@ROOT }
				had_country_flag = { flag = declined_establish_brother_kingdom_@ROOT days = 1825 }
			}
			OR = {
				NOT = { is_subject_of = ROOT }
				AND = {
					is_subject_of_type = medieval_vassal
					total_development = 200
				}
			}
		}
	}
}

make_brother_kingdom_to_personal_union = {
	category = influence

	alert_index = 2
	alert_tooltip = make_brother_kingdom_to_personal_union_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = brother_kingdom
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = brother_kingdom
			}
		}
		has_regency = no
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		months_of_ruling = 24
		FROM = {
			months_of_ruling = 24
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = BROTHER_KINGDOM_AT_LEAST_SUBJECT_FOR_25_YEARS_TT
				years_in_vassalage_under = {
					who = ROOT
					years = 25
					all_subject_country = yes
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = brother_kingdom
				}
				has_regency = no
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				months_of_ruling = 24
				FROM = {
					months_of_ruling = 24
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 25
						all_subject_country = yes
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = personal_union
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = brother_kingdom
				}
				has_regency = no
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				months_of_ruling = 24
				FROM = {
					months_of_ruling = 24
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 25
						all_subject_country = yes
					}
				}
			}
			add_prestige = -10
			FROM = {
				add_legitimacy = -5
				clr_country_flag = make_brother_kingdom_to_personal_union_@ROOT
				set_country_flag = make_brother_kingdom_to_personal_union_@ROOT
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				diplomatic_reputation = 0
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				NOT = { diplomatic_reputation = 0 }
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_CURIA_CONTROLLER
			limit = {
				FROM = {
					is_papal_controller = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -5 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_RULER_STATS_COMPARED
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = their_ruler_adm
				value = ADM
				who = FROM
			}
			export_to_variable = {
				which = their_ruler_dip
				value = DIP
				who = FROM
			}
			export_to_variable = {
				which = their_ruler_mil
				value = MIL
				who = FROM
			}
			export_to_variable = {
				which = our_ruler_adm
				value = ADM
			}
			export_to_variable = {
				which = our_ruler_dip
				value = DIP
			}
			export_to_variable = {
				which = our_ruler_mil
				value = MIL
			}
			change_variable = { which = ai_value which = our_ruler_adm }
			change_variable = { which = ai_value which = our_ruler_dip }
			change_variable = { which = ai_value which = our_ruler_mil }
			subtract_variable = { which = ai_value which = their_ruler_adm }
			subtract_variable = { which = ai_value which = their_ruler_dip }
			subtract_variable = { which = ai_value which = their_ruler_mil }
			multiply_variable = { which = ai_value value = 15 }
		}
		add_entry = {
			name = FROM_RULER_IS_OLDER
			limit = {
				NOT = { ruler_age = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_LEGITIMACY_COMPARED
			export_to_variable = {
				which = ai_value
				value = trigger_value:legitimacy
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:legitimacy
				who = FROM
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_HAS_A_HEIR
			limit = {
				FROM = {
					has_heir = yes
					heir_has_ruler_dynasty = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_HEIR_FROM_HAS_NO_HEIR
			limit = {
				has_heir = yes
				heir_has_ruler_dynasty = yes
				FROM = {
					has_heir = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = FROM_HAS_REGENCY
			limit = {
				FROM = {
					OR = {
						has_regency = yes
						has_consort_regency = yes
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
	}

	ai_will_do = {
		prestige = 1
		FROM = {
			has_opinion = {
				who = ROOT
				value = 50
			}
		}
	}
}

make_personal_union_to_brother_kingdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_be_overlord = brother_kingdom
		has_heir = yes
		FROM = {
			is_subject_of = ROOT
			OR = {
				is_subject_of_type = personal_union
				#is_subject_of_type = salic_personal_union
			}
			government = monarchy
			religion_group = christian
		}
	}

	is_allowed = {
		hidden_trigger = {
			can_be_overlord = brother_kingdom
			has_heir = yes
			FROM = {
				is_subject_of = ROOT
				OR = {
					is_subject_of_type = personal_union
					#is_subject_of_type = salic_personal_union
				}
				government = monarchy
				religion_group = christian
			}
		}
		has_regency = no
		months_of_ruling = 60
		legitimacy = 80
		heir_age = 15
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				can_be_overlord = brother_kingdom
				has_heir = yes
				FROM = {
					is_subject_of = ROOT
					OR = {
						is_subject_of_type = personal_union
						#is_subject_of_type = salic_personal_union
					}
					government = monarchy
					religion_group = christian
				}
				has_regency = no
				months_of_ruling = 60
				legitimacy = 80
				heir_age = 15
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			create_subject = {
				subject = FROM
				subject_type = brother_kingdom
			}
			exile_heir_as = new_brother_kingdom_ruler_from_@ROOT
			FROM = {
				define_ruler = {
					dynasty = ROOT
					claim = 100
					age = 20
					male = yes
				}
				set_heir = new_brother_kingdom_ruler_from_@ROOT
				kill_ruler = yes
				add_stability = 1
				add_liberty_desire = -10
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

brother_kingdom_ask_overlord_to_join_war = {
	category = alliance

	alert_index = 6
	alert_tooltip = brother_kingdom_ask_overlord_to_join_war_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
			overlord_of = ROOT
		}
		is_subject_of_type = brother_kingdom
		any_country = {
			is_subject = no
			is_in_war = {
				defender_leader = THIS
				attacker_leader = ROOT
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject = no
				overlord_of = ROOT
			}
			is_subject_of_type = brother_kingdom
			any_country = {
				is_subject = no
				is_in_war = {
					defender_leader = THIS
					attacker_leader = ROOT
				}
			}
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_DECLINE_A_CALL_TO_ARMS_OF_A_SUBJECT_WITHIN_LAST_1_YEAR
				OR = {
					NOT = { has_country_flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT }
					had_country_flag = { flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT days = 365 }
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					overlord_of = ROOT
				}
				is_subject_of_type = brother_kingdom
				any_country = {
					is_subject = no
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT }
						had_country_flag = { flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT days = 365 }
					}
				}
			}
			FROM = {
				join_all_offensive_wars_of = ROOT
				clr_country_flag = accepted_brother_kingdom_offensive_call_to_arms_@ROOT
				set_country_flag = accepted_brother_kingdom_offensive_call_to_arms_@ROOT
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					overlord_of = ROOT
				}
				is_subject_of_type = brother_kingdom
				any_country = {
					is_subject = no
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT }
						had_country_flag = { flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT days = 365 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT
				set_country_flag = declined_brother_kingdom_offensive_call_to_arms_@ROOT
			}
			add_liberty_desire = 10
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_RULER_MIL_SKILL
			export_to_variable = {
				which = ai_value
				value = MIL
				who = FROM
			}
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_defensive }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 120
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_hostile }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 150
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_ATTITUDE_TOWARDS_FROM
			limit = {
				ai_attitude = { who = FROM attitude = attitude_loyal }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = atittude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = attitude_hostile }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_ALREADY_FIGHTING_IN_A_WAR
			limit = {
				FROM = {
					is_at_war = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALREADY_PARTICIPANT_IN_WAR_WITH_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					is_in_war = {
						participants = FROM
						participants = THIS
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_TRUCE_WITH_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					truce_with = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					alliance_with = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALREADY_JOINED_A_WAR_AGAINST_A_COALITION_TARGET_OF_ROOT_WITHIN_LAST_365_DAYS
			limit = {
				FROM = {
					has_country_flag = accepted_brother_kingdom_offensive_call_to_arms_@ROOT
					NOT = { had_country_flag = { flag = accepted_brother_kingdom_offensive_call_to_arms_@ROOT days = 365 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_WOULD_GET_STABILITY_HIT
			limit = {
				OR = {
					any_country = {
						is_in_war = {
							defender_leader = THIS
							attacker_leader = ROOT
						}
						OR = {
							marriage_with = FROM
							truce_with = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_IN_DEBT
			limit = {
				FROM = {
					num_of_loans = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_loans
				who = FROM
			}
			multiply_variable = { which = ai_value value = -10 }
		}
		add_entry = {
			name = FROM_WAR_EXHAUSTION
			export_to_variable = {
				which = ai_value
				value = trigger_value:war_exhaustion
				who = FROM
			}
			multiply_variable = { which = ai_value value = -10 }
		}
	}

	ai_will_do = {
		overlord = {
			is_at_war = no
		}
		any_country = {
			is_subject = no
			is_in_war = {
				defender_leader = THIS
				attacker_leader = ROOT
			}
			war_score_against = { who = ROOT value = 25 }
		}
		NOT = {
			calc_true_if = {
				all_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
				}
				amount = 3
			}
		}
	}
}

brother_kingdom_become_independent = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = brother_kingdom
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = brother_kingdom
		}
		NOT = { truce_with = FROM }
		liberty_desire = 50
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = brother_kingdom
				NOT = { truce_with = FROM }
				liberty_desire = 50
			}
			add_stability = -1
			add_ruler_modifier = {
				name = ruler_just_canceled_to_be_brother_kingdom
				duration = -1
				hidden = yes
			}
			FROM = {
				country_event = { id = subjects_expanded_brother_kingdom_events.2 }
			}
		}
	}

	ai_will_do = {
		stability = 1
		NOT = { war_exhaustion = 1 }
		manpower_percentage = 0.75
		OR = {
			num_of_allies = 2
			army_size = FROM
			calc_true_if = {
				all_country = {
					is_supporting_independence_of = ROOT
				}
				amount = 2
			}
		}
		OR = {
			liberty_desire = 60
			army_size = FROM
			total_development = FROM
		}
		OR = {
			is_at_war = no
			AND = {
				NOT = {
					is_in_war = {
						attacker_leader = ROOT
					}
				}
				NOT = {
					is_in_war = {
						defender_leader = ROOT
					}
				}
				all_owned_province = {
					OR = {
						controlled_by = ROOT
						controlled_by = REB
					}
				}
				NOT = { num_of_rebel_armies = 2 }
				NOT = { num_of_rebel_controlled_provinces = 3 }
			}
		}
	}
}

cancel_brother_kingdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = brother_kingdom
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = brother_kingdom
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = brother_kingdom
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
				add_ruler_modifier = {
					name = ruler_just_canceled_to_be_brother_kingdom
					duration = -1
					hidden = yes
				}
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 50
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_client_march
establish_client_march = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		is_subject = no
		primitives = no
		can_create_subject_type = {
			subject = FROM
			subject_type = client_march
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			is_subject = no
			primitives = no
			can_create_subject_type = {
				subject = FROM
				subject_type = client_march
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}
	
	on_accept = {
		if = {
			limit = {
				is_subject = no
				primitives = no
				can_create_subject_type = {
					subject = FROM
					subject_type = client_march
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			create_subject = {
				subject = FROM
				subject_type = client_march
			}
		}
	}
	
	ai_will_do = {
		always = no
	}
}

#subjects_expanded_diplomatic_actions_colonial_subjects
combine_colony_with_other_colony_in_same_colonial_region = {
	category = influence

	require_acceptance = no

	is_visible = {
		ai = no
		FROM = {
			is_subject_of = ROOT
			is_colonial_subject_type = yes
		}
		any_subject_country = {
			is_colonial_subject_type = yes
			NOT = { tag = FROM }
			ai = yes
			capital_scope = {
				FROM = {
					capital_scope = {
						colonial_region = PREV_PREV
					}
				}
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			ai = no
			FROM = {
				is_subject_of = ROOT
				is_colonial_subject_type = yes
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		custom_trigger_tooltip = {
			tooltip = COMBINE_COLONY_WITH_OTHER_COLONY_IN_SAME_COLONIAL_REGION_VALID_OTHER_COLONY_TT
			any_subject_country = {
				is_colonial_subject_type = yes
				NOT = { tag = FROM }
				ai = yes
				NOT = { liberty_desire = 50 }
				is_at_war = no
				capital_scope = {
					FROM = {
						capital_scope = {
							colonial_region = PREV_PREV
						}
					}
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				ai = no
				FROM = {
					is_subject_of = ROOT
					is_colonial_subject_type = yes
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				any_subject_country = {
					is_colonial_subject_type = yes
					NOT = { tag = FROM }
					ai = yes
					NOT = { liberty_desire = 50 }
					is_at_war = no
					capital_scope = {
						FROM = {
							capital_scope = {
								colonial_region = PREV_PREV
							}
						}
					}
				}
			}
			FROM = {
				add_liberty_desire = -10
			}
			every_subject_country = {
				limit = {
					is_colonial_subject_type = yes
					NOT = { tag = FROM }
					ai = yes
					NOT = { liberty_desire = 50 }
					is_at_war = no
					capital_scope = {
						FROM = {
							capital_scope = {
								colonial_region = PREV_PREV
							}
						}
					}
				}
				FROM = { inherit = PREV }
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

#subjects_expanded_diplomatic_actions_crusader_state_vassal
establish_crusader_state_vassal = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = crusader_state_vassal
		}
	}
	
	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = crusader_state_vassal
		}
		if = {
			limit = {
				tag = PAP
			}
			OR = {
				any_country = {
					is_crusade_target = yes
				}
				is_papal_controller = yes
				religious_unity = 1
			}
		}
		else = {
			papal_influence = 20
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			variable_arithmetic_trigger = {
				custom_tooltip = HAS_LESS_THAN_HALF_OF_PREV_TOTAL_DEVELOPMENT
				export_to_variable = {
					which = our_total_dev
					value = trigger_value:total_development
				}
				#subtract_variable = { which = our_total_dev value = 1 }
				export_to_variable = {
					which = their_total_dev
					value = trigger_value:total_development
					who = PREV
				}
				#subtract_variable = { which = their_total_dev value = 1 }
				divide_variable = { which = their_total_dev value = 2 }
				NOT = { check_variable = { which = our_total_dev which = their_total_dev } }
			}
		}
	}
	
	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = crusader_state_vassal
				}
				if = {
					limit = {
						tag = PAP
					}
					OR = {
						any_country = {
							is_crusade_target = yes
						}
						is_papal_controller = yes
						religious_unity = 1
					}
				}
				else = {
					papal_influence = 20
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			if = {
				limit = {
					NOT = { tag = PAP }
				}
				add_papal_influence = -20
			}
			create_subject = {
				subject = FROM
				subject_type = crusader_state_vassal
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
		any_country = {
			is_crusade_target = yes
		}
	}
}

send_crusader_knights_to_crusader_state_vassal = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		religion = catholic
		FROM = {
			religion = catholic
			is_subject_of = ROOT
			is_subject_of_type = crusader_state_vassal
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			religion = catholic
			FROM = {
				religion = catholic
				is_subject_of = ROOT
				is_subject_of_type = crusader_state_vassal
			}
		}
		manpower = 1
		treasury = 500
		FROM = {
			is_at_war = yes
		}
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			NOT = { has_country_modifier = send_crusader_knights_to_crusader_state_vassal }
		}
	}
	
	on_accept = {
		if = {
			limit = {
				religion = catholic
				FROM = {
					religion = catholic
					is_subject_of = ROOT
					is_subject_of_type = crusader_state_vassal
				}
				FROM = {
					is_at_war = yes
				}
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					NOT = { has_country_modifier = send_crusader_knights_to_crusader_state_vassal }
				}
			}
			add_manpower = -1
			add_treasury = -500
			FROM = {
				add_manpower = 1
				add_treasury = 500
				add_country_modifier = {
					name = send_crusader_knights_to_crusader_state_vassal
					duration = 1825
				}
			}
		}
	}
	
	ai_will_do = {
		crusade_target = {
			war_with = FROM
		}
		manpower = 10000
		treasury = 1500
	}
}

invite_missionars_from_crusader_state_vassal = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		religion = catholic
		FROM = {
			religion = catholic
			is_subject_of = ROOT
			is_subject_of_type = crusader_state_vassal
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			religion = catholic
			FROM = {
				religion = catholic
				is_subject_of = ROOT
				is_subject_of_type = crusader_state_vassal
			}
		}
		treasury = 1000
		is_at_war = no
		NOT = { num_of_missionaries = 4 }
		NOT = { has_country_modifier = invite_missionars_from_crusader_state_vassal }
		FROM = {
			is_at_war = no
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				religion = catholic
				FROM = {
					religion = catholic
					is_subject_of = ROOT
					is_subject_of_type = crusader_state_vassal
				}
				treasury = 1000
				is_at_war = no
				NOT = { num_of_missionaries = 4 }
				NOT = { has_country_modifier = invite_missionars_from_crusader_state_vassal }
				FROM = {
					is_at_war = no
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			add_treasury = -1000
			add_country_modifier = {
				name = invite_missionars_from_crusader_state_vassal
				duration = 1825
			}
			FROM = {
				add_treasury = 1000
				add_liberty_desire = 25
			}
		}
	}
	
	ai_will_do = {
		treasury = 2000
		NOT = { num_of_missionaries = 3 }
		FROM = {
			NOT = { liberty_desire = 25 }
		}
		NOT = { religious_unity = 0.5 }
	}
}

make_crusader_state_vassal_to_theocracy = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		religion = catholic
		government = theocracy
		FROM = {
			religion = catholic
			NOT = { government = theocracy }
			is_subject_of = ROOT
			is_subject_of_type = crusader_state_vassal
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			religion = catholic
			government = theocracy
			FROM = {
				religion = catholic
				NOT = { government = theocracy }
				is_subject_of = ROOT
				is_subject_of_type = crusader_state_vassal
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				religion = catholic
				government = theocracy
				FROM = {
					religion = catholic
					NOT = { government = theocracy }
					is_subject_of = ROOT
					is_subject_of_type = crusader_state_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				change_government = theocracy
				add_government_reform = leading_clergy_reform
				add_liberty_desire = 25
			}
		}
	}
	
	ai_will_do = {
		tag = PAP
		FROM = {
			NOT = { liberty_desire = 25 }
		}
	}
}

#subjects_expanded_diplomatic_actions_defensive_march
establish_defensive_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = defensive_march
		}
	}

	is_allowed = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = defensive_march
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				is_subject = no
				can_create_subject_type = {
					subject = FROM
					subject_type = defensive_march
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			create_subject = {
				subject = FROM
				subject_type = defensive_march
			}
		}
	}

	ai_will_do = {
		is_great_power = no
		NOT = { total_development = 500 }
		FROM = {
			NOT = { liberty_desire = 50 }
			NOT = { is_different_march_subject = yes }
			NOT = { development_of_overlord_fraction = 0.25 }
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
			num_of_owned_provinces_with = {
				value = 5
				fort_level = 2
			}
			any_neighbor_country = {
				OR = {
					is_rival = ROOT
					is_enemy = ROOT
				}
				army_strength = { who = ROOT value = 2.5 }
			}
			NOT = {
				num_of_owned_provinces_with = {
					value = 10
					is_permanent_claim = ROOT
				}
			}
		}
	}
}

ask_to_become_defensive_march = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_defensive_march_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = defensive_march
			}
		}
	}

	is_allowed = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = defensive_march
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = defensive_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = defensive_march
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = defensive_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				clr_country_flag = declined_become_defensive_march_@ROOT
				set_country_flag = declined_become_defensive_march_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_defensive_march
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_HAS_TOO_FEW_FORTS
			limit = {
				NOT = {
					num_of_owned_provinces_with = {
						value = 5
						fort_level = 2
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_VASSAL_FOR_AT_LEAST_10_YEARS
			limit = {
				years_in_vassalage_under = {
					who = FROM
					years = 10
					all_subject_country = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_RIVALS
			limit = {
				NOT = {
					any_neighbor_country = {
						OR = {
							is_rival = FROM
							is_enemy = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_STRONG_RIVALS
			limit = {
				any_neighbor_country = {
					OR = {
						is_rival = FROM
						is_enemy = FROM
					}
				}
				NOT = {
					any_neighbor_country = {
						OR = {
							is_rival = FROM
							is_enemy = FROM
						}
						army_strength = { who = FROM value = 2.5 }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_MORE_THAN_25_PERCENT_OF_OVERLORD_DEVELOPMENT
			limit = {
				development_of_overlord_fraction = 0.25
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_TOO_POWERFUL
			limit = {
				OR = {
					is_great_power = yes
					total_development = 500
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { liberty_desire = 50 }
		NOT = { is_different_march_subject = yes }
		army_size = 20
		num_of_owned_provinces_with = {
			value = 10
			fort_level = 2
		}
		any_neighbor_country = {
			OR = {
				is_rival = FROM
				is_enemy = FROM
			}
		}
		FROM = {
			is_great_power = no
			NOT = { total_development = 500 }
			OR = {
				NOT = { has_country_flag = declined_become_defensive_march_@ROOT }
				had_country_flag = { flag = declined_become_defensive_march_@ROOT days = 1825 }
			}
		}
		NOT = {
			num_of_owned_provinces_with = {
				value = 10
				is_permanent_claim = FROM
			}
		}
	}
}

enable_offensive_wars_for_defensive_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = defensive_march
			NOT = { has_country_flag = call_defensive_march_to_offensive_war }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = defensive_march
				NOT = { has_country_flag = call_defensive_march_to_offensive_war }
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			custom_trigger_tooltip = {
				tooltip = HAS_NOT_DISABLED_OFFENSIVE_WARS_FOR_DEFENSIVE_MARCH_LAST_10_YEARS
				NOT = { has_country_modifier = switched_defensive_march_to_or_from_offensive_wars }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = defensive_march
					NOT = { has_country_flag = call_defensive_march_to_offensive_war }
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					NOT = { has_country_modifier = switched_defensive_march_to_or_from_offensive_wars }
				}
			}
			FROM = {
				set_country_flag = call_defensive_march_to_offensive_war
				country_event = { id = subjects_expanded_defensive_march_events.1 }
				add_country_modifier = {
					name = switched_defensive_march_to_or_from_offensive_wars
					duration = 3650
					hidden = yes
				}
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

disable_offensive_wars_for_defensive_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = defensive_march
			has_country_flag = call_defensive_march_to_offensive_war
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = defensive_march
				has_country_flag = call_defensive_march_to_offensive_war
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = {
			custom_trigger_tooltip = {
				tooltip = HAS_NOT_ENABLED_OFFENSIVE_WARS_FOR_DEFENSIVE_MARCH_LAST_10_YEARS
				NOT = { has_country_modifier = switched_defensive_march_to_or_from_offensive_wars }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = defensive_march
					has_country_flag = call_defensive_march_to_offensive_war
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					NOT = { has_country_modifier = switched_defensive_march_to_or_from_offensive_wars }
				}
			}
			FROM = {
				clr_country_flag = call_defensive_march_to_offensive_war
				country_event = { id = subjects_expanded_defensive_march_events.2 }
				add_country_modifier = {
					name = switched_defensive_march_to_or_from_offensive_wars
					duration = 3650
					hidden = yes
				}
			}
		}
	}

	ai_will_do = {
		always = yes
	}
}

#subjects_expanded_diplomatic_actions_dutch_province_subject
establish_dutch_province_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_dutch_province_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		NOT = { exists = NED }
		can_create_subject_type = {
			subject = FROM
			subject_type = dutch_province_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			NOT = { exists = NED }
		}
		can_create_subject_type = {
			subject = FROM
			subject_type = dutch_province_subject
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		army_size = FROM
		total_base_tax = FROM
		is_month = 1
		if = {
			limit = {
				FROM = {
					NOT = { is_subject_of = ROOT }
				}
			}
			alliance_with = FROM
		}
		else = {
			FROM = {
				NOT = { liberty_desire = 50 }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				NOT = { exists = NED }
				can_create_subject_type = {
					subject = FROM
					subject_type = dutch_province_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				army_size = FROM
				total_base_tax = FROM
				is_month = 1
				if = {
					limit = {
						FROM = {
							NOT = { is_subject_of = ROOT }
						}
					}
					alliance_with = FROM
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = dutch_province_subject
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				NOT = { exists = NED }
				can_create_subject_type = {
					subject = FROM
					subject_type = dutch_province_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				army_size = FROM
				total_base_tax = FROM
				is_month = 1
				if = {
					limit = {
						FROM = {
							NOT = { is_subject_of = ROOT }
						}
					}
					alliance_with = FROM
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_establish_dutch_province_subject_@ROOT
				set_country_flag = declined_establish_dutch_province_subject_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_dutch_province_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_DIFF_OF_GOV_RANKS
			export_to_variable = {
				which = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			export_to_variable = {
				which = ai_value
				value = army_size
			}
			export_to_variable = {
				which = ai_value_2
				value = army_size
				who = FROM
			}
			multiply_variable = { which = ai_value_2 value = 1.5 }
			subtract_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				NOT = { overlord_of = FROM }
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_HAVE_SAME_PRIMARY_CULTURE
			limit = {
				primary_culture = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_NUM_OF_PROVINCES
			export_to_variable = {
				which = ai_value
				value = num_of_cities
				who = FROM
			}
			multiply_variable = { which = ai_value value = -5 }
		}
		add_entry = {
			name = FROM_IS_FRISIAN
			limit = {
				FROM = {
					primary_culture = frisian
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_WALLONIAN
			limit = {
				FROM = {
					primary_culture = wallonian
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_FRISIAN
			limit = {
				primary_culture = frisian
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_WALLONIAN
			limit = {
				primary_culture = wallonian
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { has_country_flag = formed_netherlands_flag }
		OR = {
			tag = HOL
			tag = UTR
			tag = GEL
			has_subject_of_type = dutch_province_subject
		}
		OR = {
			owns = 95
			owns = 96
			owns = 97
			owns = 98
			owns = 99
			owns = 100
			owns = 4383
		}
		OR = {
			NOT = { primary_culture = frisian }
			FROM = {
				NOT = { primary_culture = frisian }
			}
		}
		OR = {
			NOT = { primary_culture = wallonian }
			FROM = {
				NOT = { primary_culture = wallonian }
			}
		}
		FROM = {
			OR = {
				owns = 95
				owns = 96
				owns = 97
				owns = 98
				owns = 99
				owns = 100
				owns = 4383
			}
			OR = {
				NOT = { has_country_flag = declined_establish_dutch_province_subject_@ROOT }
				had_country_flag = { flag = declined_establish_dutch_province_subject_@ROOT days = 1825 }
			}
		}
	}
}

ask_for_dutch_province_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_for_dutch_province_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		NOT = { exists = NED }
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = dutch_province_subject
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			NOT = { exists = NED }
		}
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = dutch_province_subject
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			army_size = ROOT
		}
		FROM = {
			total_base_tax = ROOT
		}
		is_month = 1
		if = {
			limit = {
				NOT = { is_subject_of = FROM }
			}
			alliance_with = FROM
		}
		else = {
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				NOT = { exists = NED }
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = dutch_province_subject
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					army_size = ROOT
				}
				FROM = {
					total_base_tax = ROOT
				}
				is_month = 1
				if = {
					limit = {
						NOT = { is_subject_of = FROM }
					}
					alliance_with = FROM
				}
				else = {
					NOT = { liberty_desire = 50 }
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = dutch_province_subject
				}
				add_truce_with = ROOT
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				NOT = { exists = NED }
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = dutch_province_subject
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					army_size = ROOT
				}
				FROM = {
					total_base_tax = ROOT
				}
				is_month = 1
				if = {
					limit = {
						NOT = { is_subject_of = FROM }
					}
					alliance_with = FROM
				}
				else = {
					NOT = { liberty_desire = 50 }
				}
			}
			clr_country_flag = declined_establish_dutch_province_subject_@FROM
			set_country_flag = declined_establish_dutch_province_subject_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_for_dutch_province_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = ROOT_IS_VASSAL_OF_FROM
			limit = {
				is_subject_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				is_subject_of = FROM
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_DIFF_OF_GOV_RANKS
			export_to_variable = {
				which = ai_value
				value = trigger_value:government_rank
				who = FROM
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:government_rank
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			export_to_variable = {
				which = ai_value
				value = army_size
				who = FROM
			}
			export_to_variable = {
				which = ai_value_2
				value = army_size
			}
			multiply_variable = { which = ai_value_2 value = 1.5 }
			subtract_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				NOT = { is_subject_of = FROM }
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_HAVE_SAME_PRIMARY_CULTURE
			limit = {
				primary_culture = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_NUM_OF_PROVINCES
			export_to_variable = {
				which = ai_value
				value = num_of_cities
			}
			multiply_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = STRATEGIC_VALUE
			limit = {
				NOT = {
					AND = {
						FROM = {
							NOT = { has_country_flag = formed_netherlands_flag }
							OR = {
								tag = HOL
								tag = UTR
								tag = GEL
								has_subject_of_type = dutch_province_subject
							}
							OR = {
								owns = 95
								owns = 96
								owns = 97
								owns = 98
								owns = 99
								owns = 100
								owns = 4383
							}
						}
						OR = {
							NOT = { primary_culture = frisian }
							FROM = {
								NOT = { primary_culture = frisian }
							}
						}
						OR = {
							NOT = { primary_culture = wallonian }
							FROM = {
								NOT = { primary_culture = wallonian }
							}
						}
						OR = {
							owns = 95
							owns = 96
							owns = 97
							owns = 98
							owns = 99
							owns = 100
							owns = 4383
						}
						OR = {
							NOT = { has_country_flag = declined_establish_dutch_province_subject_@FROM }
							had_country_flag = { flag = declined_establish_dutch_province_subject_@FROM days = 1825 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_FRISIAN
			limit = {
				FROM = {
					primary_culture = frisian
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_WALLONIAN
			limit = {
				FROM = {
					primary_culture = wallonian
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_FRISIAN
			limit = {
				primary_culture = frisian
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_WALLONIAN
			limit = {
				primary_culture = wallonian
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			owns = 95
			owns = 96
			owns = 97
			owns = 98
			owns = 99
			owns = 100
			owns = 4383
		}
		OR = {
			NOT = { has_country_flag = declined_establish_dutch_province_subject_@FROM }
			had_country_flag = { flag = declined_establish_dutch_province_subject_@FROM days = 1825 }
		}
		NOT = { has_reform = free_city }
		is_emperor = no
		NOT = { num_of_subjects = 1 }
		NOT = { num_of_cities = 20 }
		NOT = { num_of_cities = FROM }
		OR = {
			NOT = { primary_culture = frisian }
			FROM = {
				NOT = { primary_culture = frisian }
			}
		}
		OR = {
			NOT = { primary_culture = wallonian }
			FROM = {
				NOT = { primary_culture = wallonian }
			}
		}
		FROM = {
			NOT = { has_country_flag = formed_netherlands_flag }
			OR = {
				tag = HOL
				tag = UTR
				tag = GEL
				overlord_of = ROOT
				has_subject_of_type = dutch_province_subject
			}
			OR = {
				owns = 95
				owns = 96
				owns = 97
				owns = 98
				owns = 99
				owns = 100
				owns = 4383
			}
		}
	}
}

dutch_province_subject_ask_for_independence = {
	category = influence

	alert_index = 2
	alert_tooltip = dutch_province_subject_ask_for_independence_alert_tooltip

	require_acceptance = yes

	is_visible = {
		NOT = { has_global_flag = dutch_province_subject_no_leader_election }
		is_subject_of = FROM
		is_subject_of_type = dutch_province_subject
	}

	is_allowed = {
		hidden_trigger = {
			NOT = { has_global_flag = dutch_province_subject_no_leader_election }
			is_subject_of = FROM
			is_subject_of_type = dutch_province_subject
		}
		is_at_war = no
		liberty_desire = 50
		NOT = { truce_with = FROM }
		is_month = 1
		custom_trigger_tooltip = {
			tooltip = DID_NOT_ASK_FOR_INDEPENDENCE_WITHIN_LAST_6_MONTHS
			NOT = { has_country_modifier = cooldown_dutch_province_subject_ask_for_independence }
		}
	}

	on_accept = {
		if = {
			limit = {
				NOT = { has_global_flag = dutch_province_subject_no_leader_election }
				is_subject_of = FROM
				is_subject_of_type = dutch_province_subject
				is_at_war = no
				liberty_desire = 50
				NOT = { truce_with = FROM }
				is_month = 1
			}
			FROM = {
				ROOT = { grant_independence = yes }
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				NOT = { has_global_flag = dutch_province_subject_no_leader_election }
				is_subject_of = FROM
				is_subject_of_type = dutch_province_subject
				is_at_war = no
				liberty_desire = 50
				NOT = { truce_with = FROM }
				is_month = 1
			}
			add_liberty_desire = 50
			add_opinion = {
				who = FROM
				modifier = dutch_province_subject_declined_freedom
			}
			add_country_modifier = {
				name = cooldown_dutch_province_subject_ask_for_independence
				duration = 183
				hidden = yes
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_LOW
			limit = {
				NOT = { liberty_desire = 50 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE
			limit = {
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:liberty_desire
			}
			subtract_variable = { which = ai_value value = 51 }
			divide_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			export_to_variable = {
				which = ai_value
				value = army_size
				who = FROM
			}
			export_to_variable = {
				which = ai_value_2
				value = army_size
			}
			divide_variable = { which = ai_value value = 2 }
			subtract_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = ROOT_AMOUNT_OF_ALLIANCES
			limit = {
				num_of_allies = 1
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_allies
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = FROM_AMOUNT_OF_ALLIANCES
			limit = {
				num_of_allies = 1
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_allies
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_HAS_NO_ALLIANCES
			limit = {
				NOT = { num_of_allies = 1 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -5 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				historical_friend_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = FROM_COULD_PERHAPS_ENACT_A_REFORM
			limit = {
				FROM = {
					OR = {
						NOT = { has_global_flag = dutch_province_subject_no_internal_war }
						AND = {
							NOT = { has_global_flag = dutch_province_subject_no_external_war }
							had_global_flag = { flag = dutch_province_subject_no_internal_war days = 1460 }
						}
						AND = {
							NOT = { has_global_flag = dutch_province_subject_no_leader_election }
							had_global_flag = { flag = dutch_province_subject_no_external_war days = 1460 }
						}
					}
					is_subject = no
					is_nomad = no
					stability = 1
					adm_power = 150
					dip_power = 150
					mil_power = 150
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = dutch_province_subject
						}
						amount = 2
					}
				}
				years_in_vassalage_under = {
					who = FROM
					years = 1
					all_subject_country = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_DUTCH_PROVINCES_REFORMS_PASSED
			limit = {
				has_global_flag = dutch_province_subject_no_internal_war
				NOT = { has_global_flag = dutch_province_subject_no_external_war }
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_DUTCH_PROVINCES_REFORMS_PASSED
			limit = {
				has_global_flag = dutch_province_subject_no_external_war
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		num_of_allies = 1
		liberty_desire = 70
	}
}

dutch_province_subject_force_white_peace = {
	category = influence

	alert_index = 2
	alert_tooltip = dutch_province_subject_force_white_peace_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_global_flag = dutch_province_subject_no_leader_election
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = dutch_province_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_global_flag = dutch_province_subject_no_leader_election
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = dutch_province_subject
			}
		}
		is_at_war = no
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = WAS_NOT_FORCED_TO_DO_WHITE_PEACE_WITHIN_LAST_YEAR
				NOT = { has_country_modifier = cooldown_dutch_province_subject_force_white_peace }
			}
		}
		FROM = {
			is_at_war = yes
			custom_trigger_tooltip = {
				tooltip = IS_AT_LEAST_IN_ONE_WAR_WHERE_THEY_ARE_NOT_WARLEADER
				any_country = {
					war_with = FROM
					NOT = {
						is_in_war = {
							participants = THIS
							participants = FROM
							attacker_leader = FROM
						}
					}
					NOT = {
						is_in_war = {
							participants = THIS
							participants = FROM
							defender_leader = FROM
						}
					}
				}
			}
		}
		custom_trigger_tooltip = {
			tooltip = HAS_LARGER_ARMY_SIZE_THAN_ALL_WAR_LEADERS_AGAINST_FROM
			all_country = {
				OR = {
					NOT = { war_with = FROM }
					NOT = {
						OR = {
							is_in_war = {
								participants = THIS
								participants = FROM
								attacker_leader = THIS
							}
							is_in_war = {
								participants = THIS
								participants = FROM
								defender_leader = THIS
							}
						}
					}
					ROOT = { army_size = PREV }
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				has_global_flag = dutch_province_subject_no_leader_election
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = dutch_province_subject
				}
				is_at_war = no
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					NOT = { has_country_modifier = cooldown_dutch_province_subject_force_white_peace }
				}
				FROM = {
					is_at_war = yes
					custom_trigger_tooltip = {
						tooltip = IS_AT_LEAST_IN_ONE_WAR_WHERE_THEY_ARE_NOT_WARLEADER
						any_country = {
							war_with = PREV
							NOT = {
								is_in_war = {
									participants = THIS
									participants = PREV
									attacker_leader = PREV
								}
							}
							NOT = {
								is_in_war = {
									participants = THIS
									participants = PREV
									defender_leader = PREV
								}
							}
						}
					}
				}
				all_country = {
					OR = {
						NOT = { war_with = FROM }
						NOT = {
							OR = {
								is_in_war = {
									participants = THIS
									participants = FROM
									attacker_leader = THIS
								}
								is_in_war = {
									participants = THIS
									participants = FROM
									defender_leader = THIS
								}
							}
						}
						ROOT = { army_size = PREV }
					}
				}
			}
			FROM = {
				add_liberty_desire = 50
				add_country_modifier = {
					name = cooldown_dutch_province_subject_force_white_peace
					duration = 365
					hidden = yes
				}
				every_owned_province = {
					limit = {
						NOT = { controlled_by = PREV }
						NOT = { controlled_by = REB }
						NOT = { is_permanent_claim = controller }
						NOT = { is_core = controller }
					}
					controller = {
						add_claim = PREV
					}
				}
				every_country = {
					limit = {
						war_with = PREV
						NOT = {
							is_in_war = {
								participants = THIS
								participants = PREV
								attacker_leader = PREV
							}
						}
						NOT = {
							is_in_war = {
								participants = THIS
								participants = PREV
								defender_leader = PREV
							}
						}
					}
					white_peace = PREV
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				has_global_flag = dutch_province_subject_no_leader_election
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = dutch_province_subject
				}
				is_at_war = no
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					NOT = { has_country_modifier = cooldown_dutch_province_subject_force_white_peace }
				}
				FROM = {
					is_at_war = yes
					custom_trigger_tooltip = {
						tooltip = IS_AT_LEAST_IN_ONE_WAR_WHERE_THEY_ARE_NOT_WARLEADER
						any_country = {
							war_with = PREV
							NOT = {
								is_in_war = {
									participants = THIS
									participants = PREV
									attacker_leader = PREV
								}
							}
							NOT = {
								is_in_war = {
									participants = THIS
									participants = PREV
									defender_leader = PREV
								}
							}
						}
					}
				}
				all_country = {
					OR = {
						NOT = { war_with = FROM }
						NOT = {
							OR = {
								is_in_war = {
									participants = THIS
									participants = FROM
									attacker_leader = THIS
								}
								is_in_war = {
									participants = THIS
									participants = FROM
									defender_leader = THIS
								}
							}
						}
						ROOT = { army_size = PREV }
					}
				}
			}
			FROM = {
				add_liberty_desire = 25
				add_country_modifier = {
					name = cooldown_dutch_province_subject_force_white_peace
					duration = 365
					hidden = yes
				}
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = base_values
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_ENEMY_CONTROLLED_PROVINCES
			limit = {
				FROM = {
					any_owned_province = {
						NOT = { controlled_by = PREV }
						NOT = { controlled_by = REB }
					}
					NOT = {
						calc_true_if = {
							all_owned_province = {
								NOT = { controlled_by = PREV }
								NOT = { controlled_by = REB }
							}
							amount = 2
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_HAS_ENEMY_CONTROLLED_PROVINCES
			limit = {
				FROM = {
					calc_true_if = {
						all_owned_province = {
							NOT = { controlled_by = PREV }
							NOT = { controlled_by = REB }
						}
						amount = 2
					}
					NOT = {
						calc_true_if = {
							all_owned_province = {
								NOT = { controlled_by = PREV }
								NOT = { controlled_by = REB }
							}
							amount = 4
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_HAS_ENEMY_CONTROLLED_PROVINCES
			limit = {
				FROM = {
					calc_true_if = {
						all_owned_province = {
							NOT = { controlled_by = PREV }
							NOT = { controlled_by = REB }
						}
						amount = 4
					}
					NOT = {
						calc_true_if = {
							all_owned_province = {
								NOT = { controlled_by = PREV }
								NOT = { controlled_by = REB }
							}
							amount = 6
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_HAS_ENEMY_CONTROLLED_PROVINCES
			limit = {
				FROM = {
					calc_true_if = {
						all_owned_province = {
							NOT = { controlled_by = PREV }
							NOT = { controlled_by = REB }
						}
						amount = 6
					}
					NOT = {
						calc_true_if = {
							all_owned_province = {
								NOT = { controlled_by = PREV }
								NOT = { controlled_by = REB }
							}
							amount = 8
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
		}
		add_entry = {
			name = FROM_HAS_ENEMY_CONTROLLED_PROVINCES
			limit = {
				FROM = {
					calc_true_if = {
						all_owned_province = {
							NOT = { controlled_by = PREV }
							NOT = { controlled_by = REB }
						}
						amount = 8
					}
					NOT = {
						calc_true_if = {
							all_owned_province = {
								NOT = { controlled_by = PREV }
								NOT = { controlled_by = REB }
							}
							amount = 10
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_HAS_ENEMY_CONTROLLED_PROVINCES
			limit = {
				FROM = {
					calc_true_if = {
						all_owned_province = {
							NOT = { controlled_by = PREV }
							NOT = { controlled_by = REB }
						}
						amount = 10
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
		}
		add_entry = {
			name = FROM_NUM_OF_PROVINCES
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_cities
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = FROM_HAS_OWN_CONTROLLED_PROVINCES
			limit = {
				any_province = {
					NOT = { owned_by = FROM }
					controlled_by = FROM
				}
				NOT = {
					calc_true_if = {
						all_province = {
							NOT = { owned_by = FROM }
							controlled_by = FROM
						}
						amount = 2
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_OWN_CONTROLLED_PROVINCES
			limit = {
				calc_true_if = {
					all_province = {
						NOT = { owned_by = FROM }
						controlled_by = FROM
					}
					amount = 2
				}
				NOT = {
					calc_true_if = {
						all_province = {
							NOT = { owned_by = FROM }
							controlled_by = FROM
						}
						amount = 4
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_OWN_CONTROLLED_PROVINCES
			limit = {
				calc_true_if = {
					all_province = {
						NOT = { owned_by = FROM }
						controlled_by = FROM
					}
					amount = 4
				}
				NOT = {
					calc_true_if = {
						all_province = {
							NOT = { owned_by = FROM }
							controlled_by = FROM
						}
						amount = 6
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_OWN_CONTROLLED_PROVINCES
			limit = {
				calc_true_if = {
					all_province = {
						NOT = { owned_by = FROM }
						controlled_by = FROM
					}
					amount = 6
				}
				NOT = {
					calc_true_if = {
						all_province = {
							NOT = { owned_by = FROM }
							controlled_by = FROM
						}
						amount = 8
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_OWN_CONTROLLED_PROVINCES
			limit = {
				calc_true_if = {
					all_province = {
						NOT = { owned_by = FROM }
						controlled_by = FROM
					}
					amount = 8
				}
				NOT = {
					calc_true_if = {
						all_province = {
							NOT = { owned_by = FROM }
							controlled_by = FROM
						}
						amount = 10
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_OWN_CONTROLLED_PROVINCES
			limit = {
				calc_true_if = {
					all_province = {
						NOT = { owned_by = FROM }
						controlled_by = FROM
					}
					amount = 10
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_CAPITAL_CONTROLLED_BY_ENEMY
			limit = {
				FROM = {
					capital_scope = {
						NOT = { controlled_by = PREV }
						NOT = { controlled_by = REB }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_ENEMY_ARMIES_ON_CORE_TERRITORY
			limit = {
				FROM = {
					any_owned_province = {
						is_core = PREV
						any_country = {
							war_with = FROM
							NOT = {
								is_in_war = {
									participants = THIS
									participants = FROM
									attacker_leader = FROM
								}
							}
							NOT = {
								is_in_war = {
									participants = THIS
									participants = FROM
									defender_leader = FROM
								}
							}
							PREV = {
								num_of_units_in_province = {
									who = PREV
									amount = 5
								}
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ARMY_SIZE
			export_to_variable = {
				which = ai_value
				value = trigger_value:army_size
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE
			export_to_variable = {
				which = ai_value
				value = trigger_value:liberty_desire
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
	}

	ai_will_do = {
		calc_true_if = {
			all_subject_country = {
				is_subject_of_type = dutch_province_subject
			}
			amount = 2
		}
		NOT = {
			calc_true_if = {
				all_subject_country = {
					is_subject_of_type = dutch_province_subject
				}
				amount = 3
			}
		}
		FROM = {
			any_owned_province = {
				NOT = { controlled_by = PREV }
				NOT = { controlled_by = REB }
			}
		}
	}
}

cancel_dutch_province_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = dutch_province_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = dutch_province_subject
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
		is_month = 1
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = dutch_province_subject
				}
				NOT = { truce_with = FROM }
				prestige = 0
				is_month = 1
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		OR = {
			AND = {
				exists = NED
				NOT = { tag = NED }
			}
			FROM = {
				liberty_desire = 100
				years_in_vassalage_under = {
					who = ROOT
					years = 50
					all_subject_country = yes
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_fief_subject
establish_fief_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_fief_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = fief_subject
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = fief_subject
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		if = {
			limit = {
				FROM = {
					NOT = { is_subject_of = ROOT }
				}
			}
			FROM = {
				has_opinion = {
					who = ROOT
					value = 150
				}
			}
			alliance_with = FROM
			FROM = {
				NOT = { total_development = 100 }
			}
		}
		else = {
			FROM = {
				NOT = { liberty_desire = 50 }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = fief_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				if = {
					limit = {
						FROM = {
							NOT = { is_subject_of = ROOT }
						}
					}
					FROM = {
						has_opinion = {
							who = ROOT
							value = 150
						}
					}
					alliance_with = FROM
					FROM = {
						NOT = { total_development = 100 }
					}
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = fief_subject
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = fief_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				if = {
					limit = {
						FROM = {
							NOT = { is_subject_of = ROOT }
						}
					}
					FROM = {
						has_opinion = {
							who = ROOT
							value = 150
						}
					}
					alliance_with = FROM
					FROM = {
						NOT = { total_development = 100 }
					}
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_establish_fief_subject_@ROOT
				set_country_flag = declined_establish_fief_subject_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_fief_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_DIFF_OF_GOV_RANKS
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { overlord_of = FROM }
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { overlord_of = FROM }
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				NOT = { overlord_of = FROM }
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				NOT = { overlord_of = FROM }
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				NOT = { overlord_of = FROM }
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MORE_THAN_100_TOTAL_DEVELOPMENT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					total_development = 100
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				NOT = { overlord_of = FROM }
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -89 }
					NOT = { check_variable = { which = eco_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -89 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				NOT = { overlord_of = FROM }
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_FROM_HAVE_SAME_PRIMARY_CULTURE
			limit = {
				NOT = { overlord_of = FROM }
				primary_culture = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_CLAIMED_CULTURAL_HEGEMONY
			limit = {
				is_expanded_mod_active = { mod = peace_treaties }
				has_country_modifier = pte_culture_group_hegemony_modifier
				NOT = { is_variable_equal = { which = pte_culture_group_hegemony_var value = 0 } }
				FROM = {
					culture_group = variable:Root:pte_culture_group_hegemony_var
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
	}

	ai_will_do = {
		is_emperor = no
		NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = fief_subject } amount = 5 } }
		num_of_free_diplomatic_relations = 1
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_establish_fief_subject_@ROOT }
				had_country_flag = { flag = declined_establish_fief_subject_@ROOT days = 1825 }
			}
			NOT = { is_subject_of = ROOT }
		}
	}
}

demand_troops_from_fief_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = fief_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = fief_subject
			}
		}
		FROM = {
			is_at_war = no
		}
		FROM = {
			num_of_infantry = 10
		}
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_DEMAND_TROOPS_OF_FIEF_WITHIN_LAST_10_YEARS
				NOT = { has_country_modifier = cooldown_demand_troops_from_fief_subject }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = fief_subject
				}
				FROM = {
					is_at_war = no
				}
				FROM = {
					num_of_infantry = 10
				}
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					NOT = { has_country_modifier = cooldown_demand_troops_from_fief_subject }
				}
			}
			capital_scope = {
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
				infantry = ROOT
			}
			FROM = {
				add_liberty_desire = 10
				add_country_modifier = {
					name = cooldown_demand_troops_from_fief_subject
					duration = 1825
					hidden = yes
				}
				country_event = { id = subjects_expanded_fief_subject_events.1 }
			}
			random_province = {
				limit = {
					infantry_in_province = FROM
				}
				kill_units = {
					who = FROM
					type = infantry
					amount = 1
				}
			}
			random_province = {
				limit = {
					infantry_in_province = FROM
				}
				kill_units = {
					who = FROM
					type = infantry
					amount = 1
				}
			}
			random_province = {
				limit = {
					infantry_in_province = FROM
				}
				kill_units = {
					who = FROM
					type = infantry
					amount = 1
				}
			}
			random_province = {
				limit = {
					infantry_in_province = FROM
				}
				kill_units = {
					who = FROM
					type = infantry
					amount = 1
				}
			}
			random_province = {
				limit = {
					infantry_in_province = FROM
				}
				kill_units = {
					who = FROM
					type = infantry
					amount = 1
				}
			}
		}
	}

	ai_will_do = {
		is_at_war = yes
		NOT = { manpower = 1 }
		NOT = { army_size = 30 }
		FROM = {
			NOT = { liberty_desire = 40 }
		}
		NOT = {
			calc_true_if = {
				all_subject_country = {
					has_country_modifier = cooldown_demand_troops_from_fief_subject
				}
				amount = 2
			}
		}
	}
}

enforce_call_to_arms_from_fief_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = fief_subject
		}
		is_at_war = yes
		OR = {
			is_in_war = {
				attacker_leader = ROOT
			}
			is_in_war = {
				defender_leader = ROOT
			}
		}
		any_country = {
			OR = {
				is_in_war = {
					attacker_leader = ROOT
					defender_leader = THIS
				}
				is_in_war = {
					attacker_leader = THIS
					defender_leader = ROOT
				}
			}
			NOT = { war_with = FROM }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = fief_subject
			}
			is_at_war = yes
			OR = {
				is_in_war = {
					attacker_leader = ROOT
				}
				is_in_war = {
					defender_leader = ROOT
				}
			}
			any_country = {
				OR = {
					is_in_war = {
						attacker_leader = ROOT
						defender_leader = THIS
					}
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
					}
				}
				NOT = { war_with = FROM }
			}
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = fief_subject
				}
				is_at_war = yes
				OR = {
					is_in_war = {
						attacker_leader = ROOT
					}
					is_in_war = {
						defender_leader = ROOT
					}
				}
				any_country = {
					OR = {
						is_in_war = {
							attacker_leader = ROOT
							defender_leader = THIS
						}
						is_in_war = {
							attacker_leader = THIS
							defender_leader = ROOT
						}
					}
					NOT = { war_with = FROM }
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				add_liberty_desire = 25
				join_all_defensive_wars_of = ROOT
				join_all_offensive_wars_of = ROOT
				country_event = { id = subjects_expanded_fief_subject_events.2 }
			}
		}
	}

	ai_will_do = {
		is_at_war = yes
		NOT = { war_score = -20 }
		FROM = {
			army_size = 5
			NOT = { liberty_desire = 30 }
		}
	}
}

cancel_fief_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = fief_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = fief_subject
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = fief_subject
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_imperial_feud_subject
establish_imperial_feud_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_imperial_feud_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = imperial_feud_subject
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = imperial_feud_subject
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		imperial_influence = 5
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = imperial_feud_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				imperial_influence = 5
			}
			add_imperial_influence = -5
			create_subject = {
				subject = FROM
				subject_type = imperial_feud_subject
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = imperial_feud_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				imperial_influence = 5
			}
			FROM = {
				clr_country_flag = declined_establish_imperial_feud_subject_@ROOT
				set_country_flag = declined_establish_imperial_feud_subject_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_imperial_feud_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				diplomatic_reputation = 0
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				NOT = { diplomatic_reputation = 0 }
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				OR = {
					any_owned_province = {
						is_core = FROM
					}
					any_subject_country = {
						is_subject_other_than_tributary_trigger = yes
						any_owned_province = {
							is_core = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_NEIGHBOR_OUTSIDE_OF_HRE
			limit = {
				FROM = {
					any_neighbor_country = {
						is_part_of_hre = no
						variable_arithmetic_trigger = {
							export_to_variable = {
								which = this_army_size
								value = trigger_value:army_size
							}
							export_to_variable = {
								which = our_army_size
								value = trigger_value:army_size
								who = ROOT
							}
							export_to_variable = {
								which = their_army_size
								value = trigger_value:army_size
								who = FROM
							}
							divide_variable = { which = this_army_size value = 2 }
							divide_variable = { which = our_army_size value = 3 }
							check_variable = { which = this_army_size which = their_army_size }
							check_variable = { which = our_army_size which = this_army_size }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_HAS_STRONG_NEIGHBOR_OUTSIDE_OF_HRE
			limit = {
				FROM = {
					any_neighbor_country = {
						is_part_of_hre = no
						variable_arithmetic_trigger = {
							export_to_variable = {
								which = this_army_size
								value = trigger_value:army_size
							}
							export_to_variable = {
								which = our_army_size
								value = trigger_value:army_size
								who = ROOT
							}
							export_to_variable = {
								which = their_army_size
								value = trigger_value:army_size
								who = FROM
							}
							divide_variable = { which = this_army_size value = 2 }
							divide_variable = { which = our_army_size value = 3 }
							check_variable = { which = this_army_size which = their_army_size }
							NOT = { check_variable = { which = our_army_size which = this_army_size } }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
					is_papal_controller = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_CURIA_CONTROLLER
			limit = {
				FROM = {
					is_papal_controller = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = AMOUNT_OF_IMPERIAL_INFLUENCE
			export_to_variable = {
				which = ai_value
				value = trigger_value:imperial_influence
			}
			#change_variable = { which = ai_value value = -1 }
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_OWNS_HRE_PROVINCES
			limit = {
				FROM = {
					NOT = { total_development = 100 }
					any_owned_province = {
						is_part_of_hre = yes
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_OWNS_HRE_PROVINCES_BUT_IS_LARGE
			limit = {
				FROM = {
					total_development = 100
					any_owned_province = {
						is_part_of_hre = yes
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_LEFT_DURING_SHADOW_KINGDOM_EVENT
			limit = {
				FROM = {
					has_country_flag = was_member_of_HRE_and_left
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		imperial_influence = 10
		OR = {
			NOT = { religion = catholic }
			FROM = {
				NOT = { tag = PAP }
			}
		}
		FROM = {
			NOT = { total_development = 200 }
			OR = {
				NOT = { has_country_flag = declined_establish_imperial_feud_subject_@ROOT }
				had_country_flag = { flag = declined_establish_imperial_feud_subject_@ROOT days = 1825 }
			}
		}
	}
}

ask_for_imperial_feud_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_for_imperial_feud_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = imperial_feud_subject
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = imperial_feud_subject
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			imperial_influence = 5
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = imperial_feud_subject
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					imperial_influence = 5
				}
			}
			FROM = {
				add_imperial_influence = -5
				create_subject = {
					subject = ROOT
					subject_type = imperial_feud_subject
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = imperial_feud_subject
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					imperial_influence = 5
				}
			}
			clr_country_flag = declined_establish_imperial_feud_subject_@FROM
			set_country_flag = declined_establish_imperial_feud_subject_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_for_imperial_feud_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_protective }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_IS_EMPIRE_RANK
			limit = {
				government_rank = 9
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_IS_KINGDOM_RANK
			limit = {
				government_rank = 8
				NOT = { government_rank = 9 }
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
				who = FROM
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_PAPAL_STATE
			limit = {
				FROM = {
					religion = catholic
				}
				tag = PAP
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_HRE_PROVINCES
			limit = {
				any_owned_province = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_TOO_HIGH_DEVELOPMENT
			limit = {
				total_development = 200
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_HRE_MEMBERS
			limit = {
				NOT = { hre_size = 25 }
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:hre_size
			}
			#change_variable = { which = ai_value_2 value = -1 }
			subtract_variable = { which = ai_value which = ai_value_2 }
			multiply_variable = { which = ai_value value = 5 }
		}
	}

	ai_will_do = {
		is_papal_controller = no
		NOT = { personality = ai_militarist }
		NOT = { government_rank = 8 }
		NOT = { num_of_subjects = 1 }
		OR = {
			NOT = { has_country_flag = declined_establish_imperial_feud_subject_@FROM }
			had_country_flag = { flag = declined_establish_imperial_feud_subject_@FROM days = 1825 }
		}
		religion = FROM
		NOT = { total_development = 150 }
		OR = {
			ai_attitude = { who = FROM attitude = attitude_allied }
			ai_attitude = { who = FROM attitude = attitude_friendly }
			ai_attitude = { who = FROM attitude = attitude_threatened }
			any_neighbor_country = {
				is_part_of_hre = no
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = this_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = ROOT
					}
					divide_variable = { which = this_army_size value = 2 }
					check_variable = { which = this_army_size which = their_army_size }
				}
			}
		}
		FROM = {
			NOT = {
				any_owned_province = {
					is_core = ROOT
				}
			}
			NOT = {
				any_subject_country = {
					is_subject_other_than_tributary_trigger = yes
					any_owned_province = {
						is_core = ROOT
					}
				}
			}
		}
		NOT = { has_country_flag = was_member_of_HRE_and_left }
	}
}

make_imperial_feud_subject_hre_member = {
	category = influence

	alert_index = 21
	alert_tooltip = make_imperial_feud_subject_hre_member_alert_tooltip

	require_acceptance = yes

	is_visible = {
		is_emperor = yes
		NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
		NOT = { hre_reform_passed = privilegia_de_non_appelando }
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = imperial_feud_subject
			is_part_of_hre = no
		}
	}

	is_allowed = {
		hidden_trigger = {
			is_emperor = yes
			NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
			NOT = { hre_reform_passed = privilegia_de_non_appelando }
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = imperial_feud_subject
				is_part_of_hre = no
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			OR = {
				religion = catholic
				religion = protestant
				religion = reformed
				religion = ROOT
			}
		}
		imperial_influence = 5
		FROM = {
			if = {
				limit = {
					has_dlc = "Emperor"
				}
				OR = {
					AND = {
						hre_reform_passed = emperor_reichsstabilitaet
						years_in_vassalage_under = {
							who = ROOT
							years = 5
							all_subject_country = yes
						}
					}
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
			}
			else = {
				OR = {
					AND = {
						hre_reform_passed = hofgericht
						years_in_vassalage_under = {
							who = ROOT
							years = 5
							all_subject_country = yes
						}
					}
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
			}
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_REJECT_TO_JOIN_THE_HRE_WITHIN_LAST_5_YEARS
				OR = {
					NOT = { has_country_flag = declined_join_hre }
					had_country_flag = { flag = declined_join_hre days = 1825 }
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				is_emperor = yes
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_feud_subject
					is_part_of_hre = no
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					OR = {
						religion = catholic
						religion = protestant
						religion = reformed
						religion = ROOT
					}
				}
				imperial_influence = 5
				FROM = {
					if = {
						limit = {
							has_dlc = "Emperor"
						}
						OR = {
							AND = {
								hre_reform_passed = emperor_reichsstabilitaet
								years_in_vassalage_under = {
									who = ROOT
									years = 5
									all_subject_country = yes
								}
							}
							years_in_vassalage_under = {
								who = ROOT
								years = 10
								all_subject_country = yes
							}
						}
					}
					else = {
						OR = {
							AND = {
								hre_reform_passed = hofgericht
								years_in_vassalage_under = {
									who = ROOT
									years = 5
									all_subject_country = yes
								}
							}
							years_in_vassalage_under = {
								who = ROOT
								years = 10
								all_subject_country = yes
							}
						}
					}
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_join_hre }
						had_country_flag = { flag = declined_join_hre days = 1825 }
					}
				}
			}
			FROM = {
				grant_independence = yes
				every_owned_province = {
					limit = {
						continent = europe
					}
					set_in_empire = yes
				}
				if = {
					limit = {
						NOT = { num_of_electors = 7 }
					}
					elector = yes
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				is_emperor = yes
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_feud_subject
					is_part_of_hre = no
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					OR = {
						religion = catholic
						religion = protestant
						religion = reformed
						religion = ROOT
					}
				}
				imperial_influence = 5
				FROM = {
					if = {
						limit = {
							has_dlc = "Emperor"
						}
						OR = {
							AND = {
								hre_reform_passed = emperor_reichsstabilitaet
								years_in_vassalage_under = {
									who = ROOT
									years = 5
									all_subject_country = yes
								}
							}
							years_in_vassalage_under = {
								who = ROOT
								years = 10
								all_subject_country = yes
							}
						}
					}
					else = {
						OR = {
							AND = {
								hre_reform_passed = hofgericht
								years_in_vassalage_under = {
									who = ROOT
									years = 5
									all_subject_country = yes
								}
							}
							years_in_vassalage_under = {
								who = ROOT
								years = 10
								all_subject_country = yes
							}
						}
					}
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_join_hre }
						had_country_flag = { flag = declined_join_hre days = 1825 }
					}
				}
			}
			add_imperial_influence = -5
			FROM = {
				clr_country_flag = declined_join_hre
				set_country_flag = declined_join_hre
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_DUCHY_RANK
			limit = {
				FROM = {
					NOT = { government_rank = 8 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
					is_papal_controller = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_CURIA_CONTROLLER
			limit = {
				FROM = {
					tag = PAP
					is_papal_controller = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = AMOUNT_OF_IMPERIAL_INFLUENCE
			export_to_variable = {
				which = ai_value
				value = trigger_value:imperial_influence
			}
			#change_variable = { which = ai_value value = -1 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_OWNS_HRE_PROVINCES
			limit = {
				FROM = {
					any_owned_province = {
						is_part_of_hre = yes
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE
			limit = {
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:liberty_desire
				who = FROM
			}
			#change_variable = { which = ai_value_2 value = -1 }
			subtract_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				calc_true_if = {
					amount = 8
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 8
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 8
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 7
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 7
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 7
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 6
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 6
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 6
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 5
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 5
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 4
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 4
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 4
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 3
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 3
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 3
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 2
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 2
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				OR = {
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				calc_true_if = {
					amount = 12
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 12
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 12
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 11
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 11
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 11
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 10
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 10
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 9
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 9
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 9
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 8
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 8
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 8
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 7
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 7
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 7
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 6
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 6
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 6
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 5
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 5
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 4
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 4
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 4
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 3
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 3
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 3
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 2
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 2
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				OR = {
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_LEFT_DURING_SHADOW_KINGDOM_EVENT
			limit = {
				FROM = {
					has_country_flag = was_member_of_HRE_and_left
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			imperial_influence = 10
			FROM = {
				ai = yes
			}
		}
	}
}

ask_for_imperial_feud_subject_hre_member = {
	category = influence

	alert_index = 21
	alert_tooltip = ask_for_imperial_feud_subject_hre_member_alert_tooltip

	require_acceptance = yes

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = imperial_feud_subject
		is_part_of_hre = no
		NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
		NOT = { hre_reform_passed = privilegia_de_non_appelando }
		FROM = {
			is_emperor = yes
		}
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = imperial_feud_subject
			is_part_of_hre = no
			NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
			NOT = { hre_reform_passed = privilegia_de_non_appelando }
			FROM = {
				is_emperor = yes
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		OR = {
			religion = catholic
			religion = protestant
			religion = reformed
			religion = FROM
		}
		years_in_vassalage_under = {
			who = FROM
			years = 3
			all_subject_country = yes
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_REJECT_TO_LET_US_JOIN_THE_HRE_WITHIN_LAST_5_YEARS
				OR = {
					NOT = { has_country_flag = declined_us_join_hre }
					had_country_flag = { flag = declined_us_join_hre days = 1825 }
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = imperial_feud_subject
				is_part_of_hre = no
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_emperor = yes
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				OR = {
					religion = catholic
					religion = protestant
					religion = reformed
					religion = FROM
				}
				years_in_vassalage_under = {
					who = FROM
					years = 3
					all_subject_country = yes
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_us_join_hre }
						had_country_flag = { flag = declined_us_join_hre days = 1825 }
					}
				}
			}
			FROM = {
				ROOT = {
					grant_independence = yes
				}
			}
			every_owned_province = {
				limit = {
					continent = europe
				}
				set_in_empire = yes
			}
			if = {
				limit = {
					NOT = { num_of_electors = 7 }
				}
				elector = yes
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = imperial_feud_subject
				is_part_of_hre = no
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_emperor = yes
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				OR = {
					religion = catholic
					religion = protestant
					religion = reformed
					religion = FROM
				}
				years_in_vassalage_under = {
					who = FROM
					years = 3
					all_subject_country = yes
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_us_join_hre }
						had_country_flag = { flag = declined_us_join_hre days = 1825 }
					}
				}
			}
			add_prestige = -5
			FROM = {
				clr_country_flag = declined_us_join_hre
				set_country_flag = declined_us_join_hre
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_OWNS_HRE_PROVINCES
			limit = {
				any_owned_province = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				calc_true_if = {
					amount = 8
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 8
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 8
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 7
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 7
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 7
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 6
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 6
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 6
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 5
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 5
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 4
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 4
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 4
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 3
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 3
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 3
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				calc_true_if = {
					amount = 2
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				NOT = { has_dlc = "Emperor" }
				NOT = {
					calc_true_if = {
						amount = 2
						hre_reform_passed = reichsreform
						hre_reform_passed = reichsregiment
						hre_reform_passed = hofgericht
						hre_reform_passed = gemeinerpfennig
						hre_reform_passed = landfriede
						hre_reform_passed = erbkaisertum
						hre_reform_passed = privilegia_de_non_appelando
						hre_reform_passed = renovatio
					}
				}
				OR = {
					hre_reform_passed = reichsreform
					hre_reform_passed = reichsregiment
					hre_reform_passed = hofgericht
					hre_reform_passed = gemeinerpfennig
					hre_reform_passed = landfriede
					hre_reform_passed = erbkaisertum
					hre_reform_passed = privilegia_de_non_appelando
					hre_reform_passed = renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				calc_true_if = {
					amount = 12
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 12
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 12
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 11
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 11
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 11
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 10
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 10
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 9
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 9
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 9
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 8
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 8
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 8
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 7
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 7
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 7
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 6
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 6
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 6
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 5
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 5
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 4
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 4
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 4
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 3
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 3
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 3
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				calc_true_if = {
					amount = 2
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_HRE_REFORMS
			limit = {
				has_dlc = "Emperor"
				NOT = {
					calc_true_if = {
						amount = 2
						hre_reform_passed = emperor_reichsreform
						hre_reform_passed = emperor_reichsregiment
						hre_reform_passed = emperor_reichsstabilitaet
						hre_reform_passed = emperor_gemeinerpfennig
						hre_reform_passed = emperor_perpetual_diet
						hre_reform_passed = emperor_landsknechtswesen
						hre_reform_passed = emperor_landfriede
						hre_reform_passed = emperor_reichstag_collegia
						hre_reform_passed = emperor_expand_gemeiner_pfennig
						hre_reform_passed = emperor_rechenschaft
						hre_reform_passed = emperor_geteilte_macht
						hre_reform_passed = emperor_reichskrieg
						hre_reform_passed = emperor_hofgericht
						hre_reform_passed = emperor_imperial_estates
						hre_reform_passed = emperor_erbkaisertum
						hre_reform_passed = emperor_privilegia_de_non_appelando
						hre_reform_passed = emperor_renovatio
					}
				}
				OR = {
					hre_reform_passed = emperor_reichsreform
					hre_reform_passed = emperor_reichsregiment
					hre_reform_passed = emperor_reichsstabilitaet
					hre_reform_passed = emperor_gemeinerpfennig
					hre_reform_passed = emperor_perpetual_diet
					hre_reform_passed = emperor_landsknechtswesen
					hre_reform_passed = emperor_landfriede
					hre_reform_passed = emperor_reichstag_collegia
					hre_reform_passed = emperor_expand_gemeiner_pfennig
					hre_reform_passed = emperor_rechenschaft
					hre_reform_passed = emperor_geteilte_macht
					hre_reform_passed = emperor_reichskrieg
					hre_reform_passed = emperor_hofgericht
					hre_reform_passed = emperor_imperial_estates
					hre_reform_passed = emperor_erbkaisertum
					hre_reform_passed = emperor_privilegia_de_non_appelando
					hre_reform_passed = emperor_renovatio
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = FROM_MIGHT_WANT_TO_VASSALIZE_ROOT
			limit = {
				FROM = {
					num_of_free_diplomatic_relations = 1
				}
				NOT = { liberty_desire = 50 }
				has_opinion = {
					who = FROM
					value = 150
				}
				NOT = { total_development = 150 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			#change_variable = { which = ai_value value = -1 }
			divide_variable = { which = ai_value value = -7 }
		}
		add_entry = {
			name = ROOT_IS_EMPIRE_RANK
			limit = {
				government_rank = 9
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_IS_KINGDOM_RANK
			limit = {
				government_rank = 8
				NOT = { government_rank = 9 }
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = {
		NOT = { tag = PAP }
		NOT = { liberty_desire = 50 }
		NOT = { government_rank = 8 }
		prestige = 10
		religion = FROM
		FROM = {
			NOT = {
				any_owned_province = {
					is_core = ROOT
				}
			}
			NOT = {
				any_subject_country = {
					is_subject_other_than_tributary_trigger = yes
					any_owned_province = {
						is_core = ROOT
					}
				}
			}
		}
		NOT = { has_country_flag = was_member_of_HRE_and_left }
		OR = {
			years_in_vassalage_under = {
				who = FROM
				years = 10
				all_subject_country = yes
			}
			AND = {
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
				years_in_vassalage_under = {
					who = FROM
					years = 5
					all_subject_country = yes
				}
			}
			AND = {
				has_opinion = {
					who = FROM
					value = 200
				}
				reverse_has_opinion = {
					who = FROM
					value = 200
				}
			}
		}
	}
}

change_imperial_feud_subject_to_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = change_imperial_feud_subject_to_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		is_emperor = yes
		NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
		NOT = { hre_reform_passed = privilegia_de_non_appelando }
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = imperial_feud_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			is_emperor = yes
			NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
			NOT = { hre_reform_passed = privilegia_de_non_appelando }
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = imperial_feud_subject
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 190
			}
		}
		FROM = {
			years_in_vassalage_under = {
				who = ROOT
				years = 10
				all_subject_country = yes
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				is_emperor = yes
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_feud_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 190
					}
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
			}
			vassalize = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				is_emperor = yes
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_feud_subject
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 190
					}
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
			}
			FROM = {
				clr_country_flag = declined_change_imperial_feud_subject_to_vassal
				set_country_flag = declined_change_imperial_feud_subject_to_vassal
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = base_values
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_DIFF_OF_GOV_RANKS
			export_to_variable = {
				which = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = { which = ai_value which = ai_value_2 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MORE_THAN_200_TOTAL_DEVELOPMENT
			limit = {
				FROM = {
					total_development = 200
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -89 }
					NOT = { check_variable = { which = eco_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -89 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_EMPEROR
			limit = {
				is_emperor = yes
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ROOT_IS_NOT_EMPEROR
			limit = {
				is_emperor = no
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		num_of_free_diplomatic_relations = 1
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_change_imperial_feud_subject_to_vassal }
				had_country_flag = { flag = declined_change_imperial_feud_subject_to_vassal days = 1825 }
			}
		}
	}
}

imperial_feud_subject_become_independent = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = imperial_feud_subject
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = imperial_feud_subject
		}
		NOT = { truce_with = FROM }
		OR = {
			liberty_desire = 50
			NOT = {
				has_opinion = {
					who = FROM
					value = 0
				}
			}
			AND = {
				has_dlc = "Art of War"
				hre_religion_locked = yes
				NOT = { religion = FROM }
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_HAS_LEFT_HRE_DURING_SHADOW_KINGDOM_EVENT
				has_country_flag = was_member_of_HRE_and_left
			}
		}
		is_at_war = no
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = imperial_feud_subject
				NOT = { truce_with = FROM }
				OR = {
					liberty_desire = 50
					NOT = {
						has_opinion = {
							who = FROM
							value = 0
						}
					}
				}
				is_at_war = no
			}
			FROM = {
				ROOT = { grant_independence = yes }
				country_event = { id = subjects_expanded_imperial_feud_subject_events.1 days = 1 }
			}
			add_truce_with = FROM
			FROM = {
				add_casus_belli = {
					target = ROOT
					type = cb_disloyal_imperial_feud_subject
				}
			}
		}
	}

	ai_will_do = {
		OR = {
			liberty_desire = 65
			NOT = {
				has_opinion = {
					who = FROM
					value = 0
				}
			}
			AND = {
				has_dlc = "Art of War"
				hre_religion_locked = yes
				NOT = { religion = FROM }
			}
			has_country_flag = was_member_of_HRE_and_left
		}
	}
}

bestow_impirial_grace_to_imperial_feud_subject = {
	category = emperor

	require_acceptance = no

	is_visible = {
		is_emperor = yes
		NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
		NOT = { hre_reform_passed = privilegia_de_non_appelando }
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = imperial_feud_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			is_emperor = yes
			NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
			NOT = { hre_reform_passed = privilegia_de_non_appelando }
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = imperial_feud_subject
			}
		}
		imperial_influence = 5
		FROM = {
			NOT = {
				has_opinion_modifier = {
					who = ROOT
					modifier = improved_imperial_relations
				}
			}
		}
		FROM = {
			NOT = {
				has_country_modifier = imperial_feud_subject_imperial_grace_modifier
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				is_emperor = yes
				NOT = { hre_reform_passed = emperor_privilegia_de_non_appelando }
				NOT = { hre_reform_passed = privilegia_de_non_appelando }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_feud_subject
				}
				imperial_influence = 5
				FROM = {
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = improved_imperial_relations
						}
					}
				}
				FROM = {
					NOT = {
						has_country_modifier = imperial_feud_subject_imperial_grace_modifier
					}
				}
			}
			add_imperial_influence = -5
			FROM = {
				add_opinion = {
					who = ROOT
					modifier = improved_imperial_relations
				}
				add_country_modifier = {
					name = imperial_feud_subject_imperial_grace_modifier
					duration = 7300
				}
			}
		}
	}

	ai_will_do = {
		imperial_influence = 10
		FROM = {
			OR = {
				liberty_desire = 60
				AND = {
					ai = no
					liberty_desire = 50
				}
				NOT = {
					has_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
	}
}

cancel_imperial_feud_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_emperor = yes
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = imperial_feud_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			is_emperor = yes
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = imperial_feud_subject
			}
		}
		is_at_war = no
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				is_emperor = yes
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_feud_subject
				}
				is_at_war = no
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
			every_country = {
				limit = {
					is_part_of_hre = yes
				}
				add_opinion = {
					who = ROOT
					modifier = emperor_abandoned_imperial_feud_subject
				}
			}
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_imperial_tributary_state
establish_imperial_tributary_state = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = imperial_tributary_state
		}
		FROM = {
			is_subject_of = ROOT
			capital_scope = { trade_range = ROOT }
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = imperial_tributary_state
		}
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				capital_scope = { trade_range = ROOT }
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 90 } }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = imperial_tributary_state
				}
				FROM = {
					is_subject_of = ROOT
					capital_scope = { trade_range = ROOT }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 90 } }
			}
			create_subject = {
				subject = FROM
				subject_type = imperial_tributary_state
			}
			FROM = {
				add_liberty_desire = -25
			}
		}
	}

	ai_will_do = {
		OR = {
			AND = {
				tag = GBR
				FROM = {
					capital_scope = {
						superregion = india_superregion
					}
				}
			}
			AND = {
				tag = ROM
				FROM = {
					government = tribal
				}
			}
		}
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
		OR = {
			FROM = { liberty_desire = 60 }
			NOT = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = imperial_tributary_state
					}
					amount = 2
				}
			}
		}
	}
}

ask_for_imperial_tributary_state = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_for_imperial_tributary_state_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = imperial_tributary_state
			}
		}
		is_subject_of = FROM
		capital_scope = { trade_range = FROM }
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = imperial_tributary_state
			}
		}
		hidden_trigger = {
			is_subject_of = FROM
			capital_scope = { trade_range = FROM }
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		NOT = { liberty_desire = 90 }
		custom_trigger_tooltip = {
			tooltip = DID_NOT_GED_DENIED_TO_BECOME_IMPERIAL_TRIBUTARY_STATE_WITHIN_LAST_5_YEARS
			OR = {
				NOT = { has_country_flag = ask_for_imperial_tributary_state_declined }
				had_country_flag = { flag = ask_for_imperial_tributary_state_declined days = 1825 }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = imperial_tributary_state
					}
				}
				is_subject_of = FROM
				capital_scope = { trade_range = FROM }
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { liberty_desire = 90 }
				OR = {
					NOT = { has_country_flag = ask_for_imperial_tributary_state_declined }
					had_country_flag = { flag = ask_for_imperial_tributary_state_declined days = 1825 }
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = imperial_tributary_state
				}
			}
			add_liberty_desire = -25
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = imperial_tributary_state
					}
				}
				is_subject_of = FROM
				capital_scope = { trade_range = FROM }
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { liberty_desire = 90 }
				OR = {
					NOT = { has_country_flag = ask_for_imperial_tributary_state_declined }
					had_country_flag = { flag = ask_for_imperial_tributary_state_declined days = 1825 }
				}
			}
			add_liberty_desire = 10
			clr_country_flag = ask_for_imperial_tributary_state_declined
			set_country_flag = ask_for_imperial_tributary_state_declined
		}
	}

	ai_acceptance = {
		add_entry = {
			name = STATEGIC_VALUE
			limit = {
				NOT = {
					OR = {
						AND = {
							tag = GBR
							FROM = {
								capital_scope = {
									superregion = india_superregion
								}
							}
						}
						AND = {
							tag = ROM
							FROM = {
								government = tribal
							}
						}
					}
					FROM = {
						NOT = {
							years_in_vassalage_under = {
								who = ROOT
								years = 10
								all_subject_country = yes
							}
						}
					}
					OR = {
						FROM = { liberty_desire = 60 }
						NOT = {
							calc_true_if = {
								all_subject_country = {
									is_subject_of_type = imperial_tributary_state
								}
								amount = 2
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE
			limit = {
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:liberty_desire
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE
			limit = {
				NOT = { liberty_desire = 50 }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:liberty_desire
			}
			subtract_variable = { which = ai_value value = 101 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		liberty_desire = 60
		has_heir = yes
		has_regency = no
	}
}

cancel_imperial_tributary_state = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = imperial_tributary_state
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = imperial_tributary_state
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = imperial_tributary_state
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			has_heir = yes
			years_in_vassalage_under = {
				who = ROOT
				years = 30
				all_subject_country = yes
			}
			OR = {
				is_neighbor_of = ROOT
				any_country = {
					is_subject_of = ROOT
					NOT = { tag = FROM }
					is_neighbor_of = FROM
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_integrated_personal_union
establish_integrated_personal_union = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = integrated_personal_union
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = integrated_personal_union
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = integrated_personal_union
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = integrated_personal_union
			}
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { has_country_flag = integrated_personal_union_was_made_to_personal_union_again }
			NOT = { liberty_desire = 40 }
			total_development = 100
			NOT = { total_development = 300 }
			years_in_vassalage_under = {
				who = ROOT
				years = 70
				all_subject_country = yes
			}
		}
	}
}

increase_chance_to_integrate_integrated_personal_union = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = integrated_personal_union
			NOT = { has_country_modifier = increase_chance_to_integrate_integrated_personal_union_modifier }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = integrated_personal_union
				NOT = { has_country_modifier = increase_chance_to_integrate_integrated_personal_union_modifier }
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			years_in_vassalage_under = {
				who = ROOT
				years = 10
				all_subject_country = yes
			}
		}
		if = {
			limit = {
				FROM = {
					total_development = 500
				}
			}
			dip_power = 200
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 200
				}
			}
			dip_power = 150
		}
		else = {
			dip_power = 100
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = integrated_personal_union
					NOT = { has_country_modifier = increase_chance_to_integrate_integrated_personal_union_modifier }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
			}
			if = {
				limit = {
					FROM = {
						total_development = 500
					}
				}
				add_dip_power = -200
			}
			else_if = {
				limit = {
					FROM = {
						total_development = 200
					}
				}
				add_dip_power = -150
			}
			else = {
				add_dip_power = -100
			}
			FROM = {
				add_country_modifier = {
					name = increase_chance_to_integrate_integrated_personal_union_modifier
					duration = 9125
				}
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

return_integrated_personal_union_to_personal_union = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = integrated_personal_union
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = integrated_personal_union
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			years_in_vassalage_under = {
				who = ROOT
				years = 10
				all_subject_country = yes
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				hidden_trigger = {
					FROM = {
						is_subject_of = ROOT
						is_subject_of_type = integrated_personal_union
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
			}
			FROM = {
				set_country_flag = integrated_personal_union_was_made_to_personal_union_again
				add_opinion = {
					who = ROOT
					modifier = returned_to_vassal
				}
				grant_independence = yes
			}
			create_union = FROM
			add_prestige = -10
			FROM = {
				add_liberty_desire = 25
			}
		}
	}

	ai_will_do = {
		FROM = {
			OR = {
				liberty_desire = 90
				AND = {
					liberty_desire = 60
					has_support_loyalists = yes
				}
			}
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

cancel_integrated_personal_union = {
	category = influence

	require_acceptance = no

	is_visible = {
		NOT = { has_dlc = "Rights of Man" }
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = integrated_personal_union
		}
	}

	is_allowed = {
		hidden_trigger = {
			NOT = { has_dlc = "Rights of Man" }
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = integrated_personal_union
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				NOT = { has_dlc = "Rights of Man" }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = integrated_personal_union
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		always = no
	}
}

#subjects_expanded_diplomatic_actions_integrated_tribe_subject
establish_integrated_tribe_subject = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = integrated_tribe_subject
		}
	}
	
	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = integrated_tribe_subject
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = integrated_tribe_subject
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = integrated_tribe_subject
			}
		}
	}
	
	ai_will_do = {
		OR = {
			AND = {
				tag = GAZ
				FROM = {
					tag = AVR
				}
			}
			AND = {
				government = tribal
				capital_scope = {
					continent = north_america
				}
				FROM = {
					government = tribal
					capital_scope = {
						continent = north_america
					}
				}
			}
		}
		FROM = {
			NOT = { liberty_desire = 30 }
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
	}
}

integrated_tribe_subject_give_additional_tribute_to_overlord = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		is_subject_of_type = integrated_tribe_subject
		is_subject_of = FROM
	}
	
	is_allowed = {
		hidden_trigger = {
			is_subject_of_type = integrated_tribe_subject
			is_subject_of = FROM
		}
		manpower_percentage = 0.2
		is_at_war = no
		FROM = { is_at_war = no }
		custom_trigger_tooltip = {
			tooltip = INTEGRATED_TRIBE_SUBJECT_DID_NOT_SEND_ADDITIONAL_TRIBUTE_WITHIN_LAST_5_YEARS
			NOT = { has_country_modifier = cooldown_integrated_tribe_subject_give_additional_tribute_to_overlord }
		}
	}
	
	on_accept = {
		if = {
			limit = {
				is_subject_of_type = integrated_tribe_subject
				is_subject_of = FROM
				manpower_percentage = 0.2
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { has_country_modifier = cooldown_integrated_tribe_subject_give_additional_tribute_to_overlord }
			}
			divide_variable = { which = integrated_tribe_subject_yearly_manpower_var value = 10 }
			add_yearly_manpower = -0.1
			FROM = {
				country_event = { id = subjects_expanded_integrated_tribe_subject_events.1 }
				add_opinion = {
					who = ROOT
					modifier = integrated_tribe_subject_paid_additional_tribute
				}
			}
			add_country_modifier = {
				name = cooldown_integrated_tribe_subject_give_additional_tribute_to_overlord
				duration = 1825
				hidden = yes
			}
		}
	}
	
	ai_will_do = {
		has_scutage = yes
		NOT = { liberty_desire = 50 }
		manpower_percentage = 0.5
		FROM = {
			OR = {
				NOT = {
					has_opinion = {
						who = ROOT
						value = 25
					}
				}
				AND = {
					is_at_war = yes
					NOT = { manpower = 5 }
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_iqta_vassal
establish_iqta_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = iqta_vassal
		}
		FROM = {
			is_subject_of = ROOT
		}
	}

	is_allowed = {
		hidden_trigger = {
			can_create_subject_type = {
				subject = FROM
				subject_type = iqta_vassal
			}
			FROM = {
				is_subject_of = ROOT
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = iqta_vassal
				}
				FROM = {
					is_subject_of = ROOT
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			create_subject = {
				subject = FROM
				subject_type = iqta_vassal
			}
			add_truce_with = FROM
			FROM = {
				country_event = { id = subjects_expanded_iqta_vassal_events.3 }
				country_event = { id = subjects_expanded_iqta_vassal_events.3 days = 1 }
			}
		}
	}

	ai_will_do = {
		OR = {
			is_defender_of_faith = yes
			has_reform = iqta
			# Missions Expanded reforms
			has_reform = caliphate_theocracy_reform
			has_reform = caliphate_reform
			has_reform = ME_caliphate_reform_sunni_andalusia
			has_reform = ME_caliphate_reform_sunni_arabian
			# Extended Timeline reforms
			has_reform = caliphate_reform #VU - ET entry used by PDX that they've not given any credit to ET for. 
		}
		FROM = {
			vassal_of = ROOT
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
				}
			}
			religion = ROOT
			OR = {
				NOT = { religious_unity = 0.75 }
				any_neighbor_country = {
					is_subject = no
					NOT = { tag = ROOT }
					NOT = { is_neighbor_of = ROOT }
					NOT = { alliance_with = ROOT }
					NOT = { religion = ROOT }
					NOT = { has_matching_religion = ROOT }
				}
			}
		}
	}
}

allow_annex_iqta_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = iqta_vassal
			NOT = { has_country_modifier = iqta_vassal_allow_annex_modifier }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = iqta_vassal
				NOT = { has_country_modifier = iqta_vassal_allow_annex_modifier }
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			years_in_vassalage_under = {
				who = ROOT
				years = 10
				all_subject_country = yes
			}
		}
		FROM = {
			religion = ROOT
		}
		FROM = {
			religious_unity = 0.25
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = iqta_vassal
					NOT = { has_country_modifier = iqta_vassal_allow_annex_modifier }
				}
				is_at_war = no
				FROM = {
					is_at_war = no
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 10
						all_subject_country = yes
					}
				}
				FROM = {
					religion = ROOT
				}
				FROM = {
					religious_unity = 0.25
				}
			}
			FROM = {
				add_country_modifier = {
					name = iqta_vassal_allow_annex_modifier
					duration = -1
					hidden = yes
				}
			}
		}
	}

	ai_will_do = {
		FROM = {
			OR = {
				NOT = { liberty_desire = 20 }
				AND = {
					has_scutage = no
					NOT = { liberty_desire = 30 }
				}
				years_in_vassalage_under = {
					who = ROOT
					years = 25
				}
			}
		}
	}
}

cancel_allow_annex_iqta_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = iqta_vassal
			has_country_modifier = iqta_vassal_allow_annex_modifier
			NOT = { has_country_modifier = iqta_vassal_is_getting_annexed_modifier }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = iqta_vassal
				has_country_modifier = iqta_vassal_allow_annex_modifier
				NOT = { has_country_modifier = iqta_vassal_is_getting_annexed_modifier }
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = iqta_vassal
					has_country_modifier = iqta_vassal_allow_annex_modifier
					NOT = { has_country_modifier = iqta_vassal_is_getting_annexed_modifier }
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			FROM = {
				remove_country_modifier = iqta_vassal_allow_annex_modifier
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

#subjects_expanded_diplomatic_actions_mandala_trade_vassal
establish_mandala_trade_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = mandala_trade_vassal
		can_create_subject_type = {
			subject = FROM
			subject_type = mandala_trade_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = mandala_trade_vassal
			can_create_subject_type = {
				subject = FROM
				subject_type = mandala_trade_vassal
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		liberty_desire = 75
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = mandala_trade_vassal
				can_create_subject_type = {
					subject = FROM
					subject_type = mandala_trade_vassal
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				liberty_desire = 75
			}
			FROM = {
				ROOT = {
					grant_independence = yes
				}
				transfer_subjects_of_type_to = { type = vassal who = ROOT }
				transfer_subjects_of_type_to = { type = client_vassal who = ROOT }
				transfer_subjects_of_type_to = { type = march who = ROOT }
				transfer_subjects_of_type_to = { type = client_march who = ROOT }
				transfer_subjects_of_type_to = { type = roman_client_kingdom who = ROOT }
				transfer_subjects_of_type_to = { type = voivodeship who = ROOT }
				transfer_subjects_of_type_to = { type = fief_subject who = ROOT }
				transfer_subjects_of_type_to = { type = crusader_state_vassal who = ROOT }
				transfer_subjects_of_type_to = { type = nahuatl_vassal who = ROOT }
				transfer_subjects_of_type_to = { type = peasant_vassal who = ROOT }
				transfer_subjects_of_type_to = { type = muslim_tributary_vassal who = ROOT }
				transfer_subjects_of_type_to = { type = integrated_tribe_subject who = ROOT }
				transfer_subjects_of_type_to = { type = naval_march who = ROOT }
				transfer_subjects_of_type_to = { type = iqta_vassal who = ROOT }
				transfer_subjects_of_type_to = { type = pagan_chiefdom who = ROOT }
				transfer_subjects_of_type_to = { type = administrative_region who = ROOT }
				transfer_subjects_of_type_to = { type = defensive_march who = ROOT }
				transfer_subjects_of_type_to = { type = agricultural_march who = ROOT }
				transfer_subjects_of_type_to = { type = religious_march who = ROOT }
				if = {
					limit = {
						has_subject_of_type = mandala_trade_vassal
					}
					every_subject_country = {
						limit = {
							is_subject_of_type = mandala_trade_vassal
						}
						add_opinion = {
							who = ROOT
							modifier = mandala_trade_vassal_forced
						}
						set_country_flag = will_get_reduced_liberty_desire
					}
					transfer_subjects_of_type_to = { type = mandala_trade_vassal who = ROOT }
				}
			}
			every_subject_country = {
				limit = {
					is_subject_of_type = mandala_trade_vassal
					has_country_flag = will_get_reduced_liberty_desire
				}
				clr_country_flag = will_get_reduced_liberty_desire
				add_liberty_desire = -50
			}
			create_subject = {
				subject = FROM
				subject_type = mandala_trade_vassal
			}
			FROM = {
				add_opinion = {
					who = ROOT
					modifier = mandala_trade_vassal_forced
				}
				add_truce_with = ROOT
				add_liberty_desire = -100
				country_event = { id = subjects_expanded_mandala_trade_vassal_events.1 }
			}
		}
	}

	ai_will_do = {
		num_of_free_diplomatic_relations = 1
		NOT = { war_exhaustion = 5 }
		OR = {
			AND = {
				num_of_merchants = 1
				NOT = { num_of_cities = 25 }
			}
			AND = {
				num_of_merchants = 2
				num_of_cities = 25
			}
		}
		OR = {
			army_size = FROM
			num_of_cities = FROM
			num_of_subjects = 2
			liberty_desire = 85
		}
	}
}

cancel_mandala_trade_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = mandala_trade_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = mandala_trade_vassal
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = mandala_trade_vassal
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 50
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_medieval_vassal
establish_medieval_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_medieval_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = medieval_vassal
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = medieval_vassal
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		is_neighbor_of = FROM
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = medieval_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				is_neighbor_of = FROM
				NOT = { truce_with = FROM }
			}
			create_subject = {
				subject = FROM
				subject_type = medieval_vassal
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = medieval_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				is_neighbor_of = FROM
				NOT = { truce_with = FROM }
			}
			FROM = {
				clr_country_flag = declined_establish_medieval_vassal_@ROOT
				set_country_flag = declined_establish_medieval_vassal_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_medieval_vassal_opinion
			}
			add_casus_belli = {
				target = FROM
				type = cb_force_medieval_vassal_triggered_only
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_EMPIRE_RANK
			limit = {
				government_rank = 9
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
				is_emperor = no
				emperor = {
					OR = {
						army_strength = { who = ROOT value = 0.8 }
						military_strength = { who = ROOT value = 1 }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
				OR = {
					is_emperor = yes
					emperor = {
						NOT = { army_strength = { who = ROOT value = 0.8 } }
						NOT = { military_strength = { who = ROOT value = 1 } }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			limit = {
				NOT = { is_neighbor_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_THEOCRACY
			limit = {
				FROM = {
					government = theocracy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_REPUBLIC
			limit = {
				FROM = {
					government = republic
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_ACCEPT_VASSALIZATION_REASONS
			export_to_variable = {
				which = ai_value
				value = modifier:accept_vassalization_reasons
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 15
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development value = 0.66 }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -35 }

					check_variable = { which = eco_power value = -99 }
					NOT = { check_variable = { which = eco_power value = 50 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development value = 0.66 }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -35 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 15
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development value = 0.66 }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -35 }

					NOT = { check_variable = { which = eco_power value = -99 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 15
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development value = 0.66 }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -35 }

					check_variable = { which = eco_power value = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = military_power
						value = 15
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					multiply_variable = { which = their_army_size value = 0.66 }
					divide_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power value = -35 }

					check_variable = { which = military_power value = -49 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			multiply_variable = { which = their_army_size value = 0.66 }
			divide_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value value = -35 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = military_power
						value = 15
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					multiply_variable = { which = their_army_size value = 0.66 }
					divide_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power value = -35 }

					NOT = { check_variable = { which = military_power value = -49 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = military_power
						value = 15
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					multiply_variable = { which = their_army_size value = 0.66 }
					divide_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power value = -35 }

					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
	}

	ai_will_do = {
		num_of_free_diplomatic_relations = 1
		OR = {
			current_age = age_of_discovery
			NOT = { is_year = 1450 }
		}
		NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = medieval_vassal } amount = 5 } }
		NOT = { core_claim = FROM }
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_establish_medieval_vassal_@ROOT }
				had_country_flag = { flag = declined_establish_medieval_vassal_@ROOT days = 1825 }
			}
			num_of_cities = 5
			total_development = 100
			NOT = {
				num_of_owned_provinces_with = {
					value = 3
					is_permanent_claim = ROOT
				}
			}
		}
	}
}

ask_to_become_medieval_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_medieval_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = medieval_vassal
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = medieval_vassal
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		is_neighbor_of = FROM
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = medieval_vassal
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				is_neighbor_of = FROM
				NOT = { truce_with = FROM }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = medieval_vassal
				}
				add_truce_with = ROOT
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = medieval_vassal
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				is_neighbor_of = FROM
				NOT = { truce_with = FROM }
			}
			clr_country_flag = declined_establish_medieval_vassal_@FROM
			set_country_flag = declined_establish_medieval_vassal_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_medieval_vassal
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_protective }
						ai_attitude = { who = ROOT attitude = attitude_domineering }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
				add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_KINGDOM_RANK
			limit = {
				government_rank = 8
				NOT = { government_rank = 9 }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_EMPIRE_RANK
			limit = {
				government_rank = 9
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_A_THEOCRACY
			limit = {
				government = theocracy
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_A_REPUBLIC
			limit = {
				government = republic
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			limit = {
				NOT = { is_neighbor_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = STRATEGIC_VALUE
			limit = {
				NOT = {
					AND = {
						FROM = {
							num_of_free_diplomatic_relations = 1
							OR = {
								current_age = age_of_discovery
								NOT = { is_year = 1450 }
							}
							NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = medieval_vassal } amount = 5 } }
							NOT = { core_claim = ROOT }
						}
						OR = {
							NOT = { has_country_flag = declined_establish_medieval_vassal_@FROM }
							had_country_flag = { flag = declined_establish_medieval_vassal_@FROM days = 1825 }
						}
						num_of_cities = 5
						total_development = 100
						NOT = {
							num_of_owned_provinces_with = {
								value = 3
								is_permanent_claim = FROM
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 15
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
						who = FROM
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
					}
					multiply_variable = { which = their_total_development value = 0.66 }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -35 }

					check_variable = { which = eco_power value = -99 }
					NOT = { check_variable = { which = eco_power value = 50 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
				who = FROM
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
			}
			multiply_variable = { which = their_total_development value = 0.66 }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -35 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 15
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
						who = FROM
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
					}
					multiply_variable = { which = their_total_development value = 0.66 }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -35 }

					NOT = { check_variable = { which = eco_power value = -99 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 15
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development value = 0.66 }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -35 }

					check_variable = { which = eco_power value = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = military_power
						value = 15
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					multiply_variable = { which = their_army_size value = 0.66 }
					divide_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power value = -35 }

					check_variable = { which = military_power value = -49 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
				who = FROM
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
			}
			multiply_variable = { which = their_army_size value = 0.66 }
			divide_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value value = -35 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = military_power
						value = 15
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					multiply_variable = { which = their_army_size value = 0.66 }
					divide_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power value = -35 }

					NOT = { check_variable = { which = military_power value = -49 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = military_power
						value = 15
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					multiply_variable = { which = their_army_size value = 0.66 }
					divide_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power value = -30 }

					check_variable = { which = military_power value = 35 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
	}

	ai_will_do = {
		NOT = { current_age = age_of_absolutism }
		NOT = { is_year = 1700 }
		OR = {
			NOT = { has_country_flag = declined_establish_medieval_vassal_@FROM }
			had_country_flag = { flag = declined_establish_medieval_vassal_@FROM days = 1825 }
		}
		NOT = { has_reform = free_city }
		is_emperor = no
		is_elector = no
		NOT = { num_of_subjects = 1 }
		NOT = { num_of_cities = 20 }
		NOT = { num_of_cities = FROM }
		OR = {
			is_part_of_hre = no
			FROM = { is_part_of_hre = yes }
		}
		NOT = { government_rank = 8 }
		government = monarchy
		NOT = { core_claim = FROM }
		religion = FROM
	}
}

enforce_call_to_arms_from_medieval_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = medieval_vassal
		}
		is_at_war = yes
		OR = {
			is_in_war = {
				attacker_leader = ROOT
			}
			is_in_war = {
				defender_leader = ROOT
			}
		}
		any_country = {
			OR = {
				is_in_war = {
					attacker_leader = ROOT
					defender_leader = THIS
				}
				is_in_war = {
					attacker_leader = THIS
					defender_leader = ROOT
				}
			}
			NOT = { war_with = FROM }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = medieval_vassal
			}
			is_at_war = yes
			OR = {
				is_in_war = {
					attacker_leader = ROOT
				}
				is_in_war = {
					defender_leader = ROOT
				}
			}
			any_country = {
				OR = {
					is_in_war = {
						attacker_leader = ROOT
						defender_leader = THIS
					}
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
					}
				}
				NOT = { war_with = FROM }
			}
		}
		FROM = { NOT = { liberty_desire = 50 } }
		if = {
			limit = {
				is_in_war = {
					attacker_leader = ROOT
				}
			}
			dip_power = 25
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
				}
				is_at_war = yes
				OR = {
					is_in_war = {
						attacker_leader = ROOT
					}
					is_in_war = {
						defender_leader = ROOT
					}
				}
				any_country = {
					OR = {
						is_in_war = {
							attacker_leader = ROOT
							defender_leader = THIS
						}
						is_in_war = {
							attacker_leader = THIS
							defender_leader = ROOT
						}
					}
					NOT = { war_with = FROM }
				}
				FROM = { NOT = { liberty_desire = 50 } }
				if = {
					limit = {
						is_in_war = {
							attacker_leader = ROOT
						}
					}
					dip_power = 25
				}
			}
			if = {
				limit = {
					is_in_war = {
						attacker_leader = ROOT
					}
				}
				add_dip_power = -25
			}
			FROM = {
				add_liberty_desire = 25
				join_all_defensive_wars_of = ROOT
				join_all_offensive_wars_of = ROOT
				country_event = { id = subjects_expanded_medieval_vassal_events.1 }
			}
		}
	}

	ai_will_do = {
		is_at_war = yes
		OR = {
			NOT = { war_score = -20 }
			dip_power = 200
			NOT = {
				is_in_war = {
					attacker_leader = ROOT
				}
			}
		}
		FROM = {
			army_size = 10
		}
		OR = {
			FROM = {
				NOT = { liberty_desire = 30 }
			}
			AND = {
				is_in_war = {
					defender_leader = ROOT
				}
				NOT = { war_score = -30 }
				FROM = {
					NOT = { liberty_desire = 70 }
				}
			}
		}
	}
}

disallow_medieval_vassal_to_declare_war = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = medieval_vassal
			NOT = { has_country_flag = medieval_vassal_disallowed_war }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = medieval_vassal
				NOT = { has_country_flag = medieval_vassal_disallowed_war }
			}
		}
		is_at_war = no
		dip_power = 25
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
					NOT = { has_country_flag = medieval_vassal_disallowed_war }
				}
				is_at_war = no
				dip_power = 25
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			add_dip_power = -25
			FROM = {
				set_country_flag = medieval_vassal_disallowed_war
				country_event = { id = subjects_expanded_medieval_vassal_events.2 }
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

allow_medieval_vassal_to_declare_war = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = medieval_vassal
			has_country_flag = medieval_vassal_disallowed_war
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = medieval_vassal
				has_country_flag = medieval_vassal_disallowed_war
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
					has_country_flag = medieval_vassal_disallowed_war
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				clr_country_flag = medieval_vassal_disallowed_war
				country_event = { id = subjects_expanded_medieval_vassal_events.3 }
			}
		}
	}

	ai_will_do = {
		always = yes
	}
}

force_medieval_vassal_to_annul_alliances = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = medieval_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = medieval_vassal
			}
			NOT = { has_country_flag = force_medieval_vassal_to_annul_alliances }
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
				}
				NOT = { has_country_flag = force_medieval_vassal_to_annul_alliances }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			set_country_flag = force_medieval_vassal_to_annul_alliances
			FROM = {
				save_event_target_as = medieval_vassal_target
			}
			country_event = { id = subjects_expanded_medieval_vassal_events.6 }
		}
	}

	ai_will_do = {
		always = no
	}
}

make_medieval_vassal_to_vassal = {
	category = influence

	alert_index = 2
	alert_tooltip = make_medieval_vassal_to_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = medieval_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = medieval_vassal
			}
		}
		has_regency = no
		dip_power = 100
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = MEDIEVAL_VASSAL_AT_LEAST_SUBJECT_FOR_25_YEARS_TT
				years_in_vassalage_under = {
					who = ROOT
					years = 25
					all_subject_country = yes
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
				}
				has_regency = no
				dip_power = 100
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 25
						all_subject_country = yes
					}
				}
			}
			add_dip_power = -100
			vassalize = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
				}
				has_regency = no
				dip_power = 100
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 25
						all_subject_country = yes
					}
				}
			}
			add_prestige = -10
			FROM = {
				clr_country_flag = make_medieval_vassal_to_vassal_@ROOT
				set_country_flag = make_medieval_vassal_to_vassal_@ROOT
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_CURIA_CONTROLLER
			limit = {
				FROM = {
					is_papal_controller = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -4.5 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
	}

	ai_will_do = {
		prestige = 1
		FROM = {
			has_opinion = {
				who = ROOT
				value = 50
			}
		}
	}
}

cancel_medieval_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = medieval_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = medieval_vassal
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = medieval_vassal
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			OR = {
				AND = {
					liberty_desire = 70
					OR = {
						current_age = age_of_absolutism
						is_year = 1700
						years_in_vassalage_under = {
							who = ROOT
							years = 30
							all_subject_country = yes
						}
					}
				}
				num_of_owned_provinces_with = {
					value = 5
					is_permanent_claim = ROOT
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_muslim_tributary_vassal
establish_muslim_tributary_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_muslim_tributary_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = muslim_tributary_vassal
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = muslim_tributary_vassal
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		NOT = { truce_with = FROM }
		FROM = {
			NOT = { num_of_cities = ROOT }
		}
		army_size = 20
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = muslim_tributary_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
				FROM = {
					NOT = { num_of_cities = ROOT }
				}
				army_size = 20
			}
			create_subject = {
				subject = FROM
				subject_type = muslim_tributary_vassal
			}
			add_piety = 0.05
			FROM = {
				country_event = { id = subjects_expanded_muslim_tributary_vassal_events.1 }
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = muslim_tributary_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
				FROM = {
					NOT = { num_of_cities = ROOT }
				}
				army_size = 20
			}
			FROM = {
				clr_country_flag = declined_establish_muslim_tributary_vassal_@ROOT
				set_country_flag = declined_establish_muslim_tributary_vassal_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_muslim_tributary_vassal_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
						ai_attitude = { who = ROOT attitude = atittude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_ALLIED_TO_PAPAL_STATE
			limit = {
				FROM = {
					religion = catholic
					OR = {
						alliance_with = PAP
						guaranteed_by = PAP
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_DEFENDER_OF_FAITH
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					is_defender_of_faith = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_ALLIED_TO_DEFENDER_OF_FAITH
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					any_ally = {
						religion = PREV
						is_defender_of_faith = yes
						NOT = { army_size = ROOT }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_ALLIED_TO_DEFENDER_OF_FAITH
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					any_ally = {
						religion = PREV
						is_defender_of_faith = yes
						army_size = ROOT
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_REPUBLIC
			limit = {
				FROM = {
					government = republic
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_THEOCRACY
			limit = {
				FROM = {
					government = theocracy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_ALLIED_TO_EMPEROR
			limit = {
				FROM = {
					OR = {
						any_ally = {
							is_emperor = yes
						}
						guaranteed_by = emperor
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_ALLIES
			limit = {
				FROM = {
					any_ally = {
						NOT = { tag = ROOT }
						army_size = 20
					}
					NOT = {
						calc_true_if = {
							all_ally = {
								NOT = { tag = ROOT }
								army_size = 20
							}
							amount = 2
						}
					}
					NOT = {
						any_ally = {
							NOT = { tag = ROOT }
							OR = {
								army_size = 100
								military_strength = { who = ROOT value = 2 }
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_ALLIES
			limit = {
				FROM = {
					calc_true_if = {
						all_ally = {
							NOT = { tag = ROOT }
							army_size = 20
						}
						amount = 2
					}
					NOT = {
						any_ally = {
							NOT = { tag = ROOT }
							OR = {
								army_size = 100
								military_strength = { who = ROOT value = 2 }
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_ALLIES
			limit = {
				FROM = {
					any_ally = {
						NOT = { tag = ROOT }
						OR = {
							army_size = 100
							military_strength = { who = ROOT value = 2 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_GUARANTEES
			limit = {
				any_country = {
					NOT = { tag = ROOT }
					FROM = {
						guaranteed_by = PREV
					}
					army_size = 20
				}
				NOT = {
					calc_true_if = {
						all_country = {
							NOT = { tag = ROOT }
							FROM = {
								guaranteed_by = PREV
							}
							army_size = 20
						}
						amount = 2
					}
				}
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						FROM = {
							guaranteed_by = PREV
						}
						OR = {
							army_size = 100
							military_strength = { who = ROOT value = 2 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_GUARANTEES
			limit = {
				calc_true_if = {
					all_country = {
						NOT = { tag = ROOT }
						FROM = {
							guaranteed_by = PREV
						}
						army_size = 20
					}
					amount = 2
				}
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						FROM = {
							guaranteed_by = PREV
						}
						OR = {
							army_size = 100
							military_strength = { who = ROOT value = 2 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_GUARANTEES
			limit = {
				any_country = {
					NOT = { tag = ROOT }
					FROM = {
						guaranteed_by = PREV
					}
					OR = {
						army_size = 100
						military_strength = { who = ROOT value = 2 }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SOME_MUSLIM_PROVINCES
			limit = {
				FROM = {
					OR = {
						num_of_religion = { religion = sunni value = 0.1 }
						num_of_religion = { religion = shiite value = 0.1 }
						num_of_religion = { religion = ibadi value = 0.1 }
					}
					NOT = { dominant_religion = sunni }
					NOT = { dominant_religion = shiite }
					NOT = { dominant_religion = ibadi }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MUSLIM_DOMINANT_FAITH
			limit = {
				FROM = {
					OR = {
						dominant_religion = sunni
						dominant_religion = shiite
						dominant_religion = ibadi
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_RIVALS
			limit = {
				FROM = {
					historical_rival_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_ROOT_RIVALS
			limit = {
				any_country = {
					OR = {
						alliance_with = FROM
						FROM = {
							guaranteed_by = PREV
						}
					}
					OR = {
						is_enemy = ROOT
						is_rival = ROOT
					}
				}
				NOT = {
					calc_true_if = {
						all_country = {
							OR = {
								alliance_with = FROM
								FROM = {
									guaranteed_by = PREV
								}
							}
							OR = {
								is_enemy = ROOT
								is_rival = ROOT
							}
						}
						amount = 2
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_ROOT_RIVALS
			limit = {
				calc_true_if = {
					all_country = {
						OR = {
							alliance_with = FROM
							FROM = {
								guaranteed_by = PREV
							}
						}
						OR = {
							is_enemy = ROOT
							is_rival = ROOT
						}
					}
					amount = 2
				}
				NOT = {
					calc_true_if = {
						all_country = {
							OR = {
								alliance_with = FROM
								FROM = {
									guaranteed_by = PREV
								}
							}
							OR = {
								is_enemy = ROOT
								is_rival = ROOT
							}
						}
						amount = 3
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_ROOT_RIVALS
			limit = {
				calc_true_if = {
					all_country = {
						OR = {
							alliance_with = FROM
							FROM = {
								guaranteed_by = PREV
							}
						}
						OR = {
							is_enemy = ROOT
							is_rival = ROOT
						}
					}
					amount = 3
				}
				NOT = {
					calc_true_if = {
						all_country = {
							OR = {
								alliance_with = FROM
								FROM = {
									guaranteed_by = PREV
								}
							}
							OR = {
								is_enemy = ROOT
								is_rival = ROOT
							}
						}
						amount = 4
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_ROOT_RIVALS
			limit = {
				calc_true_if = {
					all_country = {
						OR = {
							alliance_with = FROM
							FROM = {
								guaranteed_by = PREV
							}
						}
						OR = {
							is_enemy = ROOT
							is_rival = ROOT
						}
					}
					amount = 4
				}
				NOT = {
					calc_true_if = {
						all_country = {
							OR = {
								alliance_with = FROM
								FROM = {
									guaranteed_by = PREV
								}
							}
							OR = {
								is_enemy = ROOT
								is_rival = ROOT
							}
						}
						amount = 5
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = -100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_ROOT_RIVALS
			limit = {
				calc_true_if = {
					all_country = {
						OR = {
							alliance_with = FROM
							FROM = {
								guaranteed_by = PREV
							}
						}
						OR = {
							is_enemy = ROOT
							is_rival = ROOT
						}
					}
					amount = 5
				}
			}
			export_to_variable = {
				which = ai_value
				value = -1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		religion = sunni
		num_of_free_diplomatic_relations = 1
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_establish_muslim_tributary_vassal_@ROOT }
				had_country_flag = { flag = declined_establish_muslim_tributary_vassal_@ROOT days = 1825 }
			}
			NOT = { is_subject_of = ROOT }
			capital_scope = {
				continent = europe
			}
			NOT = { total_development = 150 }
			NOT = {
				num_of_owned_provinces_with = {
					value = 5
					OR = {
						is_claim = ROOT
						is_core = ROOT
					}
				}
			}
		}
	}
}

ask_for_muslim_tributary_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_muslim_tributary_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = muslim_tributary_vassal
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = muslim_tributary_vassal
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		NOT = { truce_with = FROM }
		NOT = { num_of_cities = FROM }
		FROM = {
			army_size = 20
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = muslim_tributary_vassal
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
				NOT = { num_of_cities = FROM }
				FROM = {
					army_size = 20
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = muslim_tributary_vassal
				}
				add_piety = 0.05
			}
			country_event = { id = subjects_expanded_muslim_tributary_vassal_events.1 }
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = muslim_tributary_vassal
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				NOT = { truce_with = FROM }
				NOT = { num_of_cities = FROM }
				FROM = {
					army_size = 20
				}
			}
			clr_country_flag = declined_establish_muslim_tributary_vassal_@FROM
			set_country_flag = declined_establish_muslim_tributary_vassal_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_for_muslim_tributary_vassal_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = ROOT_IS_VASSAL_OF_FROM
			limit = {
				is_subject_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_ATTITUDE_TOWARDS_FROM
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
						ai_attitude = { who = ROOT attitude = atittude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
				who = FROM
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = STRATEGIC_VALUE
			limit = {
				NOT = {
					AND = {
						FROM = {
							religion = sunni
							num_of_free_diplomatic_relations = 1
						}
						OR = {
							NOT = { has_country_flag = declined_establish_muslim_tributary_vassal_@FROM }
							had_country_flag = { flag = declined_establish_muslim_tributary_vassal_@FROM days = 1825 }
						}
						NOT = { is_subject_of = FROM }
						capital_scope = {
							continent = europe
						}
						NOT = { total_development = 150 }
						NOT = {
							num_of_owned_provinces_with = {
								value = 5
								OR = {
									is_claim = FROM
									is_core = FROM
								}
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_RIVALS
			limit = {
				FROM = {
					historical_rival_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { tag = PAP }
		is_papal_controller = no
		government = monarchy
		is_emperor = no
		is_defender_of_faith = no
		religion_group = christian
		is_part_of_hre = no
		NOT = { num_of_cities = 10 }
		capital_scope = {
			continent = europe
		}
		NOT = { historical_rival_with = FROM }
		NOT = { alliance_with = FROM }
		OR = {
			NOT = { religion = catholic }
			NOT = { alliance_with = PAP }
		}
		OR = {
			AND = {
				NOT = { religion = catholic }
				NOT = { religion = protestant }
				NOT = { religion = reformed }
			}
			NOT = { alliance_with = emperor }
		}
		NOT = {
			calc_true_if = {
				all_ally = {
					NOT = { tag = FROM }
					army_size = 20
				}
				amount = 2
			}
		}
		NOT = {
			any_ally = {
				NOT = { tag = FROM }
				OR = {
					army_size = 100
					military_strength = { who = FROM value = 2 }
					is_defender_of_faith = yes
				}
			}
		}
		NOT = {
			calc_true_if = {
				all_country = {
					NOT = { tag = FROM }
					ROOT = {
						guaranteed_by = PREV
					}
					army_size = 20
				}
				amount = 2
			}
		}
		NOT = {
			any_country = {
				NOT = { tag = FROM }
				ROOT = {
					guaranteed_by = PREV
				}
				OR = {
					army_size = 100
					military_strength = { who = FROM value = 2 }
				}
			}
		}
		NOT = {
			calc_true_if = {
				all_country = {
					OR = {
						alliance_with = FROM
						FROM = {
							guaranteed_by = PREV
						}
					}
					OR = {
						is_enemy = ROOT
						is_rival = ROOT
					}
				}
				amount = 2
			}
		}
		OR = {
			NOT = { has_country_flag = declined_establish_muslim_tributary_vassal_@FROM }
			had_country_flag = { flag = declined_establish_muslim_tributary_vassal_@FROM days = 1825 }
		}
		NOT = { num_of_religion = { religion = sunni value = 0.1 } }
		NOT = { num_of_religion = { religion = shiite value = 0.1 } }
		NOT = { num_of_religion = { religion = ibadi value = 0.1 } }
		NOT = { dominant_religion = sunni }
		NOT = { dominant_religion = shiite }
		NOT = { dominant_religion = ibadi }
		NOT = { is_subject_of = FROM }
		NOT = { army_size = FROM }
		NOT = { core_claim = FROM }
		NOT = { num_of_subjects = 1 }
		NOT = { ai_attitude = { who = FROM attitude = attitude_hostile } }
		NOT = { ai_attitude = { who = FROM attitude = attitude_outraged } }
		NOT = { ai_attitude = { who = FROM attitude = atittude_rivalry } }
		NOT = { coalition_target = FROM }
		FROM = {
			num_of_free_diplomatic_relations = 1
			OR = {
				tag = TUR
				AND = {
					OR = {
						ai = no
						NOT = { exists = TUR }
					}
					is_defender_of_faith = yes
					government_rank = 9
				}
			}
			OR = {
				religion = sunni
				AND = {
					ai = no
					religion_group = muslim
				}
			}
			NOT = { truce_with = ROOT }
			has_casus_belli_against = ROOT
			NOT = { coalition_target = ROOT }
		}
	}
}

cancel_muslim_tributary_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = muslim_tributary_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = muslim_tributary_vassal
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = muslim_tributary_vassal
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_nahuatl_vassal
establish_nahuatl_vassal = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = nahuatl_vassal
		}
	}
	
	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = nahuatl_vassal
		}
		NOT = { doom = 90 }
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = nahuatl_vassal
				}
				NOT = { doom = 90 }
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			add_doom = 10
			create_subject = {
				subject = FROM
				subject_type = nahuatl_vassal
			}
		}
	}
	
	ai_will_do = {
		NOT = { doom = 50 }
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_native_reserve
establish_native_reserve = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_native_reserve_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = native_reserve
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = native_reserve
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = native_reserve
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			create_subject = {
				subject = FROM
				subject_type = native_reserve
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = native_reserve
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			FROM = {
				clr_country_flag = declined_establish_native_reserve_@ROOT
				set_country_flag = declined_establish_native_reserve_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_native_reserve_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				NOT = { overlord_of = FROM }
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
	}

	ai_will_do = {
		OR = {
			tag = CAN
			tag = USA
			tag = FRA
			is_former_colonial_nation = yes
		}
		NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = native_reserve } amount = 5 } }
		FROM = {
			NOT = { total_development = 200 }
			capital_scope = {
				continent = north_america
			}
			OR = {
				NOT = { has_country_flag = declined_establish_native_reserve_@ROOT }
				had_country_flag = { flag = declined_establish_native_reserve_@ROOT days = 1825 }
			}
			NOT = {
				any_owned_province = {
					OR = {
						is_core = ROOT
						is_permanent_claim = ROOT
					}
				}
			}
		}
	}
}

ask_to_become_native_reserve = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_native_reserve_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = native_reserve
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = native_reserve
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = native_reserve
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = native_reserve
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = native_reserve
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			clr_country_flag = declined_establish_native_reserve_@FROM
			set_country_flag = declined_establish_native_reserve_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_for_native_reserve_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_protective }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
				who = FROM
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_TOO_HIGH_DEVELOPMENT
			limit = {
				total_development = 200
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = STATEGIC_VALUE
			limit = {
				ai = yes
				FROM = { ai = yes }
				OR = {
					FROM = {
						OR = {
							AND = {
								NOT = { tag = CAN }
								NOT = { tag = USA }
								NOT = { tag = FRA }
								is_former_colonial_nation = no
							}
							calc_true_if = { all_subject_country = { is_subject_of_type = native_reserve } amount = 5 }
						}
					}
					capital_scope = {
						NOT = { continent = north_america }
					}
					any_owned_province = {
						OR = {
							is_core = FROM
							is_permanent_claim = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = STATEGIC_VALUE
			limit = {
				ai = no
				FROM = { ai = yes }
				any_owned_province = {
					OR = {
						is_core = FROM
						is_permanent_claim = FROM
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { personality = ai_militarist }
		NOT = { government_rank = 8 }
		OR = {
			NOT = { has_country_flag = declined_establish_native_reserve_@FROM }
			had_country_flag = { flag = declined_establish_native_reserve_@FROM days = 1825 }
		}
		NOT = { total_development = 150 }
		OR = {
			ai_attitude = { who = FROM attitude = attitude_allied }
			ai_attitude = { who = FROM attitude = attitude_friendly }
			ai_attitude = { who = FROM attitude = attitude_threatened }
		}
		has_opinion = {
			who = FROM
			value = 100
		}
		FROM = {
			NOT = {
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 1
					is_core = ROOT
				}
			}
		}
	}
}

cancel_native_reserve = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = native_reserve
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = native_reserve
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = native_reserve
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_naval_march
establish_naval_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = naval_march
		}
	}

	is_allowed = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = naval_march
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				is_subject = no
				can_create_subject_type = {
					subject = FROM
					subject_type = naval_march
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			create_subject = {
				subject = FROM
				subject_type = naval_march
			}
		}
	}

	ai_will_do = {
		navy_size = 50
		FROM = {
			NOT = { liberty_desire = 50 }
			NOT = { is_different_march_subject = yes }
			NOT = { development_of_overlord_fraction = 0.25 }
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
			any_neighbor_country = {
				OR = {
					is_rival = ROOT
					is_enemy = ROOT
				}
			}
			NOT = {
				num_of_owned_provinces_with = {
					value = 10
					is_permanent_claim = ROOT
				}
			}
		}
	}
}

ask_to_become_naval_march = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_naval_march_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = naval_march
			}
		}
	}

	is_allowed = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = naval_march
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = naval_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = naval_march
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = naval_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				clr_country_flag = declined_become_naval_march_@ROOT
				set_country_flag = declined_become_naval_march_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_naval_march
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_NAVY_SIZE_TOO_SMALL
			limit = {
				FROM = {
					NOT = { navy_size = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_VASSAL_FOR_AT_LEAST_10_YEARS
			limit = {
				years_in_vassalage_under = {
					who = FROM
					years = 10
					all_subject_country = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_RIVALS
			limit = {
				NOT = {
					any_neighbor_country = {
						OR = {
							is_rival = FROM
							is_enemy = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_MORE_THAN_25_PERCENT_OF_OVERLORD_DEVELOPMENT
			limit = {
				development_of_overlord_fraction = 0.25
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { liberty_desire = 50 }
		NOT = { is_different_march_subject = yes }
		num_of_ports = 5
		navy_size = 20
		any_neighbor_country = {
			OR = {
				is_rival = FROM
				is_enemy = FROM
			}
		}
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_become_naval_march_@ROOT }
				had_country_flag = { flag = declined_become_naval_march_@ROOT days = 1825 }
			}
		}
		NOT = {
			num_of_owned_provinces_with = {
				value = 10
				is_permanent_claim = FROM
			}
		}
	}
}

naval_march_enable_send_officers = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = naval_march
			NOT = { has_country_flag = naval_march_send_officers }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = naval_march
				NOT = { has_country_flag = naval_march_send_officers }
			}
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = naval_march
					NOT = { has_country_flag = naval_march_send_officers }
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				set_country_flag = naval_march_send_officers
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

naval_march_disable_send_officers = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = naval_march
			has_country_flag = naval_march_send_officers
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = naval_march
				has_country_flag = naval_march_send_officers
			}
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = naval_march
					has_country_flag = naval_march_send_officers
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				clr_country_flag = naval_march_send_officers
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

#subjects_expanded_diplomatic_actions_pagan_chiefdom
establish_pagan_chiefdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = pagan_chiefdom
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = pagan_chiefdom
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = pagan_chiefdom
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = pagan_chiefdom
			}
		}
	}

	ai_will_do = {
		army_size = 15
		FROM = {
			NOT = { army_strength = { who = ROOT value = 0.75 } }
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
			any_neighbor_country = {
				OR = {
					is_rival = ROOT
					is_enemy = ROOT
				}
			}
		}
	}
}

ask_to_become_pagan_chiefdom = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_pagan_chiefdom_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = pagan_chiefdom
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = pagan_chiefdom
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		NOT = { liberty_desire = 50 }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = pagan_chiefdom
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { liberty_desire = 50 }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = pagan_chiefdom
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = pagan_chiefdom
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { liberty_desire = 50 }
			}
			FROM = {
				clr_country_flag = declined_become_pagan_chiefdom_@ROOT
				set_country_flag = declined_become_pagan_chiefdom_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_pagan_chiefdom
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_VASSAL_FOR_AT_LEAST_10_YEARS
			limit = {
				years_in_vassalage_under = {
					who = FROM
					years = 10
					all_subject_country = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_RIVALS
			limit = {
				NOT = {
					any_neighbor_country = {
						OR = {
							is_rival = FROM
							is_enemy = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_ARMY_SIZE
			limit = {
				army_strength = { who = FROM value = 0.75 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		religion = FROM
		any_neighbor_country = {
			OR = {
				is_rival = FROM
				is_enemy = FROM
			}
		}
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_become_pagan_chiefdom_@ROOT }
				had_country_flag = { flag = declined_become_pagan_chiefdom_@ROOT days = 1825 }
			}
		}
	}
}

increase_looting_speed_with_pagan_chiefdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_dlc = "The Cossacks"
		is_nomad = yes
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = pagan_chiefdom
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_dlc = "The Cossacks"
			is_nomad = yes
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = pagan_chiefdom
			}
		}
		horde_unity = 5
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_INCREASE_LOOTING_SPEED_WITH_THIS_PAGAN_CHIEFDOM_WITHIN_LAST_10_YEARS
				NOT = { has_country_modifier = increase_looting_speed_with_pagan_chiefdom_cooldown }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				has_dlc = "The Cossacks"
				is_nomad = yes
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = pagan_chiefdom
				}
				horde_unity = 5
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					NOT = { has_country_modifier = increase_looting_speed_with_pagan_chiefdom_cooldown }
				}
			}
			add_horde_unity = -5
			FROM = {
				add_country_modifier = {
					name = increase_looting_speed_with_pagan_chiefdom_cooldown
					duration = 3650
					hidden = yes
				}
			}
		}
	}

	ai_will_do = {
		horde_unity = 60
		is_at_war = yes
		OR = {
			NOT = {
				is_in_war = {
					attacker_leader = ROOT
				}
			}
			NOT = {
				any_country = {
					is_in_war = {
						attacker_leader = ROOT
						defenders = THIS
					}
					num_of_owned_provinces_with = {
						value = 2
						is_claim = ROOT
					}
				}
			}
		}
		NOT = {
			calc_true_if = {
				all_subject_country = {
					is_subject_of_type = pagan_chiefdom
					has_country_modifier = increase_looting_speed_with_pagan_chiefdom_cooldown
				}
				amount = 2
			}
		}
	}
}

increase_horde_unity_with_pagan_chiefdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		has_dlc = "The Cossacks"
		is_nomad = yes
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = pagan_chiefdom
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_dlc = "The Cossacks"
			is_nomad = yes
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = pagan_chiefdom
			}
		}
		NOT = { horde_unity = 100 }
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_INCREASE_HORDE_UNITY_WITH_THIS_PAGAN_CHIEFDOM_WITHIN_LAST_5_YEARS
				NOT = { has_country_modifier = increase_horde_unity_with_pagan_chiefdom_cooldown }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				has_dlc = "The Cossacks"
				is_nomad = yes
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = pagan_chiefdom
				}
				NOT = { horde_unity = 100 }
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					NOT = { has_country_modifier = increase_horde_unity_with_pagan_chiefdom_cooldown }
				}
			}
			FROM = {
				if = {
					limit = {
						total_development = 200
					}
					add_liberty_desire = 20
					ROOT = { add_horde_unity = 20 }
				}
				else_if = {
					limit = {
						total_development = 190
					}
					add_liberty_desire = 19
					ROOT = { add_horde_unity = 19 }
				}
				else_if = {
					limit = {
						total_development = 180
					}
					add_liberty_desire = 18
					ROOT = { add_horde_unity = 18 }
				}
				else_if = {
					limit = {
						total_development = 170
					}
					add_liberty_desire = 17
					ROOT = { add_horde_unity = 17 }
				}
				else_if = {
					limit = {
						total_development = 160
					}
					add_liberty_desire = 16
					ROOT = { add_horde_unity = 16 }
				}
				else_if = {
					limit = {
						total_development = 150
					}
					add_liberty_desire = 15
					ROOT = { add_horde_unity = 15 }
				}
				else_if = {
					limit = {
						total_development = 140
					}
					add_liberty_desire = 14
					ROOT = { add_horde_unity = 14 }
				}
				else_if = {
					limit = {
						total_development = 130
					}
					add_liberty_desire = 13
					ROOT = { add_horde_unity = 13 }
				}
				else_if = {
					limit = {
						total_development = 120
					}
					add_liberty_desire = 12
					ROOT = { add_horde_unity = 12 }
				}
				else_if = {
					limit = {
						total_development = 110
					}
					add_liberty_desire = 11
					ROOT = { add_horde_unity = 11 }
				}
				else_if = {
					limit = {
						total_development = 100
					}
					add_liberty_desire = 10
					ROOT = { add_horde_unity = 10 }
				}
				else_if = {
					limit = {
						total_development = 90
					}
					add_liberty_desire = 9
					ROOT = { add_horde_unity = 9 }
				}
				else_if = {
					limit = {
						total_development = 80
					}
					add_liberty_desire = 8
					ROOT = { add_horde_unity = 8 }
				}
				else_if = {
					limit = {
						total_development = 70
					}
					add_liberty_desire = 7
					ROOT = { add_horde_unity = 7 }
				}
				else_if = {
					limit = {
						total_development = 60
					}
					add_liberty_desire = 6
					ROOT = { add_horde_unity = 6 }
				}
				else_if = {
					limit = {
						total_development = 50
					}
					add_liberty_desire = 5
					ROOT = { add_horde_unity = 5 }
				}
				else_if = {
					limit = {
						total_development = 40
					}
					add_liberty_desire = 4
					ROOT = { add_horde_unity = 4 }
				}
				else_if = {
					limit = {
						total_development = 30
					}
					add_liberty_desire = 3
					ROOT = { add_horde_unity = 3 }
				}
				else_if = {
					limit = {
						total_development = 20
					}
					add_liberty_desire = 2
					ROOT = { add_horde_unity = 2 }
				}
				else = {
					add_liberty_desire = 1
					ROOT = { add_horde_unity = 1 }
				}
				add_country_modifier = {
					name = increase_horde_unity_with_pagan_chiefdom_cooldown
					duration = 1825
					hidden = yes
				}
			}
		}
	}

	ai_will_do = {
		NOT = { horde_unity = 50 }
		is_at_war = no
		FROM = {
			OR = {
				AND = {
					total_development = 200
					NOT = { liberty_desire = 25 }
				}
				AND = {
					total_development = 150
					NOT = { total_development = 200 }
					NOT = { liberty_desire = 30 }
				}
				AND = {
					total_development = 100
					NOT = { total_development = 150 }
					NOT = { liberty_desire = 35 }
				}
				AND = {
					total_development = 50
					NOT = { total_development = 100 }
					NOT = { liberty_desire = 40 }
				}
				AND = {
					NOT = { total_development = 50 }
					NOT = { liberty_desire = 45 }
				}
			}
		}
		NOT = {
			calc_true_if = {
				all_subject_country = {
					is_subject_of_type = pagan_chiefdom
					has_country_modifier = increase_horde_unity_with_pagan_chiefdom_cooldown
				}
				amount = 2
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_palatinate_vassal
establish_palatinate_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		overlord_of = FROM
		can_create_subject_type = {
			subject = FROM
			subject_type = palatinate_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			overlord_of = FROM
		}
		can_create_subject_type = {
			subject = FROM
			subject_type = palatinate_vassal
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				overlord_of = FROM
				can_create_subject_type = {
					subject = FROM
					subject_type = palatinate_vassal
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			create_subject = {
				subject = FROM
				subject_type = palatinate_vassal
			}
		}
	}

	ai_will_do = {
		always = yes
	}
}

#subjects_expanded_diplomatic_actions_papal_sanctuary_subject
establish_papal_sanctuary_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_papal_sanctuary_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = papal_sanctuary_subject
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = papal_sanctuary_subject
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 100
			}
		}
		FROM = {
			religious_unity = 0.9
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = papal_sanctuary_subject
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
				FROM = {
					religious_unity = 0.9
				}
			}
			create_subject = {
				subject = FROM
				subject_type = papal_sanctuary_subject
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = papal_sanctuary_subject
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
				FROM = {
					religious_unity = 0.9
				}
			}
			FROM = {
				clr_country_flag = declined_establish_papal_sanctuary_subject_@ROOT
				set_country_flag = declined_establish_papal_sanctuary_subject_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_papal_sanctuary_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_CURIA_CONTROLLER
			limit = {
				is_papal_controller = yes
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MONARCHY
			limit = {
				FROM = {
					government = monarchy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_REPUBLIC
			limit = {
				FROM = {
					government = republic
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_THEOCRACY
			limit = {
				FROM = {
					government = theocracy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_AMOUNT_OF_INVESTED_PAPAL_INFLUENCE
			limit = {
				FROM = {
					invested_papal_influence = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:invested_papal_influence
				who = FROM
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = zealot_personality
					ruler_has_personality = pious_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				ruler_has_personality = sinner_personality
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					OR = {
						ruler_has_personality = zealot_personality
						ruler_has_personality = pious_personality
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					ruler_has_personality = sinner_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_SUBJECT
			limit = {
				is_subject = yes
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_DEFENDER_OF_FAITH
			limit = {
				is_defender_of_faith = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_HAS_ESTABLISHED_THE_KINGDOM_OF_GOD
			limit = {
				has_country_flag = is_kingdom_of_god_flag
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_HAS_STRONG_NEIGHBOR_WITH_DIFFERENT_RELIGION
			limit = {
				FROM = {
					any_neighbor_country = {
						NOT = { religion = PREV }
						variable_arithmetic_trigger = {
							export_to_variable = {
								which = this_army_size
								value = trigger_value:army_size
							}
							export_to_variable = {
								which = our_army_size
								value = trigger_value:army_size
								who = ROOT
							}
							export_to_variable = {
								which = their_army_size
								value = trigger_value:army_size
								who = FROM
							}
							divide_variable = { which = this_army_size value = 2 }
							divide_variable = { which = our_army_size value = 3 }
							check_variable = { which = this_army_size which = their_army_size }
							check_variable = { which = our_army_size which = this_army_size }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_HAS_STRONG_NEIGHBOR_WITH_DIFFERENT_RELIGION
			limit = {
				FROM = {
					any_neighbor_country = {
						NOT = { religion = PREV }
						variable_arithmetic_trigger = {
							export_to_variable = {
								which = this_army_size
								value = trigger_value:army_size
							}
							export_to_variable = {
								which = our_army_size
								value = trigger_value:army_size
								who = ROOT
							}
							export_to_variable = {
								which = their_army_size
								value = trigger_value:army_size
								who = FROM
							}
							divide_variable = { which = this_army_size value = 2 }
							divide_variable = { which = our_army_size value = 3 }
							check_variable = { which = this_army_size which = their_army_size }
							NOT = { check_variable = { which = our_army_size which = this_army_size } }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
	}

	ai_will_do = {
		OR = {
			is_defender_of_faith = yes
			is_papal_controller = yes
			personality = ai_diplomat
			has_country_flag = is_kingdom_of_god_flag
			AND = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = zealot_personality
					ruler_has_personality = pious_personality
				}
			}
		}
		OR = {
			num_of_free_diplomatic_relations = 1
			FROM = {
				religion = ROOT
				OR = {
					government = theocracy
					is_papal_controller = yes
					is_defender_of_faith = yes
					crusade_target = {
						is_neighbor_of = PREV
					}
				}
			}
		}
		FROM = {
			is_emperor = no
			NOT = { total_development = 125 }
			OR = {
				NOT = { has_country_flag = declined_establish_papal_sanctuary_subject_@ROOT }
				had_country_flag = { flag = declined_establish_papal_sanctuary_subject_@ROOT days = 1825 }
			}
		}
	}
}

ask_for_papal_sanctuary_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_for_papal_sanctuary_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = papal_sanctuary_subject
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = papal_sanctuary_subject
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 100
			}
		}
		religious_unity = 0.9
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = papal_sanctuary_subject
					}
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
				religious_unity = 0.9
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = papal_sanctuary_subject
				}
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = papal_sanctuary_subject
					}
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
				religious_unity = 0.9
			}
			clr_country_flag = declined_establish_papal_sanctuary_subject_@FROM
			set_country_flag = declined_establish_papal_sanctuary_subject_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_for_papal_sanctuary_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_rivalry }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_IS_EMPIRE_RANK
			limit = {
				government_rank = 9
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_IS_KINGDOM_RANK
			limit = {
				government_rank = 8
				NOT = { government_rank = 9 }
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
				who = FROM
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_CURIA_CONTROLLER
			limit = {
				is_papal_controller = yes
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = ROOT_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MONARCHY
			limit = {
				government = monarchy
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_A_REPUBLIC
			limit = {
				government = republic
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_A_THEOCRACY
			limit = {
				government = theocracy
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_AMOUNT_OF_INVESTED_PAPAL_INFLUENCE
			limit = {
				FROM = {
					invested_papal_influence = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:invested_papal_influence
				who = FROM
			}
			divide_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = ROOT_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = zealot_personality
					ruler_has_personality = pious_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				ruler_has_personality = sinner_personality
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					OR = {
						ruler_has_personality = zealot_personality
						ruler_has_personality = pious_personality
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					ruler_has_personality = sinner_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_DEFENDER_OF_FAITH
			limit = {
				is_defender_of_faith = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = STATEGIC_VALUE
			limit = {
				NOT = {
					FROM = {
						OR = {
							is_defender_of_faith = yes
							is_papal_controller = yes
							personality = ai_diplomat
							has_country_flag = is_kingdom_of_god_flag
							AND = {
								has_dlc = "Rights of Man"
								OR = {
									ruler_has_personality = zealot_personality
									ruler_has_personality = pious_personality
								}
							}
						}
					}
					OR = {
						FROM = {
							num_of_free_diplomatic_relations = 1
						}
						AND = {
							religion = FROM
							OR = {
								government = theocracy
								is_papal_controller = yes
								is_defender_of_faith = yes
								crusade_target = {
									is_neighbor_of = ROOT
								}
							}
						}
					}
					is_emperor = no
					NOT = { total_development = 125 }
					OR = {
						NOT = { has_country_flag = declined_establish_papal_sanctuary_subject_@FROM }
						had_country_flag = { flag = declined_establish_papal_sanctuary_subject_@FROM days = 1825 }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { total_development = 125 }
		NOT = { government_rank = 9 }
		is_emperor = no
		is_elector = no
		NOT = { has_reform = free_city }
		invested_papal_influence = 5
		OR = {
			government = theocracy
			alliance_with = FROM
		}
		OR = {
			ai_attitude = { who = FROM attitude = attitude_threatened }
			ai_attitude = { who = FROM attitude = attitude_allied }
			ai_attitude = { who = FROM attitude = attitude_friendly }
		}
		NOT = { is_rival = FROM }
		NOT = { is_enemy = FROM }
		NOT = { army_size = FROM }
		FROM = {
			is_subject = no
			OR = {
				is_papal_controller = yes
				is_defender_of_faith = yes
				has_country_flag = is_kingdom_of_god_flag
				alliance_with = ROOT
			}
		}
		OR = {
			NOT = { has_country_flag = declined_establish_papal_sanctuary_subject_@FROM }
			had_country_flag = { flag = declined_establish_papal_sanctuary_subject_@FROM days = 1825 }
		}
	}
}

request_curia_money_from_papal_sanctuary_subject = {
	category = papacy

	alert_index = 6
	alert_tooltip = request_curia_money_from_papal_sanctuary_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_dlc = "Emperor"
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = papal_sanctuary_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			has_dlc = "Emperor"
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = papal_sanctuary_subject
			}
		}
		is_papal_controller = yes
		FROM = {
			has_regency = no
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_REQUEST_CURIA_MONEY_FROM_THIS_RULER
				NOT = { has_ruler_flag = requested_curia_money_from_papal_sanctuary_subject }
			}
		}
		FROM = {
			if = {
				limit = {
					total_development = 300
				}
				treasury = 250
			}
			else_if = {
				limit = {
					total_development = 250
				}
				treasury = 200
			}
			else_if = {
				limit = {
					total_development = 200
				}
				treasury = 150
			}
			else_if = {
				limit = {
					total_development = 100
				}
				treasury = 100
			}
			else = {
				treasury = 50
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				has_dlc = "Emperor"
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = papal_sanctuary_subject
				}
				is_papal_controller = yes
				FROM = {
					has_regency = no
				}
				FROM = {
					NOT = { has_ruler_flag = requested_curia_money_from_papal_sanctuary_subject }
				}
				FROM = {
					if = {
						limit = {
							total_development = 300
						}
						treasury = 250
					}
					else_if = {
						limit = {
							total_development = 250
						}
						treasury = 200
					}
					else_if = {
						limit = {
							total_development = 200
						}
						treasury = 150
					}
					else_if = {
						limit = {
							total_development = 100
						}
						treasury = 100
					}
					else = {
						treasury = 50
					}
				}
			}
			FROM = {
				add_papal_influence = 5
				set_ruler_flag = requested_curia_money_from_papal_sanctuary_subject
				if = {
					limit = {
						total_development = 300
					}
					add_treasury = -250
					add_curia_treasury = 250
				}
				else_if = {
					limit = {
						total_development = 250
					}
					add_treasury = -200
					add_curia_treasury = 200
				}
				else_if = {
					limit = {
						total_development = 200
					}
					add_treasury = -150
					add_curia_treasury = 150
				}
				else_if = {
					limit = {
						total_development = 100
					}
					add_treasury = -100
					add_curia_treasury = 100
				}
				else = {
					add_treasury = -50
					add_curia_treasury = 50
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				has_dlc = "Emperor"
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = papal_sanctuary_subject
				}
				is_papal_controller = yes
				FROM = {
					has_regency = no
				}
				FROM = {
					NOT = { has_ruler_flag = requested_curia_money_from_papal_sanctuary_subject }
				}
				FROM = {
					if = {
						limit = {
							total_development = 300
						}
						treasury = 250
					}
					else_if = {
						limit = {
							total_development = 250
						}
						treasury = 200
					}
					else_if = {
						limit = {
							total_development = 200
						}
						treasury = 150
					}
					else_if = {
						limit = {
							total_development = 100
						}
						treasury = 100
					}
					else = {
						treasury = 50
					}
				}
			}
			FROM = {
				set_ruler_flag = requested_curia_money_from_papal_sanctuary_subject
			}
			add_opinion = {
				who = ROOT
				modifier = declined_request_curia_money_from_papal_sanctuary_subject_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -5 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					OR = {
						ruler_has_personality = zealot_personality
						ruler_has_personality = pious_personality
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					ruler_has_personality = sinner_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_DEFENDER_OF_FAITH
			limit = {
				is_defender_of_faith = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_HAS_ESTABLISHED_THE_KINGDOM_OF_GOD
			limit = {
				has_country_flag = is_kingdom_of_god_flag
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_HAS_NOT_MUCH_MONEY
			limit = {
				FROM = {
					OR = {
						AND = {
							total_development = 300
							NOT = { treasury = 1000 }
						}
						AND = {
							NOT = { total_development = 300 }
							total_development = 250
							NOT = { treasury = 800 }
						}
						AND = {
							NOT = { total_development = 250 }
							total_development = 200
							NOT = { treasury = 600 }
						}
						AND = {
							NOT = { total_development = 200 }
							total_development = 150
							NOT = { treasury = 500 }
						}
						AND = {
							NOT = { total_development = 150 }
							total_development = 100
							NOT = { treasury = 400 }
						}
						AND = {
							NOT = { total_development = 100 }
							NOT = { treasury = 300 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_HAS_ALREAD_CONTRIBUTED_MUCH_TO_CURIA_TREASURY
			limit = {
				FROM = {
					curia_treasury_contribution = 0.5
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			personality = ai_capitalist
			AND = {
				ruler_has_personality = pious_personality
				FROM = {
					ruler_has_personality = pious_personality
				}
			}
			FROM = {
				is_defender_of_faith = yes
			}
		}
	}
}

make_papal_sanctuary_subject_to_theocracy = {
	category = influence

	alert_index = 6
	alert_tooltip = make_papal_sanctuary_subject_to_theocracy_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_be_overlord = papal_sanctuary_subject
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = papal_sanctuary_subject
			NOT = { government = theocracy }
		}
	}

	is_allowed = {
		hidden_trigger = {
			can_be_overlord = papal_sanctuary_subject
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = papal_sanctuary_subject
				NOT = { government = theocracy }
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		religion = catholic
		FROM = {
			religion = catholic
		}
		FROM = {
			papal_influence = 10
		}
		FROM = {
			has_regency = no
		}
	}

	on_accept = {
		if = {
			limit = {
				hidden_trigger = {
					can_be_overlord = papal_sanctuary_subject
					FROM = {
						is_subject_of = ROOT
						is_subject_of_type = papal_sanctuary_subject
						NOT = { government = theocracy }
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				religion = catholic
				FROM = {
					religion = catholic
				}
				FROM = {
					papal_influence = 10
				}
				FROM = {
					has_regency = no
				}
			}
			FROM = {
				change_government = theocracy
				add_government_reform = leading_clergy_reform
				add_country_modifier = {
					name = papal_sanctuary_subject_converted_to_theocracy_modifier
					duration = 1825
				}
				add_papal_influence = -10
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				hidden_trigger = {
					can_be_overlord = papal_sanctuary_subject
					FROM = {
						is_subject_of = ROOT
						is_subject_of_type = papal_sanctuary_subject
						NOT = { government = theocracy }
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				religion = catholic
				FROM = {
					religion = catholic
				}
				FROM = {
					papal_influence = 10
				}
				FROM = {
					has_regency = no
				}
			}
			add_prestige = -10
			FROM = {
				add_country_modifier = {
					name = cooldown_papal_sanctuary_subject_converted_to_theocracy_modifier
					duration = 1825
					hidden = yes
				}
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE
			limit = {
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:liberty_desire
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_CURIA_CONTROLLER
			limit = {
				is_papal_controller = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				has_reform = free_city
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MONARCHY
			limit = {
				FROM = {
					government = monarchy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_REPUBLIC
			limit = {
				FROM = {
					government = republic
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_AMOUNT_OF_INVESTED_PAPAL_INFLUENCE
			limit = {
				FROM = {
					invested_papal_influence = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:invested_papal_influence
				who = FROM
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = zealot_personality
					ruler_has_personality = pious_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				ruler_has_personality = sinner_personality
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					OR = {
						ruler_has_personality = zealot_personality
						ruler_has_personality = pious_personality
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					ruler_has_personality = sinner_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_SUBJECT
			limit = {
				is_subject = yes
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_DEFENDER_OF_FAITH
			limit = {
				is_defender_of_faith = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_HAS_ESTABLISHED_THE_KINGDOM_OF_GOD
			limit = {
				has_country_flag = is_kingdom_of_god_flag
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_HAS_A_HEIR
			limit = {
				FROM = {
					government = monarchy
					has_heir = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_NO_HEIR
			limit = {
				FROM = {
					government = monarchy
					has_heir = no
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = FROM_WAS_RECENTLY_ASKED_TO_BECOME_THEOCRACY
			limit = {
				FROM = {
					OR = {
						has_country_modifier = papal_sanctuary_subject_converted_to_theocracy_modifier
						has_country_modifier = cooldown_papal_sanctuary_subject_converted_to_theocracy_modifier
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			is_defender_of_faith = yes
			is_papal_controller = yes
			has_country_flag = is_kingdom_of_god_flag
		}
		FROM = {
			NOT = { liberty_desire = 25 }
			NOT = { has_country_modifier = papal_sanctuary_subject_converted_to_theocracy_modifier }
			NOT = { has_country_modifier = cooldown_papal_sanctuary_subject_converted_to_theocracy_modifier }
		}
	}
}

make_papal_sanctuary_subject_to_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = make_papal_sanctuary_subject_to_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_be_overlord = papal_sanctuary_subject
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = papal_sanctuary_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			can_be_overlord = papal_sanctuary_subject
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = papal_sanctuary_subject
			}
		}
		is_at_war = no
		religion = catholic
		FROM = {
			religion = catholic
		}
		FROM = {
			is_at_war = no
		}
		FROM = {
			papal_influence = 10
		}
		FROM = {
			years_in_vassalage_under = {
				who = ROOT
				years = 5
				all_subject_country = yes
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				hidden_trigger = {
					can_be_overlord = papal_sanctuary_subject
					FROM = {
						is_subject_of = ROOT
						is_subject_of_type = papal_sanctuary_subject
					}
				}
				is_at_war = no
				religion = catholic
				FROM = {
					religion = catholic
				}
				FROM = {
					is_at_war = no
				}
				FROM = {
					papal_influence = 10
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 5
						all_subject_country = yes
					}
				}
			}
			FROM = {
				grant_independence = yes
				add_papal_influence = -10
			}
			vassalize = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				hidden_trigger = {
					can_be_overlord = papal_sanctuary_subject
					FROM = {
						is_subject_of = ROOT
						is_subject_of_type = papal_sanctuary_subject
					}
				}
				is_at_war = no
				religion = catholic
				FROM = {
					religion = catholic
				}
				FROM = {
					is_at_war = no
				}
				FROM = {
					papal_influence = 10
				}
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 5
						all_subject_country = yes
					}
				}
			}
			add_prestige = -10
			FROM = {
				clr_country_flag = decline_make_papal_sanctuary_subject_to_vassal_@ROOT
				set_country_flag = decline_make_papal_sanctuary_subject_to_vassal_@ROOT
			}
			add_casus_belli = {
				target = FROM
				type = cb_vassalize_papal_sanctuary_subject
				months = 12
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_LIBERTY_DESIRE
			limit = {
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:liberty_desire
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }

					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_CURIA_CONTROLLER
			limit = {
				is_papal_controller = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				has_reform = free_city
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MONARCHY
			limit = {
				FROM = {
					government = monarchy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_REPUBLIC
			limit = {
				FROM = {
					government = republic
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_AMOUNT_OF_INVESTED_PAPAL_INFLUENCE
			limit = {
				FROM = {
					invested_papal_influence = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:invested_papal_influence
				who = FROM
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				OR = {
					ruler_has_personality = zealot_personality
					ruler_has_personality = pious_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = ROOT_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				ruler_has_personality = sinner_personality
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_RULER_IS_RELIGIOUS
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					OR = {
						ruler_has_personality = zealot_personality
						ruler_has_personality = pious_personality
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_RULER_IS_SINNER
			limit = {
				has_dlc = "Rights of Man"
				FROM = {
					ruler_has_personality = sinner_personality
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_SUBJECT
			limit = {
				is_subject = yes
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_DEFENDER_OF_FAITH
			limit = {
				is_defender_of_faith = yes
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_HAS_ESTABLISHED_THE_KINGDOM_OF_GOD
			limit = {
				has_country_flag = is_kingdom_of_god_flag
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_WAS_RECENTLY_ASKED_TO_BECOME_A_VASSAL
			limit = {
				FROM = {
					has_country_flag = decline_make_papal_sanctuary_subject_to_vassal_@ROOT
					NOT = { had_country_flag = { flag = decline_make_papal_sanctuary_subject_to_vassal_@ROOT days = 1825 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_WAS_RECENTLY_ASKED_TO_BECOME_THEOCRACY
			limit = {
				FROM = {
					OR = {
						has_country_modifier = papal_sanctuary_subject_converted_to_theocracy_modifier
						has_country_modifier = cooldown_papal_sanctuary_subject_converted_to_theocracy_modifier
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			is_papal_controller = yes
			has_country_flag = is_kingdom_of_god_flag
		}
		OR = {
			num_of_free_diplomatic_relations = 1
			FROM = {
				OR = {
					NOT = { religion = ROOT }
					NOT = {
						government = theocracy
						is_papal_controller = yes
						is_defender_of_faith = yes
						crusade_target = {
							is_neighbor_of = PREV
						}
					}
				}
			}
		}
		is_neighbor_of = FROM
		FROM = {
			NOT = { total_development = 100 }
			OR = {
				NOT = { has_country_flag = decline_make_papal_sanctuary_subject_to_vassal_@ROOT }
				had_country_flag = { flag = decline_make_papal_sanctuary_subject_to_vassal_@ROOT days = 1825 }
			}
		}
	}
}

papal_sanctuary_subject_become_independent = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = papal_sanctuary_subject
	}

	is_allowed = {
		hidden_trigger = {
			is_subject_of = FROM
			is_subject_of_type = papal_sanctuary_subject
		}
		OR = {
			NOT = { government = theocracy }
			NOT = { religion = FROM }
			FROM = {
				NOT = { can_be_overlord = papal_sanctuary_subject }
			}
		}
		NOT = { truce_with = FROM }
		OR = {
			is_excommunicated = yes
			NOT = { religion = FROM }
			FROM = {
				is_excommunicated = yes
			}
			AND = {
				liberty_desire = 50
				has_country_modifier = the_statue_in_restraint_of_appeals
			}
			liberty_desire = 65
			FROM = {
				NOT = { can_be_overlord = papal_sanctuary_subject }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = papal_sanctuary_subject
				OR = {
					NOT = { government = theocracy }
					NOT = { religion = FROM }
					FROM = {
						NOT = { can_be_overlord = papal_sanctuary_subject }
					}
				}
				NOT = { truce_with = FROM }
				OR = {
					is_excommunicated = yes
					NOT = { religion = FROM }
					FROM = {
						is_excommunicated = yes
					}
					AND = {
						liberty_desire = 50
						has_country_modifier = the_statue_in_restraint_of_appeals
					}
					liberty_desire = 65
					FROM = {
						NOT = { can_be_overlord = papal_sanctuary_subject }
					}
				}
			}
			FROM = {
				ROOT = { grant_independence = yes }
				country_event = { id = subjects_expanded_papal_sanctuary_subject_events.1 }
				add_casus_belli = {
					target = ROOT
					type = cb_insult
					months = 72
				}
			}
			add_truce_with = FROM
			if = {
				limit = {
					is_excommunicated = no
				}
				excommunicate = ROOT
			}
		}
	}

	ai_will_do = {
		OR = {
			NOT = { has_dlc = "Rights of Man" }
			AND = {
				NOT = { ruler_has_personality = zealot_personality }
				NOT = { ruler_has_personality = pious_personality }
			}
		}
		OR = {
			is_excommunicated = yes
			NOT = { religion = FROM }
			FROM = {
				is_excommunicated = yes
			}
			AND = {
				liberty_desire = 55
				has_country_modifier = the_statue_in_restraint_of_appeals
			}
			liberty_desire = 75
			FROM = {
				NOT = { can_be_overlord = papal_sanctuary_subject }
			}
		}
	}
}

cancel_papal_sanctuary_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = papal_sanctuary_subject
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = papal_sanctuary_subject
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = papal_sanctuary_subject
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_peasant_vassal
establish_peasant_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_peasant_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = peasant_vassal
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = peasant_vassal
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 165
			}
		}
		alliance_with = FROM
		FROM = {
			NOT = { total_development = 100 }
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = peasant_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 165
					}
				}
				alliance_with = FROM
				FROM = {
					NOT = { total_development = 100 }
				}
			}
			create_subject = {
				subject = FROM
				subject_type = peasant_vassal
			}
			FROM = {
				country_event = { id = subjects_expanded_peasant_vassal_events.1 }
				country_event = { id = subjects_expanded_peasant_vassal_events.1 days = 1 }
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = peasant_vassal
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 165
					}
				}
				alliance_with = FROM
				FROM = {
					NOT = { total_development = 100 }
				}
			}
			FROM = {
				clr_country_flag = declined_establish_peasant_vassal_@ROOT
				set_country_flag = declined_establish_peasant_vassal_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_peasant_vassal_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_DIFF_OF_GOV_RANKS
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = { 
				which = ai_value 
				which = ai_value_2 
			}
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MORE_THAN_100_TOTAL_DEVELOPMENT
			limit = {
				FROM = {
					total_development = 100
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -89 }
					NOT = { check_variable = { which = eco_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -89 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_PEASANTS_REPUBLIC
			limit = {
				FROM = {
					has_reform = peasants_republic
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_NOT_PEASANTS_REPUBLIC
			limit = {
				FROM = {
					NOT = { has_reform = peasants_republic }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		num_of_free_diplomatic_relations = 1
		has_global_modifier_value = {
			which = global_tax_income
			value = 2
		}
		monthly_income = 5
		NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = peasant_vassal } amount = 5 } }
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_establish_peasant_vassal_@ROOT }
				had_country_flag = { flag = declined_establish_peasant_vassal_@ROOT days = 1825 }
			}
		}
	}
}

cancel_peasant_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = peasant_vassal
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = peasant_vassal
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = peasant_vassal
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 75
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_persian_satrapy
establish_persian_satrapy = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = persian_satrapy
		}
		FROM = {
			is_subject_of = ROOT
		}
	}
	
	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = persian_satrapy
		}
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		if = {
			limit = {
				tag = TIM
				has_ruler_modifier = shahrukhs_empire
			}
			NOT = { has_ruler_modifier = shahrukhs_empire }
		}
	}
	
	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = persian_satrapy
				}
				FROM = {
					is_subject_of = ROOT
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				if = {
					limit = {
						tag = TIM
						has_ruler_modifier = shahrukhs_empire
					}
					NOT = { has_ruler_modifier = shahrukhs_empire }
				}
			}
			create_subject = {
				subject = FROM
				subject_type = persian_satrapy
			}
			FROM = {
				country_event = { id = subjects_expanded_persian_satrapy_events.1 }
				country_event = { id = subjects_expanded_persian_satrapy_events.1 days = 1 }
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
			capital_scope = {
				region_for_scope_province = {
					is_capital_of = ROOT
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_pirate_vassal
establish_pirate_brotherhood_vassal = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = pirate_brotherhood_vassal
		}
		FROM = {
			is_subject_of = ROOT
		}
	}
	
	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = pirate_brotherhood_vassal
		}
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
			}
		}
		FROM = {
			capital_scope = { trade_range = ROOT }
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = pirate_brotherhood_vassal
				}
				FROM = {
					is_subject_of = ROOT
				}
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = pirate_brotherhood_vassal
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
	}
}

cancel_pirate_brotherhood_vassal = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = pirate_brotherhood_vassal
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = pirate_brotherhood_vassal
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = pirate_brotherhood_vassal
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				grant_independence = yes
				create_alliance = ROOT
			}
		}
	}
	
	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_protectorate
establish_protectorate = {
	category = influence

	alert_index = 4
	alert_tooltip = establish_protectorate_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = protectorate
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = protectorate
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = {
			capital_scope = { trade_range = ROOT }
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = protectorate
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
			}
			create_subject = {
				subject = FROM
				subject_type = protectorate
			}
			if = {
				limit = {
					any_country = {
						is_subject_of = FROM
						is_colonial_nation = no
					}
				}
				every_country = {
					limit = {
						is_subject_of = FROM
						is_colonial_nation = no
					}
					FROM = {
						PREV = { grant_independence = yes }
					}
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = protectorate
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
			}
			FROM = {
				clr_country_flag = declined_establish_protectorate_@ROOT
				set_country_flag = declined_establish_protectorate_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_protectorate_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 0 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 100 } }
					has_opinion = { who = ROOT value = 0 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
			export_to_variable = {
				variable_name = ai_value_2
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value_2 value = 4 }
			change_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					has_opinion = { who = ROOT value = 100 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 8 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 1 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 2 } }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 2 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 3 } }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 3 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 4 } }
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 4 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 5 } }
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 5 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 6 } }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 6 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 7 } }
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 7 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 8 } }
			}
			export_to_variable = {
				which = ai_value
				value = 70
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 8 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 9 } }
			}
			export_to_variable = {
				which = ai_value
				value = 80
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 9 }
				NOT = { calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 10 } }
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_PROTECTORATES
			limit = {
				calc_true_if = { all_subject_country = { is_subject_of_type = protectorate } amount = 10 }
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_TOTAL_DEVELOPMENT_OVER_200
			limit = {
				FROM = { total_development = 200 }
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				any_country = {
					is_subject_of = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { 
				which = our_army_size 
				value = 10 
			}
			divide_variable = { 
				which = their_army_size 
				value = -10 
			}
			change_variable = { 
				which = our_army_size 
				which = their_army_size 
			}
			multiply_variable = { 
				which = their_mil_tech 
				value = -1 
			}
			change_variable = { 
				which = our_mil_tech 
				which = their_mil_tech 
			}
			multiply_variable = { 
				which = our_mil_tech 
				value = 3 
			}
			change_variable = { 
				which = ai_value 
				which = our_army_size 
			}
			change_variable = { 
				which = ai_value 
				which = our_mil_tech 
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -89 }
					NOT = { check_variable = { which = eco_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -89 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
	}

	ai_will_do = {
		NOT = {
			has_casus_belli = {
				type = cb_imperial
				target = FROM
			}
		}
		FROM = {
			total_development = 70
			NOT = { total_development = 200 }
			OR = {
				NOT = { has_country_flag = declined_establish_protectorate_@ROOT }
				had_country_flag = { flag = declined_establish_protectorate_@ROOT days = 1825 }
			}
			NOT = { adm_tech = ROOT }
			NOT = { dip_tech = ROOT }
			NOT = { mil_tech = ROOT }
			capital_scope = {
				NOT = { continent = north_america }
				NOT = { continent = south_america }
				region_for_scope_province = {
					type = all
					owner = {
						NOT = { is_subject_of = ROOT }
					}
				}
			}
		}
		institution_difference = { who = FROM value = 1 }
		has_opinion = { who = FROM value = 50 }
		OR = {
			ai_attitude = { who = FROM attitude = attitude_friendly }
			ai_attitude = { who = FROM attitude = attitude_allied }
			ai_attitude = { who = FROM attitude = attitude_neutral }
		}
		OR = {
			NOT = { has_casus_belli_against = FROM }
			FROM = {
				NOT = {
					num_of_owned_provinces_with = {
						value = 3
						OR = {
							is_claim = ROOT
							is_core = ROOT
							any_country = {
								is_subject_of = ROOT
								PREV = { is_claim = PREV }
							}
							any_country = {
								is_subject_of = ROOT
								PREV = { is_core = PREV }
							}
						}
					}
				}
			}
		}
	}
}

ask_to_become_protectorate = {
	category = influence

	alert_index = 4
	alert_tooltip = ask_to_become_protectorate_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = protectorate
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = protectorate
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		capital_scope = { trade_range = FROM }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = protectorate
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
				capital_scope = { trade_range = FROM }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = protectorate
				}
			}
			if = {
				limit = {
					any_country = {
						is_subject_of = ROOT
						is_colonial_nation = no
					}
				}
				every_country = {
					limit = {
						is_subject_of = ROOT
						is_colonial_nation = no
					}
					ROOT = {
						PREV = { grant_independence = yes }
					}
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = protectorate
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
				capital_scope = { trade_range = FROM }
			}
			FROM = {
				clr_country_flag = declined_become_protectorate_@ROOT
				set_country_flag = declined_become_protectorate_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_protectorate
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 0 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					NOT = { has_opinion = { who = ROOT value = 100 } }
					has_opinion = { who = ROOT value = 0 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
			export_to_variable = {
				variable_name = ai_value_2
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value_2 value = 4 }
			change_variable = { which = ai_value which = ai_value_2 }
		}
		add_entry = {
			name = OPINION
			limit = {
				FROM = {
					has_opinion = { who = ROOT value = 100 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 8 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_domineering }
						ai_attitude = { who = ROOT attitude = attitude_protective }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10000
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_allied }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -349 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 350
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -349 }
					NOT = { check_variable = { which = military_power value = 60 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { 
				which = our_army_size 
				value = 10 
			}
			divide_variable = { 
				which = their_army_size 
				value = -10 
			}
			change_variable = { 
				which = our_army_size 
				which = their_army_size 
			}
			multiply_variable = { 
				which = their_mil_tech 
				value = -1 
			}
			change_variable = { 
				which = our_mil_tech 
				which = their_mil_tech 
			}
			multiply_variable = { 
				which = our_mil_tech 
				value = 3 
			}
			change_variable = { 
				which = ai_value 
				which = our_army_size 
			}
			change_variable = { 
				which = ai_value 
				which = our_mil_tech 
			}
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 60 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -349 }
					NOT = { check_variable = { which = eco_power value = 60 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { 
				which = their_total_development 
				which = their_total_development 
			}
			divide_variable = { 
				which = our_total_development 
				which = their_total_development 
			}
			multiply_variable = { 
				which = ai_value 
				which = our_total_development 
			}
			change_variable = { 
				which = ai_value 
				value = -90 
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -349 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 350
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 60 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
		}
	}

	ai_will_do = {
		total_development = 70
		NOT = { total_development = 200 }
		NOT = { adm_tech = FROM }
		NOT = { dip_tech = FROM }
		NOT = { mil_tech = FROM }
		NOT = { num_of_subjects = 1 }
		has_opinion = { who = FROM value = 50 }
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_become_protectorate_@ROOT }
				had_country_flag = { flag = declined_become_protectorate_@ROOT days = 1825 }
			}
			institution_difference = { who = ROOT value = 1 }
			OR = {
				ai_attitude = { who = ROOT attitude = attitude_friendly }
				ai_attitude = { who = ROOT attitude = attitude_allied }
				ai_attitude = { who = ROOT attitude = attitude_neutral }
				ai_attitude = { who = ROOT attitude = attitude_threatened }
			}
			OR = {
				NOT = { has_casus_belli_against = ROOT }
				ROOT = {
					NOT = {
						num_of_owned_provinces_with = {
							value = 3
							OR = {
								is_claim = FROM
								is_core = FROM
								any_country = {
									is_subject_of = FROM
									PREV = { is_claim = PREV }
								}
								any_country = {
									is_subject_of = FROM
									PREV = { is_core = PREV }
								}
							}
						}
					}
				}
			}
		}
		OR = {
			FROM = { ai = no }
			AND = {
				FROM = {
					NOT = {
						has_casus_belli = {
							type = cb_imperial
							target = FROM
						}
					}
				}
				capital_scope = {
					NOT = { continent = north_america }
					NOT = { continent = south_america }
					region_for_scope_province = {
						type = all
						owner = {
							NOT = { is_subject_of = FROM }
						}
					}
				}
			}
		}
	}
}

cancel_protectorate = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = protectorate
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = protectorate
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = protectorate
				}
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { truce_with = FROM }
			}
			if = {
				limit = {
					NOT = { full_idea_group = diplomatic_ideas }
				}
				add_stability = -1
			}
			FROM = {
				grant_independence = yes
				country_event = { id = subjects_expanded_protectorate_events.2 }
				add_opinion = {
					who = ROOT
					modifier = released_protectorate
				}
			}
		}
	}
	ai_will_do = {
		OR = {
			stability = 2
			adm_power = 300
			full_idea_group = diplomatic_ideas
			FROM = {
				liberty_desire = 100
				years_in_vassalage_under = {
					who = ROOT
					years = 50
					all_subject_country = yes
				}
			}
		}
		OR = {
			AND = {
				FROM = {
					all_owned_province = {
						all_neighbor_province = {
							OR = {
								owned_by = FROM
								owned_by = ROOT
								owner = {
									is_subject_of = ROOT
									NOT = { liberty_desire = 50 }
								}
							}
						}
					}
				}
				has_casus_belli_against = FROM
			}
			AND = {
				FROM = { liberty_desire = 80 }
				NOT = {
					calc_true_if = {
						all_province = {
							OR = {
								owned_by = ROOT
								owner = {
									NOT = { tag = FROM }
									is_subject_of = ROOT
								}
							}
							same_continent = FROM
						}
						amount = 15
					}
				}
				OR = {
					is_year = 1800
					current_age = age_of_revolutions
				}
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_puppet_state
establish_puppet_state = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_puppet_state_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = puppet_state
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = puppet_state
		}
		prestige = 0
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = {
			capital_scope = { trade_range = ROOT }
		}
		FROM = {
			NOT = { total_development = 300 }
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = puppet_state
				}
				prestige = 0
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
				FROM = {
					NOT = { total_development = 300 }
				}
			}
			create_subject = {
				subject = FROM
				subject_type = puppet_state
			}
			FROM = {
				country_event = { id = subjects_expanded_puppet_state_events.1 }
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = puppet_state
				}
				prestige = 0
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
				FROM = {
					NOT = { total_development = 300 }
				}
			}
			FROM = {
				clr_country_flag = declined_establish_puppet_state_@ROOT
				set_country_flag = declined_establish_puppet_state_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_puppet_state_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_SUBJECT_AT_RIVAL_BORDER
			limit = {
				FROM = {
					is_subject_of = ROOT
				}
				OR = {
					any_rival_country = {
						is_neighbor_of = FROM
					}
					any_enemy_country = {
						is_neighbor_of = FROM
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_MONARCHY
			limit = {
				FROM = {
					government = monarchy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_OTHER_IDEOLOGY
			limit = {
				OR = {
					# Fascist Government Type
					AND = {
						OR = {
							#has_reform = fascist_government
							#has_reform = military_government
							has_reform = presidential_despot_reform
						}
						FROM = {
							#NOT = { has_reform = fascist_government }
							#NOT = { has_reform = military_government }
							NOT = { has_reform = presidential_despot_reform }
						}
					}
					# Communist Government Type
					AND = {
						OR = {
							has_reform = peasants_republic
							#has_reform = communist_government
						}
						FROM = {
							NOT = { has_reform = peasants_republic }
							#NOT = { has_reform = communist_government }
						}
					}
					# Capitalist Government Type
					AND = {
						OR = {
							has_reform = administrative_monarchy
							has_reform = constitutional_monarchy
							has_reform = merchants_reform
							has_reform = oligarchy_reform
							has_reform = administrative_republic
							has_reform = constitutional_republic
							has_reform = bureaucratic_despotism
							has_reform = english_monarchy
							has_reform = british_monarchy
							has_reform = scottish_monarchy
							has_reform = trading_city
							has_reform = dutch_republic
							has_reform = american_republic
							has_reform = federal_republic
						}
						FROM = {
							NOT = { has_reform = administrative_monarchy }
							NOT = { has_reform = constitutional_monarchy }
							NOT = { has_reform = merchants_reform }
							NOT = { has_reform = oligarchy_reform }
							NOT = { has_reform = administrative_republic }
							NOT = { has_reform = constitutional_republic }
							NOT = { has_reform = bureaucratic_despotism }
							NOT = { has_reform = english_monarchy }
							NOT = { has_reform = british_monarchy }
							NOT = { has_reform = scottish_monarchy }
							NOT = { has_reform = trading_city }
							NOT = { has_reform = dutch_republic }
							NOT = { has_reform = american_republic }
							NOT = { has_reform = federal_republic }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NOT_RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 200
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 200
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 190
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 200
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 190
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 180
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 190
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 180
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 170
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 180
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 170
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 160
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 170
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 160
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 150
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 160
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 150
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 140
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 150
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 140
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 130
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 140
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 130
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 120
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 130
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 120
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 110
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 120
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 110
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 100
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 110
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 90
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 100
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 80
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 90
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 80
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 70
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 80
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 70
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 60
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 70
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 50
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 60
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 40
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 30
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 40
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 20
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
						value = 10
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 20
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = RELEASED_FROM_IN_A_WAR
			limit = {
				FROM = {
					has_opinion_modifier = {
						modifier = released_in_peace
						who = ROOT
					}
					NOT = {
						has_opinion_modifier = {
							modifier = released_in_peace
							who = ROOT
							value = 10
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = FROM_HAS_AT_LEAST_HALF_OF_ROOT_TOTAL_DEVELOPMENT
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					divide_variable = { which = our_total_development value = 2 }

					check_variable = { which = their_total_development which = our_total_development }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				any_country = {
					is_subject_of = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -49 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -49 }
					NOT = { check_variable = { which = military_power value = 50 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = -49 }
					NOT = { check_variable = { which = eco_power value = 50 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			export_to_variable = {
				which = our_total_development
				value = trigger_value:total_development
			}
			export_to_variable = {
				which = their_total_development
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = { which = their_total_development which = their_total_development }
			divide_variable = { which = our_total_development which = their_total_development }
			multiply_variable = { which = ai_value which = our_total_development }
			change_variable = { which = ai_value value = -90 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					NOT = { check_variable = { which = eco_power value = -49 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ECONOMIC_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = eco_power
						value = 60
					}
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = FROM
					}
					multiply_variable = { which = their_total_development which = their_total_development }
					divide_variable = { which = our_total_development which = their_total_development }
					multiply_variable = { which = eco_power which = our_total_development }
					change_variable = { which = eco_power value = -90 }

					check_variable = { which = eco_power value = 50 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		num_of_free_diplomatic_relations = 1
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_establish_puppet_state_@ROOT }
				had_country_flag = { flag = declined_establish_puppet_state_@ROOT days = 1825 }
			}
			NOT = { is_subject_of = ROOT }
		}
		is_revolution_target = no
		OR = {
			is_neighbor_of = FROM
			any_rival_country = {
				is_neighbor_of = FROM
			}
		}
		OR = {
			AND = {
				is_great_power = yes
				NOT = { great_power_rank = 4 }
			}
			tag = USA
			tag = ENG
			tag = GBR
			tag = RUS
			# Fascist Government Type
			#has_reform = fascist_government
			#has_reform = military_government
			has_reform = presidential_despot_reform
			# Communist Government Type
			has_reform = peasants_republic
			#has_reform = communist_government
			# Capitalist Government Type
			has_reform = administrative_monarchy
			has_reform = constitutional_monarchy
			has_reform = merchants_reform
			has_reform = oligarchy_reform
			has_reform = administrative_republic
			has_reform = constitutional_republic
			has_reform = bureaucratic_despotism
			has_reform = english_monarchy
			has_reform = british_monarchy
			has_reform = scottish_monarchy
			has_reform = trading_city
			has_reform = dutch_republic
			has_reform = american_republic
			has_reform = federal_republic
		}
	}
}

cancel_puppet_state = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = puppet_state
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = puppet_state
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = puppet_state
				}
				is_at_war = no
				FROM = { is_at_war = no }
				NOT = { truce_with = FROM }
			}
			if = {
				limit = {
					NOT = { full_idea_group = diplomatic_ideas }
				}
				add_stability = -1
			}
			add_prestige = -20
			FROM = {
				grant_independence = yes
				country_event = { id = subjects_expanded_puppet_state_events.2 }
				add_opinion = {
					who = ROOT
					modifier = released_puppet_state
				}
			}
			add_truce_with = FROM
		}
	}

	ai_will_do = {
		OR = {
			stability = 1
			adm_power = 300
			full_idea_group = diplomatic_ideas
		}
		NOT = {
			OR = {
				total_development = 300
				AND = {
					is_great_power = yes
					NOT = { great_power_rank = 4 }
				}
				tag = USA
				tag = ENG
				tag = GBR
				tag = RUS
				# Fascist Government Type
				#has_reform = fascist_government
				#has_reform = military_government
				has_reform = presidential_despot_reform
				# Communist Government Type
				has_reform = peasants_republic
				#has_reform = communist_government
				# Capitalist Government Type
				has_reform = administrative_monarchy
				has_reform = constitutional_monarchy
				has_reform = merchants_reform
				has_reform = oligarchy_reform
				has_reform = administrative_republic
				has_reform = constitutional_republic
				has_reform = bureaucratic_despotism
				has_reform = english_monarchy
				has_reform = british_monarchy
				has_reform = scottish_monarchy
				has_reform = trading_city
				has_reform = dutch_republic
				has_reform = american_republic
				has_reform = federal_republic
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_religious_march
establish_religious_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = religious_march
		}
	}

	is_allowed = {
		is_subject = no
		can_create_subject_type = {
			subject = FROM
			subject_type = religious_march
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				is_subject = no
				can_create_subject_type = {
					subject = FROM
					subject_type = religious_march
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			create_subject = {
				subject = FROM
				subject_type = religious_march
			}
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { liberty_desire = 50 }
			NOT = { is_different_march_subject = yes }
			NOT = { development_of_overlord_fraction = 0.25 }
			num_of_missionaries = 1
			any_neighbor_country = {
				OR = {
					is_rival = ROOT
					is_enemy = ROOT
				}
				NOT = { religion_group = ROOT }
			}
			NOT = { religious_unity = 0.7 }
			NOT = {
				can_create_subject_type = {
					subject = FROM
					subject_type = crusader_state_vassal
				}
			}
			NOT = {
				can_create_subject_type = {
					subject = FROM
					subject_type = iqta_vassal
				}
			}
			NOT = {
				num_of_owned_provinces_with = {
					value = 10
					is_permanent_claim = ROOT
				}
			}
		}
	}
}

ask_to_become_religious_march = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_religious_march_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = religious_march
			}
		}
	}

	is_allowed = {
		FROM = {
			is_subject = no
			can_create_subject_type = {
				subject = ROOT
				subject_type = religious_march
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = religious_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = religious_march
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					can_create_subject_type = {
						subject = ROOT
						subject_type = religious_march
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			FROM = {
				clr_country_flag = declined_become_religious_march_@ROOT
				set_country_flag = declined_become_religious_march_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_religious_march
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = ROOT_IS_VASSAL_FOR_AT_LEAST_10_YEARS
			limit = {
				years_in_vassalage_under = {
					who = FROM
					years = 10
					all_subject_country = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_NOT_A_NEIGHBOR_OF_FROMS_RIVALS
			limit = {
				NOT = {
					any_neighbor_country = {
						OR = {
							is_rival = FROM
							is_enemy = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_MORE_THAN_25_PERCENT_OF_OVERLORD_DEVELOPMENT
			limit = {
				development_of_overlord_fraction = 0.25
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_TOO_FEW_PRODUCTION_INCOME
			limit = {
				OR = {
					NOT = { monthly_income = 20 }
					NOT = { production_income_percentage = 0.35 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_HAS_TOO_HIGH_RELIGIOUS_UNITY
			limit = {
				religious_unity = 0.75
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { liberty_desire = 50 }
		NOT = { is_different_march_subject = yes }
		NOT = { religious_unity = 0.6 }
		num_of_missionaries = 1
		any_neighbor_country = {
			OR = {
				is_rival = FROM
				is_enemy = FROM
			}
			NOT = { religion_group = FROM }
		}
		FROM = {
			NOT = {
				can_create_subject_type = {
					subject = ROOT
					subject_type = crusader_state_vassal
				}
			}
			NOT = {
				can_create_subject_type = {
					subject = ROOT
					subject_type = iqta_vassal
				}
			}
			OR = {
				NOT = { has_country_flag = declined_become_religious_march_@ROOT }
				had_country_flag = { flag = declined_become_religious_march_@ROOT days = 1825 }
			}
		}
		NOT = {
			num_of_owned_provinces_with = {
				value = 10
				is_permanent_claim = FROM
			}
		}
	}
}

religious_march_enable_increased_conversion_efforts = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = religious_march
			NOT = { has_country_flag = religious_march_increased_conversion_efforts }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = religious_march
				NOT = { has_country_flag = religious_march_increased_conversion_efforts }
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			any_owned_province = {
				has_owner_religion = no
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = religious_march
					NOT = { has_country_flag = religious_march_increased_conversion_efforts }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					any_owned_province = {
						has_owner_religion = no
					}
				}
			}
			FROM = {
				set_country_flag = religious_march_increased_conversion_efforts
			}
		}
	}

	ai_will_do = {
		FROM = {
			is_at_war = no
			NOT = { liberty_desire = 35 }
			NOT = { religious_unity = 0.5 }
		}
	}
}

religious_march_disable_increased_conversion_efforts = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = religious_march
			has_country_flag = religious_march_increased_conversion_efforts
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = religious_march
				has_country_flag = religious_march_increased_conversion_efforts
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = religious_march
					has_country_flag = religious_march_increased_conversion_efforts
				}
				is_at_war = no
				FROM = { is_at_war = no }
			}
			add_prestige = -10
			FROM = {
				clr_country_flag = religious_march_increased_conversion_efforts
			}
		}
	}

	ai_will_do = {
		FROM = {
			OR = {
				is_at_war = yes
				liberty_desire = 55
				religious_unity = 0.8
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_revolution_subject
cancel_revolution_subject = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		NOT = { has_dlc = "Rights of Man" }
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = revolution_subject
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			NOT = { has_dlc = "Rights of Man" }
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = revolution_subject
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}
	
	on_accept = {
		if = {
			limit = {
				NOT = { has_dlc = "Rights of Man" }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = revolution_subject
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}
	
	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_roman_client_kingdom
establish_roman_client_kingdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = roman_client_kingdom
		}
		FROM = {
			is_subject_of = PREV
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = roman_client_kingdom
		}
		FROM = {
			is_subject_of = PREV
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = roman_client_kingdom
				}
				FROM = {
					is_subject_of = PREV
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = roman_client_kingdom
			}
		}
	}

	ai_will_do = {
		OR = {
			num_of_free_diplomatic_relations = 1
			FROM = {
				any_neighbor_country = {
					OR = {
						is_rival = FROM
						is_enemy = FROM
					}
				}
			}
		}
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
	}
}

place_roman_ruler_on_subject_throne = {
	category = influence

	require_acceptance = no

	is_visible = {
		OR = {
			tag = ROM
			#tag = ROW
			tag = BYZ
		}
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = roman_client_kingdom
			government = monarchy
			has_regency = no
		}
	}

	is_allowed = {
		hidden_trigger = {
			OR = {
				tag = ROM
				#tag = ROW
				tag = BYZ
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = roman_client_kingdom
				government = monarchy
				has_regency = no
			}
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_REPLACE_CURRENT_RULER
				NOT = { has_ruler_flag = placed_on_throne_by_@ROOT }
			}
		}
		custom_trigger_tooltip = {
			tooltip = DID_NOT_REPLACE_RULER_WITHIN_LAST_50_YEARS
			NOT = { has_country_modifier = cooldown_placed_roman_ruler_on_subject_throne }
		}
	}

	on_accept = {
		if = {
			limit = {
				OR = {
					tag = ROM
					#tag = ROW
					tag = BYZ
				}
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = roman_client_kingdom
					government = monarchy
					has_regency = no
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = {
					NOT = { has_ruler_flag = placed_on_throne_by_@ROOT }
				}
				NOT = { has_country_modifier = cooldown_placed_roman_ruler_on_subject_throne }
			}
			FROM = {
				define_ruler = {
					culture = ROOT
					religion = ROOT
					male = yes
				}
				if = {
					limit = {
						has_heir = yes
					}
					kill_heir = {}
				}
				add_liberty_desire = 10
				set_ruler_flag = placed_on_throne_by_@ROOT
				add_opinion = {
					who = ROOT
					modifier = roman_client_kingdom_replaced_ruler
				}
			}
			add_country_modifier = {
				name = cooldown_placed_roman_ruler_on_subject_throne
				duration = 18250
				hidden = yes
			}
		}
	}

	ai_will_do = {
		FROM = {
			months_of_ruling = 60
			NOT = { marriage_with = ROOT }
			NOT = { dynasty = ROOT }
			NOT = { ruler_culture = ROOT }
			OR = {
				AND = {
					has_heir = no
					NOT = { legitimacy = 50 }
				}
				AND = {
					is_female = yes
					ROOT = { is_female = no }
				}
			}
		}
	}
}

demand_additional_tribute_from_roman_client_kingdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		OR = {
			tag = ROM
			#tag = ROW
			tag = BYZ
		}
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = roman_client_kingdom
		}
	}

	is_allowed = {
		hidden_trigger = {
			OR = {
				tag = ROM
				#tag = ROW
				tag = BYZ
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = roman_client_kingdom
			}
		}
		FROM = { NOT = { liberty_desire = 50 } }
	}

	on_accept = {
		if = {
			limit = {
				OR = {
					tag = ROM
					#tag = ROW
					tag = BYZ
				}
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = roman_client_kingdom
				}
				FROM = { NOT = { liberty_desire = 50 } }
			}
			FROM = {
				country_event = { id = subjects_expanded_roman_client_kingdom_events.3 }
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

cancel_roman_client_kingdom = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = roman_client_kingdom
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = roman_client_kingdom
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = roman_client_kingdom
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 30
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_sister_republic
establish_sister_republic = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_sister_republic_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = sister_republic
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = sister_republic
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		has_opinion = {
			who = FROM
			value = 150
		}
		reverse_has_opinion = {
			who = FROM
			value = 150
		}
		total_development = FROM
		FROM = {
			variable_arithmetic_trigger = {
				custom_tooltip = HAS_AT_LEAST_ONE_THIRD_OF_PREV_TOTAL_DEVELOPMENT
				export_to_variable = {
					which = our_total_development
					value = trigger_value:total_development
				}
				#subtract_variable = { which = our_total_development value = 1 }
				export_to_variable = {
					which = their_total_development
					value = trigger_value:total_development
					who = PREV
				}
				#subtract_variable = { which = their_total_development value = 1 }
				divide_variable = { which = their_total_development value = 3 }
				check_variable = { which = our_total_development which = their_total_development }
			}
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				OR = {
					ai = yes
					FROM = {
						ai = yes
					}
				}
			}
			trust = {
				who = FROM
				value = 60
			}
			FROM = {
				trust = {
					who = ROOT
					value = 60
				}
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = { is_subject_of = ROOT }
				}
			}
			alliance_with = FROM
		}
		else = {
			FROM = {
				NOT = { liberty_desire = 50 }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = sister_republic
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
				total_development = FROM
				FROM = {
					variable_arithmetic_trigger = {
						custom_tooltip = HAS_AT_LEAST_ONE_THIRD_OF_PREV_TOTAL_DEVELOPMENT
						export_to_variable = {
							which = our_total_development
							value = trigger_value:total_development
						}
						#subtract_variable = { which = our_total_development value = 1 }
						export_to_variable = {
							which = their_total_development
							value = trigger_value:total_development
							who = PREV
						}
						#subtract_variable = { which = their_total_development value = 1 }
						divide_variable = { which = their_total_development value = 3 }
						check_variable = { which = our_total_development which = their_total_development }
					}
				}
				if = {
					limit = {
						has_dlc = "The Cossacks"
						OR = {
							ai = yes
							FROM = {
								ai = yes
							}
						}
					}
					trust = {
						who = FROM
						value = 60
					}
					FROM = {
						trust = {
							who = ROOT
							value = 60
						}
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = { is_subject_of = ROOT }
						}
					}
					alliance_with = FROM
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = sister_republic
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = sister_republic
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
				total_development = FROM
				FROM = {
					variable_arithmetic_trigger = {
						custom_tooltip = HAS_AT_LEAST_ONE_THIRD_OF_PREV_TOTAL_DEVELOPMENT
						export_to_variable = {
							which = our_total_development
							value = trigger_value:total_development
						}
						#subtract_variable = { which = our_total_development value = 1 }
						export_to_variable = {
							which = their_total_development
							value = trigger_value:total_development
							who = PREV
						}
						#subtract_variable = { which = their_total_development value = 1 }
						divide_variable = { which = their_total_development value = 3 }
						check_variable = { which = our_total_development which = their_total_development }
					}
				}
				if = {
					limit = {
						has_dlc = "The Cossacks"
						OR = {
							ai = yes
							FROM = {
								ai = yes
							}
						}
					}
					trust = {
						who = FROM
						value = 60
					}
					FROM = {
						trust = {
							who = ROOT
							value = 60
						}
					}
				}
				if = {
					limit = {
						FROM = {
							NOT = { is_subject_of = ROOT }
						}
					}
					alliance_with = FROM
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_establish_sister_republic_@ROOT
				set_country_flag = declined_establish_sister_republic_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_sister_republic_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = base_values
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_DIFF_OF_GOV_RANKS
			export_to_variable = {
				which = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				which = ai_value_2
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = { 
				which = ai_value 
				which = ai_value_2 
			}
			multiply_variable = { 
				which = ai_value 
				value = 10 
			}
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
				who = FROM
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				NOT = { overlord_of = FROM }
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				NOT = { overlord_of = FROM }
				is_part_of_hre = yes
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_PAPAL_STATE
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					tag = PAP
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MORE_THAN_200_TOTAL_DEVELOPMENT
			limit = {
				FROM = {
					total_development = 200
				}
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				NOT = { overlord_of = FROM }
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_A_THEOCRACY
			limit = {
				FROM = {
					government = theocracy
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MUTUAL_OPINION_ABOVE_150
			limit = {
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
			}
			export_to_variable = {
				which = ai_value
				value = opinion
				who = ROOT
				with = FROM
			}
			export_to_variable = {
				which = ai_value_2
				value = opinion
				who = FROM
				with = ROOT
			}
			change_variable = { which = ai_value which = ai_value_2 }
			divide_variable = { which = ai_value value = 2 }
			subtract_variable = { which = ai_value value = 150 }
			divide_variable = { which = ai_value value = 3.3 }
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { is_subject_of = ROOT }
			is_neighbor_of = ROOT
			OR = {
				NOT = { has_country_flag = declined_establish_sister_republic_@ROOT }
				had_country_flag = { flag = declined_establish_sister_republic_@ROOT days = 1825 }
			}
		}
	}
}

ask_for_sister_republic = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_for_sister_republic_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = sister_republic
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = sister_republic
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		has_opinion = {
			who = FROM
			value = 150
		}
		reverse_has_opinion = {
			who = FROM
			value = 150
		}
		FROM = {
			total_development = ROOT
		}
		FROM = {
			ROOT = {
				variable_arithmetic_trigger = {
					custom_tooltip = HAS_AT_LEAST_ONE_THIRD_OF_PREV_TOTAL_DEVELOPMENT
					export_to_variable = {
						which = our_total_development
						value = trigger_value:total_development
					}
					#subtract_variable = { which = our_total_development value = 1 }
					export_to_variable = {
						which = their_total_development
						value = trigger_value:total_development
						who = PREV
					}
					#subtract_variable = { which = their_total_development value = 1 }
					divide_variable = { which = their_total_development value = 3 }
					check_variable = { which = our_total_development which = their_total_development }
				}
			}
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
			}
			trust = {
				who = FROM
				value = 60
			}
			FROM = {
				trust = {
					who = ROOT
					value = 60
				}
			}
		}
		if = {
			limit = {
				NOT = { is_subject_of = FROM }
			}
			alliance_with = FROM
		}
		else = {
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = sister_republic
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
				FROM = {
					total_development = ROOT
				}
				FROM = {
					ROOT = {
						variable_arithmetic_trigger = {
							custom_tooltip = HAS_AT_LEAST_ONE_THIRD_OF_PREV_TOTAL_DEVELOPMENT
							export_to_variable = {
								which = our_total_development
								value = trigger_value:total_development
							}
							#subtract_variable = { which = our_total_development value = 1 }
							export_to_variable = {
								which = their_total_development
								value = trigger_value:total_development
								who = PREV
							}
							#subtract_variable = { which = their_total_development value = 1 }
							divide_variable = { which = their_total_development value = 3 }
							check_variable = { which = our_total_development which = their_total_development }
						}
					}
				}
				if = {
					limit = {
						has_dlc = "The Cossacks"
					}
					trust = {
						who = FROM
						value = 60
					}
					FROM = {
						trust = {
							who = ROOT
							value = 60
						}
					}
				}
				if = {
					limit = {
						NOT = { is_subject_of = FROM }
					}
					alliance_with = FROM
				}
				else = {
					NOT = { liberty_desire = 50 }
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = sister_republic
				}
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = sister_republic
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
				FROM = {
					total_development = ROOT
				}
				FROM = {
					ROOT = {
						variable_arithmetic_trigger = {
							custom_tooltip = HAS_AT_LEAST_ONE_THIRD_OF_PREV_TOTAL_DEVELOPMENT
							export_to_variable = {
								which = our_total_development
								value = trigger_value:total_development
							}
							#subtract_variable = { which = our_total_development value = 1 }
							export_to_variable = {
								which = their_total_development
								value = trigger_value:total_development
								who = PREV
							}
							#subtract_variable = { which = their_total_development value = 1 }
							divide_variable = { which = their_total_development value = 3 }
							check_variable = { which = our_total_development which = their_total_development }
						}
					}
				}
				if = {
					limit = {
						has_dlc = "The Cossacks"
					}
					trust = {
						who = FROM
						value = 60
					}
					FROM = {
						trust = {
							who = ROOT
							value = 60
						}
					}
				}
				if = {
					limit = {
						NOT = { is_subject_of = FROM }
					}
					alliance_with = FROM
				}
				else = {
					NOT = { liberty_desire = 50 }
				}
			}
			clr_country_flag = declined_establish_sister_republic_@FROM
			set_country_flag = declined_establish_sister_republic_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_for_sister_republic_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = STRATEGIC_VALUE
			limit = {
				NOT = {
					AND = {
						NOT = { is_subject_of = FROM }
						is_neighbor_of = FROM
						OR = {
							NOT = { has_country_flag = declined_establish_sister_republic_@FROM }
							had_country_flag = { flag = declined_establish_sister_republic_@FROM days = 1825 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = base_values
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_VASSAL_OF_FROM
			limit = {
				is_subject_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				is_subject_of = FROM
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_MARRIAGE_WITH_ROOT
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 2000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION_GROUP
			limit = {
				NOT = { religion_group = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				religion_group = FROM
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					NOT = { check_variable = { which = military_power value = -39 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = -39 }
					NOT = { check_variable = { which = military_power value = 30 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 0
			}
			export_to_variable = {
				which = our_mil_tech
				value = mil_tech
				who = FROM
			}
			export_to_variable = {
				which = their_mil_tech
				value = mil_tech
			}
			export_to_variable = {
				which = our_army_size
				value = trigger_value:army_size
				who = FROM
			}
			export_to_variable = {
				which = their_army_size
				value = trigger_value:army_size
			}
			divide_variable = { which = our_army_size value = 10 }
			divide_variable = { which = their_army_size value = -10 }
			change_variable = { which = our_army_size which = their_army_size }
			multiply_variable = { which = their_mil_tech value = -1 }
			change_variable = { which = our_mil_tech which = their_mil_tech }
			multiply_variable = { which = our_mil_tech value = 3 }
			change_variable = { which = ai_value which = our_army_size }
			change_variable = { which = ai_value which = our_mil_tech }
		}
		add_entry = {
			name = ROOT_FROM_MILITARY_POWER_COMPARED
			limit = {
				variable_arithmetic_trigger = {
					export_to_variable = {
						which = our_mil_tech
						value = mil_tech
						who = FROM
					}
					export_to_variable = {
						which = their_mil_tech
						value = mil_tech
					}
					export_to_variable = {
						which = our_army_size
						value = trigger_value:army_size
						who = FROM
					}
					export_to_variable = {
						which = their_army_size
						value = trigger_value:army_size
					}
					export_to_variable = {
						which = military_power
						value = 0
					}
					divide_variable = { which = our_army_size value = 10 }
					divide_variable = { which = their_army_size value = -10 }
					change_variable = { which = our_army_size which = their_army_size }
					multiply_variable = { which = their_mil_tech value = -1 }
					change_variable = { which = our_mil_tech which = their_mil_tech }
					multiply_variable = { which = our_mil_tech value = 3 }
					change_variable = { which = military_power which = our_army_size }
					change_variable = { which = military_power which = our_mil_tech }
					check_variable = { which = military_power value = 30 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
		}
		add_entry = {
			name = ROOT_HAS_MORE_THAN_200_TOTAL_DEVELOPMENT
			limit = {
				total_development = 200
			}
			export_to_variable = {
				which = ai_value
				value = 75
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				NOT = { is_subject_of = FROM }
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = MUTUAL_OPINION_ABOVE_150
			limit = {
				has_opinion = {
					who = FROM
					value = 150
				}
				reverse_has_opinion = {
					who = FROM
					value = 150
				}
			}
			export_to_variable = {
				which = ai_value
				value = opinion
				who = ROOT
				with = FROM
			}
			export_to_variable = {
				which = ai_value_2
				value = opinion
				who = FROM
				with = ROOT
			}
			change_variable = { which = ai_value which = ai_value_2 }
			divide_variable = { which = ai_value value = 2 }
			subtract_variable = { which = ai_value value = 150 }
			divide_variable = { which = ai_value value = 3.3 }
		}
	}

	ai_will_do = {
		NOT = { has_reform = free_city }
		NOT = { num_of_subjects = 1 }
		OR = {
			is_subject_of = FROM
			AND = {
				is_part_of_hre = no
				FROM = { is_part_of_hre = no }
			}
			AND = {
				is_part_of_hre = yes
				FROM = { is_part_of_hre = yes }
			}
		}
		OR = {
			AND = {
				NOT = { government_rank = 9 }
				FROM = { government_rank = 9 }
			}
			AND = {
				NOT = { government_rank = 8 }
				FROM = { government_rank = 8 }
			}
		}
		government = republic
		NOT = { total_development = 200 }
		is_neighbor_of = FROM
		historical_friend_with = FROM
		NOT = { army_size = FROM }
		OR = {
			NOT = { has_country_flag = declined_establish_sister_republic_@FROM }
			had_country_flag = { flag = declined_establish_sister_republic_@FROM days = 1825 }
		}
	}
}

sister_republic_ask_overlord_to_join_war = {
	category = alliance

	alert_index = 6
	alert_tooltip = sister_republic_ask_overlord_to_join_war_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
			overlord_of = ROOT
		}
		is_subject_of_type = sister_republic
		any_country = {
			is_subject = no
			is_in_war = {
				defender_leader = THIS
				attacker_leader = ROOT
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject = no
				overlord_of = ROOT
			}
			is_subject_of_type = sister_republic
			any_country = {
				is_subject = no
				is_in_war = {
					defender_leader = THIS
					attacker_leader = ROOT
				}
			}
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_DECLINE_A_CALL_TO_ARMS_OF_A_SUBJECT_WITHIN_LAST_1_YEAR
				OR = {
					NOT = { has_country_flag = declined_sister_republic_offensive_call_to_arms }
					had_country_flag = { flag = declined_sister_republic_offensive_call_to_arms days = 365 }
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					overlord_of = ROOT
				}
				is_subject_of_type = sister_republic
				any_country = {
					is_subject = no
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_sister_republic_offensive_call_to_arms }
						had_country_flag = { flag = declined_sister_republic_offensive_call_to_arms days = 365 }
					}
				}
			}
			FROM = {
				join_all_offensive_wars_of = ROOT
				clr_country_flag = accepted_sister_republic_offensive_call_to_arms
				set_country_flag = accepted_sister_republic_offensive_call_to_arms
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					is_subject = no
					overlord_of = ROOT
				}
				is_subject_of_type = sister_republic
				any_country = {
					is_subject = no
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
				}
				FROM = {
					OR = {
						NOT = { has_country_flag = declined_sister_republic_offensive_call_to_arms }
						had_country_flag = { flag = declined_sister_republic_offensive_call_to_arms days = 365 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_sister_republic_offensive_call_to_arms
				set_country_flag = declined_sister_republic_offensive_call_to_arms
			}
			add_liberty_desire = 10
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_RULER_MIL_SKILL
			export_to_variable = {
				which = ai_value
				value = MIL
				who = FROM
			}
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_defensive }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_threatened }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 120
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_hostile }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 150
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_ATTITUDE_TOWARDS_FROM
			limit = {
				ai_attitude = { who = FROM attitude = attitude_loyal }
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = atittude_rivalry }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = attitude_hostile }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					FROM = {
						ai_attitude = { who = PREV attitude = attitude_friendly }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_ALREADY_FIGHTING_IN_A_WAR
			limit = {
				FROM = {
					is_at_war = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALREADY_PARTICIPANT_IN_WAR_WITH_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					is_in_war = {
						participants = FROM
						participants = THIS
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_TRUCE_WITH_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					truce_with = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALLIED_TO_COALITION_TARGET
			limit = {
				any_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
					alliance_with = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ALREADY_JOINED_A_WAR_AGAINST_A_COALITION_TARGET_OF_ROOT_WITHIN_LAST_365_DAYS
			limit = {
				FROM = {
					has_country_flag = accepted_sister_republic_offensive_call_to_arms
					NOT = { had_country_flag = { flag = accepted_sister_republic_offensive_call_to_arms days = 365 } }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_WOULD_GET_STABILITY_HIT
			limit = {
				OR = {
					any_country = {
						is_in_war = {
							defender_leader = THIS
							attacker_leader = ROOT
						}
						OR = {
							marriage_with = FROM
							truce_with = FROM
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_IN_DEBT
			limit = {
				FROM = {
					num_of_loans = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:num_of_loans
				who = FROM
			}
			multiply_variable = { which = ai_value value = -10 }
		}
		add_entry = {
			name = FROM_WAR_EXHAUSTION
			export_to_variable = {
				which = ai_value
				value = trigger_value:war_exhaustion
				who = FROM
			}
			multiply_variable = { which = ai_value value = -10 }
		}
	}

	ai_will_do = {
		overlord = {
			is_at_war = no
		}
		any_country = {
			is_subject = no
			is_in_war = {
				defender_leader = THIS
				attacker_leader = ROOT
			}
			war_score_against = { who = ROOT value = 25 }
		}
		NOT = {
			calc_true_if = {
				all_country = {
					is_in_war = {
						defender_leader = THIS
						attacker_leader = ROOT
					}
				}
				amount = 3
			}
		}
	}
}

cancel_sister_republic = {
	category = influence

	require_acceptance = no

	is_visible = {
		NOT = { has_dlc = "Rights of Man" }
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = sister_republic
		}
	}

	is_allowed = {
		hidden_trigger = {
			NOT = { has_dlc = "Rights of Man" }
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = sister_republic
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				NOT = { has_dlc = "Rights of Man" }
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = sister_republic
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 90
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_stato_da_mar_vassal
establish_stato_da_mar_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_stato_da_mar_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = stato_da_mar_vassal
		}
		FROM = {
			OR = {
				is_subject_of = ROOT
				NOT = { num_of_cities = 2 }
			}
			capital_scope = {
				NOT = {
					any_trade_node_member_country = {
						is_subject_of_type_with_overlord = {
							who = ROOT
							type = stato_da_mar_vassal
						}
					}
				}
			}
		}
		capital_scope = {
			FROM = {
				capital_scope = {
					NOT = { region = PREV_PREV }
				}
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				OR = {
					is_subject_of = ROOT
					NOT = { num_of_cities = 2 }
				}
				capital_scope = {
					NOT = {
						any_trade_node_member_country = {
							is_subject_of_type_with_overlord = {
								who = ROOT
								type = stato_da_mar_vassal
							}
						}
					}
				}
			}
			capital_scope = {
				FROM = {
					capital_scope = {
						NOT = { region = PREV_PREV }
					}
				}
			}
		}
		can_create_subject_type = {
			subject = FROM
			subject_type = stato_da_mar_vassal
		}
		FROM = {
			capital_scope = { trade_range = ROOT }
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
				}
			}
			FROM = {
				NOT = { liberty_desire = 50 }
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					OR = {
						is_subject_of = ROOT
						NOT = { num_of_cities = 2 }
					}
					capital_scope = {
						NOT = {
							any_trade_node_member_country = {
								is_subject_of_type_with_overlord = {
									who = ROOT
									type = stato_da_mar_vassal
								}
							}
						}
					}
				}
				capital_scope = {
					FROM = {
						capital_scope = {
							NOT = { region = PREV_PREV }
						}
					}
				}
				can_create_subject_type = {
					subject = FROM
					subject_type = stato_da_mar_vassal
				}
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				if = {
					limit = {
						FROM = {
							is_subject_of = ROOT
						}
					}
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			create_subject = {
				subject = FROM
				subject_type = stato_da_mar_vassal
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					OR = {
						is_subject_of = ROOT
						NOT = { num_of_cities = 2 }
					}
					capital_scope = {
						NOT = {
							any_trade_node_member_country = {
								is_subject_of_type_with_overlord = {
									who = ROOT
									type = stato_da_mar_vassal
								}
							}
						}
					}
				}
				capital_scope = {
					FROM = {
						capital_scope = {
							NOT = { region = PREV_PREV }
						}
					}
				}
				can_create_subject_type = {
					subject = FROM
					subject_type = stato_da_mar_vassal
				}
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				if = {
					limit = {
						FROM = {
							is_subject_of = ROOT
						}
					}
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
			}
			FROM = {
				clr_country_flag = declined_establish_stato_da_mar_vassal_@ROOT
				set_country_flag = declined_establish_stato_da_mar_vassal_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_stato_da_mar_vassal_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_MEMBER
			limit = {
				NOT = { overlord_of = FROM }
				is_part_of_hre = no
				FROM = {
					is_part_of_hre = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_HRE_ELECTOR
			limit = {
				FROM = {
					is_elector = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPEROR
			limit = {
				FROM = {
					is_emperor = yes
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_IMPERIAL_CITY
			limit = {
				FROM = {
					has_reform = free_city
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_ACCEPT_VASSALIZATION_REASONS
			export_to_variable = {
				which = ai_value
				value = modifier:accept_vassalization_reasons
			}
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_HIGH_TRADE_POWER_IN_THEIR_HOME_NODE
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					capital_scope = {
						trade_share = {
							country = PREV
							share = 30
						}
						NOT = {
							trade_share = {
								country = PREV
								share = 50
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_HIGH_TRADE_POWER_IN_THEIR_HOME_NODE
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					capital_scope = {
						trade_share = {
							country = PREV
							share = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1.5 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_ALLIES
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					any_ally = {
						NOT = { tag = ROOT }
						army_size = 20
					}
					NOT = {
						calc_true_if = {
							all_ally = {
								NOT = { tag = ROOT }
								army_size = 20
							}
							amount = 2
						}
					}
					NOT = {
						any_ally = {
							NOT = { tag = ROOT }
							OR = {
								army_size = 100
								military_strength = { who = ROOT value = 2 }
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_ALLIES
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					calc_true_if = {
						all_ally = {
							NOT = { tag = ROOT }
							army_size = 20
						}
						amount = 2
					}
					NOT = {
						any_ally = {
							NOT = { tag = ROOT }
							OR = {
								army_size = 100
								military_strength = { who = ROOT value = 2 }
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_ALLIES
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					any_ally = {
						NOT = { tag = ROOT }
						OR = {
							army_size = 100
							military_strength = { who = ROOT value = 2 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_GUARANTEES
			limit = {
				NOT = { overlord_of = FROM }
				any_country = {
					NOT = { tag = ROOT }
					FROM = {
						guaranteed_by = PREV
					}
					army_size = 20
				}
				NOT = {
					calc_true_if = {
						all_country = {
							NOT = { tag = ROOT }
							FROM = {
								guaranteed_by = PREV
							}
							army_size = 20
						}
						amount = 2
					}
				}
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						FROM = {
							guaranteed_by = PREV
						}
						OR = {
							army_size = 100
							military_strength = { who = ROOT value = 2 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_GUARANTEES
			limit = {
				NOT = { overlord_of = FROM }
				calc_true_if = {
					all_country = {
						NOT = { tag = ROOT }
						FROM = {
							guaranteed_by = PREV
						}
						army_size = 20
					}
					amount = 2
				}
				NOT = {
					any_country = {
						NOT = { tag = ROOT }
						FROM = {
							guaranteed_by = PREV
						}
						OR = {
							army_size = 100
							military_strength = { who = ROOT value = 2 }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_STRONG_GUARANTEES
			limit = {
				NOT = { overlord_of = FROM }
				any_country = {
					NOT = { tag = ROOT }
					FROM = {
						guaranteed_by = PREV
					}
					OR = {
						army_size = 100
						military_strength = { who = ROOT value = 2 }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 25
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 50
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					trust = {
						who = ROOT
						value = 30
					}
					NOT = {
						trust = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = TRUST
			limit = {
				FROM = {
					NOT = {
						trust = {
							who = ROOT
							value = 30
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			tag = VEN
			primary_culture = venetian
		}
		FROM = {
			OR = {
				NOT = { has_country_flag = declined_establish_stato_da_mar_vassal_@ROOT }
				had_country_flag = { flag = declined_establish_stato_da_mar_vassal_@ROOT days = 1825 }
			}
			NOT = { is_subject_of = ROOT }
			capital_scope = {
				has_merchant = ROOT
				OR = {
					continent = europe
					continent = africa
					continent = asia
				}
			}
			NOT = {
				any_owned_province = {
					OR = {
						is_core = ROOT
						is_permanent_claim = ROOT
					}
				}
			}
		}
	}
}

ask_to_become_stato_da_mar_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_stato_da_mar_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = stato_da_mar_vassal
			}
		}
		OR = {
			is_subject_of = FROM
			NOT = { num_of_cities = 2 }
		}
		capital_scope = {
			NOT = {
				any_trade_node_member_country = {
					is_subject_of_type_with_overlord = {
						who = FROM
						type = stato_da_mar_vassal
					}
				}
			}
		}
		capital_scope = {
			FROM = {
				capital_scope = {
					NOT = { region = PREV_PREV }
				}
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			OR = {
				is_subject_of = FROM
				NOT = { num_of_cities = 2 }
			}
			capital_scope = {
				NOT = {
					any_trade_node_member_country = {
						is_subject_of_type_with_overlord = {
							who = FROM
							type = stato_da_mar_vassal
						}
					}
				}
			}
			capital_scope = {
				FROM = {
					capital_scope = {
						NOT = { region = PREV_PREV }
					}
				}
			}
		}
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = stato_da_mar_vassal
			}
		}
		capital_scope = { trade_range = FROM }
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		if = {
			limit = {
				is_subject_of = FROM
			}
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				OR = {
					is_subject_of = FROM
					NOT = { num_of_cities = 2 }
				}
				capital_scope = {
					NOT = {
						any_trade_node_member_country = {
							is_subject_of_type_with_overlord = {
								who = FROM
								type = stato_da_mar_vassal
							}
						}
					}
				}
				capital_scope = {
					FROM = {
						capital_scope = {
							NOT = { region = PREV_PREV }
						}
					}
				}
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = stato_da_mar_vassal
					}
				}
				capital_scope = { trade_range = FROM }
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				if = {
					limit = {
						is_subject_of = FROM
					}
					NOT = { liberty_desire = 50 }
				}
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = stato_da_mar_vassal
				}
				add_truce_with = ROOT
			}
		}
	}

	on_decline = {
		if = {
			limit = {
				OR = {
					is_subject_of = FROM
					NOT = { num_of_cities = 2 }
				}
				capital_scope = {
					NOT = {
						any_trade_node_member_country = {
							is_subject_of_type_with_overlord = {
								who = FROM
								type = stato_da_mar_vassal
							}
						}
					}
				}
				capital_scope = {
					FROM = {
						capital_scope = {
							NOT = { region = PREV_PREV }
						}
					}
				}
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = stato_da_mar_vassal
					}
				}
				capital_scope = { trade_range = FROM }
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				if = {
					limit = {
						is_subject_of = FROM
					}
					NOT = { liberty_desire = 50 }
				}
			}
			clr_country_flag = declined_establish_stato_da_mar_vassal_@FROM
			set_country_flag = declined_establish_stato_da_mar_vassal_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_stato_da_mar_vassal
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = ROOT_IS_VASSAL_OF_FROM
			limit = {
				is_subject_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				is_subject_of = FROM
				liberty_desire = 50
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_allied }
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_FROM_NOT_SAME_RELIGION
			limit = {
				NOT = { religion = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = -4 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = FROM_ROOT_ARE_RIVALS
			limit = {
				OR = {
					is_rival = FROM
					is_enemy = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			divide_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = STRATEGIC_VALUE
			limit = {
				NOT = {
					AND = {
						FROM = {
							OR = {
								tag = VEN
								primary_culture = venetian
							}
						}
						OR = {
							NOT = { has_country_flag = declined_establish_stato_da_mar_vassal_@FROM }
							had_country_flag = { flag = declined_establish_stato_da_mar_vassal_@FROM days = 1825 }
						}
						NOT = { is_subject_of = FROM }
						capital_scope = {
							has_merchant = FROM
							OR = {
								continent = europe
								continent = africa
								continent = asia
							}
						}
						NOT = {
							any_owned_province = {
								OR = {
									is_core = FROM
									is_permanent_claim = FROM
								}
							}
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		is_subject = no
		NOT = { total_development = 50 }
		NOT = { government_rank = 8 }
		alliance_with = FROM
		religion = FROM
		OR = {
			is_part_of_hre = no
			FROM = {
				is_part_of_hre = yes
			}
		}
		is_elector = no
		is_emperor = no
		NOT = { num_of_subjects = 1 }
		NOT = { has_reform = free_city }
		capital_scope = {
			NOT = {
				trade_share = {
					country = PREV
					share = 30
				}
			}
		}
		FROM = {
			NOT = {
				any_owned_province = {
					is_core = ROOT
				}
			}
		}
		NOT = {
			any_ally = {
				NOT = { tag = FROM }
				OR = {
					army_size = 50
					military_strength = { who = FROM value = 1.5 }
				}
			}
		}
		NOT = {
			any_country = {
				NOT = { tag = FROM }
				ROOT = {
					guaranteed_by = PREV
				}
				OR = {
					army_size = 50
					military_strength = { who = FROM value = 1.5 }
				}
			}
		}
	}
}

enable_stato_da_mar_vassal_seize_merchant_fleets = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = stato_da_mar_vassal
			NOT = { has_country_flag = stato_da_mar_vassal_seize_merchant_fleets }
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = stato_da_mar_vassal
				NOT = { has_country_flag = stato_da_mar_vassal_seize_merchant_fleets }
			}
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = stato_da_mar_vassal
					NOT = { has_country_flag = stato_da_mar_vassal_seize_merchant_fleets }
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
			}
			FROM = {
				set_country_flag = stato_da_mar_vassal_seize_merchant_fleets
			}
		}
	}

	ai_will_do = {
		FROM = {
			NOT = { liberty_desire = 35 }
		}
	}
}

disable_stato_da_mar_vassal_seize_merchant_fleets = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = stato_da_mar_vassal
			has_country_flag = stato_da_mar_vassal_seize_merchant_fleets
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = stato_da_mar_vassal
				has_country_flag = stato_da_mar_vassal_seize_merchant_fleets
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = stato_da_mar_vassal
					has_country_flag = stato_da_mar_vassal_seize_merchant_fleets
				}
			}
			FROM = {
				clr_country_flag = stato_da_mar_vassal_seize_merchant_fleets
			}
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 55
		}
	}
}

#subjects_expanded_diplomatic_actions_trade_outpost
establish_trade_outpost = {
	category = influence

	alert_index = 6
	alert_tooltip = establish_trade_outpost_alert_tooltip

	require_acceptance = yes

	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = trade_outpost
		}
	}

	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = trade_outpost
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = {
			capital_scope = { trade_range = ROOT }
		}
	}

	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = trade_outpost
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
			}
			create_subject = {
				subject = FROM
				subject_type = trade_outpost
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = trade_outpost
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = {
					capital_scope = { trade_range = ROOT }
				}
			}
			FROM = {
				clr_country_flag = declined_establish_trade_outpost_@ROOT
				set_country_flag = declined_establish_trade_outpost_@ROOT
			}
			add_opinion = {
				who = FROM
				modifier = declined_establish_trade_outpost_opinion
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				has_subject_of_type = trade_outpost
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 2
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 2
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 3
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 3
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 4
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 30
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 4
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 5
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 40
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 5
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 6
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 6
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 7
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 60
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 7
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 8
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 70
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 8
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 9
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 80
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 9
				}
				NOT = {
					calc_true_if = {
						all_subject_country = {
							is_subject_of_type = trade_outpost
						}
						amount = 10
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 90
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = NUM_OF_TRADE_OUTPOSTS
			limit = {
				calc_true_if = {
					all_subject_country = {
						is_subject_of_type = trade_outpost
					}
					amount = 10
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				NOT = { overlord_of = FROM }
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				NOT = { overlord_of = FROM }
				any_country = {
					is_subject_of = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = BORDER_DISTANCE
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = FROM_IS_KINGDOM_RANK
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					government_rank = 8
					NOT = { government_rank = 9 }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_IS_EMPIRE_RANK
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					government_rank = 9
				}
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			limit = {
				NOT = { overlord_of = FROM }
			}
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -2 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				NOT = { overlord_of = FROM }
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				NOT = { overlord_of = FROM }
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_RIVALS
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					historical_rival_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				NOT = { overlord_of = FROM }
				FROM = {
					personality = ai_capitalist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_IS_VASSAL_OF_ROOT
			limit = {
				overlord_of = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 100
			}
		}
		add_entry = {
			name = FROM_LIBERTY_DESIRE_TOO_HIGH
			limit = {
				overlord_of = FROM
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		OR = {
			NOT = { overlord_of = FROM }
			FROM = {
				NOT = {
					years_in_vassalage_under = {
						who = ROOT
						years = 5
						all_subject_country = yes
					}
				}
			}
		}
		FROM = {
			NOT = { total_development = 100 }
			OR = {
				NOT = { has_country_flag = declined_establish_trade_outpost_@ROOT }
				had_country_flag = { flag = declined_establish_trade_outpost_@ROOT days = 1825 }
			}
			capital_scope = {
				has_merchant = ROOT
			}
		}
		OR = {
			AND = {
				NOT = { has_dlc = "Wealth of Nations" }
				NOT = { has_dlc = "Dharma" }
			}
			FROM = {
				capital_scope = {
					NOT = { superregion = india_superregion }
					NOT = { superregion = china_superregion }
					NOT = { region = japan_region }
					NOT = { continent = oceania }
					NOT = { superregion = east_indies_superregion }
					NOT = { continent = africa }
				}
			}
		}
	}
}

ask_to_become_trade_outpost = {
	category = influence

	alert_index = 6
	alert_tooltip = ask_to_become_trade_outpost_alert_tooltip

	require_acceptance = yes

	is_visible = {
		is_subject = no
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = trade_outpost
			}
		}
	}

	is_allowed = {
		FROM = {
			can_create_subject_type = {
				subject = ROOT
				subject_type = trade_outpost
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		capital_scope = { trade_range = FROM }
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = trade_outpost
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
				capital_scope = { trade_range = FROM }
			}
			FROM = {
				create_subject = {
					subject = ROOT
					subject_type = trade_outpost
				}
			}
			add_truce_with = FROM
		}
	}

	on_decline = {
		if = {
			limit = {
				FROM = {
					can_create_subject_type = {
						subject = ROOT
						subject_type = trade_outpost
					}
				}
				is_at_war = no
				FROM = { is_at_war = no }
				capital_scope = { trade_range = FROM }
			}
			clr_country_flag = declined_establish_trade_outpost_@FROM
			set_country_flag = declined_establish_trade_outpost_@FROM
			add_opinion = {
				who = FROM
				modifier = declined_ask_to_become_trade_outpost
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_friendly }
						ai_attitude = { who = ROOT attitude = attitude_threatened }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					ai_attitude = { who = ROOT attitude = attitude_neutral }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_ATTITUDE_TOWARDS_ROOT
			limit = {
				FROM = {
					OR = {
						ai_attitude = { who = ROOT attitude = attitude_hostile }
						ai_attitude = { who = ROOT attitude = attitude_outraged }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = MODIFIER_DIPLO_SKILL
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = ROOT_IS_MERCHANT_REPUBLIC
			limit = {
				has_reform = merchants_reform
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = FROM_IS_MERCHANT_REPUBLIC
			limit = {
				FROM = {
					has_reform = merchants_reform
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = BORDER_DISTANCE
			export_to_variable = {
				which = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}
		add_entry = {
			name = FROM_DEVELOPMENT
			export_to_variable = {
				which = ai_value
				value = trigger_value:total_development
				who = FROM
			}
			#subtract_variable = { which = ai_value value = 1 }
			divide_variable = { which = ai_value value = -3 }
		}
		add_entry = {
			name = ROOT_OWNS_FROM_CORE_PROVINCES
			limit = {
				any_owned_province = {
					is_core = FROM
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = ROOT_FROM_ARE_ALLIED
			limit = {
				alliance_with = FROM
			}
			export_to_variable = {
				which = ai_value
				value = 15
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_FRIENDS
			limit = {
				FROM = {
					historical_friend_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = ROOT_FROM_ARE_HISTORICAL_RIVALS
			limit = {
				FROM = {
					historical_rival_with = ROOT
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_capitalist
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = STATEGIC_VALUE
			limit = {
				NOT = {
					OR = {
						FROM = {
							NOT = { overlord_of = ROOT }
						}
						NOT = {
							years_in_vassalage_under = {
								who = FROM
								years = 5
								all_subject_country = yes
							}
						}
					}
					NOT = { total_development = 100 }
					OR = {
						AND = {
							NOT = { has_dlc = "Wealth of Nations" }
							NOT = { has_dlc = "Dharma" }
						}
						capital_scope = {
							NOT = { superregion = india_superregion }
							NOT = { superregion = china_superregion }
							NOT = { region = japan_region }
							NOT = { continent = oceania }
							NOT = { superregion = east_indies_superregion }
							NOT = { continent = africa }
						}
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1000
			}
			multiply_variable = { which = ai_value value = -1 }
		}
		add_entry = {
			name = FROM_HAS_NO_MERCHANT_IN_OUR_HOME_TRADE_NODE
			limit = {
				capital_scope = {
					NOT = { has_merchant = FROM }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = { which = ai_value value = -1 }
		}
	}

	ai_will_do = {
		NOT = { num_of_subjects = 1 }
		OR = {
			NOT = { has_country_flag = declined_establish_trade_outpost_@FROM }
			had_country_flag = { flag = declined_establish_trade_outpost_@FROM days = 1825 }
		}
		FROM = {
			OR = {
				is_great_power = yes
				total_development = 300
			}
		}
		OR = {
			AND = {
				government = monarchy
				FROM = { government = monarchy }
			}
			AND = {
				government = republic
				FROM = { government = republic }
			}
			AND = {
				government = theocracy
				FROM = { government = theocracy }
			}
		}
		has_opinion = {
			who = FROM
			value = 100
		}
	}
}

improve_trade_outpost = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = trade_outpost
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = trade_outpost
			}
		}
		is_at_war = no
		treasury = 500
		adm_power = 25
		dip_power = 50
		FROM = { is_at_war = no }
		FROM = {
			NOT = { liberty_desire = 75 }
		}
		FROM = {
			custom_trigger_tooltip = {
				tooltip = DID_NOT_IMPROVE_TRADE_OUTPOST_WITHIN_LAST_5_YEARS
				OR = {
					NOT = { has_country_flag = improved_trade_outpost_flag }
					had_country_flag = { flag = improved_trade_outpost_flag days = 1825 }
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = trade_outpost
				}
				is_at_war = no
				treasury = 500
				adm_power = 25
				dip_power = 50
				FROM = { is_at_war = no }
				FROM = {
					NOT = { liberty_desire = 75 }
				}
				FROM = {
					custom_trigger_tooltip = {
						tooltip = DID_NOT_IMPROVE_TRADE_OUTPOST_WITHIN_LAST_5_YEARS
						NOT = { has_country_modifier = improved_trade_outpost_modifier }
					}
				}
			}
			add_treasury = -500
			add_adm_power = -25
			add_dip_power = -50
			FROM = {
				add_liberty_desire = -10
				add_country_modifier = {
					name = improved_trade_outpost_modifier
					duration = 730
				}
				capital_scope = {
					add_base_tax = 2
					add_base_production = 4
					add_trade_modifier = {
						who = ROOT
						power = 10
						key = improved_trade_outpost_trade_modifier
						duration = 730
					}
				}
				clr_country_flag = improved_trade_outpost_flag
				set_country_flag = improved_trade_outpost_flag
			}
		}
	}

	ai_will_do = {
		treasury = 2000
		adm_power = 100
		dip_power = 100
		FROM = {
			NOT = { liberty_desire = 40 }
			capital_scope = {
				has_merchant = ROOT
			}
		}
		NOT = {
			calc_true_if = {
				all_subject_country = {
					is_subject_of_type = trade_outpost
					has_country_modifier = improved_trade_outpost_modifier
				}
				amount = 3
			}
		}
	}
}

end_trade_outpost = {
	category = influence

	require_acceptance = no

	is_visible = {
		is_subject_of = FROM
		is_subject_of_type = trade_outpost
	}

	is_allowed = {
		is_subject_of = FROM
		is_subject_of_type = trade_outpost
		NOT = { truce_with = FROM }
		is_at_war = no
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = trade_outpost
				NOT = { truce_with = FROM }
				is_at_war = no
			}
			FROM = {
				ROOT = { grant_independence = yes }
				country_event = { id = subjects_expanded_trade_outpost_events.4 }
			}
			add_stability = -1
		}
	}

	ai_will_do = {
		liberty_desire = 70
	}
}

cancel_trade_outpost = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = trade_outpost
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = trade_outpost
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = trade_outpost
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}

	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#subjects_expanded_diplomatic_actions_viking_settlement
viking_settlement_demand_raid_loot = {
	category = influence

	require_acceptance = no

	is_visible = {
		can_be_overlord = viking_settlement
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = viking_settlement
		}
	}

	is_allowed = {
		hidden_trigger = {
			can_be_overlord = viking_settlement
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = viking_settlement
				NOT = { has_country_flag = viking_settlement_demanding_raid_loot }
			}
		}
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
		FROM = { years_of_income = 0.5 }
		FROM = { sailors_percentage = 0.1 }
		FROM = {
			has_opinion = {
				who = ROOT
				value = 0
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				can_be_overlord = viking_settlement
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = viking_settlement
					NOT = { has_country_flag = viking_settlement_demanding_raid_loot }
				}
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
				FROM = { years_of_income = 0.5 }
				FROM = { sailors_percentage = 0.1 }
				FROM = {
					has_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
			FROM = {
				country_event = { id = subjects_expanded_viking_settlement_events.4 }
			}
		}
	}

	ai_will_do = {
		NOT = { had_recent_war = 2 }
		OR = {
			AND = {
				NOT = { treasury = 10000 }
				NOT = { years_of_income = 2 }
			}
			NOT = { sailors_percentage = 0.1 }
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 50
			}
			years_of_income = 1
			sailors_percentage = 0.2
			NOT = { liberty_desire = 30 }
		}
	}
}

#subjects_expanded_diplomatic_actions_voivodeship
establish_voivodeship = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		can_create_subject_type = {
			subject = FROM
			subject_type = voivodeship
		}
	}
	
	is_allowed = {
		can_create_subject_type = {
			subject = FROM
			subject_type = voivodeship
		}
		NOT = { truce_with = FROM }
		is_at_war = no
		FROM = { is_at_war = no }
		FROM = { NOT = { liberty_desire = 50 } }
	}
	
	on_accept = {
		if = {
			limit = {
				can_create_subject_type = {
					subject = FROM
					subject_type = voivodeship
				}
				NOT = { truce_with = FROM }
				is_at_war = no
				FROM = { is_at_war = no }
				FROM = { NOT = { liberty_desire = 50 } }
			}
			create_subject = {
				subject = FROM
				subject_type = voivodeship
			}
			if = {
				limit = {
					NOT = {
						OR = {
							culture_group = FROM
							accepted_culture = FROM
							FROM = {
								accepted_culture = ROOT
							}
						}
					}
				}
				add_stability = -1
				add_prestige = -10
			}
		}
	}
	
	ai_will_do = {
		is_emperor = no
		OR = {
			culture_group = FROM
			accepted_culture = FROM
			FROM = {
				accepted_culture = ROOT
			}
		}
		FROM = {
			NOT = {
				years_in_vassalage_under = {
					who = ROOT
					years = 10
					all_subject_country = yes
				}
			}
		}
	}
}

cancel_voivodeship = {
	category = influence

	require_acceptance = no
	
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = voivodeship
		}
	}
	
	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = voivodeship
			}
		}
		NOT = { truce_with = FROM }
		prestige = 0
	}
	
	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_subject_of_type = voivodeship
				}
				NOT = { truce_with = FROM }
				prestige = 0
			}
			FROM = {
				if = {
					limit = {
						NOT = { liberty_desire = 50 }
					}
					add_opinion = {
						who = ROOT
						modifier = vassal_abandoned
					}
				}
				grant_independence = yes
				add_truce_with = ROOT
			}
			add_truce_with = FROM
			add_prestige = -25
		}
	}
	
	ai_will_do = {
		FROM = {
			liberty_desire = 100
			years_in_vassalage_under = {
				who = ROOT
				years = 25
				all_subject_country = yes
			}
		}
	}
}

#zzz_subjects_expanded_diplomatic_actions
disallow_subject_from_annexing_subjects = {
	category = influence

	require_acceptance = no

	is_visible = {
		ai = no
		FROM = {
			is_subject_of = ROOT
			NOT = { is_tributary_or_similar_subject = yes }
			num_of_subjects = 1
			NOT = { has_country_modifier = disallow_subject_from_annexing_subjects_modifier }
		}
	}

	is_allowed = {
		hidden_trigger = {
			ai = no
			FROM = {
				is_subject_of = ROOT
				NOT = { is_tributary_or_similar_subject = yes }
				num_of_subjects = 1
				NOT = { has_country_modifier = disallow_subject_from_annexing_subjects_modifier }
			}
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 50
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				ai = no
				FROM = {
					is_subject_of = ROOT
					NOT = { is_tributary_or_similar_subject = yes }
					num_of_subjects = 1
					NOT = { has_country_modifier = disallow_subject_from_annexing_subjects_modifier }
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 50
					}
				}
			}
			FROM = {
				add_liberty_desire = 20
				add_country_modifier = {
					name = disallow_subject_from_annexing_subjects_modifier
					duration = 7300
				}
				country_event = { id = subjects_expanded_general_events.1 }
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

transfer_vassal_to_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = transfer_vassal_to_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		ai = no
		is_free_or_tributary_trigger = yes
		NOT = { has_country_flag = uses_transfer_vassal_to_subject }
		FROM = {
			is_subject_of = ROOT
			NOT = { is_tributary_or_similar_subject = yes }
			is_subject_type_that_can_have_subjects = yes
		}
		any_subject_country = {
			NOT = { tag = FROM }
			is_neighbor_of = FROM
			OR = {
				is_subject_of_type = vassal
				is_subject_of_type = client_vassal
				is_subject_of_type = march
				is_subject_of_type = client_march
				is_subject_of_type = naval_march
				is_subject_of_type = defensive_march
				is_subject_of_type = agricultural_march
				is_subject_of_type = religious_march
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			ai = no
			is_free_or_tributary_trigger = yes
			NOT = { has_country_flag = uses_transfer_vassal_to_subject }
			FROM = {
				is_subject_of = ROOT
				NOT = { is_tributary_or_similar_subject = yes }
				is_subject_type_that_can_have_subjects = yes
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		any_subject_country = {
			NOT = { tag = FROM }
			is_neighbor_of = FROM
			OR = {
				is_subject_of_type = vassal
				is_subject_of_type = client_vassal
				is_subject_of_type = march
				is_subject_of_type = client_march
				is_subject_of_type = naval_march
				is_subject_of_type = defensive_march
				is_subject_of_type = agricultural_march
				is_subject_of_type = religious_march
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				ai = no
				is_free_or_tributary_trigger = yes
				NOT = { has_country_flag = uses_transfer_vassal_to_subject }
				FROM = {
					is_subject_of = ROOT
					NOT = { is_tributary_or_similar_subject = yes }
					is_subject_type_that_can_have_subjects = yes
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				any_subject_country = {
					NOT = { tag = FROM }
					is_neighbor_of = FROM
					OR = {
						is_subject_of_type = vassal
						is_subject_of_type = client_vassal
						is_subject_of_type = march
						is_subject_of_type = client_march
						is_subject_of_type = naval_march
						is_subject_of_type = defensive_march
						is_subject_of_type = agricultural_march
						is_subject_of_type = religious_march
					}
				}
			}
			FROM = {
				save_event_target_as = transfer_to_subject_target_overlord_target
			}
			set_country_flag = uses_transfer_vassal_to_subject
			country_event = { id = subjects_expanded_general_events.2 }
		}
	}

	on_decline = {
	}

	ai_acceptance = {
		add_entry = {
			name = SE_REASON_BASE_VALUE
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

release_subject_from_subject = {
	category = influence

	alert_index = 6
	alert_tooltip = release_subject_from_subject_alert_tooltip

	require_acceptance = yes

	is_visible = {
		ai = no
		is_free_or_tributary_trigger = yes
		NOT = { has_country_flag = uses_release_subject_from_subject }
		FROM = {
			is_subject_of = ROOT
			NOT = { is_tributary_or_similar_subject = yes }
			is_subject_type_that_can_have_subjects = yes
			any_subject_country = {
				OR = {
					is_subject_of_type = tributary_state
					is_subject_of_type = protectorate
					is_subject_of_type = imperial_tributary_state
					is_subject_of_type = papal_sanctuary_subject
					is_subject_of_type = imperial_feud_subject
					is_subject_of_type = trade_outpost
				}
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			ai = no
			is_free_or_tributary_trigger = yes
			NOT = { has_country_flag = uses_release_subject_from_subject }
			FROM = {
				is_subject_of = ROOT
				NOT = { is_tributary_or_similar_subject = yes }
				is_subject_type_that_can_have_subjects = yes
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		FROM = {
			NOT = { liberty_desire = 50 }
		}
		FROM = {
			any_subject_country = {
				OR = {
					is_subject_of_type = tributary_state
					is_subject_of_type = protectorate
					is_subject_of_type = imperial_tributary_state
					is_subject_of_type = papal_sanctuary_subject
					is_subject_of_type = imperial_feud_subject
					is_subject_of_type = trade_outpost
				}
			}
		}
	}

	on_accept = {
		if = {
			limit = {
				ai = no
				is_free_or_tributary_trigger = yes
				NOT = { has_country_flag = uses_release_subject_from_subject }
				FROM = {
					is_subject_of = ROOT
					NOT = { is_tributary_or_similar_subject = yes }
					is_subject_type_that_can_have_subjects = yes
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
				FROM = {
					NOT = { liberty_desire = 50 }
				}
				FROM = {
					any_subject_country = {
						OR = {
							is_subject_of_type = tributary_state
							is_subject_of_type = protectorate
							is_subject_of_type = imperial_tributary_state
							is_subject_of_type = papal_sanctuary_subject
							is_subject_of_type = imperial_feud_subject
							is_subject_of_type = trade_outpost
						}
					}
				}
			}
			FROM = {
				save_event_target_as = subject_to_force_release_subject_target
			}
			set_country_flag = uses_release_subject_from_subject
			country_event = { id = subjects_expanded_general_events.5 }
		}
	}

	on_decline = {
	}

	ai_acceptance = {
		add_entry = {
			name = SE_REASON_BASE_VALUE
			export_to_variable = {
				which = ai_value
				value = 50
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

return_subject_to_vassal = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			NOT = { 
				is_subject_of_type = daimyo_vassal
			    is_subject_of_type = daimyo_barony_vassal
			    is_subject_of_type = daimyo_viscounty_vassal
			    is_subject_of_type = daimyo_county_vassal
			    is_subject_of_type = daimyo_marquisate_vassal
			    is_subject_of_type = daimyo_duchy_vassal
			    is_subject_of_type = daimyo_principality_vassal
			}
			OR = {
				is_similar_vassal_subject = yes
				AND = {
					is_similar_march_subject = yes
					NOT = { is_different_march_subject = yes }
				}
			}
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				NOT = { 
					is_subject_of_type = daimyo_vassal
					is_subject_of_type = daimyo_barony_vassal
					is_subject_of_type = daimyo_viscounty_vassal
					is_subject_of_type = daimyo_county_vassal
					is_subject_of_type = daimyo_marquisate_vassal
					is_subject_of_type = daimyo_duchy_vassal
					is_subject_of_type = daimyo_principality_vassal
				}
				OR = {
					is_similar_vassal_subject = yes
					AND = {
						is_similar_march_subject = yes
						NOT = { is_different_march_subject = yes }
					}
				}
			}
		}
		prestige = 0
		if = {
			limit = {
				OR = {
					NOT = { religion = nahuatl }
					is_religion_reformed = yes
				}
				FROM = {
					is_subject_of_type = nahuatl_vassal
				}
			}
			FROM = {
				NOT = { liberty_desire = 90 }
			}
		}
		else = {
			FROM = {
				NOT = { liberty_desire = 50 }
			}
		}
		FROM = {
			has_opinion = {
				who = ROOT
				value = 100
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					NOT = { 
				    	is_subject_of_type = daimyo_vassal
				    	is_subject_of_type = daimyo_barony_vassal
				    	is_subject_of_type = daimyo_viscounty_vassal
				    	is_subject_of_type = daimyo_county_vassal
				    	is_subject_of_type = daimyo_marquisate_vassal
				    	is_subject_of_type = daimyo_duchy_vassal
				    	is_subject_of_type = daimyo_principality_vassal
				    }
					OR = {
						is_similar_vassal_subject = yes
						AND = {
							is_similar_march_subject = yes
							NOT = { is_different_march_subject = yes }
						}
					}
				}
				prestige = 0
				if = {
					limit = {
						OR = {
							NOT = { religion = nahuatl }
							is_religion_reformed = yes
						}
						FROM = {
							is_subject_of_type = nahuatl_vassal
						}
					}
					FROM = {
						NOT = { liberty_desire = 90 }
					}
				}
				else = {
					FROM = {
						NOT = { liberty_desire = 50 }
					}
				}
				FROM = {
					has_opinion = {
						who = ROOT
						value = 100
					}
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			FROM = {
				add_opinion = {
					who = ROOT
					modifier = returned_to_vassal
				}
				grant_independence = yes
			}
			vassalize = FROM
			add_prestige = -10
			FROM = {
				add_liberty_desire = 25
			}
		}
	}

	ai_will_do = {
		NOT = { truce_with = FROM }
		OR = {
			AND = {
				OR = {
					is_year = 1700
					current_age = age_of_absolutism
					NOT = { religion = catholic }
				}
				FROM = {
					OR = {
						ROOT = { NOT = { religion = catholic } }
						NOT = { liberty_desire = 33 }
					}
					is_subject_of_type = crusader_state_vassal
				}
			}
			AND = {
				OR = {
					NOT = { religion = nahuatl }
					is_religion_reformed = yes
				}
				FROM = {
					is_subject_of_type = nahuatl_vassal
				}
			}
			AND = {
				europe = {
					type = all
					country_or_non_sovereign_subject_holds = ROOT
				}
				FROM = {
					is_subject_of_type = muslim_tributary_vassal
				}
			}
			FROM = {
				is_subject_of_type = pagan_chiefdom
				OR = {
					AND = {
						liberty_desire = 70
						years_in_vassalage_under = {
							who = ROOT
							years = 5
							all_subject_country = yes
						}
					}
					NOT = {
						any_neighbor_country = {
							is_subject = no
							NOT = { tag = ROOT }
							OR = {
								is_great_power = yes
								total_development = 300
								is_rival = ROOT
								is_enemy = ROOT
							}
						}
					}
				}
			}
			FROM = {
				is_subject_of_type = palatinate_vassal
				is_elector = no
			}
			FROM = {
				is_lesser_in_union = no
				liberty_desire = 100
				years_in_vassalage_under = {
					who = ROOT
					years = 25
					all_subject_country = yes
				}
			}
			FROM = {
				is_lesser_in_union = yes
				liberty_desire = 100
				years_in_vassalage_under = {
					who = ROOT
					years = 60
					all_subject_country = yes
				}
			}
		}
	}
}

make_custom_march_subject_to_march = {
	category = influence

	require_acceptance = no

	is_visible = {
		ai = no
		FROM = {
			is_subject_of = ROOT
			is_different_march_subject = yes
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_different_march_subject = yes
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_different_march_subject = yes
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			FROM = {
				grant_independence = yes
			}
			create_subject = {
				subject = FROM
				subject_type = march
			}
		}
	}

	ai_will_do = {
		always = no
	}
}

revoke_custom_march_subject = {
	category = influence

	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_different_march_subject = yes
		}
	}

	is_allowed = {
		hidden_trigger = {
			FROM = {
				is_subject_of = ROOT
				is_different_march_subject = yes
			}
		}
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}

	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject_of = ROOT
					is_different_march_subject = yes
				}
				is_at_war = no
				FROM = {
					is_at_war = no
				}
			}
			if = {
				limit = {
					NOT = { full_idea_group = diplomatic_ideas }
				}
				add_stability = -1
			}
			FROM = {
				add_opinion = {
					who = ROOT
					modifier = broke_march
				}
				grant_independence = yes
			}
			vassalize = FROM
		}
	}

	ai_will_do = {
		NOT = { truce_with = FROM }
		FROM = {
			OR = {
				development_of_overlord_fraction = 0.3
				num_of_owned_provinces_with = {
					value = 10
					is_permanent_claim = ROOT
				}
				AND = {
					liberty_desire = 100
					years_in_vassalage_under = {
						who = ROOT
						years = 25
						all_subject_country = yes
					}
				}
				NOT = {
					any_neighbor_country = {
						is_subject = no
						NOT = { tag = ROOT }
						OR = {
							is_great_power = yes
							total_development = 300
							is_rival = ROOT
							is_enemy = ROOT
							army_strength = { who = ROOT value = 2.5 }
						}
					}
				}
				AND = {
					is_subject_of_type = religious_march
					religious_unity = 0.95
				}
			}
		}
	}
}